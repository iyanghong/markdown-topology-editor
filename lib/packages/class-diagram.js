/* eslint-disable */
module.exports=function(r){var i={};function n(t){if(i[t])return i[t].exports;var e=i[t]={i:t,l:!1,exports:{}};return r[t].call(e.exports,e,e.exports,n),e.l=!0,e.exports}return n.m=r,n.c=i,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=157)}([function(t,r,e){"use strict";function i(t){for(var e in t)r.hasOwnProperty(e)||(r[e]=t[e])}Object.defineProperty(r,"__esModule",{value:!0}),i(e(198)),i(e(197)),i(e(117))},function(t,e,r){"use strict";var n,i,p=r(0);(Xe=n=n||{})[Xe.Any=-1]="Any",Xe[Xe.CtrlOrAlt=0]="CtrlOrAlt",Xe[Xe.Ctrl=1]="Ctrl",Xe[Xe.Shift=2]="Shift",Xe[Xe.Alt=3]="Alt",Xe[Xe.Right=4]="Right",(nr=i=i||{})[nr.None=-1]="None",nr[nr.Document=0]="Document",nr[nr.Canvas=1]="Canvas";var o=["fontColor","fontFamily","fontSize","lineHeight","textAlign","textBaseline"],s={cacheLen:30,refresh:30,fontColor:"#222222",fontFamily:'"Hiragino Sans GB", "Microsoft YaHei", "Helvetica Neue", Helvetica, Arial',fontSize:12,lineHeight:1.5,textAlign:"center",textBaseline:"middle",color:"#222222",activeColor:"#1890ff",hoverColor:"#fa541c",anchorRadius:4,anchorFillStyle:"#fff",dockStrokeStyle:"#fa541c",dockFillStyle:"#fa541c",dragColor:"#1890ff",rotateCursor:"/assets/img/rotate.cur",hoverCursor:"pointer",minScale:.3,maxScale:5,anchorSize:5,keydown:i.Document,viewPadding:0,gridSize:10,gridColor:"#f3f3f3",ruleColor:"#888888"};function h(){return(4294967296*(1+Math.random())|0).toString(16).substring(1)}var u=(a.prototype.floor=function(){this.x|=0,this.y|=0},a.prototype.round=function(){this.x=Math.round(this.x),this.y=Math.round(this.y)},a.prototype.clone=function(){var t=new a(this.x,this.y,this.direction,this.anchorIndex,this.id,this.hidden,this.autoAnchor);return this.data&&(t.data=this.data),this.mode&&(t.mode=this.mode),t},a.prototype.hit=function(t,e){return t.x>this.x-(e=void 0===e?5:e)&&t.x<this.x+e&&t.y>this.y-e&&t.y<this.y+e},a.prototype.rotate=function(t,e){if(!t||360===t)return this;t*=Math.PI/180;var r=(this.x-e.x)*Math.cos(t)-(this.y-e.y)*Math.sin(t)+e.x,e=(this.x-e.x)*Math.sin(t)+(this.y-e.y)*Math.cos(t)+e.y;return this.x=r,this.y=e,this},a.prototype.isSameAs=function(t){return this.anchorIndex===t.anchorIndex&&this.direction===t.direction&&this.id===t.id},a);function a(t,e,r,i,n,o,s){this.x=t,this.y=e,this.direction=r,this.anchorIndex=i,this.id=n,this.hidden=o,this.autoAnchor=s}function f(t){for(var e={nodes:[],lines:[]},r=0,i=t;r<i.length;r++){var n=i[r];n.type?e.lines.push(n):(e.nodes.push(n),n.children&&(e.nodes.push.apply(e.nodes,f(n.children).nodes),e.lines.push.apply(e.lines,f(n.children).lines)))}return e}function y(e,t){var r=[];return t.forEach(function(t){(t.id===e||-1<t.tags.indexOf(e))&&r.push(t),t.children&&r.push.apply(r,y(e,t.children))}),r}function c(t,e){for(var r=[],i=0;i<e.length;i++)e[i].id===t||-1<e[i].tags.indexOf(t)?(r.push(e[i]),e.splice(i,1),--i):e[i].children&&r.push.apply(r,c(t,e[i].children));return r}function l(t,e){for(var r,i=0,n=t;i<n.length;i++){var o=n[i];if(!o.type&&o.children)for(var s=0,a=o.children;s<a.length;s++){var c=a[s];if(c.id===e.id)return o;if(!c.type&&(c.children&&(r=l(c.children,e))))return r}}return r}function d(t,e){if(e.length<3)return!1;for(var r=!1,i=e[e.length-1],n=0,o=e;n<o.length;n++){var s=o[n];i.y>t.y!=s.y>t.y&&s.x+(t.y-s.y)*(i.x-s.x)/(i.y-s.y)>t.x&&(r=!r),i=s}return r}function g(t,e,r,i){void 0===i&&(i=1);var n=Math.atan2(e.y-r.y,r.x-e.x);i=5<i?i:5;var o=Math.sin(n)*i,i=Math.cos(n)*i;return d(t,[new u(e.x-o,e.y-i),new u(r.x-o,r.y-i),new u(r.x+o,r.y+i),new u(e.x+o,e.y+i)])}function m(t,e){return 0|Math.sqrt(Math.pow(Math.abs(t.x-e.x),2)+Math.pow(Math.abs(t.y-e.y),2))}function v(t,e,r,i){var n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d","M"+t.x+" "+t.y+" C"+e.x+" "+e.y+" "+r.x+" "+r.y+" "+i.x+" "+i.y),0|n.getTotalLength()}window.topologyPoint=u,window.Le5leTopologyPoint=u;var w,b,x=(S.prototype.init=function(){this.ex=this.x+this.width,this.ey=this.y+this.height,this.calcCenter()},S.prototype.floor=function(){this.x|=0,this.y|=0,this.width|=0,this.height|=0,this.init()},S.prototype.round=function(){this.x=Math.round(this.x),this.y=Math.round(this.y),this.width=Math.round(this.width),this.height=Math.round(this.height),this.init()},S.prototype.clone=function(){return new S(this.x,this.y,this.width,this.height)},S.prototype.hit=function(t,e){return void 0===e&&(e=0),t&&t.x>this.x-e&&t.x<this.ex+e&&t.y>this.y-e&&t.y<this.ey+e},S.prototype.hitByRect=function(t){return t.x>this.x&&t.x<this.ex&&t.y>this.y&&t.y<this.ey||t.ex>this.x&&t.ex<this.ex&&t.y>this.y&&t.y<this.ey||t.ex>this.x&&t.ex<this.ex&&t.ey>this.y&&t.ey<this.ey||t.x>this.x&&t.x<this.ex&&t.ey>this.y&&t.ey<this.ey},S.prototype.hitRotate=function(t,e,r){for(var i=this.toPoints(),n=0,o=i;n<o.length;n++)o[n].rotate(e,r);return d(t,i)},S.prototype.calcCenter=function(){this.center.x=this.x+this.width/2,this.center.y=this.y+this.height/2},S.prototype.toPoints=function(){return[new u(this.x,this.y),new u(this.ex,this.y),new u(this.ex,this.ey),new u(this.x,this.ey)]},S.prototype.translate=function(t,e){this.x+=t,this.y+=e,this.ex+=t,this.ey+=e,this.calcCenter()},S.prototype.scale=function(t,e,r){e=e||this.center,void 0===r&&(r=t),this.x=e.x-(e.x-this.x)*t,this.y=e.y-(e.y-this.y)*r,this.width*=t,this.height*=r,this.init()},S);function S(t,e,r,i){this.x=t,this.y=e,this.width=r,this.height=i,this.center=new u(0,0),r<0&&(r=0),i<0&&(i=0),this.init()}window.topologyRect=x,(Xe=w=w||{})[Xe.Click=0]="Click",Xe[Xe.DblClick=1]="DblClick",Xe[Xe.WebSocket=2]="WebSocket",Xe[Xe.Mqtt=3]="Mqtt",Xe[Xe.MoveIn=4]="MoveIn",Xe[Xe.MoveOut=5]="MoveOut",(nr={})[nr.Link=0]="Link",nr[nr.StartAnimate=1]="StartAnimate",nr[nr.Function=2]="Function",nr[nr.WindowFn=3]="WindowFn",nr[nr.SetProps=4]="SetProps",nr[nr.PauseAnimate=5]="PauseAnimate",nr[nr.StopAnimate=6]="StopAnimate",nr[nr.Emit=7]="Emit",(Xe=b=b||{})[Xe.Node=0]="Node",Xe[Xe.Line=1]="Line";var _,k=["link","doStartAnimate","doFn","doWindowFn","","doPauseAnimate","doStopAnimate","doEmit"],I={name:"",tags:[],visible:!0,rect:new x(0,0,0,0),fontColor:"",fontFamily:'"Hiragino Sans GB", "Microsoft YaHei", "Helvetica Neue", Helvetica, Arial',fontSize:12,lineHeight:1.5,fontStyle:"normal",fontWeight:"normal",textAlign:"center",textBaseline:"middle",textBackground:"",animateCycleIndex:0,events:[],dash:0,lineDashOffset:0,lineWidth:1,strokeStyle:"",fillStyle:"",globalAlpha:1,rotate:0,offsetRotate:0,textMaxLine:0,textOffsetX:0,textOffsetY:0,animatePos:0},L={},P=(T.prototype.fromData=function(t,e){for(var r in e?"string"==typeof e&&(e=JSON.parse(e)):e={},I.id=h(),t=Object.assign({},I,t))this[r]=t[r];for(var r in e)this[r]=e[r];Array.isArray(this.tags)&&(this.tags=Object.assign([],this.tags)),this.rect&&(this.rect=new x(this.rect.x,this.rect.y,this.rect.width,this.rect.height)),this.lineWidth=this.lineWidth||1,!this.fontColor&&e.font&&(this.fontColor=e.font.color||this.fontColor,this.fontFamily=e.font.fontFamily||this.fontFamily,this.fontSize=e.font.fontSize||this.fontSize,this.lineHeight=e.font.lineHeight||this.lineHeight,this.fontStyle=e.font.fontStyle||this.fontStyle,this.fontWeight=e.font.fontWeight||this.fontWeight,this.textAlign=e.font.textAlign||this.textAlign,this.textBaseline=e.font.textBaseline||this.textBaseline,this.textBackground=e.font.background||this.textBackground,delete this.font),this.events&&(this.events=JSON.parse(JSON.stringify(this.events))),this.wheres&&(this.wheres=JSON.parse(JSON.stringify(this.wheres))),"object"==typeof this.data&&(this.data=JSON.parse(JSON.stringify(this.data))),delete this.img,delete this.animateStart,delete this.animateReady},T.prototype.render=function(t){if(this.visible)if(!this.from||this.to){if(t.save(),t.setAttrs&&t.setAttrs(this),(this.rotate||this.offsetRotate)&&(t.translate(this.rect.center.x,this.rect.center.y),t.rotate((this.rotate+this.offsetRotate)*Math.PI/180),t.translate(-this.rect.center.x,-this.rect.center.y)),1<this.lineWidth&&(t.lineWidth=this.lineWidth),this.strokeImage?this.strokeImage===this.lastStrokeImage&&this.strokeImg?t.strokeStyle=t.createPattern(this.strokeImg,"repeat"):this.loadStrokeImg():t.strokeStyle=this.strokeStyle||p.Store.get(this.generateStoreKey("LT:color")),this.fillImage?this.fillImage===this.lastFillImage&&this.fillImg?t.fillStyle=t.createPattern(this.fillImg,"repeat"):this.loadFillImg():this.fillStyle&&(t.fillStyle=this.fillStyle),this.lineCap?t.lineCap=this.lineCap:this.type===b.Line&&(t.lineCap="round"),this.globalAlpha<1&&(t.globalAlpha=this.globalAlpha),this.lineDash)t.setLineDash(this.lineDash);else switch(this.dash){case 1:t.setLineDash([5,5]);break;case 2:t.setLineDash([10,10]);break;case 3:t.setLineDash([10,10,2,10])}if(this.lineDashOffset&&(t.lineDashOffset=this.lineDashOffset),this.shadowColor&&(t.shadowColor=this.shadowColor,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowBlur=this.shadowBlur),this.draw(t),t.restore(),this.children)for(var e=0,r=this.children;e<r.length;e++)r[e].render(t)}else if(this.children)for(var i=0,n=this.children;i<n.length;i++)n[i].render(t)},T.prototype.loadFillImg=function(){var t,e=this;this.fillImage&&((t=new Image).crossOrigin="anonymous",t.src=this.fillImage,t.onload=function(){e.lastFillImage=e.fillImage,e.fillImg=t,L[e.fillImage]={img:t},p.Store.set(e.generateStoreKey("LT:imageLoaded"),!0)})},T.prototype.loadStrokeImg=function(){var t,e=this;this.strokeImage&&((t=new Image).crossOrigin="anonymous",t.src=this.strokeImage,t.onload=function(){e.lastStrokeImage=e.strokeImage,e.strokeImg=t,L[e.strokeImage]={img:t},p.Store.set(e.generateStoreKey("LT:imageLoaded"),!0)})},T.prototype.click=function(){if(this.events)for(var t=0,e=this.events;t<e.length;t++){var r=e[t];r.type===w.Click&&this[k[r.action]]&&this[k[r.action]](r.value,r.params)}},T.prototype.dblclick=function(){if(this.events)for(var t=0,e=this.events;t<e.length;t++){var r=e[t];r.type===w.DblClick&&this[k[r.action]]&&this[k[r.action]](r.value,r.params)}},T.prototype.moveIn=function(){if(this.events)for(var t=0,e=this.events;t<e.length;t++){var r=e[t];r.type===w.MoveIn&&this[k[r.action]]&&this[k[r.action]](r.value,r.params)}},T.prototype.moveOut=function(){if(this.events)for(var t=0,e=this.events;t<e.length;t++){var r=e[t];r.type===w.MoveOut&&this[k[r.action]]&&this[k[r.action]](r.value,r.params)}},T.prototype.doWheres=function(){var e=this;this.wheres&&this.wheres.forEach(function(t){t.fn.trim()?new Function("pen",t.fn)(e)&&t.actions&&t.actions.forEach(function(t){e.doAction(t)}):new Function("attr","return attr "+t.comparison+" "+t.value)(e[t.key])&&t.actions&&t.actions.forEach(function(t){e.doAction(t)})})},T.prototype.doAction=function(t){switch(t.do||t.action){case 0:case"Link":this.link(t.url||t.value,t._blank||t.params);break;case 1:case"StartAnimate":this.doStartAnimate(t.tag||t.value);break;case 5:case"PauseAnimate":this.doPauseAnimate(t.tag||t.value);break;case 6:case"StopAnimate":this.doStopAnimate(t.tag||t.value);break;case 2:case"Function":this.doFn(t.fn||t.value,t.params);break;case 3:case"WindowFn":this.doWindowFn(t.fn||t.value,t.params);break;case 7:case"Emit":this.doEmit(t.fn||t.value,t.params)}},T.prototype.show=function(){return this.visible=!0,this},T.prototype.hide=function(){return this.visible=!1,this},T.prototype.isVisible=function(){return this.visible},T.prototype.getTID=function(){return this.TID},T.prototype.setTID=function(t){if(this.TID=t,this.children)for(var e=0,r=this.children;e<r.length;e++)r[e].setTID(t);return this},T.prototype.startAnimate=function(){this.animateStart=Date.now(),this.type!==b.Node||this.animateReady||this.initAnimate(),p.Store.set(this.generateStoreKey("LT:AnimatePlay"),{pen:this}),2===this.playType&&this.play()},T.prototype.play=function(t){p.Store.set(this.generateStoreKey("LT:play"),{pen:this,pause:t})},T.prototype.link=function(t,e){window.open(t,void 0===e?"_blank":e)},T.prototype.doStartAnimate=function(t,e){t?p.Store.set(this.generateStoreKey("LT:AnimatePlay"),{tag:t}):this.startAnimate()},T.prototype.doPauseAnimate=function(t,e){t?p.Store.set(this.generateStoreKey("LT:AnimatePlay"),{tag:t,stop:!0}):this.pauseAnimate()},T.prototype.doStopAnimate=function(t,e){t?p.Store.set(this.generateStoreKey("LT:AnimatePlay"),{tag:t,stop:!0}):this.stopAnimate()},T.prototype.doFn=function(t,e){new Function("pen","params",t)(this,e)},T.prototype.doWindowFn=function(t,e){window[t](this,e)},T.prototype.doEmit=function(t,e){p.Store.set(this.generateStoreKey("LT:emit"),{event:t,params:e,pen:this})},T.prototype.generateStoreKey=function(t){return this.TID+"-"+t},T);function T(){}function C(t,e){var r=e.borderRadius,i=e.borderRadius;e.borderRadius<1&&(r=e.rect.width*e.borderRadius,i=e.rect.height*e.borderRadius);i=r<i?r:i;e.rect.width<2*i&&(i=e.rect.width/2),e.rect.height<2*i&&(i=e.rect.height/2),t.beginPath(),t.moveTo(e.rect.x+i,e.rect.y),t.arcTo(e.rect.x+e.rect.width,e.rect.y,e.rect.x+e.rect.width,e.rect.y+e.rect.height,i),t.arcTo(e.rect.x+e.rect.width,e.rect.y+e.rect.height,e.rect.x,e.rect.y+e.rect.height,i),t.arcTo(e.rect.x,e.rect.y+e.rect.height,e.rect.x,e.rect.y,i),t.arcTo(e.rect.x,e.rect.y,e.rect.x+e.rect.width,e.rect.y,i),t.closePath(),(e.fillStyle||e.bkType)&&t.fill(),t.stroke()}function R(t,e){t.beginPath(),t.ellipse(e.rect.x+e.rect.width/2,e.rect.y+e.rect.height/2,e.rect.width/2,e.rect.height/2,0,0,2*Math.PI),(e.fillStyle||e.bkType)&&t.fill(),t.stroke()}function A(t,e){t.beginPath(),t.moveTo(e.rect.x+e.rect.width/2,e.rect.y),t.lineTo(e.rect.x+e.rect.width,e.rect.y+e.rect.height),t.lineTo(e.rect.x,e.rect.y+e.rect.height),t.closePath(),(e.fillStyle||e.bkType)&&t.fill(),t.stroke()}function E(t,e){t.beginPath(),t.moveTo(e.rect.x+e.rect.width/2,e.rect.y),t.lineTo(e.rect.x+e.rect.width,e.rect.y+e.rect.height/2),t.lineTo(e.rect.x+e.rect.width/2,e.rect.y+e.rect.height),t.lineTo(e.rect.x,e.rect.y+e.rect.height/2),t.closePath(),(e.fillStyle||e.bkType)&&t.fill(),t.stroke()}function N(t,e){t.beginPath(),t.moveTo(e.rect.x,e.rect.y+e.rect.height/2),t.lineTo(e.rect.x+e.rect.height/2,e.rect.y),t.lineTo(e.rect.x+e.rect.height/2,e.rect.y+e.rect.height/3),t.lineTo(e.rect.x+e.rect.width,e.rect.y+e.rect.height/3),t.lineTo(e.rect.x+e.rect.width,e.rect.y+2*e.rect.height/3),t.lineTo(e.rect.x+e.rect.height/2,e.rect.y+2*e.rect.height/3),t.lineTo(e.rect.x+e.rect.height/2,e.rect.y+2*e.rect.height/3),t.lineTo(e.rect.x+e.rect.height/2,e.rect.y+e.rect.height),t.closePath(),(e.fillStyle||e.bkType)&&t.fill(),t.stroke()}function M(t,e){t.beginPath(),t.moveTo(e.rect.x,e.rect.y+e.rect.height/3),t.lineTo(e.rect.x+(e.rect.width-e.rect.height/2),e.rect.y+e.rect.height/3),t.lineTo(e.rect.x+(e.rect.width-e.rect.height/2),e.rect.y),t.lineTo(e.rect.x+e.rect.width,e.rect.y+e.rect.height/2),t.lineTo(e.rect.x+(e.rect.width-e.rect.height/2),e.rect.y+e.rect.height),t.lineTo(e.rect.x+(e.rect.width-e.rect.height/2),e.rect.y+2*e.rect.height/3),t.lineTo(e.rect.x,e.rect.y+2*e.rect.height/3),t.closePath(),(e.fillStyle||e.bkType)&&t.fill(),t.stroke()}function O(t,e){t.beginPath(),t.moveTo(e.rect.x,e.rect.y+e.rect.height/2),t.lineTo(e.rect.x+e.rect.height/2,e.rect.y),t.lineTo(e.rect.x+e.rect.height/2,e.rect.y+e.rect.height/3),t.lineTo(e.rect.x+(e.rect.width-e.rect.height/2),e.rect.y+e.rect.height/3),t.lineTo(e.rect.x+(e.rect.width-e.rect.height/2),e.rect.y),t.lineTo(e.rect.x+e.rect.width,e.rect.y+e.rect.height/2),t.lineTo(e.rect.x+(e.rect.width-e.rect.height/2),e.rect.y+e.rect.height),t.lineTo(e.rect.x+(e.rect.width-e.rect.height/2),e.rect.y+2*e.rect.height/3),t.lineTo(e.rect.x+e.rect.height/2,e.rect.y+2*e.rect.height/3),t.lineTo(e.rect.x+e.rect.height/2,e.rect.y+e.rect.height),t.closePath(),(e.fillStyle||e.bkType)&&t.fill(),t.stroke()}function B(t,e){var r=[];switch(e.whiteSpace){case"nowrap":r.push(e.text);break;case"pre-line":r=e.text.split(/[\n]/g);break;default:for(var i=e.getTextRect(),n=e.text.split(/[\n]/g),o=0;o<n.length;++o){var s=function(t,e,r){for(var i=[],n=t[0]||"",o=1;o<t.length;++o){var s=t[o]||"",a=n+s,c=(a.match(/[\u4e00-\u9fa5]/g)||"").length;(a.length-c)*r*.5+c*r<e?n+=s:(i.push(n),n=s)}return i.push(n),i}(function(t){var e=[],r="";t=t||"";for(var i=0;i<t.length;++i){var n=t.charCodeAt(i);n<33||126<n?(r&&(e.push(r),r=""),e.push(t[i])):r+=t[i]}return r&&e.push(r),e}(n[o]),i.width,e.fontSize);r.push.apply(r,s)}}return r}function D(t,e){for(var r=B(0,e),i=0,n=0,o=r;n<o.length;n++){var s=o[n];t.font=(e.fontStyle||"normal")+" normal "+(e.fontWeight||"normal")+" "+e.fontSize+"px/"+e.lineHeight+" "+e.fontFamily;s=t.measureText(s).width;i<s&&(i=s)}return{width:i,height:r.length*e.fontSize*e.lineHeight}}function F(t,e,r,i,n,o){if(e&&o){var s=t.measureText(e).width;t.save(),t.fillStyle=o;var a=r-s/2,c=i-n/2;switch(t.textAlign){case"left":a=r;break;case"right":a=r-s}switch(t.textBaseline){case"top":c=i;break;case"bottom":c=i-n}t.fillRect(a,c,s,n),t.restore()}}function j(t,e){if(e.text){e.text.split||(e.text+=""),t.save(),t.beginPath(),delete t.shadowColor,delete t.shadowBlur,t.font=(e.fontStyle||"normal")+" normal "+(e.fontWeight||"normal")+" "+e.fontSize+"px/"+e.lineHeight+" "+e.fontFamily,e.fontColor?t.fillStyle=e.fontColor:t.fillStyle=p.Store.get(e.generateStoreKey("LT:fontColor")),e.textAlign&&(t.textAlign=e.textAlign),e.textBaseline&&(t.textBaseline=e.textBaseline);var r=e.getTextRect(),i=B(0,e),n=e.fontSize*e.lineHeight,o=0<e.textMaxLine&&e.textMaxLine<i.length?e.textMaxLine:i.length,s=r.x+r.width/2,a=r.y+(r.height-n*o)/2+4*n/7;switch(t.textAlign){case"left":s=r.x;break;case"right":s=r.x+r.width}switch(t.textBaseline){case"top":a=r.y+(n-e.fontSize)/2;break;case"bottom":a=r.ey-n*i.length+n}!function(t,e,r,i,n,o,s,a){s=!s||s>e.length?e.length:Math.ceil(s);for(var c,h=0;h<s-1;++h)a&&F(t,e[h],r,i+h*o,o,a),t.fillText(e[h],r,i+h*o);s<e.length?(c=(e[s-1]||"")+"...",e[s-1]&&t.measureText(c).width>n&&(c=e[s-1].substr(0,e[s-1].length-2)+"..."),a&&F(t,c,r,i+(s-1)*o,o,a),t.fillText(c,r,i+(s-1)*o)):(a&&F(t,e[s-1],r,i+(s-1)*o,o,a),t.fillText(e[s-1],r,i+(s-1)*o))}(t,i,s+e.textOffsetX,a+e.textOffsetY,r.width,(r.height,n),o,e.textBackground),t.restore()}}function U(t,e){t.save(),t.textAlign="center",t.textBaseline="middle";var r=e.getIconRect(),i=r.x+r.width/2,n=r.y+r.height/2;switch(e.imageAlign){case"top":n=r.y,t.textBaseline="top";break;case"bottom":n=r.ey,t.textBaseline="bottom";break;case"left":i=r.x,t.textAlign="left";break;case"right":i=r.ex,t.textAlign="right";break;case"left-top":i=r.x,n=r.y,t.textAlign="left",t.textBaseline="top";break;case"right-top":i=r.ex,n=r.y,t.textAlign="right",t.textBaseline="top";break;case"left-bottom":i=r.x,n=r.ey,t.textAlign="left",t.textBaseline="bottom";break;case"right-bottom":i=r.ex,n=r.ey,t.textAlign="right",t.textBaseline="bottom"}0<e.iconSize?t.font=e.iconSize+"px "+e.iconFamily:r.width>r.height?t.font=r.height+"px "+e.iconFamily:t.font=r.width+"px "+e.iconFamily,t.fillStyle=e.iconColor||p.Store.get(e.generateStoreKey("LT:iconColor"))||e.fontColor,e.iconRotate&&(t.translate(r.center.x,r.center.y),t.rotate(e.iconRotate*Math.PI/180),t.translate(-r.center.x,-r.center.y)),t.beginPath(),t.fillText(e.icon,i,n),t.restore()}function K(t,e){t.beginPath();var r=e.rect.y+e.rect.height/2;t.moveTo(e.rect.x,r),t.lineTo(e.rect.x+e.rect.width,r),t.stroke()}function W(t){t.anchors.push(new u(t.rect.x+t.rect.width/2,t.rect.y,_.Up)),t.anchors.push(new u(t.rect.x+3*t.rect.width/4,t.rect.y+t.rect.height/2,_.Right)),t.anchors.push(new u(t.rect.x+t.rect.width/2,t.rect.y+t.rect.height,_.Bottom)),t.anchors.push(new u(t.rect.x+t.rect.width/4,t.rect.y+t.rect.height/2,_.Left))}function q(t){t.anchors.push(new u(t.rect.x,t.rect.y+t.rect.height/2,_.Left)),t.anchors.push(new u(t.rect.x+t.rect.width,t.rect.y+t.rect.height/2,_.Right))}function z(t){var e=t.rect.y+t.rect.height/2;t.anchors.push(new u(t.rect.x,e,_.Left)),t.anchors.push(new u(t.rect.x+t.rect.width,e,_.Right));for(var r=t.rect.x+5;r<t.rect.ex;r+=5){var i=new u(r,e,_.Bottom);i.hidden=!0,t.anchors.push(i)}}function H(t){var e=t.rect.width/2,r=t.rect.height/2;r<e?e=r:r=e;var i=t.rect.height/10;t.iconRect=new x(t.rect.x+(t.rect.width-e)/2,t.rect.y+(i=i<10?10:i),e,r)}function V(t){var e=t.rect.height/20;t.textRect=new x(t.rect.x+t.rect.width/4,t.rect.y+2*t.rect.height/3-(e=e<5?0:e),t.rect.width/2,t.rect.height/3-5);var r=5*t.rect.width/7,e=5*t.rect.height/7;t.fullTextRect=new x(t.rect.x+(t.rect.width-r)/2,t.rect.y+(t.rect.height-e)/2,r,e)}function Y(t){var e=2*t.rect.width/7,r=2*t.rect.height/7;r<e?e=r:r=e;var i=e;t.iconRect=new x(t.rect.x+(t.rect.width-e)/2,t.rect.y+(i=i<10?10:i),e,r)}function X(t){t.textRect=new x(t.rect.x+t.rect.width/4,t.rect.y+2*t.rect.height/3,t.rect.width/2,t.rect.height/3-5);var e=t.rect.width/2,r=3*t.rect.height/7;t.fullTextRect=new x(t.rect.x+(t.rect.width-e)/2,t.rect.y+t.rect.height/2-5,e,r)}function G(t){var e=t.rect.width/3,r=t.rect.height/3;r<e?e=r:r=e;var i=t.rect.width/5;t.iconRect=new x(t.rect.x+(t.rect.width-e)/2,t.rect.y+(i=i<10?10:i),e,r)}function Q(t){var e=t.rect.height/10;t.textRect=new x(t.rect.x+t.rect.width/3,t.rect.y+2*t.rect.height/3-(e=e<5?0:e),t.rect.width/3,t.rect.height/3-5);var r=t.rect.width/2,e=+t.rect.height/2;t.fullTextRect=new x(t.rect.x+(t.rect.width-r)/2,t.rect.y+t.rect.height/4,r,e)}function $(t){t.iconRect=new x(0,0,0,0)}function J(t){t.textRect=new x(t.rect.x+t.rect.height/2,t.rect.y+t.rect.height/3,t.rect.width-t.rect.height/2,t.rect.height/3),t.fullTextRect=t.textRect}function Z(t){t.iconRect=new x(0,0,0,0)}function tt(t){t.textRect=new x(t.rect.x,t.rect.y+t.rect.height/3,t.rect.width-t.rect.height/2,t.rect.height/3),t.fullTextRect=t.textRect}function et(t){t.iconRect=new x(0,0,0,0)}function rt(t){t.textRect=new x(t.rect.x+t.rect.height/2,t.rect.y+t.rect.height/3,t.rect.width-t.rect.height,t.rect.height/3),t.fullTextRect=t.textRect}function it(t){t.iconRect=new x(0,0,0,0)}function nt(t){t.fullTextRect=new x(t.rect.x+10,t.rect.y+t.rect.height/2-20,t.rect.width-20,20),t.textRect=t.fullTextRect}function ot(t,e){t.beginPath(),t.moveTo(e.from.x,e.from.y),t.lineTo(e.to.x,e.to.y),t.stroke()}function st(t,e){}function at(t){t.controlPoints=[]}(nr=_=_||{})[nr.None=0]="None",nr[nr.Up=1]="Up",nr[nr.Right=2]="Right",nr[nr.Bottom=3]="Bottom",nr[nr.Left=4]="Left";var ct=50;function ht(t,e){t.beginPath(),t.moveTo(e.from.x,e.from.y);for(var r=0,i=e.controlPoints;r<i.length;r++){var n=i[r];t.lineTo(n.x,n.y)}t.lineTo(e.to.x,e.to.y),t.stroke()}function lt(t,e){t.save(),t.fillStyle="#fff",t.lineWidth=2;for(var r=0,i=e.controlPoints;r<i.length;r++){var n=i[r];t.beginPath(),t.arc(n.x,n.y,4,0,2*Math.PI),t.stroke(),t.fill()}t.restore()}function ut(t){t.controlPoints=[];var e=ft(t.from,t.to);t.from.direction&&t.controlPoints.push(e);var r,i=ft(t.to,t.from);switch(e.direction){case _.Up:r=function(t,e){if(t.x===e.x||t.y===e.y)return[];{if(t.y>e.y)return e.direction===_.Up&&t.y-e.y>3*ct?t.x<e.x?e.x-t.x<ct?[new u(t.x-2*ct,t.y),new u(t.x-2*ct,e.y)]:[new u(t.x,e.y)]:t.x-e.x<ct?[new u(t.x+2*ct,t.y),new u(t.x+2*ct,e.y)]:[new u(t.x,e.y)]:e.direction===_.Left&&t.x>e.x||e.direction===_.Right&&t.x<e.x?[new u(e.x,t.y)]:[new u(t.x,e.y)];if(e.direction!==_.Bottom)return[new u(e.x,t.y)];if(t.x<e.x)return yt(t,e);t=yt(e,t);return[t[1],t[0]]}}(e,i);break;case _.Right:r=function(t,e){if(t.x===e.x||t.y===e.y)return[];{if(t.x<e.x)return e.direction===_.Right&&e.x-t.x>3*ct?t.y<e.y?e.y-t.y<ct?[new u(t.x,t.y-2*ct),new u(e.x,t.y-2*ct)]:[new u(e.x,t.y)]:t.y-e.y<ct?[new u(t.x,t.y+2*ct),new u(e.x,t.y+2*ct)]:[new u(e.x,t.y)]:e.direction===_.Right||e.direction===_.Up&&t.y<e.y||e.direction===_.Bottom&&t.y>e.y?[new u(e.x,t.y)]:[new u(t.x,e.y)];if(e.direction!==_.Left)return[new u(t.x,e.y)];if(t.y<e.y)return gt(t,e);t=gt(e,t);return[t[1],t[0]]}}(e,i);break;case _.Bottom:r=function(t,e){if(t.x===e.x||t.y===e.y)return[];{if(t.y<e.y)return e.direction===_.Bottom&&e.y-t.y>3*ct?t.x<e.x?e.x-t.x<ct?[new u(t.x-2*ct,t.y),new u(t.x-2*ct,e.y)]:[new u(t.x,e.y)]:t.x-e.x<ct?[new u(t.x+2*ct,t.y),new u(t.x+2*ct,e.y)]:[new u(t.x,e.y)]:e.direction===_.Left&&t.x>e.x||e.direction===_.Right&&t.x<e.x?[new u(e.x,t.y)]:[new u(t.x,e.y)];if(e.direction!==_.Up)return[new u(e.x,t.y)];if(t.x<e.x)return yt(t,e);t=yt(e,t);return[t[1],t[0]]}}(e,i);break;case _.Left:r=function(t,e){if(t.x===e.x||t.y===e.y)return[];{if(t.x>e.x)return e.direction===_.Left&&t.x-e.x>3*ct?t.y<e.y?e.y-t.y<ct?[new u(t.x,t.y+2*ct),new u(e.x,t.y+2*ct)]:[new u(e.x,t.y)]:t.y-e.y<ct?[new u(t.x,t.y-2*ct),new u(e.x,t.y-2*ct)]:[new u(e.x,t.y)]:e.direction===_.Left||e.direction===_.Up&&t.y<e.y||e.direction===_.Bottom&&t.y>e.y?[new u(e.x,t.y)]:[new u(t.x,e.y)];if(e.direction!==_.Right)return[new u(t.x,e.y)];if(t.y<e.y)return gt(t,e);t=gt(e,t);return[t[1],t[0]]}}(e,i)}t.controlPoints.push.apply(t.controlPoints,r),t.to.direction&&t.controlPoints.push(i)}function dt(t,e){if(!e.controlPoints||!e.controlPoints.length)return g(t,e.from,e.to,e.lineWidth/2);if(g(t,e.from,e.controlPoints[0]))return!0;if(g(t,e.to,e.controlPoints[e.controlPoints.length-1]))return!0;for(var r=0;r<e.controlPoints.length-1;++r)if(g(t,e.controlPoints[r],e.controlPoints[r+1]))return!0;return!1}function pt(t,e){var r=[e.from];r.push.apply(r,e.controlPoints),r.push(e.to);for(var i=0,n=r;i<n.length;i++){var o=n[i];Math.abs(t.x-o.x)<7&&(t.x=o.x),Math.abs(t.y-o.y)<7&&(t.y=o.y)}}function ft(t,e){var r=t.clone();switch(t.direction){case _.Up:e.y<t.y?r.y-=Math.round((t.y-e.y)/2):r.y-=ct;break;case _.Right:e.x>t.x?r.x+=Math.round((e.x-t.x)/2):r.x+=ct;break;case _.Bottom:e.y>t.y?r.y+=Math.round((e.y-t.y)/2):r.y+=ct;break;case _.Left:e.x<t.x?r.x-=Math.round((t.x-e.x)/2):r.x-=ct}return r}function yt(t,e){var r=t.x+(e.x-t.x)/2;return[new u(r,t.y),new u(r,e.y)]}function gt(t,e){var r=t.y+(e.y-t.y)/2;return[new u(t.x,r),new u(e.x,r)]}function mt(t){var e=parseInt,r=Math.round,i={};if(9<(n=t.length)){var n,o=t=t.split(","),s=o[0],a=o[1],c=o[2],o=o[3];if((n=t.length)<3||4<n)return null;i.r=e("a"==s[3]?s.slice(5):s.slice(4)),i.g=e(a),i.b=e(c),i.a=o?parseFloat(o):-1}else{if(8==n||6==n||n<4)return null;t=e((t=n<6?"#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+(4<n?t[4]+t[4]:""):t).slice(1),16),9==n||5==n?(i.r=t>>24&255,i.g=t>>16&255,i.b=t>>8&255,i.a=r((255&t)/.255)/1e3):(i.r=t>>16,i.g=t>>8&255,i.b=255&t,i.a=-1)}return i}function vt(t,e,r,i){var n,o,s,a,c=Math.round,h="string"==typeof r;return"number"!=typeof t||t<-1||1<t||"string"!=typeof e||"r"!=e[0]&&"#"!=e[0]||r&&!h?null:(a=9<e.length,a=h?9<r.length||"c"==r&&!a:a,s=mt(e),e=t<0,r=r&&"c"!=r?mt(r):e?{r:0,g:0,b:0,a:-1}:{r:255,g:255,b:255,a:-1},e=1-(t=e?-1*t:t),s&&r?(i=i?(n=c(e*s.r+t*r.r),o=c(e*s.g+t*r.g),c(e*s.b+t*r.b)):(n=c(Math.pow(e*Math.pow(s.r,2)+t*Math.pow(r.r,2),.5)),o=c(Math.pow(e*Math.pow(s.g,2)+t*Math.pow(r.g,2),.5)),c(Math.pow(e*Math.pow(s.b,2)+t*Math.pow(r.b,2),.5))),h=s.a,r=r.a,h=(s=0<=h||0<=r)?h<0?r:r<0?h:h*e+r*t:0,a?"rgb"+(s?"a(":"(")+n+","+o+","+i+(s?","+c(1e3*h)/1e3:"")+")":"#"+(4294967296+16777216*n+65536*o+256*i+(s?c(255*h):0)).toString(16).slice(1,s?void 0:-2)):null)}function wt(t,e){e=mt(e)||{r:0,g:0,b:0};return e.a<0?"rgba("+e.r+","+e.g+","+e.b+","+t+")":"rgba("+e.r+","+e.g+","+e.b+","+(t+e.a)+")"}function bt(t,e){return+e||(e&&"%"===e[e.length-1]?t*+(e=e.substr(0,e.length-1))/100:0)}function xt(t,e){var r=t.x-e.x,e=t.y-e.y;return Math.sqrt(r*r+e*e)}var St=80;function _t(t,e){t.beginPath(),t.moveTo(e.from.x,e.from.y),t.bezierCurveTo(e.controlPoints[0].x,e.controlPoints[0].y,e.controlPoints[1].x,e.controlPoints[1].y,e.to.x,e.to.y),t.stroke()}function kt(t,e){t.save(),t.fillStyle=wt(.5,t.strokeStyle+""),t.lineWidth=1,t.beginPath(),t.moveTo(e.from.x,e.from.y),t.lineTo(e.controlPoints[0].x,e.controlPoints[0].y),t.stroke(),t.beginPath(),t.moveTo(e.to.x,e.to.y),t.lineTo(e.controlPoints[1].x,e.controlPoints[1].y),t.stroke(),t.fillStyle="#fff",t.lineWidth=2;for(var r=0,i=e.controlPoints;r<i.length;r++){var n=i[r];t.beginPath(),t.arc(n.x,n.y,4,0,2*Math.PI),t.stroke(),t.fill()}t.restore()}function It(t){t.from.direction||(t.from.direction=_.Bottom),t.to.direction||(t.to.direction=(t.from.direction+2)%4,t.to.direction||(t.to.direction=_.Left)),t.controlPoints=[Tt(t.from,t.to),Tt(t.to,t.from)],p.Store.set(Ct(t,"pts-")+t.id,void 0)}function Lt(t,e){var r=p.Store.get(Ct(e,"pts-")+e.id);if(!r){if(r=[e.from],e.controlPoints)for(var i=.01;i<1;i+=.01)r.push(Pt(i,e.from,e.controlPoints[0],e.controlPoints[1],e.to));r.push(e.to),p.Store.set(Ct(e,"pts-")+e.id,r)}for(var n=r.length-1,i=0;i<n;++i)if(g(t,r[i],r[i+1]))return!0;return!1}function Pt(t,e,r,i,n){var o=e.x,s=e.y,a=n.x,c=n.y,e=r.x,n=r.y,r=i.x,i=i.y;return new u(o*(1-t)*(1-t)*(1-t)+3*e*t*(1-t)*(1-t)+3*r*t*t*(1-t)+a*t*t*t,s*(1-t)*(1-t)*(1-t)+3*n*t*(1-t)*(1-t)+3*i*t*t*(1-t)+c*t*t*t)}function Tt(t,e){var r=new u(t.x,t.y,t.direction,t.anchorIndex,t.id),i=window.topologyControlPtDistance||St;if((t.direction===_.Up||t.direction===_.Bottom)&&Math.abs(t.x-e.x)<3)return e.y>t.y?(i=Math.round((e.y-t.y)/3),r.y+=i):(i=Math.round((t.y-e.y)/3),r.y-=i),r;if((t.direction===_.Left||t.direction===_.Right)&&Math.abs(t.y-e.y)<3)return e.x>t.x?(i=Math.round((e.x-t.x)/3),r.x+=i):(i=Math.round((t.x-e.x)/3),r.x-=i),r;switch(t.direction){case _.Up:r.y-=i;break;case _.Right:r.x+=i;break;case _.Bottom:r.y+=i;break;case _.Left:r.x-=i}return r}function Ct(t,e){return t.getTID()+"-"+e}var Rt=20;function At(t){switch(t.from.direction||(t.from.direction=_.Bottom),t.to.direction||(t.to.direction=(t.from.direction+2)%4,t.to.direction||(t.to.direction=_.Left)),t.from.direction){case _.Up:t.controlPoints=[new u(t.from.x,t.from.y-Rt),new u(t.from.x,t.to.y)];break;case _.Right:t.controlPoints=[new u(t.from.x+Rt,t.from.y),new u(t.from.x,t.to.y)];break;case _.Bottom:t.controlPoints=[new u(t.from.x,t.from.y+Rt),new u(t.from.x,t.to.y)];break;case _.Left:t.controlPoints=[new u(t.from.x-Rt,t.from.y),new u(t.from.x,t.to.y)]}p.Store.set(Ct(t,"pts-")+t.id,void 0)}function Et(t,e,r,i,n){i+=3*t.lineWidth;var o=t.lineWidth/10;t.lineWidth<2&&(t.lineWidth=2,o=0),t.translate(r.x,r.y),t.rotate(Math.atan2(r.y-e.y,r.x-e.x)),t.translate(-r.x-t.lineWidth+5*o,-r.y),t.moveTo(r.x,r.y+o),t.lineTo(r.x,r.y-o),t.lineTo(r.x-i,r.y-i/3),t.lineTo(r.x-i,r.y+i/3),t.closePath(),t.stroke(),t.fillStyle=n||t.strokeStyle,t.fill()}function Nt(t,e,r,i){Et(t,e,r,i,p.Store.get("LT:bkColor")||"#fff")}function Mt(t,e,r,i,n){var o=(i+=3*t.lineWidth)/2,s=t.lineWidth/10;t.lineWidth<2&&(t.lineWidth=2,s=0),t.translate(r.x,r.y),t.rotate(Math.atan2(r.y-e.y,r.x-e.x)),t.translate(-r.x-t.lineWidth+5*s,-r.y),t.moveTo(r.x,r.y+s),t.lineTo(r.x,r.y-s),t.lineTo(r.x-o,r.y-o/2),t.lineTo(r.x-i,r.y-s),t.lineTo(r.x-i,r.y+s),t.lineTo(r.x-o,r.y+o/2),t.closePath(),t.stroke(),t.fillStyle=n||t.strokeStyle,t.fill()}function Ot(t,e,r,i){Mt(t,e,r,i,p.Store.get("LT:bkColor")||"#fff")}function Bt(t,e,r,i,n){i=(i+=3*t.lineWidth)/2;t.lineWidth<2&&(t.lineWidth=2),t.translate(r.x,r.y),t.rotate(Math.atan2(r.y-e.y,r.x-e.x)),t.translate(-r.x,-r.y-t.lineWidth/10),t.arc(r.x-i-t.lineWidth/2,r.y,i,0,2*Math.PI),t.stroke(),t.fillStyle=n||t.strokeStyle,t.fill()}function Dt(t,e,r,i){Bt(t,e,r,i,p.Store.get("LT:bkColor")||"#fff")}function Ft(t){t.anchors.push(new u(t.rect.x,t.rect.y+t.rect.height/2,_.Left)),t.anchors.push(new u(t.rect.x+t.rect.width/2,t.rect.y,_.Up)),t.anchors.push(new u(t.rect.x+t.rect.width,t.rect.y+t.rect.height/2,_.Right)),t.anchors.push(new u(t.rect.x+t.rect.width/2,t.rect.y+t.rect.height,_.Bottom));for(var e,r=5;r<360;r+=5)r%90!=0&&(e=Math.round(r/90),(e=new u(t.rect.center.x+Math.sin(r/180*Math.PI)*t.rect.width/2,t.rect.center.y+Math.cos(r/180*Math.PI)*t.rect.height/2,e)).hidden=!0,t.anchors.push(e))}function jt(t,e,r,i){i+=3*t.lineWidth,t.translate(r.x,r.y),t.rotate(Math.atan2(r.y-e.y,r.x-e.x)),t.translate(-r.x-t.lineWidth/5,-r.y-t.lineWidth/5),t.moveTo(r.x,r.y),t.lineTo(r.x-i,r.y-i/3),t.moveTo(r.x,r.y),t.lineTo(r.x-i,r.y+i/3),t.stroke()}function Ut(t,e,r,i){i+=3*t.lineWidth,t.translate(r.x,r.y),t.rotate(Math.atan2(r.y-e.y,r.x-e.x)),t.translate(-r.x-t.lineWidth/5,-r.y-t.lineWidth/5),r.x>e.x?(t.moveTo(r.x,r.y),t.lineTo(r.x-i,r.y-i/3)):(t.moveTo(r.x,r.y),t.lineTo(r.x-i,r.y+i/3)),t.stroke()}function Kt(t,e,r,i){i+=3*t.lineWidth,t.translate(r.x,r.y),t.rotate(Math.atan2(r.y-e.y,r.x-e.x)),t.translate(-r.x-t.lineWidth/5,-r.y-t.lineWidth/5),r.x<e.x?(t.moveTo(r.x,r.y),t.lineTo(r.x-i,r.y-i/3)):(t.moveTo(r.x,r.y),t.lineTo(r.x-i,r.y+i/3)),t.stroke()}function Wt(t,e){t.beginPath(),t.moveTo(e.rect.x+e.rect.width/2,e.rect.y),t.lineTo(e.rect.x+e.rect.width,e.rect.y+2*e.rect.height/5),t.lineTo(e.rect.x+4*e.rect.width/5,e.rect.y+e.rect.height),t.lineTo(e.rect.x+e.rect.width/5,e.rect.y+e.rect.height),t.lineTo(e.rect.x,e.rect.y+2*e.rect.height/5),t.closePath(),(e.fillStyle||e.bkType)&&t.fill(),t.stroke()}function qt(t){var e=t.rect.width/2,r=t.rect.height/2;r<e?e=r:r=e;var i=t.rect.height/7;t.iconRect=new x(t.rect.x+(t.rect.width-e)/2,t.rect.y+(i=i<10?10:i),e,r)}function zt(t){t.textRect=new x(t.rect.x+t.rect.width/5,t.rect.y+5*t.rect.height/7,3*t.rect.width/5,t.rect.height/4);var e=3*t.rect.width/5,r=3*t.rect.height/5;t.fullTextRect=new x(t.rect.x+(t.rect.width-e)/2,t.rect.y+t.rect.height/4,e,r)}function Ht(t){t.anchors.push(new u(t.rect.x+t.rect.width/2,t.rect.y,_.Up)),t.anchors.push(new u(t.rect.x+t.rect.width,t.rect.y+2*t.rect.height/5,_.Right)),t.anchors.push(new u(t.rect.x+4*t.rect.width/5,t.rect.y+t.rect.height,_.Bottom)),t.anchors.push(new u(t.rect.x+t.rect.width/5,t.rect.y+t.rect.height,_.Bottom)),t.anchors.push(new u(t.rect.x,t.rect.y+2*t.rect.height/5,_.Left))}function Vt(t,e){t.beginPath();var r=e.rect.width/5;t.moveTo(e.rect.x+r,e.rect.y),t.lineTo(e.rect.x+e.rect.width-r,e.rect.y),t.lineTo(e.rect.x+e.rect.width,e.rect.y+e.rect.height/2),t.lineTo(e.rect.x+e.rect.width-r,e.rect.y+e.rect.height),t.lineTo(e.rect.x+r,e.rect.y+e.rect.height),t.lineTo(e.rect.x,e.rect.y+e.rect.height/2),t.closePath(),(e.fillStyle||e.bkType)&&t.fill(),t.stroke()}function Yt(t){t.anchors.push(new u(t.rect.x+t.rect.width/2,t.rect.y,_.Up)),t.anchors.push(new u(t.rect.x+t.rect.width,t.rect.y+t.rect.height/2,_.Right)),t.anchors.push(new u(t.rect.x+t.rect.width/2,t.rect.y+t.rect.height,_.Bottom)),t.anchors.push(new u(t.rect.x,t.rect.y+t.rect.height/2,_.Left));var e=new u(t.rect.x+t.rect.width/10,t.rect.y+t.rect.height/4,_.Left);e.hidden=!0,t.anchors.push(e);e=new u(t.rect.x+t.rect.width/10,t.rect.y+3*t.rect.height/4,_.Left);e.hidden=!0,t.anchors.push(e);e=new u(t.rect.x+9*t.rect.width/10,t.rect.y+t.rect.height/4,_.Right);e.hidden=!0,t.anchors.push(e);e=new u(t.rect.x+9*t.rect.width/10,t.rect.y+3*t.rect.height/4,_.Right);e.hidden=!0,t.anchors.push(e)}function Xt(t){var e=3*t.rect.width/5,r=3*t.rect.height/4;t.iconRect=new x(t.rect.x+t.rect.width/5+t.paddingLeftNum,t.rect.y+t.paddingTopNum,e-t.paddingLeftNum-t.paddingRightNum,r-t.paddingTopNum-t.paddingBottomNum),t.fullIconRect=new x(t.rect.x+t.rect.width/5+t.paddingLeftNum,t.rect.y+t.paddingTopNum,e-t.paddingLeftNum-t.paddingRightNum,t.rect.height-t.paddingTopNum-t.paddingBottomNum)}function Gt(t){var e=3*t.rect.width/5,r=t.rect.height/4;t.textRect=new x(t.rect.x+t.rect.width/5+t.paddingLeftNum,t.rect.y+t.rect.height-r+t.paddingTopNum,e-t.paddingLeftNum-t.paddingRightNum,r),t.fullTextRect=new x(t.rect.x+t.rect.width/5+t.paddingLeftNum,t.rect.y+t.paddingTopNum,e-t.paddingLeftNum-t.paddingRightNum,t.rect.height-t.paddingTopNum-t.paddingBottomNum)}function Qt(t,e){t.beginPath();for(var r=0;r<5;++r)t.lineTo(Math.cos((18+72*r)/180*Math.PI)*e.rect.width/2+e.rect.x+e.rect.width/2,-Math.sin((18+72*r)/180*Math.PI)*e.rect.width/2+e.rect.y+e.rect.height/2),t.lineTo(Math.cos((54+72*r)/180*Math.PI)*e.rect.width/4+e.rect.x+e.rect.width/2,-Math.sin((54+72*r)/180*Math.PI)*e.rect.width/4+e.rect.y+e.rect.height/2);t.closePath(),(e.fillStyle||e.bkType)&&t.fill(),t.stroke()}function $t(t){t.anchors.push(new u(Math.cos(.1*Math.PI)*t.rect.width/2+t.rect.x+t.rect.width/2,-Math.sin(.1*Math.PI)*t.rect.width/2+t.rect.y+t.rect.height/2,_.Right)),t.anchors.push(new u(Math.cos(.5*Math.PI)*t.rect.width/2+t.rect.x+t.rect.width/2,-Math.sin(.5*Math.PI)*t.rect.width/2+t.rect.y+t.rect.height/2,_.Up)),t.anchors.push(new u(Math.cos(.9*Math.PI)*t.rect.width/2+t.rect.x+t.rect.width/2,-Math.sin(.9*Math.PI)*t.rect.width/2+t.rect.y+t.rect.height/2,_.Left)),t.anchors.push(new u(Math.cos(1.3*Math.PI)*t.rect.width/2+t.rect.x+t.rect.width/2,-Math.sin(1.3*Math.PI)*t.rect.width/2+t.rect.y+t.rect.height/2,_.Bottom)),t.anchors.push(new u(Math.cos(1.7*Math.PI)*t.rect.width/2+t.rect.x+t.rect.width/2,-Math.sin(1.7*Math.PI)*t.rect.width/2+t.rect.y+t.rect.height/2,_.Bottom))}function Jt(t){t.iconRect=new x(0,0,0,0)}function Zt(t){var e=2*t.rect.width/5,r=2*t.rect.height/5;t.fullTextRect=new x(t.rect.x+(t.rect.width-e)/2,t.rect.y+(t.rect.height-r)/2,e,r),t.textRect=t.fullTextRect}function te(t,e){t.beginPath(),t.moveTo(e.rect.x+e.rect.width/5,e.rect.y+13*e.rect.height/16),t.bezierCurveTo(e.rect.x-e.rect.width/15,e.rect.y+13*e.rect.height/16,e.rect.x-e.rect.width/15,e.rect.y+7*e.rect.height/16,e.rect.x+e.rect.width/5,e.rect.y+7*e.rect.height/16),t.bezierCurveTo(e.rect.x+e.rect.width/5,e.rect.y,e.rect.x+4*e.rect.width/5,e.rect.y,e.rect.x+4*e.rect.width/5,e.rect.y+7*e.rect.height/16),t.bezierCurveTo(e.rect.x+16*e.rect.width/15,e.rect.y+7*e.rect.height/16,e.rect.x+16*e.rect.width/15,e.rect.y+13*e.rect.height/16,e.rect.x+4*e.rect.width/5,e.rect.y+13*e.rect.height/16),t.closePath(),(e.fillStyle||e.bkType)&&t.fill(),t.stroke()}function ee(t){t.anchors.push(new u(t.rect.x,t.rect.y+3*t.rect.height/5,_.Left)),t.anchors.push(new u(t.rect.x+t.rect.width/2,t.rect.y+t.rect.height/9,_.Up)),t.anchors.push(new u(t.rect.x+t.rect.width,t.rect.y+3*t.rect.height/5,_.Right)),t.anchors.push(new u(t.rect.x+t.rect.width/2,t.rect.y+4*t.rect.height/5,_.Bottom))}function re(t){t.iconRect=new x(0,0,0,0)}function ie(t){t.textRect=new x(t.rect.x+t.rect.width/4,t.rect.y+t.rect.height/4,t.rect.width/2,6*t.rect.height/11),t.fullTextRect=t.textRect}function ne(t,e){t.beginPath(),t.moveTo(e.rect.x,e.rect.y),t.lineTo(e.rect.x+e.rect.width,e.rect.y),t.lineTo(e.rect.x+e.rect.width,e.rect.y+3*e.rect.height/4),t.lineTo(e.rect.x+8*e.rect.width/16,e.rect.y+3*e.rect.height/4),t.lineTo(e.rect.x+e.rect.width/4,e.rect.ey),t.lineTo(e.rect.x+5*e.rect.width/16,e.rect.y+3*e.rect.height/4),t.lineTo(e.rect.x,e.rect.y+3*e.rect.height/4),t.closePath(),(e.fillStyle||e.bkType)&&t.fill(),t.stroke()}function oe(t){t.iconRect=new x(0,0,0,0),t.fullIconRect=t.iconRect}function se(t){t.textRect=new x(t.rect.x+t.paddingLeftNum,t.rect.y+t.paddingTopNum,t.rect.width-t.paddingLeftNum-t.paddingRightNum,3*t.rect.height/4-t.paddingTopNum-t.paddingBottomNum),t.fullTextRect=t.textRect}function ae(t){t.anchors.push(new u(t.rect.x,t.rect.y+3*t.rect.height/8,_.Left)),t.anchors.push(new u(t.rect.x+t.rect.width/2,t.rect.y,_.Up)),t.anchors.push(new u(t.rect.x+t.rect.width,t.rect.y+3*t.rect.height/8,_.Right)),t.anchors.push(new u(t.rect.x+t.rect.width/4,t.rect.ey,_.Bottom))}function ce(t,e){t.beginPath();var r=e.rect.width/6;t.moveTo(e.rect.x,e.rect.y),t.lineTo(e.rect.ex-r,e.rect.y),t.lineTo(e.rect.ex,e.rect.y+r),t.lineTo(e.rect.ex,e.rect.ey),t.lineTo(e.rect.x,e.rect.ey),t.closePath(),t.moveTo(e.rect.ex-r,e.rect.y),t.lineTo(e.rect.ex-r,e.rect.y+r),t.lineTo(e.rect.ex,e.rect.y+r),(e.fillStyle||e.bkType)&&t.fill(),t.stroke()}function he(t){var e=0,r=0;t.text&&(t.paddingRightNum?e=t.paddingRightNum:r=t.paddingBottomNum||t.lineHeight*t.fontSize*(t.textMaxLine||1)),t.iconRect=new x(t.rect.x,t.rect.y,t.rect.width-e,t.rect.height-r),t.fullIconRect=t.rect}function le(t){var e;t.paddingRightNum?(e=t.paddingRightNum-5,t.textRect=new x(t.rect.x+t.rect.width-e,t.rect.y,e,t.rect.height-2*t.textOffsetY)):(e=t.paddingBottomNum||t.lineHeight*t.fontSize*(t.textMaxLine||1),t.textRect=new x(t.rect.x,t.rect.y+t.rect.height-e,t.rect.width-2*t.textOffsetX,e)),t.fullTextRect=t.rect}function ue(t){var e=0,r=0;t.text&&(t.paddingRightNum?e=t.paddingRightNum:r=t.paddingBottomNum||t.lineHeight*t.fontSize*(t.textMaxLine||1)),t.anchors.push(new u(t.rect.x,t.rect.y+(t.rect.height-r)/2,_.Left)),t.anchors.push(new u(t.rect.x+(t.rect.width-e)/2,t.rect.y,_.Up)),t.anchors.push(new u(t.rect.x+t.rect.width-e,t.rect.y+(t.rect.height-r)/2,_.Right)),t.anchors.push(new u(t.rect.x+(t.rect.width-e)/2,t.rect.y+t.rect.height-r,_.Bottom))}var de=(pe.prototype.render=function(t){t.save(),t.fillStyle=this.fillStyle,t.strokeStyle=this.strokeStyle,t.beginPath();for(var e=0;e<this.points.length;++e)e?t.lineTo(this.points[e].x,this.points[e].y):t.moveTo(this.points[e].x,this.points[e].y);t.closePath(),this.fillStyle&&t.fill(),t.stroke(),t.restore()},pe);function pe(t,e,r,i,n,o){void 0===n&&(n=""),void 0===o&&(o=""),this.points=[],this.fillStyle="",this.strokeStyle="",this.points.push(t),this.points.push(e),this.points.push(r),this.points.push(i),this.fillStyle=n,this.strokeStyle=o||n}var fe=(ye.prototype.render=function(t){for(var e=0,r=this.surfaces;e<r.length;e++)r[e].render(t)},ye);function ye(t,e,r,i,n){void 0===i&&(i="#ddd"),void 0===n&&(n="#ccc"),this.surfaces=[];var o=e*Math.sin(45*Math.PI/180),s=new u(t.x,t.y+o),a=new u(t.ex-o,t.y+o),c=new u(t.ex-o,t.ey),e=new u(t.x,t.ey);this.surfaces.push(new de(s,a,c,e,i,n)),this.surfaces.push(new de(s,new u(t.x+o,t.y),new u(t.ex,t.y),a,vt(.5,i),n)),this.surfaces.push(new de(a,new u(t.ex,t.y),new u(t.ex,t.ey-o),c,vt(.6,i),n))}function ge(t,e){new fe(e.rect,e.z,e.zRotate,e.fillStyle,e.strokeStyle).render(t)}function me(t){var e=t.z*Math.sin(45*Math.PI/180);t.anchors.push(new u(t.rect.x,t.rect.ey-(t.rect.height-e)/2,_.Left)),t.anchors.push(new u(t.rect.x+t.rect.width/2,t.rect.y+e/2,_.Up)),t.anchors.push(new u(t.rect.ex-e/2,t.rect.y+t.rect.height/2,_.Right)),t.anchors.push(new u(t.rect.x+(t.rect.width-e)/2,t.rect.y+t.rect.height,_.Bottom))}function ve(t){t.fullIconRect=t.fullTextRect,t.iconRect=new x(t.fullIconRect.x,t.fullIconRect.y,t.fullIconRect.width,2*t.fullIconRect.height/3)}function we(t){var e=t.z*Math.sin(45*Math.PI/180);t.fullTextRect=new x(t.rect.x,t.rect.y+e,t.rect.width-e,t.rect.height-e),t.textRect=new x(t.fullTextRect.x+10,t.fullTextRect.y+2*t.fullTextRect.height/3,t.fullTextRect.width-20,t.fullTextRect.height/3-5)}function be(t,e){t.beginPath();var r=e.rect.width/4,i=e.rect.x+e.rect.width/2;t.arc(i,e.rect.y+r,r,0,2*Math.PI),t.moveTo(e.rect.x,e.rect.y+3*r),t.lineTo(e.rect.ex,e.rect.y+3*r),t.moveTo(i,e.rect.y+2*r),t.lineTo(i,e.rect.y+4*r),t.moveTo(i,e.rect.y+4*r),t.lineTo(e.rect.x,e.rect.ey),t.moveTo(i,e.rect.y+4*r),t.lineTo(e.rect.ex,e.rect.ey),(e.fillStyle||e.bkType)&&t.fill(),t.stroke()}function xe(t){t.iconRect=new x(0,0,0,0)}function Se(t){t.textRect=new x(0,0,0,0),t.fullTextRect=t.textRect}function _e(t){t.iconRect=new x(t.rect.x+t.paddingLeftNum,t.rect.y+t.paddingTopNum,t.rect.height-t.paddingTopNum-t.paddingBottomNum,t.rect.height-t.paddingTopNum-t.paddingBottomNum),t.fullIconRect=new x(t.rect.x+t.paddingLeftNum,t.rect.y+t.paddingTopNum,t.rect.width-t.paddingLeftNum-t.paddingRightNum,t.rect.height-t.paddingTopNum-t.paddingBottomNum)}function ke(t){var e=t.rect.height-t.paddingTopNum-t.paddingBottomNum;t.textRect=new x(t.rect.x+t.paddingLeftNum+e,t.rect.y+t.paddingTopNum,t.rect.width-t.paddingLeftNum-t.paddingRightNum-e,e),t.fullTextRect=new x(t.rect.x+t.paddingLeftNum,t.rect.y+t.paddingTopNum,t.rect.width-t.paddingLeftNum-t.paddingRightNum,e)}function Ie(e,t){t.points&&t.points[0]&&(e.beginPath(),e.moveTo(t.points[0].x,t.points[0].y),t.points.forEach(function(t){e.lineTo(t.x,t.y)}),t.closePath&&!t.doing&&e.closePath(),(t.fillStyle||t.bkType)&&e.fill(),e.stroke())}function Le(t){var e,r;t.points&&t.points.length&&(e=t.points[0],r=t.points[t.points.length-1],e.x<r.x?(t.anchors.push(new u(e.x,e.y,_.Left)),t.anchors.push(new u(r.x,r.y,_.Right))):(t.anchors.push(new u(e.x,e.y,_.Right)),t.anchors.push(new u(r.x,r.y,_.Left))))}function Pe(t){for(var e=function(t){var e=t.borderRadius,r=t.borderRadius;t.borderRadius<1&&(e=t.rect.width*t.borderRadius,r=t.rect.height*t.borderRadius);r=e<r?e:r;t.rect.width<2*r&&(r=t.rect.width/2);t.rect.height<2*r&&(r=t.rect.height/2);return r}(t),r=0;r<5;r++)2!==r&&(n=t.rect.x+t.rect.width*(r+1)/6,i=t.rect.y,n<t.rect.x+e?i=Ce(t.rect.x+e,i+e,n,e,-1):n>t.rect.x+t.rect.width-e&&(i=Ce(t.rect.x+t.rect.width-e,i+e,n,e,-1)),t.anchors.push(new u(n,i,_.Up)));for(r=0;r<3;r++){var i=t.rect.y+t.rect.height*(r+1)/4,n=t.rect.x+t.rect.width;i<t.rect.y+e?n=Te(n-e,t.rect.y+e,i,e):i>t.rect.y+t.rect.height-e&&(n=Te(n-e,t.rect.y+t.rect.height-e,i,e)),t.anchors.push(new u(n,i,_.Right))}for(r=0;r<5;r++)2!==r&&(n=t.rect.x+t.rect.width*(r+1)/6,i=t.rect.y+t.rect.height,n<t.rect.x+e?i=Ce(t.rect.x+e,i-e,n,e):n>t.rect.x+t.rect.width-e&&(i=Ce(t.rect.x+t.rect.width-e,i-e,n,e)),t.anchors.push(new u(n,i,_.Bottom)));for(r=0;r<3;r++){i=t.rect.y+t.rect.height*(r+1)/4,n=t.rect.x;i<t.rect.y+e?n=Te(n+e,t.rect.y+e,i,e,-1):i>t.rect.y+t.rect.height-e&&(n=Te(n+e,t.rect.y+t.rect.height-e,i,e,-1)),t.anchors.push(new u(n,i,_.Left))}}function Te(t,e,r,i,n){return(n=void 0===n?1:n)*Math.sqrt(Math.pow(i,2)-Math.pow(r-e,2))+t}function Ce(t,e,r,i,n){return(n=void 0===n?1:n)*Math.sqrt(Math.pow(i,2)-Math.pow(r-t,2))+e}function Re(t,e){t.beginPath(),t.moveTo(e.rect.x,e.rect.y+e.rect.height),t.lineTo(e.rect.x+e.rect.width,e.rect.y+e.rect.height),t.closePath(),t.stroke()}function Ae(t){t.anchors.push(new u(t.rect.x,t.rect.y+t.rect.height,4)),t.anchors.push(new u(t.rect.x+t.rect.width,t.rect.y+t.rect.height,2))}function Ee(t,e){if(e.points&&e.points[1]){t.beginPath(),t.moveTo(e.points[0].x,e.points[0].y);for(var r=1;r<e.points.length;)if(e.points[r].data){if(!e.points[r+2])break;t.bezierCurveTo(e.points[r].x,e.points[r].y,e.points[r+1].x,e.points[r+1].y,e.points[r+2].x,e.points[r+2].y),r+=2}else t.lineTo(e.points[r].x,e.points[r].y),++r;e.closePath&&!e.doing&&t.closePath(),(e.fillStyle||e.bkType)&&t.fill(),t.stroke()}}var Ne={},Me={},Oe={},Be={},De={},Fe={};function je(t,e,r,i,n,o){return(!Ne[t]||!o)&&(Ne[t]=e,Be[t]=r,Me[t]=i,Oe[t]=n,!0)}Ne.combine=C,Ne.div=C,Ne.graffiti=Ie,Be.graffiti=Le,Ne.lines=Ee,Ne.square=C,Ne.rectangle=C,Me.rectangle=_e,Oe.rectangle=ke,Ne.circle=R,Me.circle=H,Oe.circle=V,Be.circle=Ft,Ne.triangle=A,Be.triangle=W,Me.triangle=Y,Oe.triangle=X,Ne.diamond=E,Me.diamond=G,Oe.diamond=Q,Ne.hexagon=Vt,Me.hexagon=Xt,Oe.hexagon=Gt,Be.hexagon=Yt,Ne.pentagon=Wt,Me.pentagon=qt,Oe.pentagon=zt,Be.pentagon=Ht,Ne.pentagram=Qt,Me.pentagram=Jt,Oe.pentagram=Zt,Be.pentagram=$t,Ne.leftArrow=N,Be.leftArrow=q,Me.leftArrow=$,Oe.leftArrow=J,Ne.rightArrow=M,Be.rightArrow=q,Me.rightArrow=Z,Oe.rightArrow=tt,Ne.twowayArrow=O,Be.twowayArrow=q,Me.twowayArrow=et,Oe.twowayArrow=rt,Ne.cloud=te,Be.cloud=ee,Me.cloud=re,Oe.cloud=ie,Ne.message=ne,Be.message=ae,Me.message=oe,Oe.message=se,Ne.file=ce,Ne.text=j,Me.text=it,Ne.line=K,Be.line=z,Me.line=it,Oe.line=nt,Ne.image=function(t,e){},Me.image=he,Oe.image=le,Be.image=ue,Ne.cube=ge,Be.cube=me,Me.cube=ve,Oe.cube=we,Ne.people=be,Me.people=xe,Oe.people=Se,Ne.mindNode=C,Be.mindNode=Pe,Me.mindNode=_e,Oe.mindNode=ke,Ne.mindLine=Re,Be.mindLine=Ae,De.line={drawFn:ot,drawControlPointsFn:st,controlPointsFn:at,pointIn:dt},De.polyline={drawFn:ht,drawControlPointsFn:lt,controlPointsFn:ut,dockControlPointFn:pt,pointIn:dt},De.curve={drawFn:_t,drawControlPointsFn:kt,controlPointsFn:It,pointIn:Lt},De.mind={drawFn:_t,drawControlPointsFn:kt,controlPointsFn:At,pointIn:Lt},Fe.triangleSolid=Et,Fe.triangle=Nt,Fe.diamondSolid=Mt,Fe.diamond=Ot,Fe.circleSolid=Bt,Fe.circle=Dt,Fe.line=jt,Fe.lineUp=Ut,Fe.lineDown=Kt,window.registerTopologyNode=je,window.registerTopologyLine=function(t,e,r,i,n,o,s,a,c,h){return void 0===h&&(h=!0),!(De[t]&&!h)&&(De[t]={drawFn:e,drawControlPointsFn:r,controlPointsFn:i,dockControlPointFn:n,pointIn:o,getLength:s,getCenter:a,getPointByPos:c},!0)};var Ue,Ke,We=((Ue=function(t,e){return(Ue=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}Ue(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)})(qe,Ke=P),qe.prototype.setFrom=function(t,e){void 0===e&&(e=""),this.from=t,this.fromArrow=e,this.textRect=void 0},qe.prototype.setTo=function(t,e){void 0===e&&(e="triangleSolid"),this.to=t,this.toArrow=e,this.textRect=void 0},qe.prototype.calcControlPoints=function(t){"line"!==this.name&&this.manualCps&&!t||(this.textRect=void 0,this.from&&this.to&&De[this.name]&&De[this.name].controlPointsFn(this))},qe.prototype.draw=function(t){if(this.animateDot){if(t.fillStyle=t.strokeStyle,"dot"===this.animateType)return t.beginPath(),t.arc(this.animateDot.x,this.animateDot.y,this.animateDotSize,0,2*Math.PI,!1),void t.fill();if("comet"===this.animateType){var e=this.getBubbles();t.save();for(var r=0,i=e;r<i.length;r++){var n=i[r];t.globalAlpha=n.a,t.beginPath(),t.arc(n.pos.x,n.pos.y,n.r,0,2*Math.PI,!1),t.fill()}t.restore()}}!this.isAnimate&&0<this.borderWidth&&this.borderColor&&(t.save(),this.lineJoin&&(t.lineJoin=this.lineJoin),t.lineWidth=this.lineWidth+this.borderWidth,t.strokeStyle=this.borderColor,De[this.name]&&De[this.name].drawFn(t,this),t.restore()),this.isAnimate&&"comet"===this.animateType||!De[this.name]||(this.lineJoin&&(t.lineJoin=this.lineJoin),De[this.name].drawFn(t,this));var o,e=p.Store.get(this.generateStoreKey("LT:scale"))||1;this.fromArrow&&Fe[this.fromArrow]&&(t.save(),t.beginPath(),t.lineDashOffset=0,t.setLineDash([]),t.fillStyle=this.fromArrowColor||t.strokeStyle,t.strokeStyle=t.fillStyle,o=this.to,"curve"===this.name?o=Pt(.95-this.lineWidth/100,this.to,this.controlPoints[1],this.controlPoints[0],this.from):"line"!==this.name&&this.controlPoints.length&&(o=this.controlPoints[0]),Fe[this.fromArrow](t,o,this.from,this.fromArrowSize*e),t.restore()),this.toArrow&&Fe[this.toArrow]&&(t.save(),t.beginPath(),t.lineDashOffset=0,t.setLineDash([]),t.fillStyle=this.toArrowColor||t.strokeStyle,t.strokeStyle=t.fillStyle,o=this.from,"curve"===this.name?o=Pt(.95-this.lineWidth/100,this.from,this.controlPoints[0],this.controlPoints[1],this.to):"mind"===this.name?o=Pt(.96-this.lineWidth/100,this.from,this.controlPoints[0],this.controlPoints[1],this.to):"line"!==this.name&&this.controlPoints.length&&(o=this.controlPoints[this.controlPoints.length-1]),Fe[this.toArrow](t,o,this.to,this.toArrowSize*e),t.restore()),this.text&&!this.isAnimate&&(this.textRect||this.calcTextRect(),j(t,this))},qe.prototype.pointIn=function(t){return De[this.name].pointIn(t,this)},qe.prototype.getLen=function(){switch(this.name){case"line":return m(this.from,this.to);case"polyline":if(!this.controlPoints||!this.controlPoints.length)return m(this.from,this.to);for(var t=0,e=this.from,r=0,i=this.controlPoints;r<i.length;r++){var n=i[r];t+=m(e,n),e=n}return 0|(t+=m(e,this.to));case"curve":case"mind":return v(this.from,this.controlPoints[0],this.controlPoints[1],this.to);default:if(De[this.name].getLength)return De[this.name].getLength(this)}return 0},qe.prototype.calcTextRect=function(){var t=this.getCenter(),e=Math.abs(this.from.x-this.to.x);e<100&&(e=100);var r=this.lineHeight*this.fontSize*(this.textMaxLine||this.text&&this.text.split("\n").length||1);this.textRect=new x(t.x-e/2,t.y-r/2,e,r)},qe.prototype.getTextRect=function(){return this.calcTextRect(),this.textRect},qe.prototype.getCenter=function(){var t=new u(this.from.x,this.from.y);switch(this.name){case"line":t=this.getLineCenter(this.from,this.to);break;case"polyline":var e=Math.round(this.controlPoints.length/2),t=this.getLineCenter(this.controlPoints[e-1]||this.from,this.controlPoints[e]||this.to);break;case"curve":t=Pt(.5,this.to,this.controlPoints[1],this.controlPoints[0],this.from);break;default:De[this.name].getCenter&&(t=De[this.name].getCenter(this))}return t},qe.prototype.getLineCenter=function(t,e){return new u((t.x+e.x)/2,(t.y+e.y)/2)},qe.prototype.getPointByPos=function(t){if(t<=0)return this.from;switch(this.name){case"line":return this.getLinePtByPos(this.from,this.to,t);case"polyline":if(this.controlPoints&&this.controlPoints.length){for(var e=[].concat(this.controlPoints,this.to),r=this.from,i=0,n=e;i<n.length;i++){var o=n[i],s=m(r,o);if(!(s<t))return this.getLinePtByPos(r,o,t);t-=s,r=o}return this.to}return this.getLinePtByPos(this.from,this.to,t);case"curve":return Pt(t/this.getLen(),this.from,this.controlPoints[0],this.controlPoints[1],this.to);default:if(De[this.name].getPointByPos)return De[this.name].getPointByPos(t,this)}return null},qe.prototype.getPointByReversePos=function(t){if(t<=0)return this.to;switch(this.name){case"line":return this.getLinePtByPos(this.to,this.from,t);case"polyline":if(this.controlPoints&&this.controlPoints.length){var e=[];this.controlPoints.forEach(function(t){e.unshift(t)}),e.unshift(this.to);for(var r=this.to,i=0,n=e;i<n.length;i++){var o=n[i],s=m(r,o);if(!(s<t))return this.getLinePtByPos(r,o,t);t-=s,r=o}return this.from}return this.getLinePtByPos(this.to,this.from,t);case"curve":return Pt(t/this.getLen(),this.to,this.controlPoints[1],this.controlPoints[0],this.from);default:if(De[this.name].getPointByReversePos)return De[this.name].getPointByReversePos(t,this)}return null},qe.prototype.getLinePtByPos=function(t,e,r){var i,n=m(t,e);return r<=0?t:n<=r?e:(i=t.x+(e.x-t.x)*(r/n),n=t.y+(e.y-t.y)*(r/n),new u(i,n))},qe.prototype.calcRectInParent=function(t){var e=t.rect.width-t.paddingLeftNum-t.paddingRightNum,r=t.rect.height-t.paddingTopNum-t.paddingBottomNum;this.rectInParent={x:100*(this.from.x-t.rect.x-t.paddingLeftNum)/e+"%",y:100*(this.from.y-t.rect.y-t.paddingTopNum)/r+"%",width:0,height:0,rotate:0}},qe.prototype.calcRectByParent=function(t){var e,r,i;this.rectInParent&&(e=t.rect.width-t.paddingLeftNum-t.paddingRightNum,i=t.rect.height-t.paddingTopNum-t.paddingBottomNum,r=t.rect.x+t.paddingLeftNum+bt(e,this.rectInParent.x)+bt(e,this.rectInParent.marginLeft),i=t.rect.y+t.paddingTopNum+bt(i,this.rectInParent.y)+bt(e,this.rectInParent.marginTop),void 0===this.rectInParent.marginLeft&&this.rectInParent.marginRight&&(r-=bt(e,this.rectInParent.marginRight)),void 0===this.rectInParent.marginTop&&this.rectInParent.marginBottom&&(i-=bt(e,this.rectInParent.marginBottom)),this.translate(r-this.from.x,i-this.from.y))},qe.prototype.initAnimate=function(){this.animateStart=0,this.animateDot=void 0,this.animatePos=0},qe.prototype.pauseAnimate=function(){p.Store.set(this.generateStoreKey("LT:AnimatePlay"),{pen:this,stop:!0})},qe.prototype.stopAnimate=function(){var t=this;this.pauseAnimate(),this.initAnimate(),setTimeout(function(){p.Store.set(t.generateStoreKey("LT:render"),{pen:t,stop:!0})},50)},qe.prototype.animate=function(t){switch(this.animatePos+=this.animateSpan,this.animateType){case"beads":this.animateReverse?this.lineDashOffset=this.animatePos:this.lineDashOffset=-this.animatePos;var e=this.lineWidth;e<5&&(e=5),this.animateLineDash?this.lineDash=this.animateLineDash:this.lineDash=[e,2*e];break;case"dot":case"comet":e=this.lineDash=void 0,e=this.animateReverse?this.getPointByReversePos(this.animatePos+this.animateToSize):this.getPointByPos(this.animatePos+this.animateFromSize);this.animateDot=e;break;default:this.animateReverse?this.lineDash=[0,this.length-this.animatePos+1,this.animatePos]:this.lineDash=[this.animatePos,this.length-this.animatePos+1]}if(this.animatePos>this.length+this.animateSpan-this.animateFromSize-this.animateToSize){if(++this.animateCycleIndex>=this.animateCycle&&0<this.animateCycle)return this.animateStart=0,this.initAnimate(),void p.Store.set(this.generateStoreKey("animateEnd"),this);this.animatePos=this.animateSpan}},qe.prototype.getBubbles=function(){for(var t=[],e=0;e<30&&0<this.animatePos-e;++e)this.animateReverse?t.push({pos:this.getPointByReversePos(this.animatePos-2*e+this.animateToSize),a:1-.03*e,r:this.lineWidth-.01*e}):t.push({pos:this.getPointByPos(this.animatePos-2*e+this.animateFromSize),a:1-.03*e,r:this.lineWidth-.01*e});return t},qe.prototype.round=function(){this.from.round(),this.to.round()},qe.prototype.translate=function(t,e){if(this.from){this.from.x+=t,this.from.y+=e,this.to.x+=t,this.to.y+=e,this.text&&(this.textRect=void 0);for(var r=0,i=this.controlPoints;r<i.length;r++){var n=i[r];n.x+=t,n.y+=e}}if(this.children)for(var o=0,s=this.children;o<s.length;o++)s[o].translate(t,e);p.Store.set(this.generateStoreKey("pts-")+this.id,void 0)},qe.prototype.scale=function(t,e){if(this.from){this.from.x=e.x-(e.x-this.from.x)*t,this.from.y=e.y-(e.y-this.from.y)*t,this.to.x=e.x-(e.x-this.to.x)*t,this.to.y=e.y-(e.y-this.to.y)*t,this.lineWidth*=t,this.borderWidth*=t,this.fontSize*=t,this.text&&(this.textRect=void 0),this.textOffsetX*=t,this.textOffsetY*=t;for(var r=0,i=this.controlPoints;r<i.length;r++){var n=i[r];n.x=e.x-(e.x-n.x)*t,n.y=e.y-(e.y-n.y)*t}}if(this.children)for(var o=0,s=this.children;o<s.length;o++)s[o].scale(t,e);p.Store.set(this.generateStoreKey("pts-")+this.id,void 0)},qe.prototype.hit=function(t,e){if(this.from.hit(t,e=void 0===e?0:e)||this.to.hit(t,e))return this},qe.prototype.clone=function(){return new qe(this)},qe);function qe(t){var e=Ke.call(this)||this;if(e.fromData({name:"curve",fromArrow:"",toArrow:"",controlPoints:[],fromArrowSize:5,toArrowSize:5,borderWidth:0,borderColor:"#000000",animateColor:"",animateSpan:1,animateFromSize:0,animateToSize:0,animateDotSize:3,textBackground:"#ffffff"},t),e.type=b.Line,t.from&&(e.from=new u(t.from.x,t.from.y,t.from.direction,t.from.anchorIndex,t.from.id,t.autoAnchor)),t.to&&(e.to=new u(t.to.x,t.to.y,t.to.direction,t.to.anchorIndex,t.to.id,t.autoAnchor)),"mind"===t.name&&(!t.controlPoints||2<t.controlPoints.length))t.controlPoints=void 0,e.calcControlPoints(!0);else if(t.controlPoints){e.controlPoints=[];for(var r=0,i=t.controlPoints;r<i.length;r++){var n=i[r];e.controlPoints.push(new u(n.x,n.y,n.direction,n.anchorIndex,n.id))}}return t.children&&(e.children=[],t.children.forEach(function(t){e.children.push(new qe(t))})),e}var ze,He,Ve,Ye,Xe=(ze=function(t,e){return(ze=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}ze(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),Ge=["TID","events","wheres","text","fontColor","fontFamily","fontSize","lineHeight","fontStyle","fontWeight","textAlign","textBaseline","textBackground","iconFamily","icon","iconSize","iconColor"],Qe=(Xe($e,He=P),$e.cloneState=function(t){var e=new $e(t,!0);return Ge.forEach(function(t){delete e[t]}),e},$e.prototype.restore=function(t){if(t=!t&&this.animateReady?$e.cloneState(this.animateReady):t){for(var e in this)void 0!==t[e]&&e.indexOf("animate")<0&&e.indexOf("Animate")<0&&(Ge.includes(e)||(this[e]=t[e],"rect"===e&&(this.rect=new x(this.rect.x,this.rect.y,this.rect.width,this.rect.height))));this.init(!0)}},$e.prototype.checkData=function(){this.rect.width=this.rect.width<0?0:this.rect.width,this.rect.height=this.rect.height<0?0:this.rect.height,this.rect.calcCenter||(this.rect=new x(this.rect.x,this.rect.y,this.rect.width,this.rect.height))},$e.prototype.init=function(t){var e,r;this.checkData(),this.calcAbsPadding(),Oe[this.name]?Oe[this.name](this):(r=(e=this).rect.height-e.paddingTopNum-e.paddingBottomNum,e.textRect=new x(e.rect.x+e.paddingLeftNum,e.rect.y+e.paddingTopNum+3*r/4,e.rect.width-e.paddingLeftNum-e.paddingRightNum,r/4),e.fullTextRect=new x(e.rect.x+e.paddingLeftNum,e.rect.y+e.paddingTopNum,e.rect.width-e.paddingLeftNum-e.paddingRightNum,r)),Me[this.name]?Me[this.name](this):((r=this).image&&r.imageWidth?r.iconRect=new x(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.imageWidth,r.imageHeight):r.icon&&r.iconSize?r.iconRect=new x(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.iconSize,r.iconSize):r.iconRect=new x(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.rect.width-r.paddingLeftNum-r.paddingRightNum,3*r.rect.height/4-r.paddingTopNum-r.paddingBottomNum),r.fullIconRect=new x(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.rect.width-r.paddingLeftNum-r.paddingRightNum,r.rect.height-r.paddingTopNum-r.paddingBottomNum)),this.calcAnchors(),this.elementRendered=!1,t||this.addToDiv()},$e.prototype.addToDiv=function(){(this.audio||this.video||this.iframe||this.elementId||this.gif)&&p.Store.set(this.generateStoreKey("LT:addDiv"),this)},$e.prototype.removeFromDiv=function(){p.Store.set(this.generateStoreKey("LT:removeDiv"),this)},$e.prototype.hasGif=function(){if(this.gif)return!0;if(this.children)for(var t=0,e=this.children;t<e.length;t++){var r=e[t];if(r.type===b.Node&&r.hasGif&&r.hasGif())return!0}return!1},$e.prototype.calcAbsPadding=function(){this.paddingLeftNum=bt(this.rect.width,this.paddingLeft),this.paddingRightNum=bt(this.rect.width,this.paddingRight),this.paddingTopNum=bt(this.rect.height,this.paddingTop),this.paddingBottomNum=bt(this.rect.height,this.paddingBottom)},$e.prototype.setChildrenIds=function(){if(this.children)for(var t=0,e=this.children;t<e.length;t++){var r=e[t];r.id=h(),r.type===b.Node&&r.setChildrenIds()}},$e.prototype.draw=function(t){if(Ne[this.name]){switch(this.bkType){case 1:this.drawBkLinearGradient(t);break;case 2:this.drawBkRadialGradient(t)}Ne[this.name](t,this),"text"!==this.name&&this.text&&j(t,this),this.image||this.img&&""===this.elementId?this.drawImg(t):this.icon&&(t.save(),t.shadowColor="",t.shadowBlur=0,U(t,this),t.restore())}},$e.prototype.drawBkLinearGradient=function(t){var e,r;this.gradientFromColor&&this.gradientToColor&&(e=new u(this.rect.x,this.rect.center.y),r=new u(this.rect.ex,this.rect.center.y),this.gradientAngle%90==0&&this.gradientAngle%180?this.gradientAngle%270?(e.x=this.rect.center.x,e.y=this.rect.y,r.x=this.rect.center.x,r.y=this.rect.ey):(e.x=this.rect.center.x,e.y=this.rect.ey,r.x=this.rect.center.x,r.y=this.rect.y):this.gradientAngle&&(e.rotate(this.gradientAngle,this.rect.center),r.rotate(this.gradientAngle,this.rect.center)),(r=t.createLinearGradient(e.x,e.y,r.x,r.y)).addColorStop(0,this.gradientFromColor),r.addColorStop(1,this.gradientToColor),t.fillStyle=r)},$e.prototype.drawBkRadialGradient=function(t){var e;this.gradientFromColor&&this.gradientToColor&&((e=this.rect.width)<this.rect.height&&(e=this.rect.height),(e=t.createRadialGradient(this.rect.center.x,this.rect.center.y,(e*=.5)*this.gradientRadius,this.rect.center.x,this.rect.center.y,e)).addColorStop(0,this.gradientFromColor),e.addColorStop(1,this.gradientToColor),t.fillStyle=e)},$e.prototype.drawImg=function(t){var e=this;this.lastImage!==this.image&&(this.img=void 0,this.lastImage&&0<this.lastImage.indexOf(".gif")&&p.Store.set(this.generateStoreKey("LT:addDiv"),this));var r,i=this.image&&0<this.image.indexOf(".gif");if(i){if(this.img)return void(this.TID&&!this.elementLoaded&&(this.elementLoaded=!0,p.Store.set(this.generateStoreKey("LT:addDiv"),this)))}else{if(this.img){t.save(),t.shadowColor="",t.shadowBlur=0;var n=this.getIconRect(),o=n.x,s=n.y,a=n.width,c=n.height;switch(this.imageWidth&&(a=this.imageWidth),this.imageHeight&&(c=this.imageHeight),this.imgNaturalWidth&&this.imgNaturalHeight&&this.imageRatio&&(this.imageWidth?c=this.imgNaturalHeight/this.imgNaturalWidth*a:a=this.imgNaturalWidth/this.imgNaturalHeight*c),o+=(n.width-a)/2,s+=(n.height-c)/2,this.imageAlign){case"top":s=n.y;break;case"bottom":s=n.ey-c;break;case"left":o=n.x;break;case"right":o=n.ex-a;break;case"left-top":o=n.x,s=n.y;break;case"right-top":o=n.ex-a,s=n.y;break;case"left-bottom":o=n.x,s=n.ey-c;break;case"right-bottom":o=n.ex-a,s=n.ey-c}return this.iconRotate&&(t.translate(n.center.x,n.center.y),t.rotate(this.iconRotate*Math.PI/180),t.translate(-n.center.x,-n.center.y)),t.drawImage(this.img,o,s,a,c),void t.restore()}if(L[this.image])return this.img=L[this.image].img,this.lastImage=this.image,this.imgNaturalWidth=this.img.naturalWidth,this.imgNaturalHeight=this.img.naturalHeight,void this.drawImg(t)}this.image&&((r=new Image).crossOrigin="anonymous",r.src=this.image,r.onload=function(){e.lastImage=e.image,e.imgNaturalWidth=r.naturalWidth,e.imgNaturalHeight=r.naturalHeight,e.img=r,L[e.image]={img:r},p.Store.set(e.generateStoreKey("LT:imageLoaded"),!0),!e.gif&&i&&(e.gif=!0,e.TID&&(e.elementLoaded=!0,p.Store.set(e.generateStoreKey("LT:addDiv"),e)))})},$e.prototype.calcAnchors=function(){var t,r=this;this.anchors=[],Be[this.name]?Be[this.name](this):((t=this).anchors.push(new u(t.rect.x,t.rect.y+t.rect.height/2,_.Left)),t.anchors.push(new u(t.rect.x+t.rect.width/2,t.rect.y,_.Up)),t.anchors.push(new u(t.rect.x+t.rect.width,t.rect.y+t.rect.height/2,_.Right)),t.anchors.push(new u(t.rect.x+t.rect.width/2,t.rect.y+t.rect.height,_.Bottom))),this.manualAnchors&&this.manualAnchors.forEach(function(t){var e=Math.abs(t.x-r.rect.center.x);Math.abs(t.y-r.rect.center.y)<e?t.x<r.rect.center.x?t.direction=_.Left:t.direction=_.Right:t.y<r.rect.center.y?t.direction=_.Up:t.direction=_.Bottom,r.anchors.push(t)}),this.calcRotateAnchors()},$e.prototype.calcRotateAnchors=function(t){void 0===t&&(t=this.rotate),this.rotatedAnchors=[];for(var e=0,r=this.anchors;e<r.length;e++){var i=r[e];this.rotatedAnchors.push(i.clone().rotate(t,this.rect.center))}},$e.prototype.getTextRect=function(){var t=this.textRect;return t=!this.icon&&!this.image?this.fullTextRect:t},$e.prototype.getIconRect=function(){var t=this.iconRect;return t=!this.text?this.fullIconRect||this.fullTextRect||this.rect:t},$e.prototype.calcRectByParent=function(t){var e,r,i,n,o;this.rectInParent&&(e=t.rect.width-t.paddingLeftNum-t.paddingRightNum,o=t.rect.height-t.paddingTopNum-t.paddingBottomNum,r=t.rect.x+t.paddingLeftNum+bt(e,this.rectInParent.x)+bt(e,this.rectInParent.marginLeft),i=t.rect.y+t.paddingTopNum+bt(o,this.rectInParent.y)+bt(e,this.rectInParent.marginTop),n=bt(e,this.rectInParent.width),o=bt(o,this.rectInParent.height),void 0===this.rectInParent.marginLeft&&this.rectInParent.marginRight&&(r-=bt(e,this.rectInParent.marginRight)),void 0===this.rectInParent.marginTop&&this.rectInParent.marginBottom&&(i-=bt(e,this.rectInParent.marginBottom)),this.rect=new x(r,i,n,o),this.rectInParent.rotate||(this.rectInParent.rotate=0),t=t.rotate+t.offsetRotate,this.rotate=this.rectInParent.rotate+t,this.rectInParent.rect||(this.rectInParent.rect=this.rect.clone()))},$e.prototype.calcChildrenRect=function(){if(this.children)for(var t=0,e=this.children;t<e.length;t++){var r=e[t];r.calcRectByParent(this),r.type===b.Node&&(r.init(),r.calcChildrenRect())}},$e.prototype.calcRectInParent=function(t){var e=t.rect.width-t.paddingLeftNum-t.paddingRightNum,r=t.rect.height-t.paddingTopNum-t.paddingBottomNum;this.rectInParent={x:100*(this.rect.x-t.rect.x-t.paddingLeftNum)/e+"%",y:100*(this.rect.y-t.rect.y-t.paddingTopNum)/r+"%",width:100*this.rect.width/e+"%",height:100*this.rect.height/r+"%",rotate:this.rectInParent?this.rectInParent.rotate||0:this.rotate||0,rect:this.rect.clone()}},$e.prototype.getDockWatchers=function(){this.dockWatchers=this.rect.toPoints(),this.dockWatchers.unshift(this.rect.center)},$e.prototype.initAnimate=function(){if(this.animateFrames){for(var t=0,e=0;e<this.animateFrames.length;++e)this.animateFrames[e].start=t,t+=this.animateFrames[e].duration,this.animateFrames[e].end=t,this.animateFrames[e].initState=$e.cloneState(e?this.animateFrames[e-1].state:this),this.animateFrames[e].offsetRect=new x(this.animateFrames[e].state.rect.x-this.animateFrames[e].initState.rect.x,this.animateFrames[e].state.rect.y-this.animateFrames[e].initState.rect.y,this.animateFrames[e].state.rect.width-this.animateFrames[e].initState.rect.width,this.animateFrames[e].state.rect.height-this.animateFrames[e].initState.rect.height);this.animateDuration=t,this.animateReady=$e.cloneState(this),this.animatePos=0,this.animateFrame=0}},$e.prototype.pauseAnimate=function(){this.animateFrame=this._animateFrame,this.animatePos=this._animatePos,p.Store.set(this.generateStoreKey("LT:AnimatePlay"),{pen:this,stop:!0})},$e.prototype.stopAnimate=function(){this.animateStart=0,p.Store.set(this.generateStoreKey("LT:AnimatePlay"),{pen:this,stop:!0}),this.restore(),this.initAnimate(),p.Store.set(this.generateStoreKey("LT:render"),{pen:this,stop:!0})},$e.prototype.animate=function(t){var r=this;if(!(this.animateStart<1)){var i=t-this.animateStart;if(0<this.animateFrame&&(this.animateFrames.forEach(function(t,e){r.animateFrame<e+1&&(i+=t.duration)}),i+=this.animatePos),i>this.animateDuration){if(this.animatePos=0,this.animateFrame=0,this.restore(),0<this.animateCycle&&++this.animateCycleIndex>=this.animateCycle)return this.animateStart=0,this.animateCycleIndex=0,p.Store.set(this.generateStoreKey("animateEnd"),this),void(this.animateAlone||p.Store.set(this.generateStoreKey("LT:rectChanged"),this));this.animateStart=t,i=0}for(var e=!1,n=0;n<this.animateFrames.length;++n){var o=this.animateFrames[n];if(i>=o.start&&i<o.end){o.state.dash&&(this.dash=o.state.dash),o.state.strokeStyle&&(this.strokeStyle=o.state.strokeStyle),o.state.fillStyle&&(this.fillStyle=o.state.fillStyle),o.state.text&&(this.text=o.state.text),o.state.fontColor&&(this.fontColor=o.state.fontColor),o.state.fontFamily&&(this.fontFamily=o.state.fontFamily),o.state.fontSize&&(this.fontSize=o.state.fontSize),o.state.lineHeight&&(this.lineHeight=o.state.lineHeight),o.state.fontStyle&&(this.fontStyle=o.state.fontStyle),o.state.fontWeight&&(this.fontWeight=o.state.fontWeight),o.state.textAlign&&(this.textAlign=o.state.textAlign),o.state.textBaseline&&(this.textBaseline=o.state.textBaseline),o.state.textBackground&&(this.textBackground=o.state.textBackground),o.state.iconFamily&&(this.iconFamily=o.state.iconFamily),o.state.icon&&(this.icon=o.state.icon),o.state.iconSize&&(this.iconSize=o.state.iconSize),o.state.iconColor&&(this.iconColor=o.state.iconColor),this.visible=o.state.visible,this._animateFrame=n+1,this._animateFrame>this.animateFrame&&(this.animateFrame=0,this.animatePos=0),this._animatePos=i-o.start;var s=this._animatePos/o.duration;if(o.linear){if(o.state.rect.x!==o.initState.rect.x&&(this.rect.x=o.initState.rect.x+o.offsetRect.x*s,e=!0),o.state.rect.y!==o.initState.rect.y&&(this.rect.y=o.initState.rect.y+o.offsetRect.y*s,e=!0),o.state.rect.width!==o.initState.rect.width&&(this.rect.width=o.initState.rect.width+o.offsetRect.width*s,e=!0),o.state.rect.height!==o.initState.rect.height&&(this.rect.height=o.initState.rect.height+o.offsetRect.height*s,e=!0),this.rect.ex=this.rect.x+this.rect.width,this.rect.ey=this.rect.y+this.rect.height,this.rect.calcCenter(),void 0!==o.initState.z&&o.state.z!==o.initState.z&&(this.z=o.initState.z+(o.state.z-o.initState.z)*s,e=!0),o.state.borderRadius!==o.initState.borderRadius&&(this.borderRadius=o.initState.borderRadius+(o.state.borderRadius-o.initState.borderRadius)*s),o.state.lineWidth!==o.initState.lineWidth&&(this.lineWidth=o.initState.lineWidth+(o.state.lineWidth-o.initState.lineWidth)*s),o.state.rotate!==o.initState.rotate&&(this.rotate=o.initState.rotate+(o.state.rotate-o.initState.rotate)*s,e=!0),o.state.globalAlpha!==o.initState.globalAlpha&&(this.globalAlpha=o.initState.globalAlpha+(o.state.globalAlpha-o.initState.globalAlpha)*s),o.state.lineDashOffset&&(this.lineDashOffset?this.lineDashOffset+=o.state.lineDashOffset:this.lineDashOffset=o.state.lineDashOffset),o.state.value!==o.initState.value&&(this.value=(o.initState.value||0)+((o.state.value||0)-(o.initState.value||0))*s),o.state.num!==o.initState.num&&(this.num=(o.initState.num||0)+((o.state.num||0)-(o.initState.num||0))*s),o.state.num1!==o.initState.num1&&(this.num1=(o.initState.num1||0)+((o.state.num1||0)-(o.initState.num1||0))*s),o.state.num2!==o.initState.num2&&(this.num2=(o.initState.num2||0)+((o.state.num2||0)-(o.initState.num2||0))*s),o.state.num3!==o.initState.num3&&(this.num3=(o.initState.num3||0)+((o.state.num3||0)-(o.initState.num3||0))*s),o.state.data)for(var a in o.state.data)"number"==typeof o.state.data[a]?this.data[a]=(o.initState.data[a]||0)+((o.state.data[a]||0)-(o.initState.data[a]||0))*s:void 0!==o.state.data[a]&&void 0!==o.state.data[a]&&(this.data[a]=o.state.data[a])}else this.rect=o.state.rect,this.lineWidth=o.state.lineWidth,this.rotate=o.state.rotate,this.globalAlpha=o.state.globalAlpha,this.lineDashOffset=o.state.lineDashOffset}}e&&(this.init(!0),this.animateAlone||p.Store.set(this.generateStoreKey("LT:rectChanged"),this))}},$e.prototype.scale=function(t,e){if(e=e||this.rect.center,this.oldRect=this.rect.clone(),this.rect.x=e.x-(e.x-this.rect.x)*t,this.rect.y=e.y-(e.y-this.rect.y)*t,this.textOffsetX*=t,this.textOffsetY*=t,this.z*=t,this.rect.width*=t,this.rect.height*=t,this.rect.ex=this.rect.x+this.rect.width,this.rect.ey=this.rect.y+this.rect.height,this.lineWidth*=t,this.imageWidth&&(this.imageWidth*=t),this.imageHeight&&(this.imageHeight*=t),this.lastImage=void 0,this.fontSize*=t,this.iconSize*=t,"number"==typeof this.paddingLeft&&(this.paddingLeft*=t),"number"==typeof this.paddingTop&&(this.paddingTop*=t),"number"==typeof this.paddingRight&&(this.paddingRight*=t),"number"==typeof this.paddingBottom&&(this.paddingBottom*=t),this.rectInParent&&("number"==typeof this.rectInParent.x&&(this.rectInParent.x*=t),"number"==typeof this.rectInParent.y&&(this.rectInParent.y*=t),"number"==typeof this.rectInParent.width&&(this.rectInParent.width*=t),"number"==typeof this.rectInParent.height&&(this.rectInParent.height*=t),"number"==typeof this.rectInParent.marginLeft&&(this.rectInParent.marginLeft*=t),"number"==typeof this.rectInParent.marginTop&&(this.rectInParent.marginTop*=t),"number"==typeof this.rectInParent.marginRight&&(this.rectInParent.marginRight*=t),"number"==typeof this.rectInParent.marginBottom&&(this.rectInParent.marginBottom*=t)),this.rect.calcCenter(),this.animateFrames&&this.animateFrames.length)for(var r=0,i=this.animateFrames;r<i.length;r++)(n=i[r]).initState&&(n.initState.scale||(n.initState=new $e(n.initState)),n.initState.scale(t,e)),n.state&&(n.state.scale||(n.state=new $e(n.state)),n.state.scale(t,e)),n.initState&&n.state&&(n.state.fontSize=n.initState.fontSize);if(this.scalePoints(t,t),this.elementRendered=!1,this.init(),this.children)for(var n,o=0,s=this.children;o<s.length;o++)(n=s[o]).scale(t,e);this.animateReady&&this.animateReady.scale&&this.animateReady.scale(t,e)},$e.prototype.scalePoints=function(e,r){var i=this;(this.points||this.manualAnchors)&&this.oldRect&&(e=e||this.rect.width/this.oldRect.width,r=r||this.rect.height/this.oldRect.height,this.points&&this.points.forEach(function(t){t.x=i.rect.x+(t.x-i.oldRect.x)*e,t.y=i.rect.y+(t.y-i.oldRect.y)*r}),this.manualAnchors&&this.manualAnchors.forEach(function(t){t.x=i.rect.x+(t.x-i.oldRect.x)*e,t.y=i.rect.y+(t.y-i.oldRect.y)*r}))},$e.prototype.translate=function(e,r){if(this.rect.x+=e,this.rect.y+=r,this.rect.ex=this.rect.x+this.rect.width,this.rect.ey=this.rect.y+this.rect.height,this.rect.calcCenter(),this.animateReady&&this.animateReady.translate(e,r),this.animateFrames&&this.animateFrames.length)for(var t=0,i=this.animateFrames;t<i.length;t++){var n=i[t],o=n.initState,n=n.state;o&&o.translate&&o.translate(e,r),n&&n.translate&&n.translate(e,r)}if(this.points&&this.points.forEach(function(t){t.x+=e,t.y+=r}),this.manualAnchors&&this.manualAnchors.forEach(function(t){t.x+=e,t.y+=r}),this.init(),this.children)for(var s=0,a=this.children;s<a.length;s++)a[s].translate(e,r)},$e.prototype.initRect=function(){if(this.rect.init(),this.children){this.calcChildrenRect();for(var t=0,e=this.children;t<e.length;t++){var r=e[t];r instanceof $e&&r.initRect()}}},$e.prototype.pushPoint=function(t){var e=this;this.points.push(t),this.rect||(this.rect=new x(0,0,0,0)),this.points.forEach(function(t){(!e.rect.x||e.rect.x>t.x)&&(e.rect.x=t.x),(!e.rect.y||e.rect.y>t.y)&&(e.rect.y=t.y),e.rect.ex<t.x&&(e.rect.ex=t.x),e.rect.ey<t.y&&(e.rect.ey=t.y)}),this.rect.width=this.rect.ex-this.rect.x,this.rect.height=this.rect.ey-this.rect.y},$e.prototype.nearestAnchor=function(t){for(var e=99999,r=0,i=0;i<this.rotatedAnchors.length;++i){var n=xt(t,this.rotatedAnchors[i]);n<e&&(e=n,r=i)}return{index:r,direction:this.rotatedAnchors[r].direction}},$e.prototype.hitInSelf=function(t,e){if(void 0===e&&(e=0),this.rotate%360==0)return this.rect.hit(t,e);for(var e=this.rect.toPoints(),r=0,i=e;r<i.length;r++)i[r].rotate(this.rotate,this.rect.center);return d(t,e)},$e.prototype.hit=function(t,e){var r;if(this.hitInSelf(t,e=void 0===e?0:e)&&(r=this),this.children)for(var i=this.children.length-1;-1<i;--i){var n=this.children[i].hit(t,e);if(n){r=n;break}}return r},$e.prototype.round=function(){if(this.rect.round(),this.children)for(var t=0,e=this.children;t<e.length;t++)e[t].rect.round()},$e.prototype.clone=function(){var t=new $e(this);return t.setTID(this.TID),t.elementRendered=!1,t.elementLoaded=!1,"div"!==this.name&&(t.elementId=""),this.setChildrenIds(),t},$e);function $e(e,r){var i=He.call(this)||this;i.imageRatio=!0,i.points=[],i.anchors=[],i.manualAnchors=[],i.rotatedAnchors=[],i.animateDuration=0,i.animateFrames=[],i.animateFrame=0;if(i.fromData({zRotate:0,borderRadius:0,imageAlign:"center",gradientAngle:0,gradientRadius:.01,paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0,animateFrame:0,children:[]},e),i.type=b.Node,r||(delete i.elementLoaded,delete i.elementRendered),delete i.animateReady,e.children&&e.children[0]&&e.children[0].parentRect&&(i.paddingLeft=e.children[0].parentRect.offsetX,i.paddingRight=0,i.paddingTop=e.children[0].parentRect.offsetY,i.paddingBottom=0),e.parentRect&&(i.rectInParent={x:100*e.parentRect.x+"%",y:100*e.parentRect.y+"%",width:100*e.parentRect.width+"%",height:100*e.parentRect.height+"%",marginTop:0,marginRight:0,marginBottom:0,marginLeft:0,rotate:e.parentRect.rotate},i.paddingTop=e.parentRect.marginY,i.paddingBottom=e.parentRect.marginY,i.paddingLeft=e.parentRect.marginX,i.paddingRight=e.parentRect.marginX),e.points&&(i.points=[],e.points.forEach(function(t){i.points.push(new u(t.x,t.y))})),e.manualAnchors&&(i.manualAnchors=[],e.manualAnchors.forEach(function(t){t=new u(t.x,t.y);t.id=e.id,i.manualAnchors.push(t)})),r&&(i.animateFrames=void 0),!r&&e.animateFrames&&e.animateFrames.length){for(var t=0,n=e.animateFrames;t<n.length;t++){var o=n[t];o.children=void 0,o.initState&&(o.initState=$e.cloneState(o.initState)),o.state=$e.cloneState(o.state)}i.animateFrames=e.animateFrames}return i.animateType=e.animateType||(e.animateDuration?"custom":""),i.init(r),e.init&&e.img&&!e.image&&(i.img=e.img),e.children&&(i.children=[],e.children.forEach(function(t){var e;t.TID=i.TID,t.type===b.Line?(e=new We(t)).calcRectByParent(i):((e=new $e(t)).parentId=i.id,e.calcRectByParent(i),e.init(r)),i.children.push(e)})),i}function Je(t){var e=document.createElement("div");return e.style.position="absolute",e.style.outline="none",e.style.left="-9999px",e.style.bottom="-9999px",e.style.width=t.rect.width+"px",e.style.height=t.rect.height+"px",t.elementId&&(e.id=t.elementId),e}function Ze(t,e,r){var i=document.createElement("script");i.type="text/javascript",i.src=t,i.addEventListener("load",function(){e&&e(),r&&p.Store.set("LT:render",!0)}),document.body.appendChild(i)}function tr(t){for(var r=[],e=0,i=t;e<i.length;e++){var n=i[e];if(n instanceof Qe){var o=n.rect.toPoints();if(n.rotate)for(var s=0,a=o;s<a.length;s++)a[s].rotate(n.rotate,n.rect.center);r.push.apply(r,o)}else if(n instanceof We)if(n.children)n.children.forEach(function(t){if(r.push(t.from),r.push(t.to),Array.isArray(t.controlPoints)&&r.push.apply(r,t.controlPoints),"curve"===t.name)for(var e=.01;e<1;e+=.02)r.push(Pt(e,t.from,t.controlPoints[0],t.controlPoints[1],t.to))});else if(n.from&&(r.push(n.from),r.push(n.to),Array.isArray(n.controlPoints)&&r.push.apply(r,n.controlPoints),"curve"===n.name))for(var c=.01;c<1;c+=.02)r.push(Pt(c,n.from,n.controlPoints[0],n.controlPoints[1],n.to))}var h=er(r),l=h.x1,u=h.y1,t=h.x2,h=h.y2;return new x(l,u,t-l,h-u)}function er(t){for(var e=1/0,r=1/0,i=-1/0,n=-1/0,o=0,s=t;o<s.length;o++)var a=s[o],c=a.x,a=a.y,e=Math.min(e,c),r=Math.min(r,a),i=Math.max(i,c),n=Math.max(n,a);return{x1:e,y1:r,x2:i,y2:n}}function rr(){return/Android|webOS|iPad|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)}function ir(t,e){var r={pens:[],lineName:"curve",fromArrow:"",toArrow:"triangleSolid",scale:1,locked:Ve.None};if("string"==typeof t&&(t=JSON.parse(t)),(r=Object.assign(r,t)).pens=[],t){if(t.nodes){for(var i=0,n=t.nodes;i<n.length;i++)(o=n[i]).TID=e,r.pens.push(new Qe(o));for(var o,s=0,a=t.lines;s<a.length;s++)(o=a[s]).TID=e,r.pens.push(new We(o))}t.pens&&t.pens.forEach(function(t){e&&(t.TID=e),t.type?r.pens.push(new We(t)):r.pens.push(new Qe(t))}),t.bkImageRect&&(r.bkImageRect=new x(t.bkImageRect.x,t.bkImageRect.y,t.bkImageRect.width,t.bkImageRect.height))}return r.mqttOptions?(t="",t="object"==typeof r.mqttOptions?JSON.stringify(r.mqttOptions):r.mqttOptions+"",r.mqttOptions=JSON.parse(t)):r.mqttOptions={clientId:h()},e&&p.Store.set(e+"-topology-data",r),r}(nr=Ve=Ve||{})[nr.None=0]="None",nr[nr.Readonly=1]="Readonly",nr[nr.NoMove=2]="NoMove",nr[nr.NoEvent=10]="NoEvent",(Xe=Ye=Ye||{})[Xe.Default=0]="Default",Xe[Xe.In=1]="In",Xe[Xe.Out=2]="Out";var nr=(or.prototype.generateStoreKey=function(t){return this.TID+"-"+t},or.prototype.destroy=function(){this.subcribe.unsubscribe()},or);function or(t){var e=this;this.TID=t,this.subcribe=p.Store.subscribe(this.generateStoreKey("topology-data"),function(t){e.data=t})}var sr,ar,Xe=((sr=function(t,e){return(sr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}sr(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)})(cr,ar=nr),cr.prototype.resize=function(t){t?(this.width=0|t.width,this.height=0|t.height):(this.options.width&&"auto"!==this.options.width?this.width=+this.options.width:this.width=this.parentElem.clientWidth,this.options.height&&"auto"!==this.options.height?this.height=+this.options.height:this.height=this.parentElem.clientHeight),this.canvas.style.width=this.width+"px",this.canvas.style.height=this.height+"px",this.canvas.width=this.width*cr.dpiRatio|0,this.canvas.height=this.height*cr.dpiRatio|0,this.canvas.getContext("2d").scale(cr.dpiRatio,cr.dpiRatio),p.Store.set(this.generateStoreKey("LT:size"),{width:this.canvas.width,height:this.canvas.height})},cr.prototype.render=function(){this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height)},cr.prototype.getDpiRatio=function(){return cr.dpiRatio},cr.prototype.destroy=function(){this.subcribe.unsubscribe()},cr.dpiRatio=0,cr);function cr(t,e,r){void 0===e&&(e={});var i=ar.call(this,r)||this;return i.parentElem=t,i.options=e,i.canvas=document.createElement("canvas"),i.width=0,i.height=0,i.subcribe=p.Store.subscribe(i.generateStoreKey("topology-data"),function(t){i.data=t}),i.canvas.style.position="absolute",i.canvas.style.left="0",i.canvas.style.top="0",i.canvas.style.outline="none",cr.dpiRatio||(e.extDpiRatio||0===e.extDpiRatio||(window&&1<window.devicePixelRatio?e.extDpiRatio=.25:e.extDpiRatio=0),cr.dpiRatio=(window?window.devicePixelRatio:0)+e.extDpiRatio,cr.dpiRatio<1&&(cr.dpiRatio=1)),i}var hr,lr,ur=((hr=function(t,e){return(hr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}hr(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)})(dr,lr=Xe),dr.prototype.render=function(){lr.prototype.render.call(this);var t=this.canvas.getContext("2d");t.strokeStyle=this.options.color;for(var e=0,r=this.data.pens;e<r.length;e++){var i=r[e];i.getTID()||i.setTID(this.TID),i.render(t)}this.activeLayer.render(t),this.animateLayer.render(t),this.hoverLayer.render(t)},dr);function dr(t,e,r){r=lr.call(this,t,e=void 0===e?{}:e,r)||this;return r.parentElem=t,r.options=e,r.activeLayer=p.Store.get(r.generateStoreKey("LT:ActiveLayer")),r.hoverLayer=p.Store.get(r.generateStoreKey("LT:HoverLayer")),r.animateLayer=p.Store.get(r.generateStoreKey("LT:AnimateLayer")),p.Store.set(r.generateStoreKey("LT:offscreen"),r.canvas),r}var pr,fr,yr=((pr=function(t,e){return(pr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}pr(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)})(gr,fr=Xe),gr.prototype.loadBkImg=function(t){var e=this;this.data.bkImage&&(this.bkImg=new Image,this.bkImg.crossOrigin="anonymous",this.bkImg.src=this.data.bkImage,this.bkImg.onload=function(){e.data.bkImageRect||(e.data.bkImageRect=new x(0,0,e.bkImg.naturalWidth,e.bkImg.naturalHeight)),t&&t()})},gr.prototype.clearBkImg=function(){this.bkImg=void 0},gr.prototype.rule=function(){var t=this.canvas.getContext("2d");t.save(),t.lineWidth=1,t.strokeStyle=wt(.7,this.data.ruleColor||this.options.ruleColor||"#888"),t.beginPath();for(var e=10;e<this.width;e+=10)t.moveTo(e,0),t.lineTo(e,5);for(e=10;e<this.height;e+=10)t.moveTo(0,e),t.lineTo(5,e);t.stroke(),t.beginPath(),t.strokeStyle=this.data.ruleColor||this.options.ruleColor||"#888",t.fillStyle=t.strokeStyle;for(e=100;e<this.width;e+=100)t.moveTo(e,0),t.lineTo(e,10),t.fillText(e.toString(),e+4,16);for(e=100;e<this.height;e+=100)t.moveTo(0,e),t.lineTo(10,e);t.stroke();for(e=100;e<this.height;e+=100)t.save(),t.beginPath(),t.translate(16,e-4),t.rotate(270*Math.PI/180),t.fillText(e.toString(),0,0),t.restore();t.restore()},gr.prototype.grid=function(){var t=this.canvas.getContext("2d");t.save(),t.lineWidth=1,t.strokeStyle=this.data.gridColor||this.options.gridColor||"#f3f3f3",t.beginPath();for(var e=this.data.gridSize||this.options.gridSize,r=e;r<this.width;r+=e)t.moveTo(r,0),t.lineTo(r,this.height);for(r=e;r<this.height;r+=e)t.moveTo(0,r),t.lineTo(this.width,r);t.stroke(),t.restore()},gr);function gr(t,e,r){var i=fr.call(this,t,e=void 0===e?{}:e,r)||this;return i.parentElem=t,i.options=e,i.render=function(){var t;i.data&&i.data.bkImage&&!i.bkImg?i.loadBkImg(i.render):i.width&&i.height&&i.offscreen&&((t=i.canvas.getContext("2d")).clearRect(0,0,i.canvas.width,i.canvas.height),(i.data.bkColor||i.options.bkColor)&&(t.fillStyle=i.data.bkColor||i.options.bkColor,t.fillRect(0,0,i.width,i.height)),i.bkImg&&i.data.bkImageRect&&t.drawImage(i.bkImg,i.data.bkImageRect.x,i.data.bkImageRect.y,i.data.bkImageRect.width,i.data.bkImageRect.height),(i.data.grid||i.options.grid)&&i.grid(),(i.data.rule||i.options.rule)&&i.rule(),t.drawImage(i.offscreen,0,0,i.width,i.height))},i.offscreen=p.Store.get(i.generateStoreKey("LT:offscreen")),i.parentElem.appendChild(i.canvas),i.data=p.Store.get(i.generateStoreKey("topology-data")),i}var mr,vr,wr=((mr=function(t,e){return(mr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}mr(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)})(br,vr=nr),br.prototype.lineTo=function(t,e){void 0===e&&(e="triangleSolid"),this.line&&!this.line.locked&&(this.line.setTo(t,e),(this.line.from.id||this.line.to.id)&&this.line.calcControlPoints(),p.Store.set(this.generateStoreKey("pts-")+this.line.id,void 0),p.Store.set(this.generateStoreKey("LT:updateLines"),[this.line]))},br.prototype.lineFrom=function(t){this.line.locked||(this.line.setFrom(t,this.line.fromArrow),(this.line.from.id||this.line.to.id)&&this.line.calcControlPoints(),p.Store.set(this.generateStoreKey("pts-")+this.line.id,void 0),p.Store.set(this.generateStoreKey("LT:updateLines"),[this.line]))},br.prototype.render=function(n){var t,o=this;if(this.data.locked!==Ve.NoEvent&&"transparent"!==this.options.hoverColor){if(n.fillStyle=this.options.hoverColor,n.save(),this.options.alwaysAnchor&&this.data.pens.forEach(function(t){if(t.type!==b.Line&&!t.hideAnchor){for(var e=0,r=t.rotatedAnchors;e<r.length;e++){var i=r[e];i.hidden||(n.beginPath(),n.arc(i.x,i.y,i.radius||o.options.anchorRadius,0,2*Math.PI),n.strokeStyle=i.strokeStyle||o.options.hoverColor,n.fillStyle=i.fillStyle||o.options.anchorFillStyle,n.fill(),n.stroke())}o.options.autoAnchor&&(n.beginPath(),n.arc(t.rect.center.x,t.rect.center.y,t.rect.center.radius||o.options.anchorRadius,0,2*Math.PI),n.strokeStyle=o.options.hoverColor,n.fillStyle=o.options.anchorFillStyle,n.fill(),n.stroke())}}),n.restore(),this.node&&!this.data.locked){if(this.node.getTID()||this.node.setTID(this.TID),this.root=this.getRoot(this.node)||this.node,this.root&&(n.save(),n.strokeStyle=this.options.dragColor,n.globalAlpha=.2,this.root.rotate&&(n.translate(this.root.rect.center.x,this.root.rect.center.y),n.rotate((this.root.rotate+this.root.offsetRotate)*Math.PI/180),n.translate(-this.root.rect.center.x,-this.root.rect.center.y)),n.beginPath(),n.strokeRect(this.root.rect.x,this.root.rect.y,this.root.rect.width,this.root.rect.height),n.restore()),!this.options.hideAnchor)for(var e=0;e<this.node.rotatedAnchors.length;++e)this.node.locked||this.node.hideAnchor||this.node.rotatedAnchors[e].hidden&&this.hoverAnchorIndex!==e||(n.beginPath(),n.arc(this.node.rotatedAnchors[e].x,this.node.rotatedAnchors[e].y,this.node.rotatedAnchors[e].radius||this.options.anchorRadius,0,2*Math.PI),n.strokeStyle=this.node.rotatedAnchors[e].strokeStyle||this.options.hoverColor,n.fillStyle=this.node.rotatedAnchors[e].fillStyle||this.options.anchorFillStyle,n.fill(),n.stroke());this.options.autoAnchor&&(n.beginPath(),n.arc(this.node.rect.center.x,this.node.rect.center.y,this.node.rect.center.radius||this.options.anchorRadius,0,2*Math.PI),n.strokeStyle=this.options.hoverColor,n.fillStyle=this.options.anchorFillStyle,n.fill(),n.stroke())}this.line&&!this.data.locked&&(this.root=this.getRoot(this.line),this.root&&(n.save(),n.strokeStyle=this.options.dragColor,n.globalAlpha=.2,this.root.rotate&&(n.translate(this.root.rect.center.x,this.root.rect.center.y),n.rotate((this.root.rotate+this.root.offsetRotate)*Math.PI/180),n.translate(-this.root.rect.center.x,-this.root.rect.center.y)),n.beginPath(),n.strokeRect(this.root.rect.x,this.root.rect.y,this.root.rect.width,this.root.rect.height),n.restore())),this.dockAnchor&&(n.save(),n.beginPath(),n.arc(this.dockAnchor.x,this.dockAnchor.y,this.dockAnchor.radius||this.options.anchorRadius,0,2*Math.PI),n.strokeStyle=this.options.dockStrokeStyle,n.fillStyle=this.options.dockFillStyle,n.fill(),n.stroke(),n.restore()),this.hoverLineCP&&(n.beginPath(),n.arc(this.hoverLineCP.x,this.hoverLineCP.y,5,0,2*Math.PI),n.fill()),n.strokeStyle=wt(.5,this.options.hoverColor),n.lineWidth=1,0<this.dockLineX&&(t=p.Store.get(this.generateStoreKey("LT:size")),n.beginPath(),n.moveTo(this.dockLineX,0),n.lineTo(this.dockLineX,t.height),n.stroke()),0<this.dockLineY&&(t=p.Store.get(this.generateStoreKey("LT:size")),n.beginPath(),n.moveTo(0,this.dockLineY),n.lineTo(t.width,this.dockLineY),n.stroke()),this.dragRect&&(n.fillStyle=wt(.2,this.options.dragColor),n.strokeStyle=this.options.dragColor,n.beginPath(),n.strokeRect(this.dragRect.x,this.dragRect.y,this.dragRect.width,this.dragRect.height),n.fillRect(this.dragRect.x,this.dragRect.y,this.dragRect.width,this.dragRect.height))}},br.prototype.getRoot=function(t){if(!t.parentId)return null;for(var e=0,r=this.data.pens;e<r.length;e++){var i=r[e];if(i.id===t.parentId){var n=this.getRoot(i);return n||i}}return null},br.prototype.clear=function(){this.node=void 0,this.line=void 0},br);function br(t,e){void 0===t&&(t={});e=vr.call(this,e)||this;return e.options=t,e.hoverAnchorIndex=-1,e.dockLineX=0,e.dockLineY=0,p.Store.set(e.generateStoreKey("LT:HoverLayer"),e),e}var xr,Sr,_r=((xr=function(t,e){return(xr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}xr(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)})(kr,Sr=nr),kr.prototype.calcControlPoints=function(){if(1===this.pens.length&&this.pens[0]instanceof Qe){if(this.rect=this.pens[0].rect,this.sizeCPs=this.pens[0].rect.toPoints(),this.rotateCPs=[new u(this.pens[0].rect.x+this.pens[0].rect.width/2,this.pens[0].rect.y-35),new u(this.pens[0].rect.x+this.pens[0].rect.width/2,this.pens[0].rect.y)],this.rotate||this.pens[0].rotate){for(var t=0,e=this.sizeCPs;t<e.length;t++){var r=e[t];this.pens[0].rotate&&r.rotate(this.pens[0].rotate,this.pens[0].rect.center),this.rotate&&r.rotate(this.rotate,this.rect.center)}for(var i=0,n=this.rotateCPs;i<n.length;i++){r=n[i];this.pens[0].rotate&&r.rotate(this.pens[0].rotate,this.pens[0].rect.center),this.rotate&&r.rotate(this.rotate,this.rect.center)}}(this.options.hideRotateCP||this.pens[0].hideRotateCP)&&(this.rotateCPs=[new u(-1e3,-1e3),new u(-1e3,-1e3)])}else{var o=er(this.getPoints()),s=o.x1,a=o.y1,c=o.x2,o=o.y2;this.rect=new x(s,a,c-s,o-a),this.sizeCPs=[new u(s,a),new u(c,a),new u(c,o),new u(s,o)],this.rotateCPs=[new u(s+(c-s)/2,a-35),new u(s+(c-s)/2,a)],this.options.hideRotateCP&&(this.rotateCPs=[new u(-1e3,-1e3),new u(-1e3,-1e3)])}},kr.prototype.locked=function(){for(var t=0,e=this.pens;t<e.length;t++)if(!e[t].locked)return!1;return!0},kr.prototype.getPoints=function(){for(var r=[],t=0,e=this.pens;t<e.length;t++){var i=e[t];if(i.type===b.Node){var n=i.rect.toPoints();if(i.rotate)for(var o=0,s=n;o<s.length;o++)s[o].rotate(i.rotate,i.rect.center);r.push.apply(r,n)}else if(i instanceof We)if(i.children)i.children.forEach(function(t){if(r.push(t.from),r.push(t.to),"curve"===t.name)for(var e=.01;e<1;e+=.02)r.push(Pt(e,t.from,t.controlPoints[0],t.controlPoints[1],t.to))});else if(i.from&&(r.push(i.from),r.push(i.to),"curve"===i.name))for(var a=.01;a<1;a+=.02)r.push(Pt(a,i.from,i.controlPoints[0],i.controlPoints[1],i.to))}return r},kr.prototype.clear=function(){this.pens=[],this.sizeCPs=[],this.rotateCPs=[],p.Store.set(this.generateStoreKey("LT:activeNode"),void 0)},kr.prototype.saveNodeRects=function(){this.nodeRects=[],this.childrenRects={};for(var t=0,e=this.pens;t<e.length;t++)(n=e[t]).type&&n.from?this.nodeRects.push(new x(n.from.x,n.from.y,n.rect.width,n.rect.height)):this.nodeRects.push(new x(n.rect.x,n.rect.y,n.rect.width,n.rect.height)),this.saveChildrenRects(n);this.initialSizeCPs=[];for(var r=0,i=this.sizeCPs;r<i.length;r++){var n=i[r];this.initialSizeCPs.push(n.clone())}this.getDockWatchers()},kr.prototype.saveChildrenRects=function(t){if(!t.type&&t.children)for(var e=0,r=t.children;e<r.length;e++){var i=r[e];this.childrenRects[i.id]=new x(i.rect.x,i.rect.y,i.rect.width,i.rect.height),this.childrenRotate[i.id]=i.rotate,this.saveChildrenRects(i)}},kr.prototype.resize=function(t,e,r){var i=new u(e.x,e.y),e=new u(r.x,r.y);1===this.pens.length&&this.pens[0].rotate%360&&(i.rotate(-this.pens[0].rotate,this.nodeRects[0].center),e.rotate(-this.pens[0].rotate,this.nodeRects[0].center));var n=e.x-i.x,o=e.y-i.y;switch(t){case 0:n=-n,o=-o;break;case 1:o=-o;break;case 3:n=-n}for(var s=0,a=0,c=this.pens;a<c.length;a++){var h=c[a];if(!h.locked){if(h.type!==b.Line){switch(h.oldRect=h.rect.clone(),this.options.disableSizeX||r.altKey||h.disableSizeX||(h.rect.width=this.nodeRects[s].width+n),this.options.disableSizeY||r.ctrlKey||h.disableSizeY||(h.rect.height=this.nodeRects[s].height+o),t){case 0:h.rect.x=h.rect.ex-h.rect.width,h.rect.y=h.rect.ey-h.rect.height;break;case 1:h.rect.ex=h.rect.x+h.rect.width,h.rect.y=h.rect.ey-h.rect.height;break;case 2:h.rect.ex=h.rect.x+h.rect.width,h.rect.ey=h.rect.y+h.rect.height;break;case 3:h.rect.x=h.rect.ex-h.rect.width,h.rect.ey=h.rect.y+h.rect.height}h.scalePoints(),h.rect.calcCenter(),h.init(),h.calcChildrenRect()}++s}}this.updateLines()},kr.prototype.move=function(l,u){if(this.nodeRects.length===this.pens.length){for(var d=0,p=this,t=0,e=this.pens;t<e.length;t++)!function(t){if(t.locked)return;if(t instanceof Qe){var e=p.nodeRects[d].x+l-t.rect.x,r=p.nodeRects[d].y+u-t.rect.y;t.translate(e,r);for(var i=0,n=p.getLinesOfNode(t);i<n.length;i++)n[i].translate(e,r);if(t.calcChildrenRect(),t.parentId&&!t.locked)for(var o=0,s=p.data.pens;o<s.length;o++){var a=s[o];if(a.id===t.parentId){t.calcRectInParent(a);break}}}var c,h;t instanceof We&&t.from&&(c=p.nodeRects[d].x+l-t.from.x,h=p.nodeRects[d].y+u-t.from.y,t.parentId?y(t.parentId,p.data.pens).forEach(function(t){t.translate(c,h)}):t.translate(c,h)),++d}(e[t]);this.updateLines(),this.topology.dispatch("move",this.pens)}},kr.prototype.getLinesOfNode=function(t){for(var e=[],r=f([t]),i=0,n=this.data.pens;i<n.length;i++){var o=n[i];if(o instanceof We){for(var s=o,a=!1,c=!1,h=0,l=r.nodes;h<l.length;h++){var u=l[h];s.from&&s.from.id===u.id&&(a=!0),s.to&&s.to.id===u.id&&(c=!0)}a&&c&&e.push(s)}}return e},kr.prototype.updateLines=function(t){for(var e=f(t=t||this.pens),t=f(this.data.pens),r=[],i=f(this.data.pens).nodes,n=0,o=t.lines;n<o.length;n++)for(var s=o[n],a=e.nodes,c=0,h=a=this.options.autoAnchor?i:a;c<h.length;c++){var l,u=h[c],d=0;s.from&&s.from.id===u.id&&(s.from.autoAnchor&&-1<(l=u.nearestAnchor(s.to)).index&&(s.from.anchorIndex=l.index,s.from.direction=l.direction),0<=s.from.anchorIndex&&(s.from.x=u.rotatedAnchors[s.from.anchorIndex].x,s.from.y=u.rotatedAnchors[s.from.anchorIndex].y,++d)),s.to&&s.to.id===u.id&&(s.to.autoAnchor&&-1<(l=u.nearestAnchor(s.from)).index&&(s.to.anchorIndex=l.index,s.to.direction=l.direction),0<=s.to.anchorIndex&&(s.to.x=u.rotatedAnchors[s.to.anchorIndex].x,s.to.y=u.rotatedAnchors[s.to.anchorIndex].y,++d)),d&&!this.data.manualCps&&s.calcControlPoints(),s.textRect=void 0,p.Store.set(this.generateStoreKey("pts-")+s.id,void 0),r.push(s)}p.Store.set(this.generateStoreKey("LT:updateLines"),r)},kr.prototype.offsetRotate=function(t){this.rotating=!0;for(var e=0,r=0,i=this.pens;r<i.length;r++){var n,o=i[r];o instanceof Qe&&(n=this.nodeRects[e].center.clone(),1<this.pens.length&&n.rotate(t,this.rect.center),o.rect.x=n.x-o.rect.width/2,o.rect.y=n.y-o.rect.height/2,o.rect.ex=o.rect.x+o.rect.width,o.rect.ey=o.rect.y+o.rect.height,o.rect.calcCenter(),o.init(),o.offsetRotate=t,o.calcRotateAnchors(o.rotate+o.offsetRotate),this.rotateChildren(o),++e)}this.rotate=t,this.topology.dispatch("rotated",this.pens)},kr.prototype.rotateChildren=function(t){if(t.type===b.Node&&t.children)for(var e=0,r=t.children;e<r.length;e++){var i,n,o,s=r[e];s.type===b.Node&&(i=this.childrenRects[s.id].center.clone(),n=this.childrenRects[s.id].center.clone().rotate(this.rotate,this.rect.center),(o=this.childrenRects[s.id].clone()).translate(n.x-i.x,n.y-i.y),s.rect=o,s.rotate=this.childrenRotate[s.id]+this.rotate,s.init(),this.rotateChildren(s))}},kr.prototype.updateRotate=function(){for(var t=0,e=this.pens;t<e.length;t++){var r=e[t];r.rotate+=r.offsetRotate,r.type===b.Node&&r.rectInParent&&(r.rectInParent.rotate+=r.offsetRotate),r.offsetRotate=0}this.rotate=0,this.rotating=!1},kr.prototype.add=function(t){this.has(t)||(this.pens.push(t),t instanceof Qe&&p.Store.set(this.generateStoreKey("LT:activeNode"),t))},kr.prototype.setPens=function(t){this.pens=t,1===this.pens.length&&this.pens[0]instanceof Qe&&p.Store.set(this.generateStoreKey("LT:activeNode"),this.pens[0])},kr.prototype.has=function(t){for(var e=0,r=this.pens;e<r.length;e++)if(r[e].id===t.id)return!0},kr.prototype.hasInAll=function(t,e){for(var r=0,i=e=e||this.pens;r<i.length;r++){var n=i[r];if(n.id===t.id)return!0;if(n.children)if(this.hasInAll(t,n.children))return!0}},kr.prototype.render=function(t){var e=this;if(!(this.data.locked>Ve.Readonly||"transparent"===this.options.activeColor)&&this.pens.length){this.pens.forEach(function(t){t.getTID()||t.setTID(e.TID)}),1!==this.pens.length&&this.rotating||this.calcControlPoints(),t.save(),t.strokeStyle=this.options.activeColor,t.fillStyle="#fff",t.lineWidth=1;for(var r=this.TID,i=p.Store.get(this.generateStoreKey("LT:scale"))||1,n=0,o=this.pens;n<o.length;n++){var s,a=o[n];this.data.locked&&a instanceof Qe&&((s=new Qe(a)).setTID(r),s.data=void 0,s.fillStyle=void 0,s.bkType=0,s.icon="",s.image="",s.text="","transparent"!==s.strokeStyle&&(s.strokeStyle="#ffffff",s.lineWidth+=2,s.render(t),s.strokeStyle=this.options.activeColor,s.lineWidth-=2),s.render(t)),a instanceof We&&((s=new We(a)).lineWidth*=2,s.toArrowSize=(s.toArrowSize*i-1.5*s.lineWidth)/i,s.fromArrowSize=(s.fromArrowSize*i-1.5*s.lineWidth)/i,s.setTID(r),s.strokeStyle=wt(.2,this.options.activeColor),s.borderWidth=4,s.borderColor=wt(.1,this.options.activeColor),s.fromArrowColor=this.options.activeColor,s.toArrowColor=this.options.activeColor,s.render(t),this.data.locked||a.locked||De[a.name]&&De[a.name].drawControlPointsFn(t,a))}if(1!==this.pens.length||this.pens[0].type!==b.Line)if(this.rotate&&1<this.pens.length&&(t.translate(this.rect.center.x,this.rect.center.y),t.rotate(this.rotate*Math.PI/180),t.translate(-this.rect.center.x,-this.rect.center.y)),this.data.locked||this.locked())t.restore();else{if(t.save(),t.globalAlpha=.3,t.translate(.5,.5),t.beginPath(),t.moveTo(this.sizeCPs[0].x,this.sizeCPs[0].y),t.lineTo(this.sizeCPs[1].x,this.sizeCPs[1].y),t.lineTo(this.sizeCPs[2].x,this.sizeCPs[2].y),t.lineTo(this.sizeCPs[3].x,this.sizeCPs[3].y),t.closePath(),t.stroke(),t.restore(),t.beginPath(),t.moveTo(this.rotateCPs[0].x,this.rotateCPs[0].y),t.lineTo(this.rotateCPs[1].x,this.rotateCPs[1].y),t.stroke(),t.beginPath(),t.arc(this.rotateCPs[0].x,this.rotateCPs[0].y,5,0,2*Math.PI),t.fill(),t.stroke(),!this.options.hideSizeCP&&(1<this.pens.length||!this.pens[0].hideSizeCP)){t.lineWidth=1;for(var c=0,h=this.sizeCPs;c<h.length;c++){a=h[c];t.save(),t.beginPath(),1===this.pens.length&&(this.pens[0].rotate||this.rotate)&&(t.translate(a.x,a.y),t.rotate((this.pens[0].rotate+this.rotate)*Math.PI/180),t.translate(-a.x,-a.y)),t.fillRect(a.x-4.5,a.y-4.5,8,8),t.strokeRect(a.x-5.5,a.y-5.5,10,10),t.restore()}}t.restore()}}},kr.prototype.getDockWatchers=function(){if(1===this.pens.length)return this.dockWatchers=this.nodeRects[0].toPoints(),void this.dockWatchers.unshift(this.nodeRects[0].center);this.rect&&(this.dockWatchers=this.rect.toPoints(),this.dockWatchers.unshift(this.rect.center))},kr);function kr(t,e){void 0===t&&(t={});e=Sr.call(this,e)||this;return e.options=t,e.rotateCPs=[],e.sizeCPs=[],e.pens=[],e.rotate=0,e.initialSizeCPs=[],e.nodeRects=[],e.childrenRects={},e.childrenRotate={},e.dockWatchers=[],e.rotating=!1,p.Store.set(e.generateStoreKey("LT:ActiveLayer"),e),e}var Ir,Lr,Pr=((Ir=function(t,e){return(Ir=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}Ir(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)})(Tr,Lr=nr),Tr.prototype.getAnimateLine=function(t){var e=new We(t);return e.data=e.id,e.id=h(),e.setTID(this.TID),e.isAnimate=!0,e.toArrow="",e.fromArrow&&e.fromArrow.indexOf("line")<0&&(e.animateFromSize=e.fromArrowSize+5*e.lineWidth),e.toArrow&&e.toArrow.indexOf("line")<0&&(e.animateToSize=e.toArrowSize+5*e.lineWidth),e.animateStart=t.animateStart,e.lineCap="round",e.fillStyle="#fff",e.strokeStyle=e.animateColor||this.options.animateColor,e.length=e.getLen(),e.fromArrowColor||(e.fromArrowColor=e.strokeStyle||p.Store.get(this.generateStoreKey("LT:color"))),e.toArrowColor||(e.toArrowColor=e.strokeStyle||p.Store.get(this.generateStoreKey("LT:color"))),e},Tr.prototype.findLine=function(t){for(var e=0,r=this.data.pens;e<r.length;e++){var i=r[e];if(i.id===t.data)return i}},Tr.prototype.readyPlay=function(e,r,t){var i=this,n=new Map;(t=t||this.data.pens).forEach(function(t){t.setTID(i.TID),t.visible&&!n.get(t.id)&&((r&&t.animatePlay||e&&-1<t.tags.indexOf(e))&&(!t.animateStart||t.animateStart<1)&&(t.animateStart=Date.now()),t instanceof Qe?(0<t.animateStart&&(t.animateReady||t.initAnimate(),n.set(t.id,t)),t.children&&t.children.length&&i.readyPlay(e,r,t.children)):0<t.animateStart?n.set(t.id,i.getAnimateLine(t)):i.pens.has(t.id)&&(i.pens.get(t.id).animateStart=0))}),n.forEach(function(t){t.type?i.pens.set(t.data,t):i.pens.set(t.id,t)})},Tr.prototype.animate=function(){var n=this;this.timer&&cancelAnimationFrame(this.timer),this.timer=requestAnimationFrame(function(){var r,i=Date.now();i-n.lastNow<n.options.refresh?n.animate():(n.lastNow=i,r=!1,n.pens.forEach(function(t){var e;!t.animateStart||t.animateStart<1?t.type?(n.pens.delete(t.data),(e=n.findLine(t))&&(e.animateStart=0,e.animatePos=t.animatePos)):n.pens.delete(t.id):t.animateStart>i||(t.animateFn?"function"==typeof t.animateFn?t.animateFn():window&&window[t.animateFn]&&window[t.animateFn]():t.animate(i),t.animateStart<1&&(t.type?n.pens.delete(t.data):n.pens.delete(t.id),t.type===b.Line&&(e=n.findLine(t))&&(e.animateStart=0,e.animatePos=t.animatePos),t.nextAnimate&&n.readyPlay(t.nextAnimate,!1)),r=!0)}),r&&(p.Store.set(n.generateStoreKey("LT:render"),!0),n.animate()))})},Tr.prototype.updateLines=function(o){this.pens.forEach(function(t,e){if(t instanceof We)for(var r=0,i=o;r<i.length;r++){var n=i[r];t.data===n.id&&(t.from=n.from,t.to=n.to,t.controlPoints=n.controlPoints,t.length=t.getLen())}})},Tr.prototype.render=function(r){var i=this;this.pens.forEach(function(t,e){t.visible&&t instanceof We&&(t.getTID()||t.setTID(i.TID),t.render(r))})},Tr.prototype.stop=function(){this.pens.clear(),this.timer&&cancelAnimationFrame(this.timer)},Tr.prototype.destroy=function(){this.stop(),this.subscribeUpdate.unsubscribe(),this.subscribePlay.unsubscribe()},Tr);function Tr(t,e){void 0===t&&(t={});var r=Lr.call(this,e)||this;return r.options=t,r.pens=new Map,r.lastNow=0,p.Store.set(r.generateStoreKey("LT:AnimateLayer"),r),r.options.animateColor||(r.options.animateColor="#ff6600"),r.subscribeUpdate=p.Store.subscribe(r.generateStoreKey("LT:updateLines"),function(t){r.updateLines(t)}),r.subscribePlay=p.Store.subscribe(r.generateStoreKey("LT:AnimatePlay"),function(t){t.stop?(t.tag&&y(t.tag,r.data.pens).forEach(function(t){r.pens.has(t.id)&&(r.pens.get(t.id).animateStart=0)}),t.pen&&r.pens.has(t.pen.id)&&(r.pens.get(t.pen.id).animateStart=0)):(t.pen&&(r.pens.has(t.pen.id)?r.pens.get(t.pen.id).animateStart=Date.now():t.pen.type?r.pens.set(t.pen.id,r.getAnimateLine(t.pen)):r.pens.set(t.pen.id,t.pen)),t.tag&&r.readyPlay(t.tag,!1)),r.animate()}),r}var Cr,Rr,Xe=(Cr=function(t,e){return(Cr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}Cr(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),Ar={},Er=(Xe(Nr,Rr=nr),Nr.prototype.play=function(t,e){var r=this;t&&y(t,this.data.pens).forEach(function(t){r.playOne(t,e)})},Nr.prototype.playOne=function(t,e){t.audio&&this.audios[t.id]&&this.audios[t.id].media?e?this.audios[t.id].media.pause():this.audios[t.id].media.paused&&this.audios[t.id].media.play():t.video&&Ar[t.id].media&&(e?Ar[t.id].media.pause():Ar[t.id].media.paused&&Ar[t.id].media.play())},Nr.prototype.addIframe=function(t){var e=document.createElement("iframe");return e.scrolling="no",e.frameBorder="0",e.src=t.iframe,this.iframes[t.id]=e,this.canvas.appendChild(e),e},Nr.prototype.addGif=function(t){return this.gifs[t.id]=t.img,this.canvas.appendChild(t.img),t.img},Nr.prototype.clear=function(t){if(this.canvas.innerHTML="",this.audios={},Ar={},this.iframes={},this.elements={},this.gifs={},!t)for(var e in L)delete L[e];this.player.style.top="-99999px"},Nr.prototype.formatSeconds=function(t){var e=Math.floor(t/3600),r=Math.floor(t/60)%60,t=Math.floor(t%60);return e?e+":"+r+":"+t:r?r+":"+t:"0:"+t},Nr.prototype.resize=function(t){t?(this.canvas.style.width=t.width+"px",this.canvas.style.height=t.height+"px"):(this.options.width&&"auto"!==this.options.width?this.canvas.style.width=this.options.width+"px":this.canvas.style.width=this.parentElem.clientWidth+"px",this.options.height&&"auto"!==this.options.height?this.canvas.style.height=this.options.height+"px":this.canvas.style.height=this.parentElem.clientHeight-8+"px")},Nr.prototype.render=function(){for(var t=0,e=this.data.pens;t<e.length;t++){var r=e[t];r.getTID()||r.setTID(this.TID),this.addDiv(r)}},Nr.prototype.destroy=function(){Rr.prototype.destroy.call(this),this.clear(),this.subcribeDiv.unsubscribe(),this.subcribeNode.unsubscribe(),this.subcribePlay.unsubscribe()},Nr);function Nr(t,e,r){void 0===e&&(e={});var o=Rr.call(this,r)||this;return o.parentElem=t,o.options=e,o.canvas=document.createElement("div"),o.player=document.createElement("div"),o.audios={},o.iframes={},o.elements={},o.gifs={},o.addDiv=function(t){if(t.audio&&(o.audios[t.id]&&o.audios[t.id].media.src!==t.audio&&(o.audios[t.id].media.src=t.audio),setTimeout(function(){o.setElemPosition(t,o.audios[t.id]&&o.audios[t.id].player||o.addMedia(t,"audio"))})),t.video&&(Ar[t.id]&&Ar[t.id].media.src!==t.video&&(Ar[t.id].media.src=t.video),setTimeout(function(){o.setElemPosition(t,Ar[t.id]&&Ar[t.id].player||o.addMedia(t,"video"))})),t.iframe&&(o.iframes[t.id]?(o.iframes[t.id].src!==t.iframe&&(o.iframes[t.id].src=t.iframe),o.setElemPosition(t,o.iframes[t.id])):(o.addIframe(t),setTimeout(function(){o.addDiv(t)}))),t.elementId&&(o.elements[t.id]||(o.elements[t.id]=document.getElementById(t.elementId),o.elements[t.id]&&o.canvas.appendChild(o.elements[t.id])),o.setElemPosition(t,o.elements[t.id])),t.gif&&(t.image.indexOf(".gif")<0?(t.gif=!1,o.canvas.removeChild(o.gifs[t.id]),o.gifs[t.id]=void 0):t.img&&(o.gifs[t.id]&&o.gifs[t.id].src!==t.image&&(o.gifs[t.id].src=t.image),o.setElemPosition(t,o.gifs[t.id]||o.addGif(t)))),t.children)for(var e=0,r=t.children;e<r.length;e++){var i=r[e];i.type!==b.Line&&o.addDiv(i)}},o.createPlayer=function(){o.player.style.position="fixed",o.player.style.outline="none",o.player.style.top="-99999px",o.player.style.height="40px",o.player.style.padding="10px 15px",o.player.style.background="rgba(200,200,200,.1)",o.player.style.display="flex",o.player.style.alignItems="center",o.player.style.userSelect="initial",o.player.style.pointerEvents="initial",o.player.style.zIndex="1",o.playBtn=document.createElement("i"),o.currentTime=document.createElement("span"),o.progress=document.createElement("div"),o.progressCurrent=document.createElement("div"),o.loop=document.createElement("i");var t=document.createElement("i");o.playBtn.className=o.options.playIcon,o.playBtn.style.fontSize="18px",o.playBtn.style.lineHeight="20px",o.playBtn.style.cursor="pointer",o.currentTime.style.padding="0 10px",o.currentTime.innerText="0 / 0",o.progress.style.position="relative",o.progress.style.flexGrow="1",o.progress.style.top="0",o.progress.style.height="4px",o.progress.style.background="#ccc",o.progress.style.borderRadius="2px",o.progress.style.overflow="hidden",o.progress.style.cursor="pointer",o.progressCurrent.style.position="absolute",o.progressCurrent.style.left="0",o.progressCurrent.style.top="0",o.progressCurrent.style.bottom="0",o.progressCurrent.style.width="0",o.progressCurrent.style.background="#52c41a",o.loop.style.margin="0 10px",o.loop.style.padding="2px 5px",o.loop.style.borderRadius="2px",o.loop.className=o.options.loopIcon,o.loop.style.fontSize="18px",o.loop.style.lineHeight="20px",o.loop.style.cursor="pointer",t.className=o.options.fullScreenIcon,t.style.fontSize="17px",t.style.lineHeight="20px",t.style.cursor="pointer",o.player.appendChild(o.playBtn),o.player.appendChild(o.currentTime),o.player.appendChild(o.progress),o.progress.appendChild(o.progressCurrent),o.player.appendChild(o.loop),o.player.appendChild(t),o.playBtn.onclick=function(){o.media.paused?(o.media.play(),o.playBtn.className=o.options.pauseIcon):(o.media.pause(),o.playBtn.className=o.options.playIcon)},o.progress.onclick=function(t){o.media.currentTime=t.offsetX/o.progress.clientWidth*o.media.duration},o.loop.onclick=function(){o.media.loop=!o.media.loop,o.curNode.playLoop=o.media.loop,o.media.loop?o.loop.style.background="#ddd":o.loop.style.background="none"},t.onclick=function(){o.media.requestFullscreen()}},o.getMediaCurrent=function(){o.media&&(o.currentTime.innerText=o.formatSeconds(o.media.currentTime)+" / "+o.formatSeconds(o.media.duration),o.progressCurrent.style.width=o.media.currentTime/o.media.duration*o.progress.clientWidth+"px")},o.addMedia=function(t,e){var r=document.createElement("div"),i=document.createElement("div"),n=document.createElement(e);return r.id=t.id,i.style.position="absolute",i.style.outline="none",i.style.left="0",i.style.bottom="0",i.style.height="2px",i.style.background="#52c41a",n.style.position="absolute",n.style.outline="none",n.style.left="0",n.style.right="0",n.style.top="0",n.style.bottom="0","video"===e&&(n.style.width=t.rect.width+"px",n.style.height=t.rect.height+"px"),r.style.background="transparent",1===t.playType&&(n.autoplay=!0),n.loop=t.playLoop,n.ontimeupdate=function(){i.style.width=n.currentTime/n.duration*t.rect.width+"px",o.getMediaCurrent(),o.media===n&&(t.playLoop?(n.loop=!0,o.loop.style.background="#ddd"):(n.loop=!1,o.loop.style.background="none"))},n.onended=function(){p.Store.set(o.generateStoreKey("mediaEnd"),t),o.media===n&&(o.playBtn.className=o.options.playIcon),o.play(t.nextPlay)},n.onloadedmetadata=function(){o.getMediaCurrent()},n.src=t[e],r.appendChild(n),r.appendChild(i),"video"===e?Ar[t.id]={player:r,current:i,media:n}:o.audios[t.id]={player:r,current:i,media:n},o.canvas.appendChild(r),r},o.setElemPosition=function(t,e){e&&(e.style.position="absolute",e.style.outline="none",e.style.left=t.rect.x+"px",e.style.top=t.rect.y+"px",e.style.width=t.rect.width+"px",e.style.height=t.rect.height+"px",(t.rotate||t.offsetRotate)&&(e.style.transform="rotate("+(t.rotate+t.offsetRotate)+"deg)"),t.video&&Ar[t.id]&&Ar[t.id].media&&(Ar[t.id].media.style.width="100%",Ar[t.id].media.style.height="100%"),o.data.locked>Ve.None||t.locked>Ve.None?(e.style.userSelect="initial",e.style.pointerEvents="initial"):(e.style.userSelect="none",e.style.pointerEvents="none"))},o.removeDiv=function(t){if(o.curNode&&t.id===o.curNode.id&&(o.curNode=void 0,o.media=void 0,o.player.style.top="-99999px"),t.audio&&(o.canvas.removeChild(o.audios[t.id].player),o.audios[t.id]=void 0),t.video&&(o.canvas.removeChild(Ar[t.id].player),Ar[t.id]=void 0),t.iframe&&(o.canvas.removeChild(o.iframes[t.id]),o.iframes[t.id]=void 0),t.elementId&&(o.canvas.removeChild(o.elements[t.id]),o.elements[t.id]=void 0,t.elementId=""),t.gif&&(o.canvas.removeChild(o.gifs[t.id]),o.gifs[t.id]=void 0),t.children)for(var e=0,r=t.children;e<r.length;e++){var i=r[e];i.type!==b.Line&&o.removeDiv(i)}},o.options.playIcon||(o.options.playIcon="t-icon t-play"),o.options.pauseIcon||(o.options.pauseIcon="t-icon t-pause"),o.options.fullScreenIcon||(o.options.fullScreenIcon="t-icon t-full-screen"),o.options.loopIcon||(o.options.loopIcon="t-icon t-loop"),o.canvas.style.position="absolute",o.canvas.style.left="0",o.canvas.style.top="0",o.canvas.style.outline="none",o.canvas.style.background="transparent",t.appendChild(o.canvas),t.appendChild(o.player),o.createPlayer(),o.subcribeDiv=p.Store.subscribe(o.generateStoreKey("LT:addDiv"),o.addDiv),o.subcribeDiv=p.Store.subscribe(o.generateStoreKey("LT:removeDiv"),o.removeDiv),o.subcribePlay=p.Store.subscribe(o.generateStoreKey("LT:play"),function(t){o.playOne(t.pen,t.pause)}),o.subcribeNode=p.Store.subscribe(o.generateStoreKey("LT:activeNode"),function(t){if(t&&(t.video||t.audio)){if(t.audio&&o.audios[t.id])o.media=o.audios[t.id].media;else{if(!t.video||!Ar[t.id])return;o.media=Ar[t.id].media}o.curNode=t;t=o.parentElem.getBoundingClientRect();o.player.style.top=t.top+o.parentElem.clientHeight-40+"px",o.player.style.left=t.left+"px",o.player.style.width=o.parentElem.clientWidth+"px",o.getMediaCurrent(),o.media.paused?o.playBtn.className=o.options.playIcon:o.playBtn.className=o.options.pauseIcon}else o.player.style.top="-99999px"}),document.addEventListener("fullscreenchange",function(t){o.media&&(document.fullscreen?(o.media.controls=!0,o.media.style.userSelect="initial",o.media.style.pointerEvents="initial"):(o.media.style.userSelect="none",o.media.style.pointerEvents="none",o.media.controls=!1))}),o}function Mr(t){var e=0,r=0,i=0,n=0;return"number"==typeof t?e=r=i=n=t:"string"==typeof t?e=r=i=n=parseInt(t,10):Array.isArray(t)&&(e=t[0],i=Or(t[1])?t[0]:t[1],n=Or(t[2])?t[0]:t[2],r=Or(t[3])?i:t[3]),[e,i,n,r]}function Or(t){return null==t}var Br=(Dr.prototype.init=function(){var t=this;this.socket=new WebSocket(this.url),this.socket.onmessage=this.cb,this.socket.onclose=function(){console.info("Canvas websocket closed and reconneting..."),t.init()}},Dr.prototype.close=function(){this.socket.onclose=void 0,this.socket.close()},Dr);function Dr(t,e){this.url=t,this.cb=e,this.fns={},this.init()}var Fr=r(130),jr=(Ur.prototype.init=function(){this.client=Fr.connect(this.url,this.options),this.client.on("message",this.cb),this.topics&&this.client.subscribe(this.topics.split(","))},Ur.prototype.publish=function(t,e){this.client.publish(t,e)},Ur.prototype.close=function(){this.client.end()},Ur);function Ur(t,e,r,i){this.url=t,this.options=e,this.topics=r,this.cb=i,this.fns={},this.init()}var Kr,Wr=["nw-resize","ne-resize","se-resize","sw-resize"];(nr=Kr=Kr||{})[nr.None=0]="None",nr[nr.Line=1]="Line",nr[nr.LineFrom=2]="LineFrom",nr[nr.LineTo=3]="LineTo",nr[nr.LineControlPoint=4]="LineControlPoint",nr[nr.Nodes=5]="Nodes",nr[nr.ResizeCP=6]="ResizeCP",nr[nr.HoverAnchors=7]="HoverAnchors",nr[nr.AutoAnchor=8]="AutoAnchor",nr[nr.Rotate=9]="Rotate",nr[nr.GraffitiReady=10]="GraffitiReady",nr[nr.Graffiti=11]="Graffiti",nr[nr.LinesReady=12]="LinesReady",nr[nr.Lines=13]="Lines";var qr=(zr.prototype.setupDom=function(t){this.parentElem="string"==typeof t?document.getElementById(t):t,this.parentElem.style.position="relative",this.parentElem.style.overflow="auto",this.parentElem.onresize=this.winResize,window.addEventListener("resize",this.winResize);t=this.id;this.activeLayer=new _r(this.options,t),(this.activeLayer.topology=this).hoverLayer=new wr(this.options,t),this.animateLayer=new Pr(this.options,t),this.offscreen=new ur(this.parentElem,this.options,t),this.canvas=new yr(this.parentElem,this.options,t),this.divLayer=new Er(this.parentElem,this.options,t),this.input.style.position="absolute",this.input.style.zIndex="-1",this.input.style.left="-1000px",this.input.style.width="0",this.input.style.height="0",this.input.style.outline="none",this.input.style.border="1px solid #cdcdcd",this.input.style.resize="none",this.parentElem.appendChild(this.input),this.createMarkdownTip(),this.resize()},zr.prototype.setupSubscribe=function(){var e=this;this.subcribe=p.Store.subscribe(this.generateStoreKey("LT:render"),function(){e.render()}),this.subcribeRender=p.Store.subscribe("LT:render",function(){e.render()}),this.subcribeImage=p.Store.subscribe(this.generateStoreKey("LT:imageLoaded"),function(){e.imageTimer&&clearTimeout(e.imageTimer),e.imageTimer=setTimeout(function(){e.render()},100)}),this.subcribeAnimateMoved=p.Store.subscribe(this.generateStoreKey("LT:rectChanged"),function(t){e.activeLayer.updateLines(e.data.pens)}),this.subcribeMediaEnd=p.Store.subscribe(this.generateStoreKey("mediaEnd"),function(t){t.nextPlay&&(e.animateLayer.readyPlay(t.nextPlay),e.animateLayer.animate()),e.dispatch("mediaEnd",t)}),this.subcribeAnimateEnd=p.Store.subscribe(this.generateStoreKey("animateEnd"),function(t){t&&(t.type===b.Node&&e.offscreen.render(),e.dispatch("animateEnd",t))}),this.subcribeEmit=p.Store.subscribe(this.generateStoreKey("LT:emit"),function(t){e.emit(t.event,t)})},zr.prototype.setupMouseEvent=function(){var o=this;switch(this.canvasPos=this.divLayer.canvas.getBoundingClientRect(),this.parentElem.addEventListener("scroll",this.onScroll),window.addEventListener("scroll",this.onScroll),this.divLayer.canvas.ondragover=function(t){return t.preventDefault()},this.divLayer.canvas.ondrop=function(t){if(!o.data.locked)try{var e=t.dataTransfer.getData("Topology")||t.dataTransfer.getData("Text");if(!e)return;var r=JSON.parse(e);t.preventDefault(),o.dropNodes(Array.isArray(r)?r:[r],t.offsetX,t.offsetY)}catch(t){}},rr()?(this.options.refresh=50,document.addEventListener("gesturestart",this.preventDefault),this.divLayer.canvas.ontouchstart=function(t){o.touchStart=Date.now();var e=new u(t.changedTouches[0].pageX-window.scrollX-(o.canvasPos.left||o.canvasPos.x),t.changedTouches[0].pageY-window.scrollY-(o.canvasPos.top||o.canvasPos.y));if(1<t.touches.length)return o.touches=t.touches,o.touchScale=o.data.scale,o.lastTranlated.x=e.x,void(o.lastTranlated.y=e.y);o.getMoveIn(e),o.hoverLayer.node=o.moveIn.hoverNode,o.hoverLayer.line=o.moveIn.hoverLine,o.lastTranlated.x=e.x,o.lastTranlated.y=e.y,o.onmousedown({x:e.x,y:e.y,ctrlKey:t.ctrlKey||t.metaKey,shiftKey:t.shiftKey,altKey:t.altKey,button:0})},this.divLayer.canvas.ontouchmove=function(t){t.stopPropagation();var e,r,i=t.changedTouches,n=i.length;!o.touchCenter&&1<n&&(o.touchCenter={x:i[0].pageX+(i[1].pageX-i[0].pageX)/2,y:i[0].pageY+(i[1].pageY-i[0].pageY)/2}),Date.now()-o.touchStart<50||(1<n?2===n?(e=t.scale||Math.hypot(i[0].pageX-i[1].pageX,i[0].pageY-i[1].pageY)/Math.hypot(o.touches[0].pageX-o.touches[1].pageX,o.touches[0].pageY-o.touches[1].pageY),t.preventDefault(),o.scaleTo(e*o.touchScale,o.touchCenter)):3===n&&(r=new u(i[0].pageX-window.scrollX-(o.canvasPos.left||o.canvasPos.x),i[0].pageY-window.scrollY-(o.canvasPos.top||o.canvasPos.y)),o.translate(r.x,r.y,!0)):(t.preventDefault(),r=new u(t.changedTouches[0].pageX-window.scrollX-(o.canvasPos.left||o.canvasPos.x),t.changedTouches[0].pageY-window.scrollY-(o.canvasPos.top||o.canvasPos.y)),o.onMouseMove({x:r.x,y:r.y,ctrlKey:t.ctrlKey||t.metaKey,shiftKey:t.shiftKey,altKey:t.altKey,buttons:1})))},this.divLayer.canvas.ontouchend=function(t){o.touches=void 0,o.ontouchend(t)}):(this.divLayer.canvas.onmousedown=function(t){o.touchedNode&&("graffiti"===o.touchedNode.name?(o.touchedNode.rect=new x(0,0,0,0),o.addNode(o.touchedNode),o.touchedNode=void 0):"lines"===o.touchedNode.name&&(o.addLine(o.touchedNode),o.touchedNode=void 0));t={x:t.pageX-window.scrollX-(o.canvasPos.left||o.canvasPos.x),y:t.pageY-window.scrollY-(o.canvasPos.top||o.canvasPos.y),ctrlKey:t.ctrlKey||t.metaKey,shiftKey:t.shiftKey,altKey:t.altKey,button:t.button};o.lastTranlated.x=t.x,o.lastTranlated.y=t.y,o.onmousedown(t)},this.divLayer.canvas.onmousemove=function(t){o.onMouseMove({x:t.pageX-window.scrollX-(o.canvasPos.left||o.canvasPos.x),y:t.pageY-window.scrollY-(o.canvasPos.top||o.canvasPos.y),ctrlKey:t.ctrlKey||t.metaKey,shiftKey:t.shiftKey,altKey:t.altKey,buttons:t.buttons})},this.divLayer.canvas.onmouseup=function(t){var e={x:t.pageX-window.scrollX-(o.canvasPos.left||o.canvasPos.x),y:t.pageY-window.scrollY-(o.canvasPos.top||o.canvasPos.y),ctrlKey:t.ctrlKey||t.metaKey,shiftKey:t.shiftKey,altKey:t.altKey,button:t.button};o.onmouseup(e),o.touchedNode&&(o.touchedNode.rect.x=t.pageX-window.scrollX-o.canvasPos.x-o.touchedNode.rect.width/2,o.touchedNode.rect.y=t.pageY-window.scrollY-o.canvasPos.y-o.touchedNode.rect.height/2,t=new Qe(o.touchedNode),o.addNode(t,!0),o.touchedNode=void 0)}),this.divLayer.canvas.ondblclick=this.ondblclick,this.divLayer.canvas.tabIndex=0,this.divLayer.canvas.onblur=function(){o.mouseDown=void 0},this.divLayer.canvas.onwheel=function(t){if((new Date).getTime()-o.touchStart<20)return t.preventDefault(),void t.stopPropagation();if(o.touchStart=(new Date).getTime(),!o.options.disableScale){switch(o.options.scaleKey){case n.Ctrl:if(!t.ctrlKey&&!t.metaKey)return;break;case n.Shift:if(!t.shiftKey)return;break;case n.Alt:if(!t.altKey)return}t.preventDefault(),t.stopPropagation();var e=new u(t.x-window.scrollX-(o.canvasPos.left||o.canvasPos.x),t.y-window.scrollY-(o.canvasPos.top||o.canvasPos.y)),r=o.data.scale;return t.deltaY<0?r+=.1:r-=.1,o.scaleTo(r,e),o.divLayer.canvas.focus(),!1}},this.options.keydown){case i.Document:document.addEventListener("keydown",this.onkeydown),document.addEventListener("keyup",function(){o.spaceDown=!1});break;case i.Canvas:this.divLayer.canvas.addEventListener("keydown",this.onkeydown)}},zr.prototype.ontouchend=function(t){var e=new u(t.changedTouches[0].pageX-window.scrollX-(this.canvasPos.left||this.canvasPos.x),t.changedTouches[0].pageY-window.scrollY-(this.canvasPos.top||this.canvasPos.y));this.onmouseup({x:e.x,y:e.y,ctrlKey:t.ctrlKey||t.metaKey,shiftKey:t.shiftKey,altKey:t.altKey,button:0}),this.touchedNode&&(this.touchedNode.rect.x=t.changedTouches[0].pageX-window.scrollX-this.canvasPos.x-this.touchedNode.rect.width/2,this.touchedNode.rect.y=t.changedTouches[0].pageY-window.scrollY-this.canvasPos.y-this.touchedNode.rect.height/2,t=new Qe(this.touchedNode),this.addNode(t,!0),this.touchedNode=void 0)},zr.prototype.resize=function(t){this.canvas.resize(t),this.offscreen.resize(t),this.divLayer.resize(t),this.render(),this.dispatch("resize",t)},zr.prototype.dropNodes=function(t,i,n){var e,o,s=this,a=0,c=0;t.length&&t[0].rect&&(e=t[0].rect,a=e.x,c=e.y),t.forEach(function(t){return t.id=h(),"graffiti"===t.name?(t.rect=new x(0,0,0,0),void s.addNode(t)):"lines"===t.name?(s.addLine(t),s.mouseDown={x:i,y:n},void s.onmouseup(s.mouseDown)):(o?(e=(r=t.rect).x-a,r=r.y-c,t.rect.x=o.rect.x+e,t.rect.y=o.rect.y+r):(t.rect.x=i-t.rect.width/2<<0,t.rect.y=n-t.rect.height/2<<0,o=t),void(t.type===b.Line?s.addLine(Object.assign({name:"line",from:new u(t.rect.x,t.rect.y),fromArrow:s.data.fromArrow,to:new u(t.rect.x+t.rect.width,t.rect.y+t.rect.height),toArrow:s.data.toArrow,strokeStyle:s.options.color},t),!0):s.addNode(t,!0)));var e,r}),this.divLayer.canvas.focus()},zr.prototype.addNode=function(e,t){var r=this;return void 0===t&&(t=!1),Ne[e.name]?(e.TID=this.id,!(e=!e.init?new Qe(e):e).strokeStyle&&this.options.color&&(e.strokeStyle=this.options.color),o.forEach(function(t){e[t]||(e[t]=r.options[t])}),1!==this.data.scale&&e.scale(this.data.scale),this.data.pens.push(e),t&&("echarts"===e.name?setTimeout(function(){r.activeLayer.pens=[e],r.render()},50):this.activeLayer.pens=[e]),"graffiti"===e.name&&e.doing?(this.moveIn.type=Kr.Graffiti,this.moveIn.hoverNode=e):(this.render(),this.animate(!0),this.cache()),this.dispatch("addNode",e),e):null},zr.prototype.addLine=function(t,e){return void 0===e&&(e=!1),this.data.locked?null:(t.type===b.Node&&(t.isNode=!0),t.TID=this.id,t.clone||(t=new We(t)).calcControlPoints(!0),1!==this.data.scale&&(t.fontSize*=this.data.scale),this.data.pens.push(t),"lines"===t.name&&t.doing?(this.activeLayer.clear(),this.hoverLayer.line=void 0,this.moveIn.type=Kr.Lines,this.moveIn.hoverLine=t):e&&(this.activeLayer.setPens([t]),this.render(),this.animate(!0),this.cache(),this.dispatch("addLine",t)),t)},zr.prototype.render=function(t){if((t=void 0===t?!1:t)&&(this.activeLayer.pens=[],this.hoverLayer.node=void 0,this.hoverLayer.line=void 0),this.rendering)return this;this.rendering=!0,this.offscreen.render(),this.canvas.render(),this.rendering=!1},zr.prototype.open=function(t){t&&t.mqttOptions&&!t.mqttOptions.customClientId&&(t.mqttOptions.clientId=h()),this.canvas.clearBkImg(),this.data=ir(t,this.id),this.subscribeSocket(),p.Store.set(this.generateStoreKey("LT:scale"),this.data.scale),this.dispatch("scale",this.data.scale),p.Store.set("LT:bkColor",this.data.bkColor),this.lock(this.data.locked),this.caches.list=[],this.cache(),this.divLayer.clear(),this.animateLayer.stop(),this.render(!0),this.parentElem.scrollLeft=0,this.parentElem.scrollTop=0,this.animate(!0),this.openSocket(),this.openMqtt(),this.dispatch("opened")},zr.prototype.openSocket=function(t){var e=this;this.closeSocket(),(t||this.data.websocket)&&(this.socket=new Br(t||this.data.websocket,function(t){1!==e.data.socketEvent&&e.doSocket(t.data),e.data.socketEvent&&e.dispatch("websocket",t.data)}))},zr.prototype.closeSocket=function(){this.socket&&this.socket.close()},zr.prototype.openMqtt=function(t,e){var r=this;this.closeMqtt(),(t||this.data.mqttUrl)&&(this.mqtt=new jr(t||this.data.mqttUrl,e||this.data.mqttOptions,this.data.mqttTopics,function(t,e){1!==r.data.socketEvent&&r.doSocket(e.toString(),w.Mqtt),r.data.socketEvent&&r.dispatch("mqtt",{topic:t,message:e})}))},zr.prototype.closeMqtt=function(){this.mqtt&&this.mqtt.close()},zr.prototype.doSocket=function(t,i){var e=this;void 0===i&&(i=w.WebSocket);try{t=JSON.parse(t),(t=!Array.isArray(t)?[t]:t).forEach(function(t){var r=[];t.actions&&(r=t.actions,delete t.actions),y(t.id||t.tag,e.data.pens).forEach(function(e){(e.id===t.id||e.tags&&-1<e.tags.indexOf(t.tag))&&(e.fromData(e,t),e.doWheres(),e.events&&e.events.forEach(function(t){t.type===i&&r.push(t)}),r&&r.forEach(function(t){e.doAction(t)}))}),e.willRender()})}catch(t){console.warn(t)}},zr.prototype.overflow=function(t){void 0===t&&(t=50);var e=this.getRect(),r=e.width,i=e.height,i={width:r=(r=r<e.ex?e.ex+t:r)<this.canvas.width?this.canvas.width:r,height:i=(i=i<e.ey?e.ey+t:i)<this.canvas.height?this.canvas.height:i};return this.resize(i),i},zr.prototype.setNodeText=function(){this.inputObj.text=this.input.value,"image"===this.inputObj.name&&this.inputObj.init(),this.input.style.zIndex="-1",this.input.style.left="-1000px",this.input.style.width="0",this.cache(),this.offscreen.render(),this.dispatch("setText",this.inputObj),this.inputObj=void 0},zr.prototype.getMoveIn=function(t){if(!(this.moveIn.type>=Kr.Graffiti))if(this.lastHoverNode=this.moveIn.hoverNode,this.lastHoverLine=this.moveIn.hoverLine,this.moveIn.type=Kr.None,this.moveIn.hoverNode=void 0,this.moveIn.lineControlPoint=void 0,this.moveIn.hoverLine=void 0,this.hoverLayer.hoverAnchorIndex=-1,this.data.locked||1===this.activeLayer.pens.length&&this.activeLayer.pens[0].type||this.activeLayer.locked()||!this.activeLayer.rotateCPs[0]||!this.activeLayer.rotateCPs[0].hit(t,15)){if(1<this.activeLayer.pens.length&&d(t,this.activeLayer.sizeCPs)&&(this.moveIn.type=Kr.Nodes),!this.data.locked&&!this.activeLayer.locked()&&!this.options.hideSizeCP&&(1<this.activeLayer.pens.length||!this.activeLayer.pens[0].type&&!this.activeLayer.pens[0].hideSizeCP))for(var e=0;e<this.activeLayer.sizeCPs.length;++e)if(this.activeLayer.sizeCPs[e].hit(t,10))return this.moveIn.type=Kr.ResizeCP,this.moveIn.activeAnchorIndex=e,void(this.divLayer.canvas.style.cursor=Wr[e]);if(!this.data.locked)for(var r=0,i=this.activeLayer.pens;r<i.length;r++){var n=i[r];if(n instanceof We&&!n.locked){for(e=0;e<n.controlPoints.length;++e)if(!n.locked&&n.controlPoints[e].hit(t,10))return n.controlPoints[e].id=e,this.moveIn.type=Kr.LineControlPoint,this.moveIn.lineControlPoint=n.controlPoints[e],this.moveIn.hoverLine=n,void(this.divLayer.canvas.style.cursor="pointer");if(this.inLine(t,n))return}}this.divLayer.canvas.style.cursor="default";for(var o,e=this.data.pens.length-1;-1<e;--e){if(this.data.pens[e].type===b.Node&&this.inNode(t,this.data.pens[e]))return void(o&&this.moveIn.type!==Kr.HoverAnchors&&this.inLine(t,o));this.data.pens[e].type===b.Line&&this.inLine(t,this.data.pens[e])&&(o=this.data.pens[e])}}else{this.moveIn.type=Kr.Rotate;var s=this.options.rotateCursor;this.divLayer.canvas.style.cursor=s.includes("/")?'url("'+s+'"), auto':s}},zr.prototype.inChildNode=function(t,e){if(!e)return null;for(var r=e.length-1;-1<r;--r){var i=e[r];if(i.type!==b.Line){var n=this.inChildNode(t,i.children);if(n)return n;if(n=this.inNode(t,i,!0))return n}else if(this.inLine(t,i))return i}return null},zr.prototype.inNode=function(t,e,r){if(void 0===r&&(r=!1),this.data.locked===Ve.NoEvent||!e.visible||e.locked===Ve.NoEvent)return null;var i=this.inChildNode(t,e.children);if(i)return this.moveIn.type<Kr.HoverAnchors&&(this.moveIn.type=Kr.Nodes,i.stand?this.moveIn.activeNode=i:this.moveIn.activeNode=e),i;if(e.hitInSelf(t)){if(this.moveIn.hoverNode=e,this.moveIn.type=Kr.Nodes,this.data.locked||e.locked?this.divLayer.canvas.style.cursor=this.options.hoverCursor:this.divLayer.canvas.style.cursor="move",!this.data.locked&&!e.locked&&!(this.options.hideAnchor||e.hideAnchor||e.rect.width<20||e.rect.height<20)){for(var n=0;n<e.rotatedAnchors.length;++n)if(e.rotatedAnchors[n].hit(t,this.options.anchorSize)&&(this.mouseDown||e.rotatedAnchors[n].mode!==Ye.In)){this.moveIn.type=Kr.HoverAnchors,this.moveIn.hoverAnchorIndex=n,this.hoverLayer.hoverAnchorIndex=n,this.divLayer.canvas.style.cursor="crosshair";break}this.options.autoAnchor&&e.rect.center.hit(t,this.options.anchorSize)&&(this.moveIn.hoverNode=e,this.moveIn.type=Kr.AutoAnchor,this.divLayer.canvas.style.cursor="crosshair")}return r||(this.moveIn.activeNode=this.moveIn.hoverNode),e}if(this.options.hideAnchor||e.hideAnchor||this.data.locked||e.locked)return null;if(e.hitInSelf(t,this.options.anchorSize))for(n=0;n<e.rotatedAnchors.length;++n)if(e.rotatedAnchors[n].hit(t,this.options.anchorSize)&&(this.mouseDown||e.rotatedAnchors[n].mode!==Ye.In))return this.moveIn.hoverNode=e,this.moveIn.type=Kr.HoverAnchors,this.moveIn.hoverAnchorIndex=n,this.hoverLayer.hoverAnchorIndex=n,this.divLayer.canvas.style.cursor="crosshair",r||(this.moveIn.activeNode=e),e;return null},zr.prototype.inLine=function(t,e){if(this.data.locked===Ve.NoEvent||!e.visible||e.locked===Ve.NoEvent)return null;if(e.children)for(var r=0,i=e.children;r<i.length;r++){var n=i[r],n=this.inLine(t,n);if(n)return n}if(e.from){if(e.from.hit(t,this.options.anchorSize))return this.moveIn.type=Kr.LineFrom,this.moveIn.hoverLine=e,this.data.locked||e.locked?this.divLayer.canvas.style.cursor=this.options.hoverCursor:this.divLayer.canvas.style.cursor="move",e;if(e.to.hit(t,this.options.anchorSize))return this.moveIn.type=Kr.LineTo,this.moveIn.hoverLine=e,this.data.locked||e.locked?this.divLayer.canvas.style.cursor=this.options.hoverCursor:this.divLayer.canvas.style.cursor="move",e;if(e.pointIn(t))return this.moveIn.type=Kr.Line,this.moveIn.hoverLine=e,this.divLayer.canvas.style.cursor=this.options.hoverCursor,e}return null},zr.prototype.getLineDock=function(t,e){void 0===e&&(e=Ye.Default),this.hoverLayer.dockAnchor=void 0;for(var r=0,i=this.data.pens;r<i.length;r++){var n=i[r];if(n instanceof Qe){var o=n.hit(t,10);if(o){if(o.type===b.Line){if(o.from.hit(t,10)){t.x=o.from.x,t.y=o.from.y,this.hoverLayer.dockAnchor=o.from;break}if(o.to.hit(t,10)){t.x=o.to.x,t.y=o.to.y,this.hoverLayer.dockAnchor=o.to;break}break}this.hoverLayer.node=o,this.options.autoAnchor&&o.rect.center.hit(t,10)&&(t.id=o.id,t.autoAnchor=!0,t.x=o.rect.center.x,t.y=o.rect.center.y,this.hoverLayer.dockAnchor=o.rect.center);for(var s=0;s<o.rotatedAnchors.length;++s)if((!o.rotatedAnchors[s].mode||o.rotatedAnchors[s].mode===e)&&o.rotatedAnchors[s].hit(t,10)){t.id=o.id,t.anchorIndex=s,t.autoAnchor=!1,t.direction=o.rotatedAnchors[s].direction,t.x=o.rotatedAnchors[s].x,t.y=o.rotatedAnchors[s].y,this.hoverLayer.dockAnchor=o.rotatedAnchors[s];break}if(this.hoverLayer.dockAnchor)break}}else if(n instanceof We&&n.id!==this.hoverLayer.line.id)if(n.children)for(var a=0,c=n.children;a<c.length;a++){var h=c[a];if(h.from.hit(t,10)){t.x=h.from.x,t.y=h.from.y,this.hoverLayer.dockAnchor=h.from,0;break}if(h.to.hit(t,10)){t.x=h.to.x,t.y=h.to.y,this.hoverLayer.dockAnchor=h.to,0;break}if(h.controlPoints)for(var l=0,u=h.controlPoints;l<u.length;l++)if((d=u[l]).hit(t,10)){t.x=d.x,t.y=d.y,this.hoverLayer.dockAnchor=d,0;break}}else if(n.from.hit(t,10))t.x=n.from.x,t.y=n.from.y,this.hoverLayer.dockAnchor=n.from;else if(n.to.hit(t,10))t.x=n.to.x,t.y=n.to.y,this.hoverLayer.dockAnchor=n.to;else if(n.controlPoints)for(var d,p=0,f=n.controlPoints;p<f.length;p++)if((d=f[p]).hit(t,10)){t.x=d.x,t.y=d.y,this.hoverLayer.dockAnchor=d;break}}return t},zr.prototype.getPensInRect=function(e){var r=this;e.width<0&&(e.width=-e.width,e.x=e.ex,e.ex=e.x+e.width),e.height<0&&(e.height=-e.height,e.y=e.ey,e.ey=e.y+e.height),this.activeLayer.pens=[];for(var t=0,i=this.data.pens;t<i.length;t++){var n=i[t];n.locked!==Ve.NoEvent&&(n instanceof Qe&&e.hitByRect(n.rect)&&this.activeLayer.add(n),n instanceof We&&(n.children?n.children.forEach(function(t){e.hit(t.from)&&e.hit(t.to)&&r.activeLayer.add(t)}):e.hit(n.from)&&e.hit(n.to)&&this.activeLayer.add(n)))}},zr.prototype.getAngle=function(t){if(t.x===this.activeLayer.rect.center.x)return t.y<=this.activeLayer.rect.center.y?0:180;if(t.y===this.activeLayer.rect.center.y)return t.x<this.activeLayer.rect.center.x?270:90;var e=t.x-this.activeLayer.rect.center.x,r=t.y-this.activeLayer.rect.center.y,t=Math.atan(Math.abs(e/r))/(2*Math.PI)*360;return 0<e&&0<r?t=180-t:e<0&&0<r?t+=180:e<0&&r<0&&(t=360-t),1===this.activeLayer.pens.length?t-this.activeLayer.pens[0].rotate:t},zr.prototype.showInput=function(t){var e=(this.inputObj=t).getTextRect();this.input.value=t.text||"",this.input.style.left=e.x+"px",this.input.style.top=e.y+"px",this.input.style.width=e.width+"px",this.input.style.height=e.height+"px",this.input.style.zIndex="1000",t.rotate/360?this.input.style.transform="rotate("+t.rotate+"deg)":this.input.style.transform=void 0,this.input.focus()},zr.prototype.getRect=function(t){return tr(t=t||this.data.pens)},zr.prototype.getDockPos=function(t,e,r){this.hoverLayer.dockLineX=0;var i={x:this.hoverLayer.dockLineY=0,y:0};if(r||this.options.disableDockLine)return i;for(var n=10,o=10,s=0,a=this.activeLayer.dockWatchers;s<a.length;s++)for(var c=a[s],h=0,l=this.data.pens;h<l.length;h++){var u=l[h];if(u instanceof Qe&&!this.activeLayer.has(u)&&"text"!==u.name){u.dockWatchers||u.getDockWatchers();for(var d=0,p=u.dockWatchers;d<p.length;d++){var f=p[d];Math.abs(f.x-c.x-t)<n&&(n=-99999,i.x=f.x-c.x,this.hoverLayer.dockLineX=0|f.x),Math.abs(f.y-c.y-e)<o&&(o=-99999,i.y=f.y-c.y,this.hoverLayer.dockLineY=0|f.y)}}}return i},zr.prototype.cache=function(){this.caches.index<this.caches.list.length-1&&this.caches.list.splice(this.caches.index+1,this.caches.list.length-this.caches.index-1),this.caches.list.push(this.pureData()),this.caches.list.length>this.options.cacheLen&&this.caches.list.shift(),this.caches.index=this.caches.list.length-1},zr.prototype.cacheReplace=function(t){if(t&&t.length){for(var e={},r=0,i=t.length;r<i;r++){var n=t[r],o=n.id;n instanceof Qe?e[o]=new Qe(n):n instanceof We&&(e[o]=new We(n))}var s=this.caches.list[0];if(s)for(r=0,i=s.pens.length;r<i;r++)e[o=s.pens[r].id]&&(s.pens[r]=e[o])}},zr.prototype.undo=function(t,e){void 0===t&&(t=!1),!e&&this.data.locked||this.caches.index<1||(this.divLayer.clear(!0),this.animateLayer.stop(),this.data=ir(this.caches.list[--this.caches.index],this.id),this.render(!0),this.divLayer.render(),t&&this.caches.list.splice(this.caches.index+1,this.caches.list.length-this.caches.index-1),this.dispatch("undo",this.data))},zr.prototype.redo=function(t){!t&&this.data.locked||this.caches.index>this.caches.list.length-2||(this.divLayer.clear(!0),this.data=ir(this.caches.list[++this.caches.index],this.id),this.render(!0),this.divLayer.render(),this.dispatch("redo",this.data))},zr.prototype.toImage=function(t,e){void 0===t&&(t=0),void 0===e&&(e=void 0);var r=this.getRect(),t=Mr(t||0);r.x-=t[3],r.y-=t[0],r.width+=t[3]+t[1],r.height+=t[0]+t[2];var i=this.offscreen.getDpiRatio();r.scale(i);t=document.createElement("canvas");t.width=r.width,t.height=r.height;var n=t.getContext("2d");(this.data.bkColor||this.options.bkColor)&&(n.fillStyle=this.data.bkColor||this.options.bkColor,n.fillRect(0,0,t.width,t.height));for(var o=0,s=this.data.pens;o<s.length;o++){var a=s[o],c=void 0;a.type?c=new We(a):((c=new Qe(a,!0)).animateFrames=[],c.img=a.img,c.elementId="",c.elementLoaded=!0,c.elementRendered=!0),c.scale(i,r.center),c.translate(-r.x,-r.y,!0),c.render(n)}return n.scale(1/i,1/i),this.data.bkImage&&n.drawImage(this.canvas.bkImg,0,0),e&&t.toBlob(e),t.toDataURL("image/png",1)},zr.prototype.saveAsImage=function(t,e){void 0===e&&(e=0);var r=document.createElement("a");r.setAttribute("download",t||"le5le.topology.png"),r.setAttribute("href",this.toImage(e));e=document.createEvent("MouseEvents");e.initEvent("click",!0,!0),r.dispatchEvent(e)},zr.prototype.delete=function(t,e){if(!this.data.locked||e){var r=[];if("string"==typeof t)r=c(t,this.data.pens);else for(var i=t||this.activeLayer.pens,n=0;n<i.length;n++){var o,s=i[n];s.type!==b.Line||!s.parentId||(o=y(s.parentId,this.data.pens)[0])&&"lines"===o.name&&(s=o),c(s.id,this.data.pens).length&&(r.push(s),--n,s.type===b.Node&&this.divLayer.removeDiv(s),this.options.disableEmptyLine&&this.delEmptyLines(s.id),this.animateLayer.pens.delete(s.id))}r.length&&(this.render(!0),this.cache(),this.dispatch("delete",r))}},zr.prototype.deleteAnchors=function(t,e){this.data.locked&&!e||(t||this.activeLayer.pens).forEach(function(t){t.type===b.Node&&(t.manualAnchors=void 0,t.calcAnchors())})},zr.prototype.delEmptyLines=function(t){for(var e,r=0;r<this.data.pens.length;r++)this.data.pens[r].type===b.Line&&((e=this.data.pens[r]).from.id&&e.to.id&&e.from.id!==t&&e.to.id!==t||(this.data.pens.splice(r,1),this.animateLayer.pens.delete(e.id),--r))},zr.prototype.cut=function(){if(!this.data.locked){this.clipboard=ir({pens:[]});for(var t=0;t<this.activeLayer.pens.length;t++){var e=this.activeLayer.pens[t];this.clipboard.pens.push(e.clone());var r=this.findIndex(e);-1<r&&(e.type===b.Node&&this.divLayer.removeDiv(this.data.pens[r]),this.data.pens.splice(r,1))}this.cache(),this.activeLayer.clear(),this.hoverLayer.node=void 0,this.moveIn.hoverLine=void 0,this.moveIn.hoverNode=void 0,this.render(),this.dispatch("delete",this.clipboard.pens)}},zr.prototype.copy=function(){this.clipboard=ir({pens:[]});for(var t=0,e=this.activeLayer.pens;t<e.length;t++){var r=e[t];this.clipboard.pens.push(r.clone())}this.dispatch("copy",this.clipboard)},zr.prototype.paste=function(){if(this.clipboard&&!this.data.locked){this.hoverLayer.node=void 0,this.hoverLayer.line=void 0,this.activeLayer.pens=[];for(var t={},e=0,r=this.clipboard.pens;e<r.length;e++){var i=r[e];if(i.type===b.Node&&(this.newId(i,t),i.rect.x+=20,i.rect.ex+=20,i.rect.y+=20,i.rect.ey+=20,i.init()),i instanceof We){i.id=h(),i.from=new u(i.from.x+20,i.from.y+20,i.from.direction,i.from.anchorIndex,t[i.from.id]),i.to=new u(i.to.x+20,i.to.y+20,i.to.direction,i.to.anchorIndex,t[i.to.id]);for(var n=[],o=0,s=i.controlPoints;o<s.length;o++){var a=s[o];n.push(new u(a.x+20,a.y+20))}i.controlPoints=n}this.data.pens.push(i),this.activeLayer.add(i)}this.render(),this.animate(!0),this.cache(),this.copy(),1<this.clipboard.pens.length?this.dispatch("paste",{pens:this.clipboard.pens}):0<this.activeLayer.pens.length&&this.dispatch("paste",this.activeLayer.pens[0])}},zr.prototype.newId=function(t,e){var r=t.id;if(t.id=h(),e[r]=t.id,t.children)for(var i=0,n=t.children;i<n.length;i++){var o=n[i];this.newId(o,e)}},zr.prototype.animate=function(t){this.animateLayer.readyPlay(void 0,t=void 0===t?!1:t),this.animateLayer.animate()},zr.prototype.updateProps=function(t,e){void 0===t&&(t=!0);for(var r=0,i=e=e||this.activeLayer.pens;r<i.length;r++){var n,o=i[r];o instanceof Qe&&(o.autoRect&&(n=D(this.canvas.canvas.getContext("2d"),o),o.rect.width=n.width+2*o.lineWidth,o.rect.height=n.height),o.init(),o.initRect())}this.activeLayer.updateLines(e),this.activeLayer.calcControlPoints(),this.activeLayer.saveNodeRects(),this.render(),t&&this.cache()},zr.prototype.lock=function(t){this.data.locked=t;for(var e=0,r=this.data.pens;e<r.length;e++){var i=r[e];i.addToDiv&&i.addToDiv()}this.dispatch("locked",this.data.locked)},zr.prototype.lockPens=function(t,e){for(var r=0,i=this.data.pens;r<i.length;r++)for(var n=i[r],o=0,s=t;o<s.length;o++){var a=s[o];if(n.id===a.id){n.locked=e,n.addToDiv&&n.addToDiv();break}}this.dispatch("lockPens",{pens:t,lock:e})},zr.prototype.up=function(t,e){e=e||this.data.pens;var r=this.findIndex(t,e);-1<r&&r!==e.length-1?(e.splice(r+2,0,e[r]),e.splice(r,1)):(e=l(e,t))&&this.up(t,e.children)},zr.prototype.top=function(t,e){e=e||this.data.pens;var r=this.findIndex(t,e);-1<r?(e.push(e[r]),e.splice(r,1)):(e=l(e,t))&&this.top(t,e.children)},zr.prototype.down=function(t,e){e=e||this.data.pens;var r=this.findIndex(t,e);-1<r&&0!==r?(e.splice(r-1,0,e[r]),e.splice(r+1,1)):(e=l(e,t))&&this.down(t,e.children)},zr.prototype.bottom=function(t,e){e=e||this.data.pens;var r=this.findIndex(t,e);-1<r?(e.unshift(e[r]),e.splice(r+1,1)):(e=l(e,t))&&this.bottom(t,e.children)},zr.prototype.getParent=function(t){return l(this.data.pens,t)},zr.prototype.combine=function(t,e){void 0===e&&(e=!1),t=t||this.activeLayer.pens;for(var r=this.getRect(t),i=0,n=t;i<n.length;i++){var o=n[i];-1<(a=this.findIndex(o))&&this.data.pens.splice(a,1)}for(var s=new Qe({name:"combine",rect:new x(r.x,r.y,r.width,r.height),text:"",paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0,strokeStyle:"transparent",children:[]}),a=0;a<t.length;++a)if(t[a].type===b.Node&&r.width===t[a].rect.width&&r.height===t[a].rect.height){(s=t[a]).children||(s.children=[]),t.splice(a,1);break}for(var c=0,h=t;c<h.length;c++)(o=h[c]).stand=e,o.parentId=s.id,o.calcRectInParent(s),s.children.push(o);this.data.pens.push(s),this.activeLayer.setPens([s]),this.dispatch("combine",s),this.cache()},zr.prototype.uncombine=function(t){if((t=t||this.activeLayer.pens[0])instanceof Qe){for(var e=0,r=t.children;e<r.length;e++){var i=r[e];i.parentId=void 0,i.rectInParent=void 0,i.locked=Ve.None,this.data.pens.push(i)}var n=this.findIndex(t);-1<n&&"combine"===t.name?this.data.pens.splice(n,1):t.children=void 0,this.cache(),this.activeLayer.clear(),this.hoverLayer.clear(),this.dispatch("uncombine",t)}},zr.prototype.find=function(t,e,r){Array.isArray(e)?i=e:(i=this.data.pens,r=e);var i=y(t,i);return r?i:0===i.length?null:1===i.length?i[0]:i},zr.prototype.findIndex=function(e,t){return(t=t||this.data.pens).findIndex(function(t){return t.id===e.id})},zr.prototype.play=function(t,e){this.divLayer.play(t,e)},zr.prototype.translate=function(t,e,r,i){r||(this.lastTranlated.x=0,this.lastTranlated.y=0);for(var n=t-this.lastTranlated.x,o=e-this.lastTranlated.y,s=0,a=this.data.pens;s<a.length;s++)a[s].translate(n,o);this.data.bkImageRect&&!this.data.bkImageStatic&&this.data.bkImageRect.translate(n,o),p.Store.set(this.generateStoreKey("LT:updateLines"),this.data.pens),this.lastTranlated.x=t,this.lastTranlated.y=e,this.render(),this.cache(),i||this.dispatch("translate",{x:t,y:e})},zr.prototype.scale=function(t,e){this.data.scale*t<this.options.minScale?(t=this.options.minScale/this.data.scale,this.data.scale=this.options.minScale):this.data.scale*t>this.options.maxScale?(t=this.options.maxScale/this.data.scale,this.data.scale=this.options.maxScale):this.data.scale=Math.round(this.data.scale*t*100)/100,e=e||this.getRect().center;for(var r=0,i=this.data.pens;r<i.length;r++)i[r].scale(t,e);this.data.bkImageRect&&this.data.bkImageRect.scale(t,e),p.Store.set(this.generateStoreKey("LT:updateLines"),this.data.pens),p.Store.set(this.generateStoreKey("LT:scale"),this.data.scale),this.render(),this.cache(),this.dispatch("scale",this.data.scale)},zr.prototype.scaleTo=function(t,e){this.scale(t/this.data.scale,e)},zr.prototype.round=function(){for(var t=0,e=this.data.pens;t<e.length;t++){var r=e[t];r instanceof Qe&&r.round()}},zr.prototype.centerView=function(t){if(this.hasView()){var e=this.getRect(),r=this.getViewCenter(t),t=e.center;this.translate(r.x-t.x,r.y-t.y);e=this.canvas.parentElem,r=(e.scrollWidth-e.offsetWidth)/2,t=(e.scrollHeight-e.offsetHeight)/2;return e.scrollTo(r,t),!0}},zr.prototype.fitView=function(t){var e,r,i;this.hasView()&&(i=(r=this.canvas.parentElem).offsetWidth,e=r.offsetHeight,this.resize({width:i,height:e}),this.centerView(t),r=Mr(t||this.options.viewPadding),t=this.getRect(),i=(i-r[1]-r[3])/t.width,t=(e-r[0]-r[2])/t.height,this.scale(t<i?t:i))},zr.prototype.hasView=function(){var t=this.getRect();return!(99999===t.width||99999===t.height)},zr.prototype.getViewCenter=function(t){var e=Mr(t||this.options.viewPadding),r=this.canvas,t=r.width,r=r.height;return{x:(t-e[1]-e[3])/2+e[3],y:(r-e[0]-e[2])/2+e[0]}},zr.prototype.generateStoreKey=function(t){return this.id+"-"+t},zr.prototype.createMarkdownTip=function(){this.tipMarkdown=document.createElement("div"),this.tipMarkdown.className="topology-markdown",this.tipMarkdown.style.position="fixed",this.tipMarkdown.style.zIndex="-1",this.tipMarkdown.style.left="-9999px",this.tipMarkdown.style.padding="8px 0",this.tipMarkdownContent=document.createElement("div"),this.tipMarkdownContent.style.maxWidth="320px",this.tipMarkdownContent.style.outline="none",this.tipMarkdownContent.style.borderRadius="4px",this.tipMarkdownContent.style.backgroundColor="rgba(0,0,0,.6)",this.tipMarkdownContent.style.color="#fff",this.tipMarkdownContent.style.padding="8px 16px",this.tipMarkdownContent.style.lineHeight="1.8",this.tipMarkdownContent.style.overflowY="auto",this.tipMarkdownContent.style.minHeight="30px",this.tipMarkdownContent.style.maxHeight="400px",this.tipMarkdown.appendChild(this.tipMarkdownContent),this.tipMarkdownArrowUp=document.createElement("div"),this.tipMarkdownArrowUp.className="arrow",this.tipMarkdownArrowUp.style.position="absolute",this.tipMarkdownArrowUp.style.border="6px solid transparent",this.tipMarkdownArrowUp.style.backgroundColor="transparent",this.tipMarkdownArrowUp.style.left="50%",this.tipMarkdownArrowUp.style.transform="translateX(-50%)",this.tipMarkdownArrowUp.style.top="-4px",this.tipMarkdown.appendChild(this.tipMarkdownArrowUp),this.tipMarkdownArrowDown=document.createElement("div"),this.tipMarkdownArrowDown.className="arrow",this.tipMarkdownArrowDown.style.position="absolute",this.tipMarkdownArrowDown.style.border="6px solid transparent",this.tipMarkdownArrowDown.style.left="50%",this.tipMarkdownArrowDown.style.transform="translateX(-50%)",this.tipMarkdownArrowDown.style.backgroundColor="transparent",this.tipMarkdownArrowDown.style.bottom="-4px",this.tipMarkdown.appendChild(this.tipMarkdownArrowDown),document.body.appendChild(this.tipMarkdown)},zr.prototype.showTip=function(t,e){if(t&&t.id!==this.tip&&!1!==this.data.tooltip&&0!==this.data.tooltip){if(t.title)return this.divLayer.canvas.title=t.title,void(this.tip=t.id);t.tipId&&(this.tipElem=document.getElementById(t.tipId));var r,i,n,o=this.tipElem;if(t.markdown){var o=this.tipMarkdown,s=window.marked;this.tipMarkdownContent.innerHTML=s?s(t.markdown):t.markdown;for(var a=this.tipMarkdownContent.getElementsByTagName("A"),c=0;c<a.length;++c)a[c].setAttribute("target","_blank")}o&&(r=this.parentElem.getBoundingClientRect(),i=o.getBoundingClientRect(),n=(r.left||r.x)+e.x-(i.width-t.rect.width)/2,s=(r.top||r.y)+e.y-i.height-t.rect.height,t.type||(n=(r.left||r.x)+t.rect.x-(i.width-t.rect.width)/2,s=(r.top||r.y)+t.rect.ey-i.height-t.rect.height),0<s?(this.tipMarkdownArrowUp.style.borderBottomColor="transparent",this.tipMarkdownArrowDown.style.borderTopColor="rgba(0,0,0,.6)"):(s=t.type?(r.top||r.y)+e.y:(r.top||r.y)+t.rect.ey,this.tipMarkdownArrowUp.style.borderBottomColor="rgba(0,0,0,.6)",this.tipMarkdownArrowDown.style.borderTopColor="transparent"),o.style.display="block",o.style.position="fixed",o.style.left=n+"px",o.style.top=s+"px",o.style.zIndex="100",this.tip=t.id,this.dispatch("tip",o))}},zr.prototype.hideTip=function(){this.tip&&(this.tipMarkdown.style.left="-9999px",this.tipMarkdown.style.zIndex="-1",this.tipElem&&(this.tipElem.style.left="-9999px",this.tipElem.style.zIndex="-1",this.tipElem=void 0),this.divLayer.canvas.title="",this.tip="")},zr.prototype.scroll=function(t,e){var r=this;this.scrolling||(this.scrolling=!0,this.parentElem.scrollLeft+=t,this.parentElem.scrollTop+=e,setTimeout(function(){r.scrolling=!1},700))},zr.prototype.toComponent=function(t){t=t||this.data.pens;for(var e=this.getRect(t),r=new Qe({name:"combine",rect:new x(e.x,e.y,e.width,e.height),text:"",paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0,strokeStyle:"transparent",children:[]}),i=0,n=t;i<n.length;i++)if((o=n[i]).type===b.Node&&e.width===o.rect.width&&e.height===o.rect.height){(r=o).children||(r.children=[]);break}for(var o,s=0,a=t;s<a.length;s++)(o=a[s])!==r&&(o.parentId=r.id,o.calcRectInParent(r),r.children.push(o));return r},zr.prototype.clearBkImg=function(){this.canvas.clearBkImg()},zr.prototype.dispatch=function(t,e){return this.options.on&&this.options.on(t,e),this.emit(t,e),this},zr.prototype.on=function(t,e){return this._emitter.on(t,e),this},zr.prototype.off=function(t,e){return this._emitter.off(t,e),this},zr.prototype.emit=function(t,e){return this._emitter.emit(t,e),this},zr.prototype.getValue=function(t,e){void 0===e&&(e="text");t=this.find(t);if(t=t&&(Array.isArray(t)?t[0]:t))return t[e]},zr.prototype.setValue=function(e,r,i){void 0===i&&(i="text"),y(e="object"==typeof e?(r=e).id||e.tag:e,this.data.pens).forEach(function(t){(t.id===e||t.tags&&-1<t.tags.indexOf(e))&&("object"==typeof r?t.fromData(t,r):t[i]=r,t.doWheres(),t.type===b.Node&&(t.animateReady=Qe.cloneState(t)))}),this.willRender()},zr.prototype.willRender=function(){var t=this;this.actionTimer&&clearTimeout(this.actionTimer),this.actionTimer=setTimeout(function(){t.render(),t.actionTimer=void 0},500)},zr.prototype.setLineName=function(e,t){void 0===t&&(t=!0),this.data.pens.forEach(function(t){t.type&&(t.name=e,t.calcControlPoints())}),t&&this.render()},zr.prototype.setColor=function(t){this.options.color=t,p.Store.set(this.generateStoreKey("LT:color"),t),this.options.fontColor=t,p.Store.set(this.generateStoreKey("LT:fontColor"),t)},zr.prototype.setFontColor=function(t){this.options.fontColor=t,p.Store.set(this.generateStoreKey("LT:fontColor"),t)},zr.prototype.setIconColor=function(t){p.Store.set(this.generateStoreKey("LT:iconColor"),t)},zr.prototype.setBkColor=function(t){this.data.bkColor=t,p.Store.set("LT:bkColor",t)},zr.prototype.pureData=function(){var o=this,t=JSON.parse(JSON.stringify(this.data));return t.pens.forEach(function(t){for(var e in t)void 0!==t[e]&&void 0!==t[e]||delete t[e];if(delete t.TID,delete t.animateCycleIndex,delete t.img,delete t.lastImage,delete t.fillImg,delete t.strokeImg,delete t.lastFillImage,delete t.lastStrokeImage,delete t.imgNaturalWidth,delete t.imgNaturalHeight,delete t.anchors,delete t.rotatedAnchors,delete t.dockWatchers,delete t.elementLoaded,delete t.elementRendered,delete t.animateReady,t.animateFrames&&t.animateFrames.length)for(var r=0,i=t.animateFrames;r<i.length;r++){var n=i[r];n.initState&&(delete n.initState.TID,delete n.initState.animateCycleIndex,delete n.initState.img,delete n.initState.lastImage,delete n.initState.imgNaturalWidth,delete n.initState.imgNaturalHeight,delete n.initState.anchors,delete n.initState.rotatedAnchors,delete n.initState.dockWatchers,delete n.initState.elementLoaded,delete n.initState.elementRendered,delete n.initState.fillImg,delete n.initState.strokeImg,delete n.initState.lastFillImage,delete n.initState.lastStrokeImage),n.state&&(delete n.state.TID,delete n.state.animateCycleIndex,delete n.state.img,delete n.state.lastImage,delete n.state.imgNaturalWidth,delete n.state.imgNaturalHeight,delete n.state.anchors,delete n.state.rotatedAnchors,delete n.state.dockWatchers,delete n.state.elementLoaded,delete n.state.elementRendered,delete n.state.fillImg,delete n.state.strokeImg,delete n.state.lastFillImage,delete n.state.lastStrokeImage)}o.pureDataChildren(t)}),t},zr.prototype.pureDataChildren=function(t){var r=this;t.children&&t.children.forEach(function(t){for(var e in t)void 0!==t[e]&&void 0!==t[e]&&""!==t[e]||delete t[e];delete t.TID,delete t.animateCycleIndex,delete t.img,delete t.lastImage,delete t.imgNaturalWidth,delete t.imgNaturalHeight,delete t.anchors,delete t.rotatedAnchors,delete t.dockWatchers,delete t.elementLoaded,delete t.elementRendered,delete t.animateReady,r.pureDataChildren(t)})},zr.prototype.destroy=function(){switch(this.subcribe.unsubscribe(),this.subcribeRender.unsubscribe(),this.subcribeImage.unsubscribe(),this.subcribeAnimateEnd.unsubscribe(),this.subcribeAnimateMoved.unsubscribe(),this.subcribeMediaEnd.unsubscribe(),this.subcribeEmit.unsubscribe(),this.animateLayer.destroy(),this.divLayer.destroy(),this.canvas.destroy(),this.activeLayer.destroy(),this.hoverLayer.destroy(),this.offscreen.destroy(),document.body.removeChild(this.tipMarkdown),window.removeEventListener("resize",this.winResize),this.parentElem.removeEventListener("scroll",this.onScroll),window.removeEventListener("scroll",this.onScroll),document.removeEventListener("gesturestart",this.preventDefault),this.options.keydown){case i.Document:document.removeEventListener("keydown",this.onkeydown);break;case i.Canvas:this.divLayer.canvas.removeEventListener("keydown",this.onkeydown)}this.closeSocket(),this.closeMqtt(),this.socketFn&&(this.off("websocket",this.socketFn),this.off("mqtt",this.socketFn)),this.cache=void 0,this.data=void 0,window.topology=void 0},zr);function zr(t,e){var i,l=this;void 0===e&&(e={}),this.id=h(),this.data=ir(void 0,this.id),this.caches={index:0,list:[]},this.touchStart=0,this.input=document.createElement("textarea"),this.lastTranlated={x:0,y:0},this.moveIn={type:Kr.None,activeAnchorIndex:0,hoverAnchorIndex:0,hoverNode:void 0,hoverLine:void 0,activeNode:void 0,lineControlPoint:void 0},this.needCache=!1,this.tip="",this.scheduledAnimationFrame=!1,this.scrolling=!1,this.rendering=!1,this.onScroll=function(){l.canvasPos=l.divLayer.canvas.getBoundingClientRect()},this.preventDefault=function(t){t.preventDefault()},this.winResize=function(){var t;t&&clearTimeout(t),setTimeout(function(){l.resize()},100)},this.subscribeSocket=function(){if(!l.data.socketFn)return!1;l.data.socketEvent||(l.data.socketEvent=!0);try{var t=new Function("e",l.data.socketFn);l.socketFn&&(l.off("websocket",l.socketFn),l.off("mqtt",l.socketFn)),l.on("websocket",t),l.on("mqtt",t),l.socketFn=t}catch(t){return console.error("Create the function for socket:",t),!1}return!0},this.onMouseMove=function(h){if(!l.scheduledAnimationFrame&&l.data.locked!==Ve.NoEvent)if(!l.mouseDown||l.mouseDown.restore||1===h.buttons||2===h.buttons){if(l.mouseDown&&(l.data.locked||l.spaceDown||!l.moveIn.type)){var t=!!l.data.locked;switch(l.options.translateKey){case n.Right:2==h.buttons&&(t=!0);break;case n.Any:t=!0;break;case n.Ctrl:h.ctrlKey&&(t=!0);break;case n.Shift:h.shiftKey&&(t=!0);break;case n.Alt:h.altKey&&(t=!0);break;default:(h.ctrlKey||h.altKey||2==h.buttons)&&(t=!0)}if(l.spaceDown||!l.options.disableTranslate&&t&&l.data.locked<Ve.NoMove)return l.translate(h.x,h.y,!0),!1}l.data.locked&&l.mouseDown||(l.scheduledAnimationFrame=!0,l.raf&&cancelAnimationFrame(l.raf),l.raf=requestAnimationFrame(function(){if(l.raf=void 0,l.moveIn.type===Kr.Lines)return l.hoverLayer.line&&(l.hoverLayer.lineTo(new u(h.x,h.y),""),h.shiftKey||h.ctrlKey||h.altKey||2==h.buttons?(l.hoverLayer.line.name="curve",l.hoverLayer.line.calcControlPoints()):l.hoverLayer.line.name="line",l.render()),void(l.scheduledAnimationFrame=!1);if(!l.mouseDown)return l.getMoveIn(h),l.moveIn.hoverNode!==l.lastHoverNode&&(l.lastHoverNode&&(l.lastHoverNode.moveOut(),l.dispatch("moveOutNode",l.lastHoverNode),l.hideTip(),l.hoverLayer.node=void 0),l.moveIn.hoverNode&&(l.hoverLayer.node=l.moveIn.hoverNode,l.moveIn.hoverNode.moveIn(),l.dispatch("moveInNode",l.moveIn.hoverNode),l.showTip(l.moveIn.hoverNode,h))),l.moveIn.hoverLine===l.lastHoverLine||l.moveIn.hoverNode||(l.lastHoverLine&&(l.lastHoverLine.moveOut(),l.dispatch("moveOutLine",l.lastHoverLine),l.hideTip()),l.moveIn.hoverLine&&(l.hoverLayer.line=l.moveIn.hoverLine,l.moveIn.hoverLine.moveIn(),l.dispatch("moveInLine",l.moveIn.hoverLine),l.showTip(l.moveIn.hoverLine,h))),l.moveIn.type===Kr.LineControlPoint?l.hoverLayer.hoverLineCP=l.moveIn.lineControlPoint:l.hoverLayer.hoverLineCP&&(l.hoverLayer.hoverLineCP=void 0),l.moveIn.hoverNode===l.lastHoverNode&&l.moveIn.type!==Kr.HoverAnchors&&l.hoverLayer.lasthoverLineCP===l.hoverLayer.hoverLineCP||(l.hoverLayer.lasthoverLineCP=l.hoverLayer.hoverLineCP,l.render()),void(l.scheduledAnimationFrame=!1);var t=h.x+50>l.parentElem.clientWidth+l.parentElem.scrollLeft,e=h.y+50>l.parentElem.clientHeight+l.parentElem.scrollTop;switch(l.options.disableMoveOutParent||!t&&!e||(l.dispatch("moveOutParent",h),i=r=0,h.x+50>l.divLayer.canvas.clientWidth&&(r=-5),h.y+50>l.divLayer.canvas.clientHeight&&(i=-5),l.translate(r,i,!1)),l.hideTip(),l.moveIn.type){case Kr.None:l.hoverLayer.dragRect=new x(l.mouseDown.x,l.mouseDown.y,h.x-l.mouseDown.x,h.y-l.mouseDown.y);break;case Kr.Nodes:if(l.activeLayer.locked())break;var r=h.x-l.mouseDown.x,i=h.y-l.mouseDown.y;(r||i)&&(o=l.getDockPos(r,i,h.ctrlKey||h.shiftKey||h.altKey),l.activeLayer.move(o.x||r,o.y||i),l.needCache=!0);break;case Kr.ResizeCP:l.activeLayer.resize(l.moveIn.activeAnchorIndex,l.mouseDown,h),l.dispatch("resizePens",l.activeLayer.pens),l.needCache=!0;break;case Kr.LineTo:case Kr.HoverAnchors:case Kr.AutoAnchor:if(l.hoverLayer.dockAnchor&&l.hoverLayer.dockAnchor.hit(h,10))break;var n=l.data.toArrow;l.moveIn.hoverLine&&(n=l.moveIn.hoverLine.toArrow),l.hoverLayer.line&&(l.activeLayer.pens=[l.hoverLayer.line]);var o,s=l.hoverLayer.line.to.id;h.ctrlKey||h.shiftKey||h.altKey?l.hoverLayer.lineTo(new u(h.x,h.y),n):(s=(o=l.getLineDock(new u(h.x,h.y),Ye.In)).id,o.x===l.hoverLayer.line.from.x&&o.y===l.hoverLayer.line.from.y||l.hoverLayer.lineTo(o,n)),l.hoverLayer.line.to.id=s,l.hoverLayer.line.parentId&&(c=l.find(s))&&c.from&&(c.from.x=l.hoverLayer.line.to.x,c.from.y=l.hoverLayer.line.to.y),l.needCache=!0;break;case Kr.LineFrom:var a=l.hoverLayer.line.from.id;h.ctrlKey||h.shiftKey||h.altKey?l.hoverLayer.lineFrom(new u(h.x,h.y)):(a=(s=l.getLineDock(new u(h.x,h.y),Ye.Out)).id,l.hoverLayer.lineFrom(s)),l.hoverLayer.line.from.id=a,l.hoverLayer.line.parentId&&(c=l.find(a))&&c.to&&(c.to.x=l.hoverLayer.line.from.x,c.to.y=l.hoverLayer.line.from.y),l.needCache=!0;break;case Kr.Line:var a=h.x-l.mouseDown.x,c=h.y-l.mouseDown.y;(a||c)&&(l.activeLayer.move(a,c),l.hoverLayer.line.children?l.animateLayer.updateLines(l.hoverLayer.line.children):l.animateLayer.updateLines([l.hoverLayer.line]),l.needCache=!0);break;case Kr.LineControlPoint:l.moveIn.hoverLine.controlPoints[l.moveIn.lineControlPoint.id].x=h.x,l.moveIn.hoverLine.controlPoints[l.moveIn.lineControlPoint.id].y=h.y,l.moveIn.hoverLine.textRect=void 0,De[l.moveIn.hoverLine.name]&&De[l.moveIn.hoverLine.name].dockControlPointFn&&De[l.moveIn.hoverLine.name].dockControlPointFn(l.moveIn.hoverLine.controlPoints[l.moveIn.lineControlPoint.id],l.moveIn.hoverLine),l.needCache=!0,p.Store.set(l.generateStoreKey("LT:updateLines"),[l.moveIn.hoverLine]);break;case Kr.Rotate:l.activeLayer.pens.length&&(l.activeLayer.offsetRotate(l.getAngle(h)),l.activeLayer.updateLines()),l.needCache=!0;break;case Kr.Graffiti:l.moveIn.hoverNode.pushPoint(new u(h.x,h.y))}l.render(),l.scheduledAnimationFrame=!1}))}else l.onmouseup(h)},this.onmousedown=function(t){if(0===t.button||2===t.button){switch((l.mouseDown=t).altKey&&(l.divLayer.canvas.style.cursor="move"),l.inputObj&&l.setNodeText(),l.moveIn.type){case Kr.None:l.activeLayer.clear(),l.hoverLayer.clear(),l.dispatch("space",l.mouseDown);break;case Kr.Line:case Kr.LineControlPoint:t.ctrlKey||t.shiftKey?(l.activeLayer.add(l.moveIn.hoverLine),l.dispatch("multi",l.activeLayer.pens)):(l.activeLayer.pens=[l.moveIn.hoverLine],l.dispatch("line"+(2===t.button?"RightClick":""),l.moveIn.hoverLine)),l.hoverLayer.line=l.moveIn.hoverLine,l.hoverLayer.initLine=new We(l.moveIn.hoverLine),(l.data.locked||l.moveIn.hoverLine.locked)&&l.moveIn.hoverLine.click();break;case Kr.LineFrom:case Kr.LineTo:l.activeLayer.pens=[l.moveIn.hoverLine],l.dispatch("line",l.moveIn.hoverLine),l.hoverLayer.line=l.moveIn.hoverLine;break;case Kr.HoverAnchors:l.hoverLayer.line=l.addLine({name:l.data.lineName,from:new u(l.moveIn.hoverNode.rotatedAnchors[l.moveIn.hoverAnchorIndex].x,l.moveIn.hoverNode.rotatedAnchors[l.moveIn.hoverAnchorIndex].y,l.moveIn.hoverNode.rotatedAnchors[l.moveIn.hoverAnchorIndex].direction,l.moveIn.hoverAnchorIndex,l.moveIn.hoverNode.id),fromArrow:l.data.fromArrow,to:new u(l.moveIn.hoverNode.rotatedAnchors[l.moveIn.hoverAnchorIndex].x,l.moveIn.hoverNode.rotatedAnchors[l.moveIn.hoverAnchorIndex].y),toArrow:l.data.toArrow,strokeStyle:l.options.color,lineWidth:l.data.lineWidth}),l.dispatch("anchor",{anchor:l.moveIn.hoverNode.rotatedAnchors[l.moveIn.hoverAnchorIndex],anchorIndex:l.moveIn.hoverAnchorIndex,node:l.moveIn.hoverNode,line:l.hoverLayer.line});break;case Kr.AutoAnchor:l.hoverLayer.line=l.addLine({name:l.data.lineName,from:new u(l.moveIn.hoverNode.rect.center.x,l.moveIn.hoverNode.rect.center.y,_.None,0,l.moveIn.hoverNode.id),fromArrow:l.data.fromArrow,to:new u(l.moveIn.hoverNode.rect.center.x,l.moveIn.hoverNode.rect.center.y),toArrow:l.data.toArrow,strokeStyle:l.options.color,lineWidth:l.data.lineWidth}),l.hoverLayer.line.from.autoAnchor=!0,l.dispatch("nodeCenter",l.moveIn.hoverNode);break;case Kr.Nodes:if(!l.moveIn.activeNode)break;t.ctrlKey||t.shiftKey?l.moveIn.hoverNode&&l.activeLayer.hasInAll(l.moveIn.hoverNode)?(l.activeLayer.setPens([l.moveIn.hoverNode]),l.dispatch("node"+(2===t.button?"RightClick":""),l.moveIn.hoverNode)):l.activeLayer.has(l.moveIn.activeNode)||(l.activeLayer.add(l.moveIn.activeNode),1<l.activeLayer.pens.length?l.dispatch("multi",l.activeLayer.pens):l.dispatch("node"+(2===t.button?"RightClick":""),l.moveIn.activeNode)):t.altKey?l.moveIn.hoverNode?(l.activeLayer.setPens([l.moveIn.hoverNode]),l.dispatch("node"+(2===t.button?"RightClick":""),l.moveIn.hoverNode)):l.moveIn.hoverLine&&(l.activeLayer.setPens([l.moveIn.hoverLine]),l.dispatch("line",l.moveIn.hoverLine)):l.activeLayer.pens.length<2&&(l.activeLayer.setPens([l.moveIn.activeNode]),l.dispatch("node"+(2===t.button?"RightClick":""),l.moveIn.activeNode)),(l.data.locked||l.moveIn.activeNode.locked)&&l.moveIn.activeNode.click();break;case Kr.Graffiti:l.moveIn.hoverNode.pushPoint(new u(t.x,t.y))}l.activeLayer.pens.length&&l.activeLayer.saveNodeRects(),l.render()}},this.onmouseup=function(t){if(l.mouseDown){if(l.mouseDown=void 0,l.lastTranlated.x=0,l.lastTranlated.y=0,l.hoverLayer.dockAnchor=void 0,l.hoverLayer.dockLineX=0,l.hoverLayer.dockLineY=0,l.divLayer.canvas.style.cursor="default",l.hoverLayer.dragRect)l.getPensInRect(l.hoverLayer.dragRect),l.activeLayer.pens&&1<l.activeLayer.pens.length?l.dispatch("multi",l.activeLayer.pens):l.activeLayer.pens&&l.activeLayer.pens[0]&&l.activeLayer.pens[0].type===b.Line?l.dispatch("line"+(2===t.button?"RightClick":""),l.activeLayer.pens[0]):l.activeLayer.pens&&l.activeLayer.pens[0]&&l.activeLayer.pens[0].type===b.Node&&l.dispatch("node"+(2===t.button?"RightClick":""),l.activeLayer.pens[0]);else switch(l.moveIn.type){case Kr.Nodes:t.ctrlKey&&t.shiftKey&&t.altKey&&(l.moveIn.hoverNode.manualAnchors||(l.moveIn.hoverNode.manualAnchors=[]),(r=new u(t.x,t.y)).id=l.moveIn.hoverNode.id,l.moveIn.hoverNode.manualAnchors.push(r),l.moveIn.hoverNode.calcAnchors(),l.needCache=!0);break;case Kr.HoverAnchors:l.hoverLayer.line&&((l.hoverLayer.line.to.id?!l.options.disableRepeatLine||l.data.pens.filter(function(t){return t.type===b.Line&&t.from.isSameAs(l.hoverLayer.line.from)&&t.to.isSameAs(l.hoverLayer.line.to)}).length<=1:!l.options.disableEmptyLine&&!l.hoverLayer.line.disableEmptyLine)?(l.activeLayer.pens=[l.hoverLayer.line],l.dispatch("addLine",l.hoverLayer.line)):(l.data.pens.pop(),l.activeLayer.clear())),l.offscreen.render(),l.hoverLayer.line=void 0;break;case Kr.AutoAnchor:!l.hoverLayer.line.disableEmptyLine&&!l.options.disableEmptyLine||l.hoverLayer.line.from.id&&l.hoverLayer.line.to.id?(l.activeLayer.updateLines(),l.dispatch("addLine",l.hoverLayer.line)):(l.needCache=!0,l.activeLayer.clear(),l.data.pens.splice(l.findIndex(l.hoverLayer.line),1));break;case Kr.Rotate:l.activeLayer.updateRotate();break;case Kr.LineControlPoint:p.Store.set(l.generateStoreKey("pts-")+l.moveIn.hoverLine.id,void 0);break;case Kr.LineFrom:case Kr.LineTo:!l.hoverLayer.line.disableEmptyLine&&!l.options.disableEmptyLine||l.hoverLayer.line.from.id&&l.hoverLayer.line.to.id||(l.needCache=!0,l.activeLayer.clear(),l.data.pens.splice(l.findIndex(l.hoverLayer.line),1));break;case Kr.Graffiti:!l.moveIn.hoverNode.points||l.moveIn.hoverNode.points.length<2?(l.moveIn.type=Kr.None,l.data.pens.pop()):(l.moveIn.type=Kr.Nodes,l.moveIn.hoverNode.doing=void 0,l.moveIn.hoverNode.calcAnchors(),l.activeLayer.setPens([l.moveIn.hoverNode]),l.hoverLayer.node=l.moveIn.hoverNode,l.needCache=!0);break;case Kr.Lines:var e=void 0;(e=l.moveIn.hoverLine.children&&l.moveIn.hoverLine.children.length?l.moveIn.hoverLine.children[l.moveIn.hoverLine.children.length-1]:e)||(l.moveIn.hoverLine.children=[]);var r=new We({parentId:l.moveIn.hoverLine.id,name:"line",from:new u(t.x,t.y),fromArrow:e?"":l.data.fromArrow,to:new u(t.x,t.y),toArrow:"",strokeStyle:l.options.color,lineWidth:l.data.lineWidth});e&&(r.from.id=e.id,r.from.x=e.to.x,r.from.y=e.to.y,e.to.id=r.id),l.moveIn.hoverLine.children.push(r),l.hoverLayer.line=r}l.hoverLayer.dragRect=void 0,l.render(),l.needCache&&l.cache(),l.needCache=!1}},this.ondblclick=function(){l.moveIn.hoverNode?(l.dispatch("dblclick",l.moveIn.hoverNode),l.data.locked||l.moveIn.hoverNode.locked||l.moveIn.hoverNode.hideInput||l.options.hideInput||l.showInput(l.moveIn.hoverNode),l.moveIn.hoverNode.dblclick()):l.moveIn.hoverLine&&(l.dispatch("dblclick",l.moveIn.hoverLine),l.data.locked||l.moveIn.hoverLine.locked||l.moveIn.hoverLine.hideInput||l.options.hideInput||l.showInput(l.moveIn.hoverLine),l.moveIn.hoverLine.dblclick())},this.onkeydown=function(t){if(!l.data.locked&&"INPUT"!==t.target.tagName&&"TEXTAREA"!==t.target.tagName){var e,r,i,n,o,s=!1,a=0,c=0;switch(t.key){case" ":l.spaceDown=!0;break;case"a":case"A":l.activeLayer.setPens(l.data.pens),s=!0;break;case"Delete":case"Backspace":t.ctrlKey||t.metaKey?l.deleteAnchors():l.delete(),s=!0;break;case"ArrowLeft":a=-5,(t.ctrlKey||t.metaKey)&&(a=-1),s=!0;break;case"ArrowUp":c=-5,(t.ctrlKey||t.metaKey)&&(c=-1),s=!0;break;case"ArrowRight":a=5,(t.ctrlKey||t.metaKey)&&(a=1),s=!0;break;case"ArrowDown":c=5,(t.ctrlKey||t.metaKey)&&(c=1),s=!0;break;case"x":case"X":l.cut();break;case"c":case"C":l.copy();break;case"v":case"V":l.paste();break;case"y":case"Y":(t.ctrlKey||t.metaKey)&&l.redo();break;case"z":case"Z":t.shiftKey?l.redo():(t.ctrlKey||t.metaKey)&&l.undo();break;case"Enter":l.moveIn.type===Kr.Lines&&(l.moveIn.type=Kr.None,l.moveIn.hoverLine.doing="",l.hoverLayer.line.getLen()<10&&(l.moveIn.hoverLine.children.pop(),l.hoverLayer.line=l.moveIn.hoverLine.children[l.moveIn.hoverLine.children.length-1]),l.moveIn.hoverLine.isNode?(e=[],l.moveIn.hoverLine.children.forEach(function(t){e.push(t.from),t.controlPoints&&t.controlPoints.forEach(function(t){t.data=!0,e.push(t)}),e.push(t.to)}),r=(n=er(e)).x1,o=n.y1,i=n.x2,n=n.y2,o=new Qe({name:"lines",rect:new x(r,o,i-r,n-o),points:e,closePath:l.moveIn.hoverLine.closePath}),l.activeLayer.add(o),l.data.pens.pop(),l.data.pens.push(o)):(l.hoverLayer.line.toArrow=l.data.toArrow,l.activeLayer.add(l.moveIn.hoverLine)),l.moveIn.hoverLine=void 0),s=!0;break;case"Escape":l.moveIn.type===Kr.Lines&&(l.moveIn.type=Kr.None,l.moveIn.hoverLine.children.pop(),l.hoverLayer.line=l.moveIn.hoverLine.children[l.moveIn.hoverLine.children.length-1],l.hoverLayer.line.toArrow=l.data.toArrow,l.moveIn.hoverLine.doing="",l.moveIn.hoverLine=void 0),s=!0}s&&(t.preventDefault(),t.stopPropagation(),(a||c)&&(l.activeLayer.saveNodeRects(),l.activeLayer.move(a,c),l.animateLayer.animate()),l.render(),l.cache())}},this._emitter={all:i=i||new Map,on:function(t,e){var r=i.get(t);r&&r.push(e)||i.set(t,[e])},off:function(t,e){t=i.get(t);t&&t.splice(t.indexOf(e)>>>0,1)},emit:function(e,r){(i.get(e)||[]).slice().map(function(t){t(r)}),(i.get("*")||[]).slice().map(function(t){t(e,r)})}},this.options=Object.assign({},s,e),p.Store.set(this.generateStoreKey("LT:color"),this.options.color||"#222222"),p.Store.set(this.generateStoreKey("LT:fontColor"),this.options.fontColor||"#222222"),this.setupDom(t),this.setupSubscribe(),this.setupMouseEvent(),setTimeout(function(){l.canvasPos=l.divLayer.canvas.getBoundingClientRect()},500),setTimeout(function(){l.canvasPos=l.divLayer.canvas.getBoundingClientRect()},1e3),this.cache(),(window.topology=this).dispatch("loaded")}r.d(e,"d",function(){return qr}),r.d(e,!1,function(){return n}),r.d(e,!1,function(){return i}),r.d(e,!1,function(){return o}),r.d(e,!1,function(){return s}),r.d(e,!1,function(){return f}),r.d(e,!1,function(){return y}),r.d(e,!1,function(){return c}),r.d(e,!1,function(){return l}),r.d(e,!1,function(){return d}),r.d(e,!1,function(){return g}),r.d(e,!1,function(){return m}),r.d(e,!1,function(){return v}),r.d(e,"e",function(){return Je}),r.d(e,"f",function(){return Ze}),r.d(e,!1,function(){}),r.d(e,!1,function(){return vt}),r.d(e,!1,function(){return wt}),r.d(e,!1,function(){return bt}),r.d(e,!1,function(){return xt}),r.d(e,!1,function(){return tr}),r.d(e,!1,function(){return er}),r.d(e,!1,function(){}),r.d(e,"i",function(){return h}),r.d(e,!1,function(){}),r.d(e,!1,function(){}),r.d(e,!1,function(){return rr}),r.d(e,!1,function(){return ir}),r.d(e,!1,function(){}),r.d(e,!1,function(){return b}),r.d(e,!1,function(){return L}),r.d(e,!1,function(){return P}),r.d(e,!1,function(){return Qe}),r.d(e,!1,function(){return We}),r.d(e,"a",function(){return _}),r.d(e,"b",function(){return u}),r.d(e,"c",function(){return x}),r.d(e,!1,function(){return Ve}),r.d(e,!1,function(){return Ye}),r.d(e,!1,function(){return w}),r.d(e,!1,function(){}),r.d(e,!1,function(){return Ne}),r.d(e,!1,function(){return Me}),r.d(e,!1,function(){return Oe}),r.d(e,!1,function(){return Be}),r.d(e,!1,function(){return De}),r.d(e,!1,function(){return Fe}),r.d(e,"h",function(){return je}),r.d(e,!1,function(){}),r.d(e,!1,function(){}),r.d(e,"g",function(){return C}),r.d(e,!1,function(){}),r.d(e,!1,function(){}),r.d(e,!1,function(){}),r.d(e,!1,function(){return D}),r.d(e,!1,function(){}),r.d(e,!1,function(){return j}),r.d(e,!1,function(){return U})},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(r,t,e){!function(t){function e(t){return t&&t.Math==Math&&t}r.exports=e("object"==typeof globalThis&&globalThis)||e("object"==typeof window&&window)||e("object"==typeof self&&self)||e("object"==typeof t&&t)||function(){return this}()||Function("return this")()}.call(this,e(21))},function(t,e,r){r=r(2);t.exports=!r(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})},function(t,e,r){var i=r(3),n=r(40),o=r(9),s=r(45),a=r(60),r=r(93),c=n("wks"),h=i.Symbol,l=r?h:h&&h.withoutSetter||s;t.exports=function(t){return o(c,t)&&(a||"string"==typeof c[t])||(a&&o(h,t)?c[t]=h[t]:c[t]=l("Symbol."+t)),c[t]}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},,function(t,e,r){var i=r(6);t.exports=function(t){if(!i(t))throw TypeError(String(t)+" is not an object");return t}},function(t,e,r){var i=r(15),n={}.hasOwnProperty;t.exports=Object.hasOwn||function(t,e){return n.call(i(t),e)}},function(t,e,r){var i=r(4),n=r(26),o=r(8),s=r(16),a=Object.defineProperty;e.f=i?a:function(t,e,r){if(o(t),e=s(e,!0),o(r),n)try{return a(t,e,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(t[e]=r.value),t}},function(t,e,r){var i=r(14),n=Math.min;t.exports=function(t){return 0<t?n(i(t),9007199254740991):0}},function(t,e,r){var i=r(4),n=r(10),o=r(24);t.exports=i?function(t,e,r){return n.f(t,e,o(1,r))}:function(t,e,r){return t[e]=r,t}},,function(t,e){var r=Math.ceil,i=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(0<t?i:r)(t)}},function(t,e,r){var i=r(18);t.exports=function(t){return Object(i(t))}},function(t,e,r){var n=r(6);t.exports=function(t,e){if(!n(t))return t;var r,i;if(e&&"function"==typeof(r=t.toString)&&!n(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!n(i=r.call(t)))return i;if(!e&&"function"==typeof(r=t.toString)&&!n(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},function(t,e,r){var a=r(3),c=r(12),h=r(9),l=r(32),i=r(46),r=r(25),n=r.get,u=r.enforce,d=String(String).split("String");(t.exports=function(t,e,r,i){var n=!!i&&!!i.unsafe,o=!!i&&!!i.enumerable,s=!!i&&!!i.noTargetGet;"function"==typeof r&&("string"!=typeof e||h(r,"name")||c(r,"name",e),(i=u(r)).source||(i.source=d.join("string"==typeof e?e:""))),t!==a?(n?!s&&t[e]&&(o=!0):delete t[e],o?t[e]=r:c(t,e,r)):o?t[e]=r:l(e,r)})(Function.prototype,"toString",function(){return"function"==typeof this&&n(this).source||i(this)})},function(t,e){t.exports=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t}},function(t,e,r){var i=r(42),n=r(18);t.exports=function(t){return i(n(t))}},function(t,e,r){var h=r(3),l=r(36).f,u=r(12),d=r(17),p=r(32),f=r(71),y=r(61);t.exports=function(t,e){var r,i,n,o=t.target,s=t.global,a=t.stat,c=s?h:a?h[o]||p(o,{}):(h[o]||{}).prototype;if(c)for(r in e){if(i=e[r],n=t.noTargetGet?(n=l(c,r))&&n.value:c[r],!y(s?r:o+(a?".":"#")+r,t.forced)&&void 0!==n){if(typeof i==typeof n)continue;f(i,n)}(t.sham||n&&n.sham)&&u(i,"sham",!0),d(c,r,i,t)}}},function(t,e){var r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},,function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e,r){var i,n,o,s,a,c,h,l,u=r(72),d=r(3),p=r(6),f=r(12),y=r(9),g=r(31),m=r(41),r=r(35),v="Object already initialized",d=d.WeakMap;h=u||g.state?(i=g.state||(g.state=new d),n=i.get,o=i.has,s=i.set,a=function(t,e){if(o.call(i,t))throw new TypeError(v);return e.facade=t,s.call(i,t,e),e},c=function(t){return n.call(i,t)||{}},function(t){return o.call(i,t)}):(r[l=m("state")]=!0,a=function(t,e){if(y(t,l))throw new TypeError(v);return e.facade=t,f(t,l,e),e},c=function(t){return y(t,l)?t[l]:{}},function(t){return y(t,l)}),t.exports={set:a,get:c,has:h,enforce:function(t){return h(t)?c(t):a(t,{})},getterFor:function(r){return function(t){var e;if(!p(t)||(e=c(t)).type!==r)throw TypeError("Incompatible receiver, "+r+" required");return e}}}},function(t,e,r){var i=r(4),n=r(2),o=r(28);t.exports=!i&&!n(function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a})},,function(t,e,r){var i=r(3),r=r(6),n=i.document,o=r(n)&&r(n.createElement);t.exports=function(t){return o?n.createElement(t):{}}},,function(t,e,r){function i(t){return"function"==typeof t?t:void 0}var n=r(69),o=r(3);t.exports=function(t,e){return arguments.length<2?i(n[t])||i(o[t]):n[t]&&n[t][e]||o[t]&&o[t][e]}},function(t,e,r){var i=r(3),n=r(32),r="__core-js_shared__",r=i[r]||n(r,{});t.exports=r},function(t,e,r){var i=r(3),n=r(12);t.exports=function(e,r){try{n(i,e,r)}catch(t){i[e]=r}return r}},function(t,e,r){function i(){}function n(t){return"<script>"+t+"</"+p+">"}var o,s=r(8),a=r(84),c=r(37),h=r(35),l=r(94),u=r(28),r=r(41),d="prototype",p="script",f=r("IE_PROTO"),y=function(){try{o=document.domain&&new ActiveXObject("htmlfile")}catch(t){}var t;y=o?function(t){t.write(n("")),t.close();var e=t.parentWindow.Object;return t=null,e}(o):((t=u("iframe")).style.display="none",l.appendChild(t),t.src=String("javascript:"),(t=t.contentWindow.document).open(),t.write(n("document.F=Object")),t.close(),t.F);for(var e=c.length;e--;)delete y[d][c[e]];return y()};h[f]=!0,t.exports=Object.create||function(t,e){var r;return null!==t?(i[d]=s(t),r=new i,i[d]=null,r[f]=t):r=y(),void 0===e?r:a(r,e)}},function(t,e,r){var i=r(14),n=Math.max,o=Math.min;t.exports=function(t,e){t=i(t);return t<0?n(t+e,0):o(t,e)}},function(t,e){t.exports={}},function(t,e,r){var i=r(4),n=r(68),o=r(24),s=r(19),a=r(16),c=r(9),h=r(26),l=Object.getOwnPropertyDescriptor;e.f=i?l:function(t,e){if(t=s(t),e=a(e,!0),h)try{return l(t,e)}catch(t){}if(c(t,e))return o(!n.f.call(t,e),t[e])}},function(t,e){t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},,function(t,e){t.exports=!1},function(t,e,r){var i=r(39),n=r(31);(t.exports=function(t,e){return n[t]||(n[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.15.1",mode:i?"pure":"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})},function(t,e,r){var i=r(40),n=r(45),o=i("keys");t.exports=function(t){return o[t]||(o[t]=n(t))}},function(t,e,r){var i=r(2),n=r(22),o="".split;t.exports=i(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return"String"==n(t)?o.call(t,""):Object(t)}:Object},,function(t,e,r){var i=r(52),n=r(37).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return i(t,n)}},function(t,e){var r=0,i=Math.random();t.exports=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++r+i).toString(36)}},function(t,e,r){var r=r(31),i=Function.toString;"function"!=typeof r.inspectSource&&(r.inspectSource=function(t){return i.call(t)}),t.exports=r.inspectSource},,function(t,e,r){r=r(30);t.exports=r("navigator","userAgent")||""},function(t,e,r){var i,n,o=r(3),r=r(48),o=o.process,o=o&&o.versions,o=o&&o.v8;o?n=(i=o.split("."))[0]<4?1:i[0]+i[1]:r&&(!(i=r.match(/Edge\/(\d+)/))||74<=i[1])&&(i=r.match(/Chrome\/(\d+)/))&&(n=i[1]),t.exports=n&&+n},,function(t,e,r){var c=r(19),h=r(11),l=r(34),r=function(a){return function(t,e,r){var i,n=c(t),o=h(n.length),s=l(r,o);if(a&&e!=e){for(;s<o;)if((i=n[s++])!=i)return!0}else for(;s<o;s++)if((a||s in n)&&n[s]===e)return a||s||0;return!a&&-1}};t.exports={includes:r(!0),indexOf:r(!1)}},function(t,e,r){var s=r(9),a=r(19),c=r(51).indexOf,h=r(35);t.exports=function(t,e){var r,i=a(t),n=0,o=[];for(r in i)!s(h,r)&&s(i,r)&&o.push(r);for(;e.length>n;)s(i,r=e[n++])&&(~c(o,r)||o.push(r));return o}},,,,,,,,function(t,e,r){var i=r(49),r=r(2);t.exports=!!Object.getOwnPropertySymbols&&!r(function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&i&&i<41})},function(t,e,r){var i=r(2),n=/#|\.prototype\./,r=function(t,e){t=s[o(t)];return t==c||t!=a&&("function"==typeof e?i(e):!!e)},o=r.normalize=function(t){return String(t).replace(n,".").toLowerCase()},s=r.data={},a=r.NATIVE="N",c=r.POLYFILL="P";t.exports=r},,,,,function(t,e,r){var i=r(52),n=r(37);t.exports=Object.keys||function(t){return i(t,n)}},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,r){"use strict";var i={}.propertyIsEnumerable,n=Object.getOwnPropertyDescriptor,o=n&&!i.call({1:2},1);e.f=o?function(t){t=n(this,t);return!!t&&t.enumerable}:i},function(t,e,r){r=r(3);t.exports=r},function(t,e,r){var i=r(30),n=r(44),o=r(67),s=r(8);t.exports=i("Reflect","ownKeys")||function(t){var e=n.f(s(t)),r=o.f;return r?e.concat(r(t)):e}},function(t,e,r){var a=r(9),c=r(70),h=r(36),l=r(10);t.exports=function(t,e){for(var r=c(e),i=l.f,n=h.f,o=0;o<r.length;o++){var s=r[o];a(t,s)||i(t,s,n(e,s))}}},function(t,e,r){var i=r(3),r=r(46),i=i.WeakMap;t.exports="function"==typeof i&&/native code/.test(r(i))},,,,function(t,e,r){"use strict";var s=r(15),a=r(34),c=r(11);t.exports=function(t){for(var e=s(this),r=c(e.length),i=arguments.length,n=a(1<i?arguments[1]:void 0,r),i=2<i?arguments[2]:void 0,o=void 0===i?r:a(i,r);n<o;)e[n++]=t;return e}},,function(t,e,r){var i=r(5),n=r(33),r=r(10),o=i("unscopables"),s=Array.prototype;null==s[o]&&r.f(s,o,{configurable:!0,value:n(null)}),t.exports=function(t){s[o][t]=!0}},,,,,,function(t,e,r){var i=r(4),s=r(10),a=r(8),c=r(66);t.exports=i?Object.defineProperties:function(t,e){a(t);for(var r,i=c(e),n=i.length,o=0;o<n;)s.f(t,r=i[o++],e[r]);return t}},,,,,,,,,function(t,e,r){r=r(60);t.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(t,e,r){r=r(30);t.exports=r("document","documentElement")},,,,,,,,,,,,,,,,,,,,,,,function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(118),r=(n.prototype.unsubscribe=function(){delete i.observers[this.id]},n);function n(t,e,r){this.key="",this.id=t,this.key=e,this.fn=r}e.Observer=r},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.data={},e.observers={}},,,,,,,,,,,,function(t,e,l){!function(i){t.exports=function i(n,o,s){function a(e,t){if(!o[e]){if(!n[e]){if(0,c)return c(e,!0);var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r=o[e]={exports:{}};n[e][0].call(r.exports,function(t){return a(n[e][1][t]||t)},r,r.exports,i,n,o,s)}return o[e].exports}for(var c=!1,t=0;t<s.length;t++)a(s[t]);return a}({1:[function(b,x,t){!function(r,w){!function(){"use strict";var i=b("events").EventEmitter,o=b("./store"),a=b("mqtt-packet"),c=b("readable-stream").Writable,t=b("inherits"),e=b("reinterval"),u=b("./validations"),d=b("xtend"),p=b("debug")("mqttjs:client"),h=r?r.nextTick:function(t){setTimeout(t,0)},f=w.setImmediate||function(t){h(t)},s={keepalive:60,reschedulePings:!0,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:3e4,clean:!0,resubscribe:!0},l=["ECONNREFUSED","EADDRINUSE","ECONNRESET","ENOTFOUND"],y={0:"",1:"Unacceptable protocol version",2:"Identifier rejected",3:"Server unavailable",4:"Bad username or password",5:"Not authorized",16:"No matching subscribers",17:"No subscription existed",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",132:"Unsupported Protocol Version",133:"Client Identifier not valid",134:"Bad User Name or Password",135:"Not authorized",136:"Server unavailable",137:"Server busy",138:"Banned",139:"Server shutting down",140:"Bad authentication method",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",145:"Packet identifier in use",146:"Packet Identifier not found",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"};function g(t,e,r){p("sendPacket :: packet: %O",e),p("sendPacket :: emitting `packetsend`"),t.emit("packetsend",e),p("sendPacket :: writing to stream");e=a.writeToStream(e,t.stream,t.options);p("sendPacket :: writeToStream result %s",e),!e&&r?(p("sendPacket :: handle events on `drain` once through callback."),t.stream.once("drain",r)):r&&(p("sendPacket :: invoking cb"),r())}function n(e,r,i,n){p("storeAndSend :: store packet with cmd %s to outgoingStore",r.cmd),e.outgoingStore.put(r,function(t){return t?i&&i(t):(n(),void g(e,r,i))})}function m(t){p("nop ::",t)}function v(t,e){var r,n=this;if(!(this instanceof v))return new v(t,e);for(r in this.options=e||{},s)void 0===this.options[r]?this.options[r]=s[r]:this.options[r]=e[r];p("MqttClient :: options.protocol",e.protocol),p("MqttClient :: options.protocolVersion",e.protocolVersion),p("MqttClient :: options.username",e.username),p("MqttClient :: options.keepalive",e.keepalive),p("MqttClient :: options.reconnectPeriod",e.reconnectPeriod),p("MqttClient :: options.rejectUnauthorized",e.rejectUnauthorized),this.options.clientId="string"==typeof e.clientId?e.clientId:"mqttjs_"+Math.random().toString(16).substr(2,8),p("MqttClient :: clientId",this.options.clientId),this.options.customHandleAcks=5===e.protocolVersion&&e.customHandleAcks?e.customHandleAcks:function(){arguments[3](0)},this.streamBuilder=t,this.outgoingStore=e.outgoingStore||new o,this.incomingStore=e.incomingStore||new o,this.queueQoSZero=void 0===e.queueQoSZero||e.queueQoSZero,this._resubscribeTopics={},this.messageIdToTopic={},this.pingTimer=null,this.connected=!1,this.disconnecting=!1,this.queue=[],this.connackTimer=null,this.reconnectTimer=null,this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={},this.nextId=Math.max(1,Math.floor(65535*Math.random())),this.outgoing={},this._firstConnection=!0,this.on("connect",function(){var i=this.queue;p("connect :: sending queued packets"),function e(){var t,r=i.shift();p("deliver :: entry %o",r),r&&(t=r.packet,p("deliver :: call _sendPacket for %o",t),n._sendPacket(t,function(t){r.cb&&r.cb(t),e()}))}()}),this.on("close",function(){p("close :: connected set to `false`"),this.connected=!1,p("close :: clearing connackTimer"),clearTimeout(this.connackTimer),p("close :: clearing ping timer"),null!==n.pingTimer&&(n.pingTimer.clear(),n.pingTimer=null),p("close :: calling _setupReconnect"),this._setupReconnect()}),i.call(this),p("MqttClient :: setting up stream"),this._setupStream()}t(v,i),v.prototype._setupStream=function(){var r=this,t=new c,i=a.parser(this.options),n=null,e=[];function o(){var t;e.length?h(s):(t=n,n=null,t())}function s(){p("work :: getting next packet in queue");var t=e.shift();t?(p("work :: packet pulled from queue"),r._handlePacket(t,o)):(p("work :: no packets in queue"),t=n,n=null,p("work :: done flag is %s",!!t),t&&t())}if(p("_setupStream :: calling method to clear reconnect"),this._clearReconnect(),p("_setupStream :: using streamBuilder provided to client to create stream"),this.stream=this.streamBuilder(this),i.on("packet",function(t){p("parser :: on packet push to packets array."),e.push(t)}),t._write=function(t,e,r){n=r,p("writable stream :: parsing buffer"),i.parse(t),s()},p("_setupStream :: pipe stream to writable stream"),this.stream.pipe(t),this.stream.on("error",function(t){p("streamErrorHandler :: error",t.message),l.includes(t.code)?(p("streamErrorHandler :: emitting error"),r.emit("error",t)):m(t)}),this.stream.on("close",function(){var e;p("(%s)stream :: on close",r.options.clientId),(e=r.outgoing)&&(p("flushVolatile :: deleting volatile messages from the queue and setting their callbacks as error function"),Object.keys(e).forEach(function(t){e[t].volatile&&"function"==typeof e[t].cb&&(e[t].cb(new Error("Connection closed")),delete e[t])})),p("stream: emit close to MqttClient"),r.emit("close")}),p("_setupStream: sending packet `connect`"),(t=Object.create(this.options)).cmd="connect",g(this,t),i.on("error",this.emit.bind(this,"error")),this.options.properties){if(!this.options.properties.authenticationMethod&&this.options.properties.authenticationData)return r.end(()=>this.emit("error",new Error("Packet has no Authentication Method"))),this;this.options.properties.authenticationMethod&&this.options.authPacket&&"object"==typeof this.options.authPacket&&g(this,d({cmd:"auth",reasonCode:0},this.options.authPacket))}this.stream.setMaxListeners(1e3),clearTimeout(this.connackTimer),this.connackTimer=setTimeout(function(){p("!!connectTimeout hit!! Calling _cleanUp with force `true`"),r._cleanUp(!0)},this.options.connectTimeout)},v.prototype._handlePacket=function(t,e){var r=this.options;if(5===r.protocolVersion&&r.properties&&r.properties.maximumPacketSize&&r.properties.maximumPacketSize<t.length)return this.emit("error",new Error("exceeding packets size "+t.cmd)),this.end({reasonCode:149,properties:{reasonString:"Maximum packet size was exceeded"}}),this;switch(p("_handlePacket :: emitting packetreceive"),this.emit("packetreceive",t),t.cmd){case"publish":this._handlePublish(t,e);break;case"puback":case"pubrec":case"pubcomp":case"suback":case"unsuback":this._handleAck(t),e();break;case"pubrel":this._handlePubrel(t,e);break;case"connack":this._handleConnack(t),e();break;case"pingresp":this._handlePingresp(t),e();break;case"disconnect":this._handleDisconnect(t),e()}},v.prototype._checkDisconnecting=function(t){return this.disconnecting&&(t?t(new Error("client disconnecting")):this.emit("error",new Error("client disconnecting"))),this.disconnecting},v.prototype.publish=function(t,e,r,i){var n;p("publish :: message `%s` to topic `%s`",e,t);var o=this.options;if("function"==typeof r&&(i=r,r=null),r=d({qos:0,retain:!1,dup:!1},r),this._checkDisconnecting(i))return this;switch(n={cmd:"publish",topic:t,payload:e,qos:r.qos,retain:r.retain,messageId:this._nextId(),dup:r.dup},5===o.protocolVersion&&(n.properties=r.properties,(!o.properties&&n.properties&&n.properties.topicAlias||r.properties&&o.properties&&(r.properties.topicAlias&&o.properties.topicAliasMaximum&&r.properties.topicAlias>o.properties.topicAliasMaximum||!o.properties.topicAliasMaximum&&r.properties.topicAlias))&&delete n.properties.topicAlias),p("publish :: qos",r.qos),r.qos){case 1:case 2:this.outgoing[n.messageId]={volatile:!1,cb:i||m},this._storeProcessing?(p("_storeProcessing enabled"),this._packetIdsDuringStoreProcessing[n.messageId]=!1,this._storePacket(n,void 0,r.cbStorePut)):(p("MqttClient:publish: packet cmd: %s",n.cmd),this._sendPacket(n,void 0,r.cbStorePut));break;default:this._storeProcessing?(p("_storeProcessing enabled"),this._storePacket(n,i,r.cbStorePut)):(p("MqttClient:publish: packet cmd: %s",n.cmd),this._sendPacket(n,i,r.cbStorePut))}return this},v.prototype.subscribe=function(){for(var t=new Array(arguments.length),e=0;e<arguments.length;e++)t[e]=arguments[e];var n=[],r=t.shift(),i=r.resubscribe,o=t.pop()||m,s=t.pop(),a=this,c=this.options.protocolVersion;if(delete r.resubscribe,"string"==typeof r&&(r=[r]),"function"!=typeof o&&(s=o,o=m),null!==(l=u.validateTopics(r)))return f(o,new Error("Invalid topic "+l)),this;if(this._checkDisconnecting(o))return p("subscribe: discconecting true"),this;var h,l={qos:0};if(5===c&&(l.nl=!1,l.rap=!1,l.rh=0),s=d(l,s),Array.isArray(r)?r.forEach(function(t){p("subscribe: array topic %s",t),(!a._resubscribeTopics.hasOwnProperty(t)||a._resubscribeTopics[t].qos<s.qos||i)&&(t={topic:t,qos:s.qos},5===c&&(t.nl=s.nl,t.rap=s.rap,t.rh=s.rh,t.properties=s.properties),p("subscribe: pushing topic `%s` and qos `%s` to subs list",t.topic,t.qos),n.push(t))}):Object.keys(r).forEach(function(t){var e;p("subscribe: object topic %s",t),(!a._resubscribeTopics.hasOwnProperty(t)||a._resubscribeTopics[t].qos<r[t].qos||i)&&(e={topic:t,qos:r[t].qos},5===c&&(e.nl=r[t].nl,e.rap=r[t].rap,e.rh=r[t].rh,e.properties=s.properties),p("subscribe: pushing `%s` to subs list",e),n.push(e))}),l={cmd:"subscribe",subscriptions:n,qos:1,retain:!1,dup:!1,messageId:this._nextId()},s.properties&&(l.properties=s.properties),n.length)return this.options.resubscribe&&(p("subscribe :: resubscribe true"),h=[],n.forEach(function(t){var e;0<a.options.reconnectPeriod&&(e={qos:t.qos},5===c&&(e.nl=t.nl||!1,e.rap=t.rap||!1,e.rh=t.rh||0,e.properties=t.properties),a._resubscribeTopics[t.topic]=e,h.push(t.topic))}),a.messageIdToTopic[l.messageId]=h),this.outgoing[l.messageId]={volatile:!0,cb:function(t,e){if(!t)for(var r=e.granted,i=0;i<r.length;i+=1)n[i].qos=r[i];o(t,n)}},p("subscribe :: call _sendPacket"),this._sendPacket(l),this;o(null,[])},v.prototype.unsubscribe=function(){for(var t={cmd:"unsubscribe",qos:1,messageId:this._nextId()},e=this,r=new Array(arguments.length),i=0;i<arguments.length;i++)r[i]=arguments[i];var n=r.shift(),o=r.pop()||m,s=r.pop();return"string"==typeof n&&(n=[n]),"function"!=typeof o&&(s=o,o=m),this._checkDisconnecting(o)||("string"==typeof n?t.unsubscriptions=[n]:Array.isArray(n)&&(t.unsubscriptions=n),this.options.resubscribe&&t.unsubscriptions.forEach(function(t){delete e._resubscribeTopics[t]}),"object"==typeof s&&s.properties&&(t.properties=s.properties),this.outgoing[t.messageId]={volatile:!0,cb:o},p("unsubscribe: call _sendPacket"),this._sendPacket(t)),this},v.prototype.end=function(t,e,r){var i=this;function n(){p("end :: (%s) :: finish :: calling _cleanUp with force %s",i.options.clientId,t),i._cleanUp(t,()=>{p("end :: finish :: calling process.nextTick on closeStores"),h(function(){p("end :: closeStores: closing incoming and outgoing stores"),i.disconnected=!0,i.incomingStore.close(function(e){i.outgoingStore.close(function(t){p("end :: closeStores: emitting end"),i.emit("end"),r&&(t=e||t,p("end :: closeStores: invoking callback with args"),r(t))})}),i._deferredReconnect&&i._deferredReconnect()}.bind(i))},e)}return p("end :: (%s)",this.options.clientId),null!=t&&"boolean"==typeof t||(r=e||m,e=t,t=!1,"object"!=typeof e&&(r=e,e=null,"function"!=typeof r&&(r=m))),"object"!=typeof e&&(r=e,e=null),p("end :: cb? %s",!!r),r=r||m,this.disconnecting?r():(this._clearReconnect(),this.disconnecting=!0,!t&&0<Object.keys(this.outgoing).length?(p("end :: (%s) :: calling finish in 10ms once outgoing is empty",i.options.clientId),this.once("outgoingEmpty",setTimeout.bind(null,n,10))):(p("end :: (%s) :: immediately calling finish",i.options.clientId),n())),this},v.prototype.removeOutgoingMessage=function(t){var e=this.outgoing[t]?this.outgoing[t].cb:null;return delete this.outgoing[t],this.outgoingStore.del({messageId:t},function(){e(new Error("Message removed"))}),this},v.prototype.reconnect=function(t){p("client reconnect");function e(){t?(r.options.incomingStore=t.incomingStore,r.options.outgoingStore=t.outgoingStore):(r.options.incomingStore=null,r.options.outgoingStore=null),r.incomingStore=r.options.incomingStore||new o,r.outgoingStore=r.options.outgoingStore||new o,r.disconnecting=!1,r.disconnected=!1,r._deferredReconnect=null,r._reconnect()}var r=this;return this.disconnecting&&!this.disconnected?this._deferredReconnect=e:e(),this},v.prototype._reconnect=function(){p("_reconnect: emitting reconnect to client"),this.emit("reconnect"),this.connected?(this.end(()=>{this._setupStream()}),p("client already connected. disconnecting first.")):(p("_reconnect: calling _setupStream"),this._setupStream())},v.prototype._setupReconnect=function(){var t=this;!t.disconnecting&&!t.reconnectTimer&&0<t.options.reconnectPeriod?(this.reconnecting||(p("_setupReconnect :: emit `offline` state"),this.emit("offline"),p("_setupReconnect :: set `reconnecting` to `true`"),this.reconnecting=!0),p("_setupReconnect :: setting reconnectTimer for %d ms",t.options.reconnectPeriod),t.reconnectTimer=setInterval(function(){p("reconnectTimer :: reconnect triggered!"),t._reconnect()},t.options.reconnectPeriod)):p("_setupReconnect :: doing nothing...")},v.prototype._clearReconnect=function(){p("_clearReconnect : clearing reconnect timer"),this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)},v.prototype._cleanUp=function(t,e){var r,i=arguments[2];e&&(p("_cleanUp :: done callback provided for on stream close"),this.stream.on("close",e)),p("_cleanUp :: forced? %s",t),t?(0===this.options.reconnectPeriod&&this.options.clean&&(r=this.outgoing)&&(p("flush: queue exists? %b",!!r),Object.keys(r).forEach(function(t){"function"==typeof r[t].cb&&(r[t].cb(new Error("Connection closed")),delete r[t])})),p("_cleanUp :: (%s) :: destroying stream",this.options.clientId),this.stream.destroy()):(i=d({cmd:"disconnect"},i),p("_cleanUp :: (%s) :: call _sendPacket with disconnect packet",this.options.clientId),this._sendPacket(i,f.bind(null,this.stream.end.bind(this.stream)))),this.disconnecting||(p("_cleanUp :: client not disconnecting. Clearing and resetting reconnect."),this._clearReconnect(),this._setupReconnect()),null!==this.pingTimer&&(p("_cleanUp :: clearing pingTimer"),this.pingTimer.clear(),this.pingTimer=null),e&&!this.connected&&(p("_cleanUp :: (%s) :: removing stream `done` callback `close` listener",this.options.clientId),this.stream.removeListener("close",e),e())},v.prototype._sendPacket=function(t,e,r){if(p("_sendPacket :: (%s) ::  start",this.options.clientId),r=r||m,!this.connected)return p("_sendPacket :: client not connected. Storing packet offline."),void this._storePacket(t,e,r);switch(this._shiftPingInterval(),t.cmd){case"publish":break;case"pubrel":return void n(this,t,e,r);default:return void g(this,t,e)}switch(t.qos){case 2:case 1:n(this,t,e,r);break;default:g(this,t,e)}p("_sendPacket :: (%s) ::  end",this.options.clientId)},v.prototype._storePacket=function(t,e,r){p("_storePacket :: packet: %o",t),p("_storePacket :: cb? %s",!!e),r=r||m,0===(t.qos||0)&&this.queueQoSZero||"publish"!==t.cmd?this.queue.push({packet:t,cb:e}):0<t.qos?(e=this.outgoing[t.messageId]?this.outgoing[t.messageId].cb:null,this.outgoingStore.put(t,function(t){return t?e&&e(t):void r()})):e&&e(new Error("No connection to broker"))},v.prototype._setupPingTimer=function(){p("_setupPingTimer :: keepalive %d (seconds)",this.options.keepalive);var t=this;!this.pingTimer&&this.options.keepalive&&(this.pingResp=!0,this.pingTimer=e(function(){t._checkPing()},1e3*this.options.keepalive))},v.prototype._shiftPingInterval=function(){this.pingTimer&&this.options.keepalive&&this.options.reschedulePings&&this.pingTimer.reschedule(1e3*this.options.keepalive)},v.prototype._checkPing=function(){p("_checkPing :: checking ping..."),this.pingResp?(p("_checkPing :: ping response received. Clearing flag and sending `pingreq`"),this.pingResp=!1,this._sendPacket({cmd:"pingreq"})):(p("_checkPing :: calling _cleanUp with force true"),this._cleanUp(!0))},v.prototype._handlePingresp=function(){this.pingResp=!0},v.prototype._handleConnack=function(t){p("_handleConnack");var e=this.options,r=5===e.protocolVersion?t.reasonCode:t.returnCode;clearTimeout(this.connackTimer),t.properties&&(t.properties.topicAliasMaximum&&(e.properties||(e.properties={}),e.properties.topicAliasMaximum=t.properties.topicAliasMaximum),t.properties.serverKeepAlive&&e.keepalive&&(e.keepalive=t.properties.serverKeepAlive,this._shiftPingInterval()),t.properties.maximumPacketSize&&(e.properties||(e.properties={}),e.properties.maximumPacketSize=t.properties.maximumPacketSize)),0===r?(this.reconnecting=!1,this._onConnect(t)):0<r&&((t=new Error("Connection refused: "+y[r])).code=r,this.emit("error",t))},v.prototype._handlePublish=function(r,i){p("_handlePublish: packet %o",r),i=void 0!==i?i:m;var n=r.topic.toString(),o=r.payload,t=r.qos,s=r.messageId,a=this,e=this.options,c=[0,16,128,131,135,144,145,151,153];switch(p("_handlePublish: qos %d",t),t){case 2:e.customHandleAcks(n,o,r,function(t,e){return t instanceof Error||(e=t,t=null),t?a.emit("error",t):-1===c.indexOf(e)?a.emit("error",new Error("Wrong reason code for pubrec")):void(e?a._sendPacket({cmd:"pubrec",messageId:s,reasonCode:e},i):a.incomingStore.put(r,function(){a._sendPacket({cmd:"pubrec",messageId:s},i)}))});break;case 1:e.customHandleAcks(n,o,r,function(t,e){return t instanceof Error||(e=t,t=null),t?a.emit("error",t):-1===c.indexOf(e)?a.emit("error",new Error("Wrong reason code for puback")):(e||a.emit("message",n,o,r),void a.handleMessage(r,function(t){return t?i&&i(t):void a._sendPacket({cmd:"puback",messageId:s,reasonCode:e},i)}))});break;case 0:this.emit("message",n,o,r),this.handleMessage(r,i);break;default:p("_handlePublish: unknown QoS. Doing nothing.")}},v.prototype.handleMessage=function(t,e){e()},v.prototype._handleAck=function(t){var e,r=t.messageId,i=t.cmd,n=this.outgoing[r]?this.outgoing[r].cb:null,o=this;if(n){switch(p("_handleAck :: packet type",i),i){case"pubcomp":case"puback":var s=t.reasonCode;s&&0<s&&16!==s&&((e=new Error("Publish error: "+y[s])).code=s,n(e,t)),delete this.outgoing[r],this.outgoingStore.del(t,n);break;case"pubrec":var a={cmd:"pubrel",qos:2,messageId:r},s=t.reasonCode;s&&0<s&&16!==s?((e=new Error("Publish error: "+y[s])).code=s,n(e,t)):this._sendPacket(a);break;case"suback":delete this.outgoing[r];for(var c,h=0;h<t.granted.length;h++)0==(128&t.granted[h])||(c=this.messageIdToTopic[r])&&c.forEach(function(t){delete o._resubscribeTopics[t]});n(null,t);break;case"unsuback":delete this.outgoing[r],n(null);break;default:o.emit("error",new Error("unrecognized packet type"))}this.disconnecting&&0===Object.keys(this.outgoing).length&&this.emit("outgoingEmpty")}else p("_handleAck :: Server sent an ack in error. Ignoring.")},v.prototype._handlePubrel=function(t,r){p("handling pubrel packet"),r=void 0!==r?r:m;var i=this,n={cmd:"pubcomp",messageId:t.messageId};i.incomingStore.get(t,function(t,e){t?i._sendPacket(n,r):(i.emit("message",e.topic,e.payload,e),i.handleMessage(e,function(t){return t?r(t):(i.incomingStore.del(e,m),void i._sendPacket(n,r))}))})},v.prototype._handleDisconnect=function(t){this.emit("disconnect",t)},v.prototype._nextId=function(){var t=this.nextId++;return 65536===this.nextId&&(this.nextId=1),t},v.prototype.getLastMessageId=function(){return 1===this.nextId?65535:this.nextId-1},v.prototype._resubscribe=function(t){p("_resubscribe");var e=Object.keys(this._resubscribeTopics);if(!this._firstConnection&&(this.options.clean||5===this.options.protocolVersion&&!t.sessionPresent)&&0<e.length)if(this.options.resubscribe)if(5===this.options.protocolVersion){p("_resubscribe: protocolVersion 5");for(var r=0;r<e.length;r++){var i={};i[e[r]]=this._resubscribeTopics[e[r]],i.resubscribe=!0,this.subscribe(i,{properties:i[e[r]].properties})}}else this._resubscribeTopics.resubscribe=!0,this.subscribe(this._resubscribeTopics);else this._resubscribeTopics={};this._firstConnection=!1},v.prototype._onConnect=function(o){var s;this.disconnected?this.emit("connect",o):((s=this)._setupPingTimer(),this._resubscribe(o),this.connected=!0,function r(){var e=s.outgoingStore.createStream();function i(){s._storeProcessing=!1,s._packetIdsDuringStoreProcessing={}}function n(){e.destroy(),e=null,i()}s.once("close",n),e.on("error",function(t){i(),s.removeListener("close",n),s.emit("error",t)}),e.on("end",function(){var t,e=!0;for(t in s._packetIdsDuringStoreProcessing)if(!s._packetIdsDuringStoreProcessing[t]){e=!1;break}e?(i(),s.removeListener("close",n),s.emit("connect",o)):r()}),function r(){var i,t;e&&(s._storeProcessing=!0,(t=e.read(1))?s._packetIdsDuringStoreProcessing[t.messageId]?r():s.disconnecting||s.reconnectTimer?e.destroy&&e.destroy():(i=s.outgoing[t.messageId]?s.outgoing[t.messageId].cb:null,s.outgoing[t.messageId]={volatile:!1,cb:function(t,e){i&&i(t,e),r()}},s._packetIdsDuringStoreProcessing[t.messageId]=!0,s._sendPacket(t)):e.once("readable",r))}()}())},x.exports=v}.call(this)}.call(this,b("_process"),void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./store":7,"./validations":8,_process:32,debug:15,events:19,inherits:21,"mqtt-packet":24,"readable-stream":51,reinterval:52,xtend:61}],2:[function(t,e,r){!function(d){!function(){"use strict";var s,a,c,h=t("readable-stream").Transform,l=t("duplexify"),u=!1;e.exports=function(t,e){if(e.hostname=e.hostname||e.host,!e.hostname)throw new Error("Could not determine host. Specify host manually.");var r="MQIsdp"===e.protocolId&&3===e.protocolVersion?"mqttv3.1":"mqtt";(o=e).hostname||(o.hostname="localhost"),o.path||(o.path="/"),o.wsOptions||(o.wsOptions={});var i,n,o,o=(n="alis"===(i=e).protocol?"wss":"ws",o=n+"://"+i.hostname+i.path,i.port&&80!==i.port&&443!==i.port&&(o=n+"://"+i.hostname+":"+i.port+i.path),o="function"==typeof i.transformWsUrl?i.transformWsUrl(o,i,t):o);return(s=e.my).connectSocket({url:o,protocols:r}),(r=new h)._write=function(t,e,r){s.sendSocketMessage({data:t.buffer,success:function(){r()},fail:function(){r(new Error)}})},r._flush=function(t){s.closeSocket({success:function(){t()}})},a=r,c=l.obj(),u||(u=!0,s.onSocketOpen(function(){c.setReadable(a),c.setWritable(a),c.emit("connect")}),s.onSocketMessage(function(t){var e,r;"string"==typeof t.data?(e=d.from(t.data,"base64"),a.push(e)):((r=new FileReader).addEventListener("load",function(){var t=(t=r.result)instanceof ArrayBuffer?d.from(t):d.from(t,"utf8");a.push(t)}),r.readAsArrayBuffer(t.data))}),s.onSocketClose(function(){c.end(),c.destroy()}),s.onSocketError(function(t){c.destroy(t)})),c}}.call(this)}.call(this,t("buffer").Buffer)},{buffer:14,duplexify:17,"readable-stream":51}],3:[function(t,e,r){"use strict";var i=t("net"),n=t("debug")("mqttjs:tcp");e.exports=function(t,e){var r;return e.port=e.port||1883,e.hostname=e.hostname||e.host||"localhost",r=e.port,e=e.hostname,n("port %d and host %s",r,e),i.createConnection(r,e)}},{debug:15,net:13}],4:[function(t,e,r){"use strict";var n=t("tls"),o=t("debug")("mqttjs:tls");e.exports=function(e,r){var i;function t(t){r.rejectUnauthorized&&e.emit("error",t),i.end()}return r.port=r.port||8883,r.host=r.hostname||r.host||"localhost",r.servername=r.host,r.rejectUnauthorized=!1!==r.rejectUnauthorized,delete r.path,o("port %d host %s rejectUnauthorized %b",r.port,r.host,r.rejectUnauthorized),(i=n.connect(r)).on("secureConnect",function(){r.rejectUnauthorized&&!i.authorized?i.emit("error",new Error("TLS not authorized")):i.removeListener("error",t)}),i.on("error",t),i}},{debug:15,tls:13}],5:[function(r,o,t){!function(e,w){!function(){"use strict";const n=r("ws"),f=r("debug")("mqttjs:ws"),y=r("duplexify"),g=r("readable-stream").Transform;let t=["rejectUnauthorized","ca","cert","key","pfx","passphrase"];const i=void 0!==e&&"browser"===e.title||"function"==typeof l;function m(t,e){let r=t.protocol+"://"+t.hostname+":"+t.port+t.path;return"function"==typeof t.transformWsUrl&&(r=t.transformWsUrl(r,t,e)),r}function v(e){let r=e;return e.hostname||(r.hostname="localhost"),e.port||("wss"===e.protocol?r.port=443:r.port=80),e.path||(r.path="/"),e.wsOptions||(r.wsOptions={}),i||"wss"!==e.protocol||t.forEach(function(t){e.hasOwnProperty(t)&&!e.wsOptions.hasOwnProperty(t)&&(r.wsOptions[t]=e[t])}),r}o.exports=i?function(i,n){let e;f("browserStreamBuilder");const o=function(t){let e=v(t);if(e.hostname||(e.hostname=e.host),!e.hostname){if("undefined"==typeof document)throw new Error("Could not determine host. Specify host manually.");const t=new URL(document.URL);e.hostname=t.hostname,e.port||(e.port=t.port)}return void 0===e.objectMode&&(e.objectMode=!(!0===e.binary||void 0===e.binary)),e}(n).browserBufferSize||524288,s=n.browserBufferTimeout||1e3,a=!n.objectMode;let c=function(){var t="MQIsdp"===n.protocolId&&3===n.protocolVersion?"mqttv3.1":"mqtt";let e=m(n,i),r=new WebSocket(e,[t]);return r.binaryType="arraybuffer",r}(),r=function(t,e){let r=new g({objectModeMode:t.objectMode});return r._write=e,r._flush=function(t){c.close(),t()},r}(n,function t(e,r,i){c.bufferedAmount>o&&setTimeout(t,s,e,r,i),a&&"string"==typeof e&&(e=w.from(e,"utf8"));try{c.send(e)}catch(t){return i(t)}i()});n.objectMode||(r._writev=p),r.on("close",()=>{c.close()});var t=void 0!==c.addEventListener;function h(){e.setReadable(r),e.setWritable(r),e.emit("connect")}function l(){e.end(),e.destroy()}function u(t){e.destroy(t)}function d(t){let e=t.data;e=e instanceof ArrayBuffer?w.from(e):w.from(e,"utf8"),r.push(e)}function p(e,t){const r=new Array(e.length);for(let t=0;t<e.length;t++)"string"==typeof e[t].chunk?r[t]=w.from(e[t],"utf8"):r[t]=e[t].chunk;this._write(w.concat(r),"binary",t)}return c.readyState===c.OPEN?e=r:(e=e=y(void 0,void 0,n),n.objectMode||(e._writev=p),t?c.addEventListener("open",h):c.onopen=h),e.socket=c,t?(c.addEventListener("close",l),c.addEventListener("error",u),c.addEventListener("message",d)):(c.onclose=l,c.onerror=u,c.onmessage=d),e}:function(t,e){f("streamBuilder");e=v(e),t=m(e,t);let r=function(t,e){f("createWebSocket"),f("protocol: "+e.protocolId+" "+e.protocolVersion);var r="MQIsdp"===e.protocolId&&3===e.protocolVersion?"mqttv3.1":"mqtt";return f("creating new Websocket for url: "+t+" and protocol: "+r),new n(t,[r],e.wsOptions)}(t,e),i=n.createWebSocketStream(r,e.wsOptions);return i.url=t,r.on("close",()=>{i.destroy()}),i}}.call(this)}.call(this,r("_process"),r("buffer").Buffer)},{_process:32,buffer:14,debug:15,duplexify:17,"readable-stream":51,ws:60}],6:[function(t,e,r){!function(u){!function(){"use strict";var s,a,c,h=t("readable-stream").Transform,l=t("duplexify");e.exports=function(t,e){if(e.hostname=e.hostname||e.host,!e.hostname)throw new Error("Could not determine host. Specify host manually.");var r="MQIsdp"===e.protocolId&&3===e.protocolVersion?"mqttv3.1":"mqtt";(n=e).hostname||(n.hostname="localhost"),n.path||(n.path="/"),n.wsOptions||(n.wsOptions={});var i,n,e=(n="wxs"===(i=e).protocol?"wss":"ws",e=n+"://"+i.hostname+i.path,i.port&&80!==i.port&&443!==i.port&&(e=n+"://"+i.hostname+":"+i.port+i.path),e="function"==typeof i.transformWsUrl?i.transformWsUrl(e,i,t):e);s=wx.connectSocket({url:e,protocols:[r]}),(r=new h)._write=function(t,e,r){s.send({data:t.buffer,success:function(){r()},fail:function(t){r(new Error(t))}})},r._flush=function(t){s.close({success:function(){t()}})},a=r,(c=l.obj())._destroy=function(t,e){s.close({success:function(){e&&e(t)}})};var o=c.destroy;return c.destroy=function(){c.destroy=o;var t=this;setTimeout(function(){s.close({fail:function(){t._destroy(new Error)}})},0)}.bind(c),s.onOpen(function(){c.setReadable(a),c.setWritable(a),c.emit("connect")}),s.onMessage(function(t){t=(t=t.data)instanceof ArrayBuffer?u.from(t):u.from(t,"utf8");a.push(t)}),s.onClose(function(){c.end(),c.destroy()}),s.onError(function(t){c.destroy(new Error(t.errMsg))}),c}}.call(this)}.call(this,t("buffer").Buffer)},{buffer:14,duplexify:17,"readable-stream":51}],7:[function(t,e,r){"use strict";var i=t("xtend"),n=t("readable-stream").Readable,o={objectMode:!0},s={clean:!0};function a(t){if(!(this instanceof a))return new a(t);this.options=t||{},this.options=i(s,t),this._inflights=new Map}a.prototype.put=function(t,e){return this._inflights.set(t.messageId,t),e&&e(),this},a.prototype.createStream=function(){var t=new n(o),e=!1,r=[],i=0;return this._inflights.forEach(function(t,e){r.push(t)}),t._read=function(){!e&&i<r.length?this.push(r[i++]):this.push(null)},t.destroy=function(){var t;e||(t=this,e=!0,setTimeout(function(){t.emit("close")},0))},t},a.prototype.del=function(t,e){return(t=this._inflights.get(t.messageId))?(this._inflights.delete(t.messageId),e(null,t)):e&&e(new Error("missing packet")),this},a.prototype.get=function(t,e){return(t=this._inflights.get(t.messageId))?e(null,t):e&&e(new Error("missing packet")),this},a.prototype.close=function(t){this.options.clean&&(this._inflights=null),t&&t()},e.exports=a},{"readable-stream":51,xtend:61}],8:[function(t,e,r){"use strict";e.exports={validateTopics:function(t){if(0===t.length)return"empty_topic_list";for(var e=0;e<t.length;e++)if(!function(t){for(var e=t.split("/"),r=0;r<e.length;r++)if("+"!==e[r]){if("#"===e[r])return r===e.length-1;if(-1!==e[r].indexOf("+")||-1!==e[r].indexOf("#"))return}return 1}(t[e]))return t[e];return null}}},{}],9:[function(i,h,t){!function(r){!function(){"use strict";var n=i("../client"),t=i("../store"),o=i("url"),s=i("xtend"),a=i("debug")("mqttjs"),c={};function e(t,e){if(a("connecting to an MQTT broker..."),"object"!=typeof t||e||(e=t,t=null),e=e||{},t){var r=o.parse(t,!0);if(null!=r.port&&(r.port=Number(r.port)),null===(e=s(r,e)).protocol)throw new Error("Missing protocol");e.protocol=e.protocol.replace(/:$/,"")}if((t=e).auth&&((r=t.auth.match(/^(.+):(.+)$/))?(t.username=r[1],t.password=r[2]):t.username=t.auth),e.query&&"string"==typeof e.query.clientId&&(e.clientId=e.query.clientId),e.cert&&e.key){if(!e.protocol)throw new Error("Missing secure protocol key");if(-1===["mqtts","wss","wxs","alis"].indexOf(e.protocol))switch(e.protocol){case"mqtt":e.protocol="mqtts";break;case"ws":e.protocol="wss";break;case"wx":e.protocol="wxs";break;case"ali":e.protocol="alis";break;default:throw new Error('Unknown protocol for secure connection: "'+e.protocol+'"!')}}var i;if(c[e.protocol]||(i=-1!==["mqtts","wss"].indexOf(e.protocol),e.protocol=["mqtt","mqtts","ws","wss","wx","wxs","ali","alis"].filter(function(t,e){return(!i||e%2!=0)&&"function"==typeof c[t]})[0]),!1===e.clean&&!e.clientId)throw new Error("Missing clientId for unclean clients");e.protocol&&(e.defaultProtocol=e.protocol);t=new n(function(t){return e.servers&&(t._reconnectCount&&t._reconnectCount!==e.servers.length||(t._reconnectCount=0),e.host=e.servers[t._reconnectCount].host,e.port=e.servers[t._reconnectCount].port,e.protocol=e.servers[t._reconnectCount].protocol||e.defaultProtocol,e.hostname=e.host,t._reconnectCount++),a("calling streambuilder for",e.protocol),c[e.protocol](t,e)},e);return t.on("error",function(){}),t}void 0!==r&&"browser"!==r.title||"function"!=typeof l?(c.mqtt=i("./tcp"),c.tcp=i("./tcp"),c.ssl=i("./tls"),c.tls=i("./tls"),c.mqtts=i("./tls")):(c.wx=i("./wx"),c.wxs=i("./wx"),c.ali=i("./ali"),c.alis=i("./ali")),c.ws=i("./ws"),c.wss=i("./ws"),h.exports=e,h.exports.connect=e,h.exports.MqttClient=n,h.exports.Store=t}.call(this)}.call(this,i("_process"))},{"../client":1,"../store":7,"./ali":2,"./tcp":3,"./tls":4,"./ws":5,"./wx":6,_process:32,debug:15,url:56,xtend:61}],10:[function(t,e,r){"use strict";r.byteLength=function(t){var e=l(t),t=e[0],e=e[1];return 3*(t+e)/4-e},r.toByteArray=function(t){for(var e,r=l(t),i=r[0],r=r[1],n=new h(3*(i+r)/4-r),o=0,s=0<r?i-4:i,a=0;a<s;a+=4)e=c[t.charCodeAt(a)]<<18|c[t.charCodeAt(a+1)]<<12|c[t.charCodeAt(a+2)]<<6|c[t.charCodeAt(a+3)],n[o++]=e>>16&255,n[o++]=e>>8&255,n[o++]=255&e;return 2===r&&(e=c[t.charCodeAt(a)]<<2|c[t.charCodeAt(a+1)]>>4,n[o++]=255&e),1===r&&(e=c[t.charCodeAt(a)]<<10|c[t.charCodeAt(a+1)]<<4|c[t.charCodeAt(a+2)]>>2,n[o++]=e>>8&255,n[o++]=255&e),n},r.fromByteArray=function(t){for(var e,r=t.length,i=r%3,n=[],o=0,s=r-i;o<s;o+=16383)n.push(function(t,e,r){for(var i,n=[],o=e;o<r;o+=3)i=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(255&t[o+2]),n.push(a[(i=i)>>18&63]+a[i>>12&63]+a[i>>6&63]+a[63&i]);return n.join("")}(t,o,s<o+16383?s:o+16383));return 1==i?(e=t[r-1],n.push(a[e>>2]+a[e<<4&63]+"==")):2==i&&(e=(t[r-2]<<8)+t[r-1],n.push(a[e>>10]+a[e>>4&63]+a[e<<2&63]+"=")),n.join("")};for(var a=[],c=[],h="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=0,o=i.length;n<o;++n)a[n]=i[n],c[i.charCodeAt(n)]=n;function l(t){var e=t.length;if(0<e%4)throw new Error("Invalid string. Length must be a multiple of 4");t=t.indexOf("=");return[t=-1===t?e:t,t===e?0:4-t%4]}c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63},{}],11:[function(t,e,r){"use strict";const{Buffer:l}=t("buffer"),i=Symbol.for("BufferList");function n(t){if(!(this instanceof n))return new n(t);n._init.call(this,t)}n._init=function(t){Object.defineProperty(this,i,{value:!0}),this._bufs=[],this.length=0,t&&this.append(t)},n.prototype._new=function(t){return new n(t)},n.prototype._offset=function(e){if(0===e)return[0,0];let r=0;for(let t=0;t<this._bufs.length;t++){var i=r+this._bufs[t].length;if(e<i||t===this._bufs.length-1)return[t,e-r];r=i}},n.prototype._reverseOffset=function(t){var e=t[0];let r=t[1];for(let t=0;t<e;t++)r+=this._bufs[t].length;return r},n.prototype.get=function(t){if(!(t>this.length||t<0)){t=this._offset(t);return this._bufs[t[0]][t[1]]}},n.prototype.slice=function(t,e){return"number"==typeof t&&t<0&&(t+=this.length),"number"==typeof e&&e<0&&(e+=this.length),this.copy(null,0,t,e)},n.prototype.copy=function(e,t,r,i){if(("number"!=typeof i||i>this.length)&&(i=this.length),(r="number"!=typeof r||r<0?0:r)>=this.length)return e||l.alloc(0);if(i<=0)return e||l.alloc(0);var n=!!e,o=this._offset(r),s=i-r;let a=s,c=n&&t||0,h=o[1];if(0===r&&i===this.length){if(!n)return 1===this._bufs.length?this._bufs[0]:l.concat(this._bufs,this.length);for(let t=0;t<this._bufs.length;t++)this._bufs[t].copy(e,c),c+=this._bufs[t].length;return e}if(a<=this._bufs[o[0]].length-h)return n?this._bufs[o[0]].copy(e,t,h,h+a):this._bufs[o[0]].slice(h,h+a);n||(e=l.allocUnsafe(s));for(let t=o[0];t<this._bufs.length;t++){const r=this._bufs[t].length-h;if(!(a>r)){this._bufs[t].copy(e,c,h,h+a),c+=r;break}this._bufs[t].copy(e,c,h),c+=r,a-=r,h=h&&0}return e.length>c?e.slice(0,c):e},n.prototype.shallowSlice=function(t,e){if(e="number"!=typeof e?this.length:e,(t=t||0)<0&&(t+=this.length),e<0&&(e+=this.length),t===e)return this._new();const r=this._offset(t),i=this._offset(e),n=this._bufs.slice(r[0],i[0]+1);return 0===i[1]?n.pop():n[n.length-1]=n[n.length-1].slice(0,i[1]),0!==r[1]&&(n[0]=n[0].slice(r[1])),this._new(n)},n.prototype.toString=function(t,e,r){return this.slice(e,r).toString(t)},n.prototype.consume=function(t){if(t=Math.trunc(t),Number.isNaN(t)||t<=0)return this;for(;this._bufs.length;){if(!(t>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(t),this.length-=t;break}t-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},n.prototype.duplicate=function(){const e=this._new();for(let t=0;t<this._bufs.length;t++)e.append(this._bufs[t]);return e},n.prototype.append=function(e){if(null==e)return this;if(e.buffer)this._appendBuffer(l.from(e.buffer,e.byteOffset,e.byteLength));else if(Array.isArray(e))for(let t=0;t<e.length;t++)this.append(e[t]);else if(this._isBufferList(e))for(let t=0;t<e._bufs.length;t++)this.append(e._bufs[t]);else"number"==typeof e&&(e=e.toString()),this._appendBuffer(l.from(e));return this},n.prototype._appendBuffer=function(t){this._bufs.push(t),this.length+=t.length},n.prototype.indexOf=function(t,e,r){if(void 0===r&&"string"==typeof e&&(r=e,e=void 0),"function"==typeof t||Array.isArray(t))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if("number"==typeof t?t=l.from([t]):"string"==typeof t?t=l.from(t,r):this._isBufferList(t)?t=t.slice():Array.isArray(t.buffer)?t=l.from(t.buffer,t.byteOffset,t.byteLength):l.isBuffer(t)||(t=l.from(t)),e=Number(e||0),(e=(e=isNaN(e)?0:e)<0?this.length+e:e)<0&&(e=0),0===t.length)return e>this.length?this.length:e;e=this._offset(e);let i=e[0],n=e[1];for(;i<this._bufs.length;i++){const o=this._bufs[i];for(;n<o.length;)if(o.length-n>=t.length){const r=o.indexOf(t,n);if(-1!==r)return this._reverseOffset([i,r]);n=o.length-t.length+1}else{const o=this._reverseOffset([i,n]);if(this._match(o,t))return o;n++}n=0}return-1},n.prototype._match=function(e,r){if(this.length-e<r.length)return!1;for(let t=0;t<r.length;t++)if(this.get(e+t)!==r[t])return!1;return!0},function(){const e={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(const t in e)!function(r){n.prototype[r]=null===e[r]?function(t,e){return this.slice(t,t+e)[r](0,e)}:function(t=0){return this.slice(t,t+e[r])[r](0)}}(t)}(),n.prototype._isBufferList=function(t){return t instanceof n||n.isBufferList(t)},n.isBufferList=function(t){return null!=t&&t[i]},e.exports=n},{buffer:14}],12:[function(t,e,r){"use strict";const i=t("readable-stream").Duplex,n=t("inherits"),o=t("./BufferList");function s(t){if(!(this instanceof s))return new s(t);if("function"==typeof t){this._callback=t;const e=function(t){this._callback&&(this._callback(t),this._callback=null)}.bind(this);this.on("pipe",function(t){t.on("error",e)}),this.on("unpipe",function(t){t.removeListener("error",e)}),t=null}o._init.call(this,t),i.call(this)}n(s,i),Object.assign(s.prototype,o.prototype),s.prototype._new=function(t){return new s(t)},s.prototype._write=function(t,e,r){this._appendBuffer(t),"function"==typeof r&&r()},s.prototype._read=function(t){if(!this.length)return this.push(null);t=Math.min(t,this.length),this.push(this.slice(0,t)),this.consume(t)},s.prototype.end=function(t){i.prototype.end.call(this,t),this._callback&&(this._callback(null,this.slice()),this._callback=null)},s.prototype._destroy=function(t,e){this._bufs.length=0,this.length=0,e(t)},s.prototype._isBufferList=function(t){return t instanceof s||t instanceof o||s.isBufferList(t)},s.isBufferList=o.isBufferList,e.exports=s,e.exports.BufferListStream=s,e.exports.BufferList=o},{"./BufferList":11,inherits:21,"readable-stream":51}],13:[function(t,e,r){},{}],14:[function(C,t,R){!function(t){!function(){"use strict";var a=C("base64-js"),o=C("ieee754");R.Buffer=u,R.SlowBuffer=function(t){return u.alloc(+(t=+t!=t?0:t))},R.INSPECT_MAX_BYTES=50;var e=2147483647;function n(t){if(e<t)throw new RangeError('The value "'+t+'" is invalid for option "size"');t=new Uint8Array(t);return t.__proto__=u.prototype,t}function u(t,e,r){if("number"!=typeof t)return i(t,e,r);if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return c(t)}function i(t,e,r){if("string"==typeof t)return function(t,e){if(!u.isEncoding(e="string"!=typeof e||""===e?"utf8":e))throw new TypeError("Unknown encoding: "+e);var r=0|d(t,e),i=n(r),e=i.write(t,e);return i=e!==r?i.slice(0,e):i}(t,e);if(ArrayBuffer.isView(t))return h(t);if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(P(t,ArrayBuffer)||t&&P(t.buffer,ArrayBuffer))return function(t,e,r){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw new RangeError('"length" is outside of buffer bounds');r=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r);return r.__proto__=u.prototype,r}(t,e,r);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');var i=t.valueOf&&t.valueOf();if(null!=i&&i!==t)return u.from(i,e,r);i=function(t){if(u.isBuffer(t)){var e=0|l(t.length),r=n(e);return 0===r.length||t.copy(r,0,0,e),r}return void 0!==t.length?"number"!=typeof t.length||T(t.length)?n(0):h(t):"Buffer"===t.type&&Array.isArray(t.data)?h(t.data):void 0}(t);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return u.from(t[Symbol.toPrimitive]("string"),e,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function s(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function c(t){return s(t),n(t<0?0:0|l(t))}function h(t){for(var e=t.length<0?0:0|l(t.length),r=n(e),i=0;i<e;i+=1)r[i]=255&t[i];return r}function l(t){if(e<=t)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+e.toString(16)+" bytes");return 0|t}function d(t,e){if(u.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||P(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var r=t.length,i=2<arguments.length&&!0===arguments[2];if(!i&&0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return k(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return I(t).length;default:if(n)return i?-1:k(t).length;e=(""+e).toLowerCase(),n=!0}}function r(t,e,r){var i=t[e];t[e]=t[r],t[r]=i}function p(t,e,r,i,n){if(0===t.length)return-1;if("string"==typeof r?(i=r,r=0):2147483647<r?r=2147483647:r<-2147483648&&(r=-2147483648),(r=(r=T(r=+r)?n?0:t.length-1:r)<0?t.length+r:r)>=t.length){if(n)return-1;r=t.length-1}else if(r<0){if(!n)return-1;r=0}if("string"==typeof e&&(e=u.from(e,i)),u.isBuffer(e))return 0===e.length?-1:f(t,e,r,i,n);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?(n?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(t,e,r):f(t,[e],r,i,n);throw new TypeError("val must be string, number or Buffer")}function f(t,e,r,i,n){var o=1,s=t.length,a=e.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(t.length<2||e.length<2)return-1;s/=o=2,a/=2,r/=2}function c(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(n)for(var h=-1,l=r;l<s;l++)if(c(t,l)===c(e,-1===h?0:l-h)){if(l-(h=-1===h?l:h)+1===a)return h*o}else-1!==h&&(l-=l-h),h=-1;else for(l=r=s<r+a?s-a:r;0<=l;l--){for(var u=!0,d=0;d<a;d++)if(c(t,l+d)!==c(e,d)){u=!1;break}if(u)return l}return-1}function y(t,e,r,i){return L(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,i)}function g(t,e,r){r=Math.min(t.length,r);for(var i=[],n=e;n<r;){var o,s,a,c,h=t[n],l=null,u=239<h?4:223<h?3:191<h?2:1;if(n+u<=r)switch(u){case 1:h<128&&(l=h);break;case 2:128==(192&(o=t[n+1]))&&127<(c=(31&h)<<6|63&o)&&(l=c);break;case 3:o=t[n+1],s=t[n+2],128==(192&o)&&128==(192&s)&&2047<(c=(15&h)<<12|(63&o)<<6|63&s)&&(c<55296||57343<c)&&(l=c);break;case 4:o=t[n+1],s=t[n+2],a=t[n+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&65535<(c=(15&h)<<18|(63&o)<<12|(63&s)<<6|63&a)&&c<1114112&&(l=c)}null===l?(l=65533,u=1):65535<l&&(l-=65536,i.push(l>>>10&1023|55296),l=56320|1023&l),i.push(l),n+=u}return function(t){var e=t.length;if(e<=m)return String.fromCharCode.apply(String,t);for(var r="",i=0;i<e;)r+=String.fromCharCode.apply(String,t.slice(i,i+=m));return r}(i)}R.kMaxLength=e,(u.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()}catch(t){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),u.poolSize=8192,u.from=i,u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,u.alloc=function(t,e,r){return e=e,r=r,s(t=t),!(t<=0)&&void 0!==e?"string"==typeof r?n(t).fill(e,r):n(t).fill(e):n(t)},u.allocUnsafe=c,u.allocUnsafeSlow=c,u.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==u.prototype},u.compare=function(t,e){if(P(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),P(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),!u.isBuffer(t)||!u.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;for(var r=t.length,i=e.length,n=0,o=Math.min(r,i);n<o;++n)if(t[n]!==e[n]){r=t[n],i=e[n];break}return r<i?-1:i<r?1:0},u.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return u.alloc(0);if(void 0===e)for(n=e=0;n<t.length;++n)e+=t[n].length;for(var r=u.allocUnsafe(e),i=0,n=0;n<t.length;++n){var o=t[n];if(P(o,Uint8Array)&&(o=u.from(o)),!u.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},u.byteLength=d,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)r(this,e,e+1);return this},u.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)r(this,e,e+3),r(this,e+1,e+2);return this},u.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)r(this,e,e+7),r(this,e+1,e+6),r(this,e+2,e+5),r(this,e+3,e+4);return this},u.prototype.toString=function(){var t=this.length;return 0===t?"":0===arguments.length?g(this,0,t):function(t,e,r){var i,n,o,s=!1;if((e=void 0===e||e<0?0:e)>this.length)return"";if((r=void 0===r||r>this.length?this.length:r)<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t=t||"utf8";;)switch(t){case"hex":return function(t,e,r){var i=t.length;(!r||r<0||i<r)&&(r=i);for(var n="",o=e=!e||e<0?0:e;o<r;++o)n+=function(t){return t<16?"0"+t.toString(16):t.toString(16)}(t[o]);return n}(this,e,r);case"utf8":case"utf-8":return g(this,e,r);case"ascii":return function(t,e,r){var i="";r=Math.min(t.length,r);for(var n=e;n<r;++n)i+=String.fromCharCode(127&t[n]);return i}(this,e,r);case"latin1":case"binary":return function(t,e,r){var i="";r=Math.min(t.length,r);for(var n=e;n<r;++n)i+=String.fromCharCode(t[n]);return i}(this,e,r);case"base64":return i=this,o=r,0===(n=e)&&o===i.length?a.fromByteArray(i):a.fromByteArray(i.slice(n,o));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(t,e,r){for(var i=t.slice(e,r),n="",o=0;o<i.length;o+=2)n+=String.fromCharCode(i[o]+256*i[o+1]);return n}(this,e,r);default:if(s)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),s=!0}}.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(t){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===u.compare(this,t)},u.prototype.inspect=function(){var t="",e=R.INSPECT_MAX_BYTES,t=this.toString("hex",0,e).replace(/(.{2})/g,"$1 ").trim();return this.length>e&&(t+=" ... "),"<Buffer "+t+">"},u.prototype.compare=function(t,e,r,i,n){if(P(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),!u.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===r&&(r=t?t.length:0),void 0===i&&(i=0),void 0===n&&(n=this.length),(e=void 0===e?0:e)<0||r>t.length||i<0||n>this.length)throw new RangeError("out of range index");if(n<=i&&r<=e)return 0;if(n<=i)return-1;if(r<=e)return 1;if(this===t)return 0;for(var o=(n>>>=0)-(i>>>=0),s=(r>>>=0)-(e>>>=0),a=Math.min(o,s),c=this.slice(i,n),h=t.slice(e,r),l=0;l<a;++l)if(c[l]!==h[l]){o=c[l],s=h[l];break}return o<s?-1:s<o?1:0},u.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},u.prototype.indexOf=function(t,e,r){return p(this,t,e,r,!0)},u.prototype.lastIndexOf=function(t,e,r){return p(this,t,e,r,!1)},u.prototype.write=function(t,e,r,i){if(void 0===e)i="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)i=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(r)?(r>>>=0,void 0===i&&(i="utf8")):(i=r,r=void 0)}var n=this.length-e;if((void 0===r||n<r)&&(r=n),0<t.length&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");i=i||"utf8";for(var o,s,a,c,h,l,u=!1;;)switch(i){case"hex":return function(t,e,r,i){r=Number(r)||0;var n=t.length-r;(!i||(i=Number(i))>n)&&(i=n),(n=e.length)/2<i&&(i=n/2);for(var o=0;o<i;++o){var s=parseInt(e.substr(2*o,2),16);if(T(s))return o;t[r+o]=s}return o}(this,t,e,r);case"utf8":case"utf-8":return h=e,l=r,L(k(t,(c=this).length-h),c,h,l);case"ascii":return y(this,t,e,r);case"latin1":case"binary":return y(this,t,e,r);case"base64":return o=this,s=e,a=r,L(I(t),o,s,a);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return o=e,s=r,L(function(t,e){for(var r,i,n=[],o=0;o<t.length&&!((e-=2)<0);++o)i=(r=t.charCodeAt(o))>>8,n.push(r%256),n.push(i);return n}(t,(a=this).length-o),a,o,s);default:if(u)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),u=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var m=4096;function v(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(r<t+e)throw new RangeError("Trying to access beyond buffer length")}function w(t,e,r,i,n,o){if(!u.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(n<e||e<o)throw new RangeError('"value" argument is out of bounds');if(r+i>t.length)throw new RangeError("Index out of range")}function b(t,e,r,i){if(r+i>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function x(t,e,r,i,n){return e=+e,r>>>=0,n||b(t,0,r,4),o.write(t,e,r,i,23,4),r+4}function S(t,e,r,i,n){return e=+e,r>>>=0,n||b(t,0,r,8),o.write(t,e,r,i,52,8),r+8}u.prototype.slice=function(t,e){var r=this.length;(t=~~t)<0?(t+=r)<0&&(t=0):r<t&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):r<e&&(e=r),e<t&&(e=t);e=this.subarray(t,e);return e.__proto__=u.prototype,e},u.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||v(t,e,this.length);for(var i=this[t],n=1,o=0;++o<e&&(n*=256);)i+=this[t+o]*n;return i},u.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||v(t,e,this.length);for(var i=this[t+--e],n=1;0<e&&(n*=256);)i+=this[t+--e]*n;return i},u.prototype.readUInt8=function(t,e){return t>>>=0,e||v(t,1,this.length),this[t]},u.prototype.readUInt16LE=function(t,e){return t>>>=0,e||v(t,2,this.length),this[t]|this[t+1]<<8},u.prototype.readUInt16BE=function(t,e){return t>>>=0,e||v(t,2,this.length),this[t]<<8|this[t+1]},u.prototype.readUInt32LE=function(t,e){return t>>>=0,e||v(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},u.prototype.readUInt32BE=function(t,e){return t>>>=0,e||v(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},u.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||v(t,e,this.length);for(var i=this[t],n=1,o=0;++o<e&&(n*=256);)i+=this[t+o]*n;return i>=(n*=128)&&(i-=Math.pow(2,8*e)),i},u.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||v(t,e,this.length);for(var i=e,n=1,o=this[t+--i];0<i&&(n*=256);)o+=this[t+--i]*n;return o>=(n*=128)&&(o-=Math.pow(2,8*e)),o},u.prototype.readInt8=function(t,e){return t>>>=0,e||v(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},u.prototype.readInt16LE=function(t,e){t>>>=0,e||v(t,2,this.length);t=this[t]|this[t+1]<<8;return 32768&t?4294901760|t:t},u.prototype.readInt16BE=function(t,e){t>>>=0,e||v(t,2,this.length);t=this[t+1]|this[t]<<8;return 32768&t?4294901760|t:t},u.prototype.readInt32LE=function(t,e){return t>>>=0,e||v(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},u.prototype.readInt32BE=function(t,e){return t>>>=0,e||v(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},u.prototype.readFloatLE=function(t,e){return t>>>=0,e||v(t,4,this.length),o.read(this,t,!0,23,4)},u.prototype.readFloatBE=function(t,e){return t>>>=0,e||v(t,4,this.length),o.read(this,t,!1,23,4)},u.prototype.readDoubleLE=function(t,e){return t>>>=0,e||v(t,8,this.length),o.read(this,t,!0,52,8)},u.prototype.readDoubleBE=function(t,e){return t>>>=0,e||v(t,8,this.length),o.read(this,t,!1,52,8)},u.prototype.writeUIntLE=function(t,e,r,i){t=+t,e>>>=0,r>>>=0,i||w(this,t,e,r,Math.pow(2,8*r)-1,0);var n=1,o=0;for(this[e]=255&t;++o<r&&(n*=256);)this[e+o]=t/n&255;return e+r},u.prototype.writeUIntBE=function(t,e,r,i){t=+t,e>>>=0,r>>>=0,i||w(this,t,e,r,Math.pow(2,8*r)-1,0);var n=r-1,o=1;for(this[e+n]=255&t;0<=--n&&(o*=256);)this[e+n]=t/o&255;return e+r},u.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||w(this,t,e,1,255,0),this[e]=255&t,e+1},u.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||w(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},u.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||w(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},u.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||w(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},u.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||w(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},u.prototype.writeIntLE=function(t,e,r,i){t=+t,e>>>=0,i||w(this,t,e,r,(i=Math.pow(2,8*r-1))-1,-i);var n=0,o=1,s=0;for(this[e]=255&t;++n<r&&(o*=256);)t<0&&0===s&&0!==this[e+n-1]&&(s=1),this[e+n]=(t/o>>0)-s&255;return e+r},u.prototype.writeIntBE=function(t,e,r,i){t=+t,e>>>=0,i||w(this,t,e,r,(i=Math.pow(2,8*r-1))-1,-i);var n=r-1,o=1,s=0;for(this[e+n]=255&t;0<=--n&&(o*=256);)t<0&&0===s&&0!==this[e+n+1]&&(s=1),this[e+n]=(t/o>>0)-s&255;return e+r},u.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||w(this,t,e,1,127,-128),this[e]=255&(t=t<0?255+t+1:t),e+1},u.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||w(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},u.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||w(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},u.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||w(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},u.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||w(this,t,e,4,2147483647,-2147483648),this[e]=(t=t<0?4294967295+t+1:t)>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},u.prototype.writeFloatLE=function(t,e,r){return x(this,t,e,!0,r)},u.prototype.writeFloatBE=function(t,e,r){return x(this,t,e,!1,r)},u.prototype.writeDoubleLE=function(t,e,r){return S(this,t,e,!0,r)},u.prototype.writeDoubleBE=function(t,e,r){return S(this,t,e,!1,r)},u.prototype.copy=function(t,e,r,i){if(!u.isBuffer(t))throw new TypeError("argument should be a Buffer");if(r=r||0,i||0===i||(i=this.length),e>=t.length&&(e=t.length),(i=0<i&&i<r?r:i)===r)return 0;if(0===t.length||0===this.length)return 0;if((e=e||0)<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length);var n=(i=t.length-e<i-r?t.length-e+r:i)-r;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(e,r,i);else if(this===t&&r<e&&e<i)for(var o=n-1;0<=o;--o)t[o+e]=this[o+r];else Uint8Array.prototype.set.call(t,this.subarray(r,i),e);return n},u.prototype.fill=function(t,e,r,i){if("string"==typeof t){if("string"==typeof e?(i=e,e=0,r=this.length):"string"==typeof r&&(i=r,r=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!u.isEncoding(i))throw new TypeError("Unknown encoding: "+i);var n;1===t.length&&(n=t.charCodeAt(0),("utf8"===i&&n<128||"latin1"===i)&&(t=n))}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var o;if(e>>>=0,r=void 0===r?this.length:r>>>0,"number"==typeof(t=t||0))for(o=e;o<r;++o)this[o]=t;else{var s=u.isBuffer(t)?t:u.from(t,i),a=s.length;if(0===a)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(o=0;o<r-e;++o)this[o+e]=s[o%a]}return this};var _=/[^+/0-9A-Za-z-_]/g;function k(t,e){var r;e=e||1/0;for(var i=t.length,n=null,o=[],s=0;s<i;++s){if(55295<(r=t.charCodeAt(s))&&r<57344){if(!n){if(56319<r){-1<(e-=3)&&o.push(239,191,189);continue}if(s+1===i){-1<(e-=3)&&o.push(239,191,189);continue}n=r;continue}if(r<56320){-1<(e-=3)&&o.push(239,191,189),n=r;continue}r=65536+(n-55296<<10|r-56320)}else n&&-1<(e-=3)&&o.push(239,191,189);if(n=null,r<128){if(--e<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function I(t){return a.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(_,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function L(t,e,r,i){for(var n=0;n<i&&!(n+r>=e.length||n>=t.length);++n)e[n+r]=t[n];return n}function P(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function T(t){return t!=t}}.call(this)}.call(this,C("buffer").Buffer)},{"base64-js":10,buffer:14,ieee754:20}],15:[function(r,n,i){!function(e){!function(){i.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),this.useColors){var i="color: "+this.color;t.splice(1,0,i,"color: inherit");let e=0,r=0;t[0].replace(/%[a-zA-Z%]/g,t=>{"%%"!==t&&"%c"===t&&(r=++e)}),t.splice(r,0,i)}},i.save=function(t){try{t?i.storage.setItem("debug",t):i.storage.removeItem("debug")}catch(t){}},i.load=function(){let t;try{t=i.storage.getItem("debug")}catch(t){}return!t&&void 0!==e&&"env"in e&&(t=e.env.DEBUG),t},i.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},i.storage=function(){try{return localStorage}catch(t){}}(),i.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),i.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],i.log=console.debug||console.log||(()=>{}),n.exports=r("./common")(i);const{formatters:t}=n.exports;t.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}.call(this)}.call(this,r("_process"))},{"./common":16,_process:32}],16:[function(t,e,r){e.exports=function(e){function a(t){let r,e=null;function s(...n){if(s.enabled){const o=s,t=Number(new Date),e=t-(r||t);o.diff=e,o.prev=r,o.curr=t,r=t,n[0]=a.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");let i=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,(t,e)=>{if("%%"===t)return"%";i++;const r=a.formatters[e];if("function"==typeof r){const a=n[i];t=r.call(o,a),n.splice(i,1),i--}return t}),a.formatArgs.call(o,n),(o.log||a.log).apply(o,n)}}return s.namespace=t,s.useColors=a.useColors(),s.color=a.selectColor(t),s.extend=i,s.destroy=a.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:()=>null===e?a.enabled(t):e,set:t=>{e=t}}),"function"==typeof a.init&&a.init(s),s}function i(t,e){const r=a(this.namespace+(void 0===e?":":e)+t);return r.log=this.log,r}function r(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return((a.debug=a).default=a).coerce=function(t){return t instanceof Error?t.stack||t.message:t},a.disable=function(){var t=[...a.names.map(r),...a.skips.map(r).map(t=>"-"+t)].join(",");return a.enable(""),t},a.enable=function(t){let e;a.save(t),a.names=[],a.skips=[];const r=("string"==typeof t?t:"").split(/[\s,]+/),i=r.length;for(e=0;e<i;e++)r[e]&&("-"===(t=r[e].replace(/\*/g,".*?"))[0]?a.skips.push(new RegExp("^"+t.substr(1)+"$")):a.names.push(new RegExp("^"+t+"$")))},a.enabled=function(t){if("*"===t[t.length-1])return!0;let e,r;for(e=0,r=a.skips.length;e<r;e++)if(a.skips[e].test(t))return!1;for(e=0,r=a.names.length;e<r;e++)if(a.names[e].test(t))return!0;return!1},a.humanize=t("ms"),a.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(t=>{a[t]=e[t]}),a.names=[],a.skips=[],a.formatters={},a.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return a.colors[Math.abs(r)%a.colors.length]},a.enable(a.load()),a}},{ms:29}],17:[function(u,d,t){!function(l,r){!function(){function n(t,e){t._corked?t.once("uncork",e):e()}function o(r,i){return function(t){var e;t?(e=r,t="premature close"===t.message?null:t,e._autoDestroy&&e.destroy(t)):i&&!r._ended&&r.end()}}function i(){}var s=u("readable-stream"),a=u("end-of-stream"),t=u("inherits"),e=u("stream-shift"),c=r.from&&r.from!==Uint8Array.from?r.from([0]):new r([0]),h=function(t,e,r){if(!(this instanceof h))return new h(t,e,r);s.Duplex.call(this,r),this._writable=null,this._readable=null,this._readable2=null,this._autoDestroy=!r||!1!==r.autoDestroy,this._forwardDestroy=!r||!1!==r.destroy,this._forwardEnd=!r||!1!==r.end,this._corked=1,this._ondrain=null,this._drained=!1,this._forwarding=!1,this._unwrite=null,this._unread=null,this._ended=!1,this.destroyed=!1,t&&this.setWritable(t),e&&this.setReadable(e)};t(h,s.Duplex),h.obj=function(t,e,r){return(r=r||{}).objectMode=!0,r.highWaterMark=16,new h(t,e,r)},h.prototype.cork=function(){1==++this._corked&&this.emit("cork")},h.prototype.uncork=function(){this._corked&&0==--this._corked&&this.emit("uncork")},h.prototype.setWritable=function(t){var e,r,i;this._unwrite&&this._unwrite(),this.destroyed?t&&t.destroy&&t.destroy():null!==t&&!1!==t?(r=a(t,{writable:!0,readable:!1},o(e=this,this._forwardEnd)),i=function(){var t=e._ondrain;e._ondrain=null,t&&t()},this._unwrite&&l.nextTick(i),this._writable=t,this._writable.on("drain",i),this._unwrite=function(){e._writable.removeListener("drain",i),r()},this.uncork()):this.end()},h.prototype.setReadable=function(t){if(this._unread&&this._unread(),this.destroyed)t&&t.destroy&&t.destroy();else{if(null===t||!1===t)return this.push(null),void this.resume();function e(){i._forward()}function r(){i.push(null)}var i=this,n=a(t,{writable:!1,readable:!0},o(this));this._drained=!0,this._readable=t,this._readable2=t._readableState?t:(t=t,new s.Readable({objectMode:!0,highWaterMark:16}).wrap(t)),this._readable2.on("readable",e),this._readable2.on("end",r),this._unread=function(){i._readable2.removeListener("readable",e),i._readable2.removeListener("end",r),n()},this._forward()}},h.prototype._read=function(){this._drained=!0,this._forward()},h.prototype._forward=function(){if(!this._forwarding&&this._readable2&&this._drained){var t;for(this._forwarding=!0;this._drained&&null!==(t=e(this._readable2));)this.destroyed||(this._drained=this.push(t));this._forwarding=!1}},h.prototype.destroy=function(t,e){if(e=e||i,this.destroyed)return e(null);this.destroyed=!0;var r=this;l.nextTick(function(){r._destroy(t),e(null)})},h.prototype._destroy=function(t){var e;t&&(e=this._ondrain,this._ondrain=null,e?e(t):this.emit("error",t)),this._forwardDestroy&&(this._readable&&this._readable.destroy&&this._readable.destroy(),this._writable&&this._writable.destroy&&this._writable.destroy()),this.emit("close")},h.prototype._write=function(t,e,r){if(!this.destroyed)return this._corked?n(this,this._write.bind(this,t,e,r)):t===c?this._finish(r):this._writable?void(!1===this._writable.write(t)?this._ondrain=r:this.destroyed||r()):r()},h.prototype._finish=function(r){var i=this;this.emit("preend"),n(this,function(){var t=i._forwardEnd&&i._writable,e=function(){!1===i._writableState.prefinished&&(i._writableState.prefinished=!0),i.emit("prefinish"),n(i,r)};!t||t._writableState&&t._writableState.finished?e():t._writableState?t.end(e):(t.end(),e())})},h.prototype.end=function(t,e,r){return"function"==typeof t?this.end(null,null,t):"function"==typeof e?this.end(t,null,e):(this._ended=!0,t&&this.write(t),this._writableState.ending||this.write(c),s.Writable.prototype.end.call(this,r))},d.exports=h}.call(this)}.call(this,u("_process"),u("buffer").Buffer)},{_process:32,buffer:14,"end-of-stream":18,inherits:21,"readable-stream":51,"stream-shift":54}],18:[function(t,e,r){!function(b){!function(){function m(){}var v=t("once"),w=function(e,t,r){if("function"==typeof t)return w(e,null,t);t=t||{},r=v(r||m);function i(){e.writable||y()}function n(){d=!1,p||r.call(e)}function o(t){r.call(e,t?new Error("exited with error code: "+t):null)}function s(t){r.call(e,t)}function a(){b.nextTick(g)}function c(){e.req.on("finish",y)}var h,l=e._writableState,u=e._readableState,d=t.readable||!1!==t.readable&&e.readable,p=t.writable||!1!==t.writable&&e.writable,f=!1,y=function(){p=!1,d||r.call(e)},g=function(){if(!f)return(!d||u&&u.ended&&!u.destroyed)&&(!p||l&&l.ended&&!l.destroyed)?void 0:r.call(e,new Error("premature close"))};return e.setHeader&&"function"==typeof e.abort?(e.on("complete",y),e.on("abort",a),e.req?c():e.on("request",c)):p&&!l&&(e.on("end",i),e.on("close",i)),(h=e).stdio&&Array.isArray(h.stdio)&&3===h.stdio.length&&e.on("exit",o),e.on("end",n),e.on("finish",y),!1!==t.error&&e.on("error",s),e.on("close",a),function(){f=!0,e.removeListener("complete",y),e.removeListener("abort",a),e.removeListener("request",c),e.req&&e.req.removeListener("finish",y),e.removeListener("end",i),e.removeListener("close",i),e.removeListener("finish",y),e.removeListener("exit",o),e.removeListener("end",n),e.removeListener("error",s),e.removeListener("close",a)}};e.exports=w}.call(this)}.call(this,t("_process"))},{_process:32,once:30}],19:[function(t,e,r){var a=Object.create||function(t){function e(){}return e.prototype=t,new e},s=Object.keys||function(t){var e,r=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&r.push(e);return e},i=Function.prototype.bind||function(t){var e=this;return function(){return e.apply(t,arguments)}};function n(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=a(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}((e.exports=n).EventEmitter=n).prototype._events=void 0,n.prototype._maxListeners=void 0;var o,c=10;try{var h={};Object.defineProperty&&Object.defineProperty(h,"x",{value:0}),o=0===h.x}catch(t){o=!1}function l(t){return void 0===t._maxListeners?n.defaultMaxListeners:t._maxListeners}function u(t,e,r,i){var n,o,s;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');return(n=t._events)?(n.newListener&&(t.emit("newListener",e,r.listener||r),n=t._events),o=n[e]):(n=t._events=a(null),t._eventsCount=0),o?("function"==typeof o?o=n[e]=i?[r,o]:[o,r]:i?o.unshift(r):o.push(r),!o.warned&&(s=l(t))&&0<s&&o.length>s&&(o.warned=!0,(s=new Error("Possible EventEmitter memory leak detected. "+o.length+' "'+String(e)+'" listeners added. Use emitter.setMaxListeners() to increase limit.')).name="MaxListenersExceededWarning",s.emitter=t,s.type=e,s.count=o.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",s.name,s.message))):(o=n[e]=r,++t._eventsCount),t}function d(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var t=new Array(arguments.length),e=0;e<t.length;++e)t[e]=arguments[e];this.listener.apply(this.target,t)}}function p(t,e,r){t={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},e=i.call(d,t);return e.listener=r,t.wrapFn=e}function f(t,e,r){t=t._events;if(!t)return[];e=t[e];return e?"function"==typeof e?r?[e.listener||e]:[e]:r?function(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(e):g(e,e.length):[]}function y(t){var e=this._events;if(e){t=e[t];if("function"==typeof t)return 1;if(t)return t.length}return 0}function g(t,e){for(var r=new Array(e),i=0;i<e;++i)r[i]=t[i];return r}o?Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(t){if("number"!=typeof t||t<0||t!=t)throw new TypeError('"defaultMaxListeners" must be a positive number');c=t}}):n.defaultMaxListeners=c,n.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},n.prototype.getMaxListeners=function(){return l(this)},n.prototype.emit=function(t){var e,r,i,n,o,s,a="error"===t;if(s=this._events)a=a&&null==s.error;else if(!a)return!1;if(a){if((e=1<arguments.length?arguments[1]:e)instanceof Error)throw e;a=new Error('Unhandled "error" event. ('+e+")");throw a.context=e,a}if(!(r=s[t]))return!1;var c="function"==typeof r;switch(i=arguments.length){case 1:!function(t,e){if(c)t.call(e);else for(var r=t.length,i=g(t,r),n=0;n<r;++n)i[n].call(e)}(r,this);break;case 2:!function(t,e,r,i){if(e)t.call(r,i);else for(var n=t.length,o=g(t,n),s=0;s<n;++s)o[s].call(r,i)}(r,c,this,arguments[1]);break;case 3:!function(t,e,r,i,n){if(e)t.call(r,i,n);else for(var o=t.length,s=g(t,o),a=0;a<o;++a)s[a].call(r,i,n)}(r,c,this,arguments[1],arguments[2]);break;case 4:!function(t,e,r,i,n,o){if(e)t.call(r,i,n,o);else for(var s=t.length,a=g(t,s),c=0;c<s;++c)a[c].call(r,i,n,o)}(r,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(n=new Array(i-1),o=1;o<i;o++)n[o-1]=arguments[o];!function(t,e,r){if(c)t.apply(e,r);else for(var i=t.length,n=g(t,i),o=0;o<i;++o)n[o].apply(e,r)}(r,this,n)}return!0},n.prototype.on=n.prototype.addListener=function(t,e){return u(this,t,e,!1)},n.prototype.prependListener=function(t,e){return u(this,t,e,!0)},n.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,p(this,t,e)),this},n.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,p(this,t,e)),this},n.prototype.removeListener=function(t,e){var r,i,n,o,s;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(r=i[t]))return this;if(r===e||r.listener===e)0==--this._eventsCount?this._events=a(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(n=-1,o=r.length-1;0<=o;o--)if(r[o]===e||r[o].listener===e){s=r[o].listener,n=o;break}if(n<0)return this;0===n?r.shift():function(t){for(var e=n,r=e+1,i=t.length;r<i;e+=1,r+=1)t[e]=t[r];t.pop()}(r),1===r.length&&(i[t]=r[0]),i.removeListener&&this.emit("removeListener",t,s||e)}return this},n.prototype.removeAllListeners=function(t){var e,r;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=a(null),this._eventsCount=0):r[t]&&(0==--this._eventsCount?this._events=a(null):delete r[t]),this;if(0===arguments.length){for(var i,n=s(r),o=0;o<n.length;++o)"removeListener"!==(i=n[o])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=a(null),this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(e)for(o=e.length-1;0<=o;o--)this.removeListener(t,e[o]);return this},n.prototype.listeners=function(t){return f(this,t,!0)},n.prototype.rawListeners=function(t){return f(this,t,!1)},n.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):y.call(t,e)},n.prototype.listenerCount=y,n.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]}},{}],20:[function(t,e,r){r.read=function(t,e,r,i,n){var o,s,a=8*n-i-1,c=(1<<a)-1,h=c>>1,l=-7,u=r?n-1:0,d=r?-1:1,r=t[e+u];for(u+=d,o=r&(1<<-l)-1,r>>=-l,l+=a;0<l;o=256*o+t[e+u],u+=d,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=i;0<l;s=256*s+t[e+u],u+=d,l-=8);if(0===o)o=1-h;else{if(o===c)return s?NaN:1/0*(r?-1:1);s+=Math.pow(2,i),o-=h}return(r?-1:1)*s*Math.pow(2,o-i)},r.write=function(t,e,r,i,n,o){var s,a,c=8*o-n-1,h=(1<<c)-1,l=h>>1,u=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:o-1,p=i?1:-1,o=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=h):(s=Math.floor(Math.log(e)/Math.LN2),e*(i=Math.pow(2,-s))<1&&(s--,i*=2),2<=(e+=1<=s+l?u/i:u*Math.pow(2,1-l))*i&&(s++,i/=2),h<=s+l?(a=0,s=h):1<=s+l?(a=(e*i-1)*Math.pow(2,n),s+=l):(a=e*Math.pow(2,l-1)*Math.pow(2,n),s=0));8<=n;t[r+d]=255&a,d+=p,a/=256,n-=8);for(s=s<<n|a,c+=n;0<c;t[r+d]=255&s,d+=p,s/=256,c-=8);t[r+d-p]|=128*o}},{}],21:[function(t,e,r){"function"==typeof Object.create?e.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(t,e){var r;e&&(t.super_=e,(r=function(){}).prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t)}},{}],22:[function(t,e,r){!function(s){!function(){const o=e.exports;o.types={0:"reserved",1:"connect",2:"connack",3:"publish",4:"puback",5:"pubrec",6:"pubrel",7:"pubcomp",8:"subscribe",9:"suback",10:"unsubscribe",11:"unsuback",12:"pingreq",13:"pingresp",14:"disconnect",15:"auth"},o.codes={};for(const s in o.types){const e=o.types[s];o.codes[e]=s}o.CMD_SHIFT=4,o.CMD_MASK=240,o.DUP_MASK=8,o.QOS_MASK=3,o.QOS_SHIFT=1,o.RETAIN_MASK=1,o.VARBYTEINT_MASK=127,o.VARBYTEINT_FIN_MASK=128,o.VARBYTEINT_MAX=268435455,o.SESSIONPRESENT_MASK=1,o.SESSIONPRESENT_HEADER=s.from([o.SESSIONPRESENT_MASK]),o.CONNACK_HEADER=s.from([o.codes.connack<<o.CMD_SHIFT]),o.USERNAME_MASK=128,o.PASSWORD_MASK=64,o.WILL_RETAIN_MASK=32,o.WILL_QOS_MASK=24,o.WILL_QOS_SHIFT=3,o.WILL_FLAG_MASK=4,o.CLEAN_SESSION_MASK=2,o.CONNECT_HEADER=s.from([o.codes.connect<<o.CMD_SHIFT]),o.properties={sessionExpiryInterval:17,willDelayInterval:24,receiveMaximum:33,maximumPacketSize:39,topicAliasMaximum:34,requestResponseInformation:25,requestProblemInformation:23,userProperties:38,authenticationMethod:21,authenticationData:22,payloadFormatIndicator:1,messageExpiryInterval:2,contentType:3,responseTopic:8,correlationData:9,maximumQoS:36,retainAvailable:37,assignedClientIdentifier:18,reasonString:31,wildcardSubscriptionAvailable:40,subscriptionIdentifiersAvailable:41,sharedSubscriptionAvailable:42,serverKeepAlive:19,responseInformation:26,serverReference:28,topicAlias:35,subscriptionIdentifier:11},o.propertiesCodes={};for(const s in o.properties){const e=o.properties[s];o.propertiesCodes[e]=s}function t(n){return[0,1,2].map(i=>[0,1].map(r=>[0,1].map(t=>{const e=s.alloc(1);return e.writeUInt8(o.codes[n]<<o.CMD_SHIFT|(r?o.DUP_MASK:0)|i<<o.QOS_SHIFT|t,0,!0),e})))}o.propertiesTypes={sessionExpiryInterval:"int32",willDelayInterval:"int32",receiveMaximum:"int16",maximumPacketSize:"int32",topicAliasMaximum:"int16",requestResponseInformation:"byte",requestProblemInformation:"byte",userProperties:"pair",authenticationMethod:"string",authenticationData:"binary",payloadFormatIndicator:"byte",messageExpiryInterval:"int32",contentType:"string",responseTopic:"string",correlationData:"binary",maximumQoS:"int8",retainAvailable:"byte",assignedClientIdentifier:"string",reasonString:"string",wildcardSubscriptionAvailable:"byte",subscriptionIdentifiersAvailable:"byte",sharedSubscriptionAvailable:"byte",serverKeepAlive:"int16",responseInformation:"string",serverReference:"string",topicAlias:"int16",subscriptionIdentifier:"var"},o.PUBLISH_HEADER=t("publish"),o.SUBSCRIBE_HEADER=t("subscribe"),o.SUBSCRIBE_OPTIONS_QOS_MASK=3,o.SUBSCRIBE_OPTIONS_NL_MASK=1,o.SUBSCRIBE_OPTIONS_NL_SHIFT=2,o.SUBSCRIBE_OPTIONS_RAP_MASK=1,o.SUBSCRIBE_OPTIONS_RAP_SHIFT=3,o.SUBSCRIBE_OPTIONS_RH_MASK=3,o.SUBSCRIBE_OPTIONS_RH_SHIFT=4,o.SUBSCRIBE_OPTIONS_RH=[0,16,32],o.SUBSCRIBE_OPTIONS_NL=4,o.SUBSCRIBE_OPTIONS_RAP=8,o.SUBSCRIBE_OPTIONS_QOS=[0,1,2],o.UNSUBSCRIBE_HEADER=t("unsubscribe"),o.ACKS={unsuback:t("unsuback"),puback:t("puback"),pubcomp:t("pubcomp"),pubrel:t("pubrel"),pubrec:t("pubrec")},o.SUBACK_HEADER=s.from([o.codes.suback<<o.CMD_SHIFT]),o.VERSION3=s.from([3]),o.VERSION4=s.from([4]),o.VERSION5=s.from([5]),o.VERSION131=s.from([131]),o.VERSION132=s.from([132]),o.QOS=[0,1,2].map(t=>s.from([t])),o.EMPTY={pingreq:s.from([o.codes.pingreq<<4,0]),pingresp:s.from([o.codes.pingresp<<4,0]),disconnect:s.from([o.codes.disconnect<<4,0])}}.call(this)}.call(this,t("buffer").Buffer)},{buffer:14}],23:[function(e,r,t){!function(s){!function(){const i=e("./writeToStream"),t=e("events");class n extends t{constructor(){super(),this._array=new Array(20),this._i=0}write(t){return this._array[this._i++]=t,!0}concat(){let t=0;const e=new Array(this._array.length),r=this._array;let i,n=0;for(i=0;i<r.length&&void 0!==r[i];i++)"string"!=typeof r[i]?e[i]=r[i].length:e[i]=s.byteLength(r[i]),t+=e[i];const o=s.allocUnsafe(t);for(i=0;i<r.length&&void 0!==r[i];i++)"string"!=typeof r[i]?r[i].copy(o,n):o.write(r[i],n),n+=e[i];return o}}r.exports=function(t,e){const r=new n;return i(t,r,e),r.concat()}}.call(this)}.call(this,e("buffer").Buffer)},{"./writeToStream":28,buffer:14,events:19}],24:[function(t,e,r){r.parser=t("./parser").parser,r.generate=t("./generate"),r.writeToStream=t("./writeToStream")},{"./generate":23,"./parser":27,"./writeToStream":28}],25:[function(t,i,e){!function(o){!function(){const e={},n=o.isBuffer(o.from([1,2]).subarray(0,1));function r(t){const e=o.allocUnsafe(2);return e.writeUInt8(t>>8,0),e.writeUInt8(255&t,1),e}i.exports={cache:e,generateCache:function(){for(let t=0;t<65536;t++)e[t]=r(t)},generateNumber:r,genBufVariableByteInt:function(t){let e=0,r=0;const i=o.allocUnsafe(4);for(;e=t%128|0,0<(t=t/128|0)&&(e|=128),i.writeUInt8(e,r++),0<t&&r<4;);return 0<t&&(r=0),n?i.subarray(0,r):i.slice(0,r)},generate4ByteBuffer:function(t){const e=o.allocUnsafe(4);return e.writeUInt32BE(t,0),e}}}.call(this)}.call(this,t("buffer").Buffer)},{buffer:14}],26:[function(t,e,r){e.exports=class{constructor(){this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}}},{}],27:[function(t,e,r){const i=t("bl"),n=t("events"),o=t("./packet"),c=t("./constants"),h=t("debug")("mqtt-packet:parser");class s extends n{constructor(){super(),this.parser=this.constructor.parser}static parser(t){return this instanceof s?(this.settings=t||{},this._states=["_parseHeader","_parseLength","_parsePayload","_newPacket"],this._resetState(),this):(new s).parser(t)}_resetState(){h("_resetState: resetting packet, error, _list, and _stateCounter"),this.packet=new o,this.error=null,this._list=i(),this._stateCounter=0}parse(t){for(this.error&&this._resetState(),this._list.append(t),h("parse: current state: %s",this._states[this._stateCounter]);(-1!==this.packet.length||0<this._list.length)&&this[this._states[this._stateCounter]]()&&!this.error;)this._stateCounter++,h("parse: state complete. _stateCounter is now: %d",this._stateCounter),h("parse: packet.length: %d, buffer list length: %d",this.packet.length,this._list.length),this._stateCounter>=this._states.length&&(this._stateCounter=0);return h("parse: exited while loop. packet: %d, buffer list length: %d",this.packet.length,this._list.length),this._list.length}_parseHeader(){var t=this._list.readUInt8(0);return this.packet.cmd=c.types[t>>c.CMD_SHIFT],this.packet.retain=0!=(t&c.RETAIN_MASK),this.packet.qos=t>>c.QOS_SHIFT&c.QOS_MASK,this.packet.dup=0!=(t&c.DUP_MASK),h("_parseHeader: packet: %o",this.packet),this._list.consume(1),!0}_parseLength(){var t=this._parseVarByteNum(!0);return t&&(this.packet.length=t.value,this._list.consume(t.bytes)),h("_parseLength %d",t.value),!!t}_parsePayload(){h("_parsePayload: payload %O",this._list);let t=!1;if(0===this.packet.length||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case"connect":this._parseConnect();break;case"connack":this._parseConnack();break;case"publish":this._parsePublish();break;case"puback":case"pubrec":case"pubrel":case"pubcomp":this._parseConfirmation();break;case"subscribe":this._parseSubscribe();break;case"suback":this._parseSuback();break;case"unsubscribe":this._parseUnsubscribe();break;case"unsuback":this._parseUnsuback();break;case"pingreq":case"pingresp":break;case"disconnect":this._parseDisconnect();break;case"auth":this._parseAuth();break;default:this._emitError(new Error("Not supported"))}t=!0}return h("_parsePayload complete result: %s",t),t}_parseConnect(){let t,e,r,i;h("_parseConnect");const n={},o=this.packet,s=this._parseString();if(null===s)return this._emitError(new Error("Cannot parse protocolId"));if("MQTT"!==s&&"MQIsdp"!==s)return this._emitError(new Error("Invalid protocolId"));if(o.protocolId=s,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(o.protocolVersion=this._list.readUInt8(this._pos),128<=o.protocolVersion&&(o.bridgeMode=!0,o.protocolVersion=o.protocolVersion-128),3!==o.protocolVersion&&4!==o.protocolVersion&&5!==o.protocolVersion)return this._emitError(new Error("Invalid protocol version"));if(this._pos++,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(n.username=this._list.readUInt8(this._pos)&c.USERNAME_MASK,n.password=this._list.readUInt8(this._pos)&c.PASSWORD_MASK,n.will=this._list.readUInt8(this._pos)&c.WILL_FLAG_MASK,n.will&&(o.will={},o.will.retain=0!=(this._list.readUInt8(this._pos)&c.WILL_RETAIN_MASK),o.will.qos=(this._list.readUInt8(this._pos)&c.WILL_QOS_MASK)>>c.WILL_QOS_SHIFT),o.clean=0!=(this._list.readUInt8(this._pos)&c.CLEAN_SESSION_MASK),this._pos++,o.keepalive=this._parseNum(),-1===o.keepalive)return this._emitError(new Error("Packet too short"));if(5===o.protocolVersion){const t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(o.properties=t)}var a=this._parseString();if(null===a)return this._emitError(new Error("Packet too short"));if(o.clientId=a,h("_parseConnect: packet.clientId: %s",o.clientId),n.will){if(5===o.protocolVersion){const t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(o.will.properties=t)}if(null===(t=this._parseString()))return this._emitError(new Error("Cannot parse will topic"));if(o.will.topic=t,h("_parseConnect: packet.will.topic: %s",o.will.topic),null===(e=this._parseBuffer()))return this._emitError(new Error("Cannot parse will payload"));o.will.payload=e,h("_parseConnect: packet.will.paylaod: %s",o.will.payload)}if(n.username){if(null===(i=this._parseString()))return this._emitError(new Error("Cannot parse username"));o.username=i,h("_parseConnect: packet.username: %s",o.username)}if(n.password){if(null===(r=this._parseBuffer()))return this._emitError(new Error("Cannot parse password"));o.password=r}return this.settings=o,h("_parseConnect: complete"),o}_parseConnack(){h("_parseConnack");const t=this.packet;if(this._list.length<1)return null;if(t.sessionPresent=!!(this._list.readUInt8(this._pos++)&c.SESSIONPRESENT_MASK),5===this.settings.protocolVersion)2<=this._list.length?t.reasonCode=this._list.readUInt8(this._pos++):t.reasonCode=0;else{if(this._list.length<2)return null;t.returnCode=this._list.readUInt8(this._pos++)}if(-1===t.returnCode||-1===t.reasonCode)return this._emitError(new Error("Cannot parse return code"));var e;5===this.settings.protocolVersion&&(e=this._parseProperties(),Object.getOwnPropertyNames(e).length&&(t.properties=e)),h("_parseConnack: complete")}_parsePublish(){h("_parsePublish");const t=this.packet;if(t.topic=this._parseString(),null===t.topic)return this._emitError(new Error("Cannot parse topic"));var e;0<t.qos&&!this._parseMessageId()||(5===this.settings.protocolVersion&&(e=this._parseProperties(),Object.getOwnPropertyNames(e).length&&(t.properties=e)),t.payload=this._list.slice(this._pos,t.length),h("_parsePublish: payload from buffer list: %o",t.payload))}_parseSubscribe(){h("_parseSubscribe");const t=this.packet;let e,r,i,n,o,s,a;if(1!==t.qos)return this._emitError(new Error("Wrong subscribe header"));if(t.subscriptions=[],this._parseMessageId()){if(5===this.settings.protocolVersion){const e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(t.properties=e)}for(;this._pos<t.length;){if(null===(e=this._parseString()))return this._emitError(new Error("Cannot parse topic"));if(this._pos>=t.length)return this._emitError(new Error("Malformed Subscribe Payload"));i=(r=this._parseByte())&c.SUBSCRIBE_OPTIONS_QOS_MASK,s=0!=(r>>c.SUBSCRIBE_OPTIONS_NL_SHIFT&c.SUBSCRIBE_OPTIONS_NL_MASK),o=0!=(r>>c.SUBSCRIBE_OPTIONS_RAP_SHIFT&c.SUBSCRIBE_OPTIONS_RAP_MASK),n=r>>c.SUBSCRIBE_OPTIONS_RH_SHIFT&c.SUBSCRIBE_OPTIONS_RH_MASK,a={topic:e,qos:i},5===this.settings.protocolVersion?(a.nl=s,a.rap=o,a.rh=n):this.settings.bridgeMode&&(a.rh=0,a.rap=!0,a.nl=!0),h("_parseSubscribe: push subscription `%s` to subscription",a),t.subscriptions.push(a)}}}_parseSuback(){h("_parseSuback");const t=this.packet;var e;if(this.packet.granted=[],this._parseMessageId())for(5===this.settings.protocolVersion&&(e=this._parseProperties(),Object.getOwnPropertyNames(e).length&&(t.properties=e));this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}_parseUnsubscribe(){h("_parseUnsubscribe");const t=this.packet;var e;if(t.unsubscriptions=[],this._parseMessageId())for(5===this.settings.protocolVersion&&(e=this._parseProperties(),Object.getOwnPropertyNames(e).length&&(t.properties=e));this._pos<t.length;){var r=this._parseString();if(null===r)return this._emitError(new Error("Cannot parse topic"));h("_parseUnsubscribe: push topic `%s` to unsubscriptions",r),t.unsubscriptions.push(r)}}_parseUnsuback(){h("_parseUnsuback");const t=this.packet;if(!this._parseMessageId())return this._emitError(new Error("Cannot parse messageId"));if(5===this.settings.protocolVersion){var e=this._parseProperties();for(Object.getOwnPropertyNames(e).length&&(t.properties=e),t.granted=[];this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}}_parseConfirmation(){h("_parseConfirmation: packet.cmd: `%s`",this.packet.cmd);const t=this.packet;var e;return this._parseMessageId(),5===this.settings.protocolVersion&&(2<t.length?(t.reasonCode=this._parseByte(),h("_parseConfirmation: packet.reasonCode `%d`",t.reasonCode)):t.reasonCode=0,3<t.length)&&(e=this._parseProperties(),Object.getOwnPropertyNames(e).length&&(t.properties=e)),!0}_parseDisconnect(){const t=this.packet;var e;return h("_parseDisconnect"),5===this.settings.protocolVersion&&(0<this._list.length?t.reasonCode=this._parseByte():t.reasonCode=0,e=this._parseProperties(),Object.getOwnPropertyNames(e).length&&(t.properties=e)),h("_parseDisconnect result: true"),!0}_parseAuth(){h("_parseAuth");const t=this.packet;if(5!==this.settings.protocolVersion)return this._emitError(new Error("Not supported auth packet for this version MQTT"));t.reasonCode=this._parseByte();var e=this._parseProperties();return Object.getOwnPropertyNames(e).length&&(t.properties=e),h("_parseAuth: result: true"),!0}_parseMessageId(){const t=this.packet;return t.messageId=this._parseNum(),null===t.messageId?(this._emitError(new Error("Cannot parse messageId")),!1):(h("_parseMessageId: packet.messageId %d",t.messageId),!0)}_parseString(t){var e=this._parseNum(),r=e+this._pos;if(-1===e||r>this._list.length||r>this.packet.length)return null;r=this._list.toString("utf8",this._pos,r);return this._pos+=e,h("_parseString: result: %s",r),r}_parseStringPair(){return h("_parseStringPair"),{name:this._parseString(),value:this._parseString()}}_parseBuffer(){var t=this._parseNum(),e=t+this._pos;if(-1===t||e>this._list.length||e>this.packet.length)return null;e=this._list.slice(this._pos,e);return this._pos+=t,h("_parseBuffer: result: %o",e),e}_parseNum(){if(this._list.length-this._pos<2)return-1;var t=this._list.readUInt16BE(this._pos);return this._pos+=2,h("_parseNum: result: %s",t),t}_parse4ByteNum(){if(this._list.length-this._pos<4)return-1;var t=this._list.readUInt32BE(this._pos);return this._pos+=4,h("_parse4ByteNum: result: %s",t),t}_parseVarByteNum(t){h("_parseVarByteNum");let e,r=0,i=1,n=0,o=!1;for(var s=this._pos||0;r<4&&s+r<this._list.length;){if(n+=i*((e=this._list.readUInt8(s+r++))&c.VARBYTEINT_MASK),i*=128,0==(e&c.VARBYTEINT_FIN_MASK)){o=!0;break}if(this._list.length<=r)break}return!o&&4===r&&this._list.length>=r&&this._emitError(new Error("Invalid variable byte integer")),s&&(this._pos+=r),h("_parseVarByteNum: result: %o",o=!!o&&(t?{bytes:r,value:n}:n)),o}_parseByte(){let t;return this._pos<this._list.length&&(t=this._list.readUInt8(this._pos),this._pos++),h("_parseByte: result: %o",t),t}_parseByType(t){switch(h("_parseByType: type: %s",t),t){case"byte":return 0!==this._parseByte();case"int8":return this._parseByte();case"int16":return this._parseNum();case"int32":return this._parse4ByteNum();case"var":return this._parseVarByteNum();case"string":return this._parseString();case"pair":return this._parseStringPair();case"binary":return this._parseBuffer()}}_parseProperties(){h("_parseProperties");const t=this._parseVarByteNum(),e=this._pos+t,r={};for(;this._pos<e;){const t=this._parseByte();if(!t)return this._emitError(new Error("Cannot parse property code type")),!1;const e=c.propertiesCodes[t];if(!e)return this._emitError(new Error("Unknown property")),!1;if("userProperties"!==e)r[e]?(Array.isArray(r[e])||(r[e]=[r[e]]),r[e].push(this._parseByType(c.propertiesTypes[e]))):r[e]=this._parseByType(c.propertiesTypes[e]);else{r[e]||(r[e]=Object.create(null));const t=this._parseByType(c.propertiesTypes[e]);var i;r[e][t.name]?(Array.isArray(r[e][t.name])||(i=r[e][t.name],r[e][t.name]=[i]),r[e][t.name].push(t.value)):r[e][t.name]=t.value}}return r}_newPacket(){return h("_newPacket"),this.packet&&(this._list.consume(this.packet.length),h("_newPacket: parser emit packet: packet.cmd: %s, packet.payload: %s, packet.length: %d",this.packet.cmd,this.packet.payload,this.packet.length),this.emit("packet",this.packet)),h("_newPacket: new packet"),this.packet=new o,!(this._pos=0)}_emitError(t){h("_emitError"),this.error=t,this.emit("error",t)}}e.exports=s},{"./constants":22,"./packet":26,bl:12,debug:15,events:19}],28:[function(C,R,t){!function(T){!function(){const g=C("./constants"),u=T.allocUnsafe(0),a=T.from([0]),t=C("./numbers"),r=C("process-nextick-args").nextTick,d=C("debug")("mqtt-packet:writeToStream"),i=t.cache,n=t.generateNumber,o=t.generateCache,c=t.genBufVariableByteInt,s=t.generate4ByteBuffer;let m=y,l=!0;function e(y,t,h){switch(d("generate called"),t.cork&&(t.cork(),r(p,t)),l&&(l=!1,o()),d("generate: packet.cmd: %s",y.cmd),y.cmd){case"connect":return function(t){var e=y||{},r=e.protocolId||"MQTT";let i=e.protocolVersion||4;var n=e.will;let o=e.clean;var s=e.keepalive||0,a=e.clientId||"",c=e.username,h=e.password,l=e.properties;void 0===o&&(o=!0);let u=0;if(!r||"string"!=typeof r&&!T.isBuffer(r))return t.emit("error",new Error("Invalid protocolId")),!1;if(u+=r.length+2,3!==i&&4!==i&&5!==i)return t.emit("error",new Error("Invalid protocol version")),!1;if(u+=1,("string"==typeof a||T.isBuffer(a))&&(a||4<=i)&&(a||o))u+=T.byteLength(a)+2;else{if(i<4)return t.emit("error",new Error("clientId must be supplied before 3.1.1")),!1;if(0==+o)return t.emit("error",new Error("clientId must be given if cleanSession set to 0")),!1}if("number"!=typeof s||s<0||65535<s||s%1!=0)return t.emit("error",new Error("Invalid keepalive")),!1;if(u+=2,u+=1,5===i){var d=S(t,l);if(!d)return!1;u+=d.length}if(n){if("object"!=typeof n)return t.emit("error",new Error("Invalid will")),!1;if(!n.topic||"string"!=typeof n.topic)return t.emit("error",new Error("Invalid will topic")),!1;if(u+=T.byteLength(n.topic)+2,u+=2,n.payload){if(!(0<=n.payload.length))return t.emit("error",new Error("Invalid will payload")),!1;"string"==typeof n.payload?u+=T.byteLength(n.payload):u+=n.payload.length}var p={};if(5===i){if(!(p=S(t,n.properties)))return!1;u+=p.length}}let f=!1;if(null!=c){if(!P(c))return t.emit("error",new Error("Invalid username")),!1;f=!0,u+=T.byteLength(c)+2}if(null!=h){if(!f)return t.emit("error",new Error("Username is required to use password")),!1;if(!P(h))return t.emit("error",new Error("Invalid password")),!1;u+=L(h)+2}t.write(g.CONNECT_HEADER),v(t,u),x(t,r),e.bridgeMode&&(i+=128),t.write(131===i?g.VERSION131:132===i?g.VERSION132:4===i?g.VERSION4:5===i?g.VERSION5:g.VERSION3);e=0;return e|=null!=c?g.USERNAME_MASK:0,e|=null!=h?g.PASSWORD_MASK:0,e|=n&&n.retain?g.WILL_RETAIN_MASK:0,e|=n&&n.qos?n.qos<<g.WILL_QOS_SHIFT:0,e|=n?g.WILL_FLAG_MASK:0,e|=o?g.CLEAN_SESSION_MASK:0,t.write(T.from([e])),m(t,s),5===i&&d.write(),x(t,a),n&&(5===i&&p.write(),w(t,n.topic),x(t,n.payload)),null!=c&&x(t,c),null!=h&&x(t,h),!0}(t);case"connack":return function(t){var e=h?h.protocolVersion:4,r=y||{},i=5===e?r.reasonCode:r.returnCode,n=r.properties;let o=2;if("number"!=typeof i)return t.emit("error",new Error("Invalid return code")),!1;let s=null;if(5===e){if(!(s=S(t,n)))return!1;o+=s.length}return t.write(g.CONNACK_HEADER),v(t,o),t.write(r.sessionPresent?g.SESSIONPRESENT_HEADER:a),t.write(T.from([i])),null!=s&&s.write(),!0}(t);case"publish":return function(t,e,r){d("publish: packet: %o",t);var i=r?r.protocolVersion:4,n=t||{},o=n.qos||0,s=n.retain?g.RETAIN_MASK:0,a=n.topic,c=n.payload||u,r=n.messageId,t=n.properties;let h=0;if("string"==typeof a)h+=T.byteLength(a)+2;else{if(!T.isBuffer(a))return e.emit("error",new Error("Invalid topic")),!1;h+=a.length+2}if(T.isBuffer(c)?h+=c.length:h+=T.byteLength(c),o&&"number"!=typeof r)return e.emit("error",new Error("Invalid messageId")),!1;o&&(h+=2);let l=null;if(5===i){if(!(l=S(e,t)))return!1;h+=l.length}return e.write(g.PUBLISH_HEADER[o][n.dup?1:0][s?1:0]),v(e,h),m(e,L(a)),e.write(a),0<o&&m(e,r),null!=l&&l.write(),d("publish: payload: %o",c),e.write(c)}(y,t,h);case"puback":case"pubrec":case"pubrel":case"pubcomp":return function(t,e){var r=e?e.protocolVersion:4,i=y||{},n=i.cmd||"puback",o=i.messageId,s=i.dup&&"pubrel"===n?g.DUP_MASK:0;let a=0;var c=i.reasonCode,i=i.properties;let h=5===r?3:2;if("pubrel"===n&&(a=1),"number"!=typeof o)return t.emit("error",new Error("Invalid messageId")),!1;let l=null;if(5===r&&"object"==typeof i){if(!(l=_(t,i,e,h)))return!1;h+=l.length}return t.write(g.ACKS[n][a][s][0]),v(t,h),m(t,o),5===r&&t.write(T.from([c])),null!==l&&l.write(),!0}(t,h);case"subscribe":return function(e,r,i){d("subscribe: packet: ");const n=i?i.protocolVersion:4,o=e||{},s=o.dup?g.DUP_MASK:0,a=o.messageId,c=o.subscriptions,t=o.properties;let h=0;if("number"!=typeof a)return r.emit("error",new Error("Invalid messageId")),!1;h+=2;let l=null;if(5===n){if(!(l=S(r,t)))return!1;h+=l.length}if("object"!=typeof c||!c.length)return r.emit("error",new Error("Invalid subscriptions")),!1;for(let t=0;t<c.length;t+=1){const g=c[t].topic,i=c[t].qos;if("string"!=typeof g)return r.emit("error",new Error("Invalid subscriptions - invalid topic")),!1;if("number"!=typeof i)return r.emit("error",new Error("Invalid subscriptions - invalid qos")),!1;if(5===n){const T=c[t].nl||!1;if("boolean"!=typeof T)return r.emit("error",new Error("Invalid subscriptions - invalid No Local")),!1;const g=c[t].rap||!1;if("boolean"!=typeof g)return r.emit("error",new Error("Invalid subscriptions - invalid Retain as Published")),!1;const i=c[t].rh||0;if("number"!=typeof i||2<i)return r.emit("error",new Error("Invalid subscriptions - invalid Retain Handling")),!1}h+=T.byteLength(g)+2+1}d("subscribe: writing to stream: %o",g.SUBSCRIBE_HEADER),r.write(g.SUBSCRIBE_HEADER[1][s?1:0][0]),v(r,h),m(r,a),null!==l&&l.write();let u=!0;for(const e of c){const i=e.topic,o=e.qos,s=+e.nl,d=+e.rap,a=e.rh;let t;w(r,i),t=g.SUBSCRIBE_OPTIONS_QOS[o],5===n&&(t|=s?g.SUBSCRIBE_OPTIONS_NL:0,t|=d?g.SUBSCRIBE_OPTIONS_RAP:0,t|=a?g.SUBSCRIBE_OPTIONS_RH[a]:0),u=r.write(T.from([t]))}return u}(y,t,h);case"suback":return function(e,t){var r=t?t.protocolVersion:4,i=y||{},n=i.messageId,o=i.granted,i=i.properties;let s=0;if("number"!=typeof n)return e.emit("error",new Error("Invalid messageId")),!1;if(s+=2,"object"!=typeof o||!o.length)return e.emit("error",new Error("Invalid qos vector")),!1;for(let t=0;t<o.length;t+=1){if("number"!=typeof o[t])return e.emit("error",new Error("Invalid qos vector")),!1;s+=1}let a=null;if(5===r){if(!(a=_(e,i,t,s)))return!1;s+=a.length}return e.write(g.SUBACK_HEADER),v(e,s),m(e,n),null!==a&&a.write(),e.write(T.from(o))}(t,h);case"unsubscribe":return function(e){var t=h?h.protocolVersion:4,r=y||{},i=r.messageId,n=r.dup?g.DUP_MASK:0,o=r.unsubscriptions,r=r.properties;let s=0;if("number"!=typeof i)return e.emit("error",new Error("Invalid messageId")),!1;if(s+=2,"object"!=typeof o||!o.length)return e.emit("error",new Error("Invalid unsubscriptions")),!1;for(let t=0;t<o.length;t+=1){if("string"!=typeof o[t])return e.emit("error",new Error("Invalid unsubscriptions")),!1;s+=T.byteLength(o[t])+2}let a=null;if(5===t){if(!(a=S(e,r)))return!1;s+=a.length}e.write(g.UNSUBSCRIBE_HEADER[1][n?1:0][0]),v(e,s),m(e,i),null!==a&&a.write();let c=!0;for(let t=0;t<o.length;t++)c=w(e,o[t]);return c}(t);case"unsuback":return function(e,t){var r=t?t.protocolVersion:4,i=y||{},n=i.messageId,o=i.dup?g.DUP_MASK:0,s=i.granted,a=i.properties,i=i.cmd;let c=2;if("number"!=typeof n)return e.emit("error",new Error("Invalid messageId")),!1;if(5===r){if("object"!=typeof s||!s.length)return e.emit("error",new Error("Invalid qos vector")),!1;for(let t=0;t<s.length;t+=1){if("number"!=typeof s[t])return e.emit("error",new Error("Invalid qos vector")),!1;c+=1}}let h=null;if(5===r){if(!(h=_(e,a,t,c)))return!1;c+=h.length}return e.write(g.ACKS[i][0][o][0]),v(e,c),m(e,n),null!==h&&h.write(),5===r&&e.write(T.from(s)),!0}(t,h);case"pingreq":case"pingresp":return e=y,t.write(g.EMPTY[e.cmd]);case"disconnect":return function(t){var e=h?h.protocolVersion:4,r=y||{},i=r.reasonCode,r=r.properties;let n=5===e?1:0,o=null;if(5===e){if(!(o=_(t,r,h,n)))return!1;n+=o.length}return t.write(T.from([g.codes.disconnect<<4])),v(t,n),5===e&&t.write(T.from([i])),null!==o&&o.write(),!0}(t);case"auth":return function(t,e){var r=e?e.protocolVersion:4,i=y||{},n=i.reasonCode,o=i.properties,i=5===r?1:0;5!==r&&t.emit("error",new Error("Invalid mqtt version for auth packet"));const s=_(t,o,e,i);return!!s&&(i+=s.length,t.write(T.from([g.codes.auth<<4])),v(t,i),t.write(T.from([n])),null!==s&&s.write(),!0)}(t,h);default:return t.emit("error",new Error("Unknown command")),!1}var e}function p(t){t.uncork()}Object.defineProperty(e,"cacheNumbers",{get:()=>m===y,set(t){m=t?(i&&0!==Object.keys(i).length||(l=!0),y):(l=!1,b)}});const h={};function v(t,e){if(e>g.VARBYTEINT_MAX)return t.emit("error",new Error(`Invalid variable byte integer: ${e}`)),0;let r=h[e];return r||(r=c(e),e<16384&&(h[e]=r)),d("writeVarByteInt: writing to stream: %o",r),t.write(r)}function w(t,e){var r=T.byteLength(e);return m(t,r),d("writeString: %s",e),t.write(e,"utf8")}function f(t,e,r){w(t,e),w(t,r)}function y(t,e){return d("writeNumberCached: number: %d",e),d("writeNumberCached: %o",i[e]),t.write(i[e])}function b(t,e){e=n(e);return d("writeNumberGenerated: %o",e),t.write(e)}function x(t,e){"string"==typeof e?w(t,e):e?(m(t,e.length),t.write(e)):m(t,0)}function S(n,t){if("object"!=typeof t||null!=t.length)return{length:1,write(){I(n,{},0)}};let i=0;function o(t,i){let e=0;switch(g.propertiesTypes[t]){case"byte":if("boolean"!=typeof i)return n.emit("error",new Error(`Invalid ${t}: ${i}`)),!1;e+=2;break;case"int8":if("number"!=typeof i||i<0||255<i)return n.emit("error",new Error(`Invalid ${t}: ${i}`)),!1;e+=2;break;case"binary":if(i&&null===i)return n.emit("error",new Error(`Invalid ${t}: ${i}`)),!1;e+=1+T.byteLength(i)+2;break;case"int16":if("number"!=typeof i||i<0||65535<i)return n.emit("error",new Error(`Invalid ${t}: ${i}`)),!1;e+=3;break;case"int32":if("number"!=typeof i||i<0||4294967295<i)return n.emit("error",new Error(`Invalid ${t}: ${i}`)),!1;e+=5;break;case"var":if("number"!=typeof i||i<0||268435455<i)return n.emit("error",new Error(`Invalid ${t}: ${i}`)),!1;e+=1+T.byteLength(c(i));break;case"string":if("string"!=typeof i)return n.emit("error",new Error(`Invalid ${t}: ${i}`)),!1;e+=3+T.byteLength(i.toString());break;case"pair":if("object"!=typeof i)return n.emit("error",new Error(`Invalid ${t}: ${i}`)),!1;e+=Object.getOwnPropertyNames(i).reduce((t,r)=>{const e=i[r];return Array.isArray(e)?t+=e.reduce((t,e)=>t+=3+T.byteLength(r.toString())+2+T.byteLength(e.toString()),0):t+=3+T.byteLength(r.toString())+2+T.byteLength(i[r].toString()),t},0);break;default:return n.emit("error",new Error(`Invalid property ${t}: ${i}`)),!1}return e}if(t)for(const n in t){let e=0,r=0;var s=t[n];if(Array.isArray(s))for(let t=0;t<s.length;t++){if(!(r=o(n,s[t])))return!1;e+=r}else{if(!(r=o(n,s)))return!1;e=r}if(!e)return!1;i+=e}return{length:T.byteLength(c(i))+i,write(){I(n,t,i)}}}function _(t,e,r,i){const n=["reasonString","userProperties"],o=r&&r.properties&&r.properties.maximumPacketSize?r.properties.maximumPacketSize:0;let s=S(t,e);if(o)for(;i+s.length>o;){const r=n.shift();if(!r||!e[r])return!1;delete e[r],s=S(t,e)}return s}function k(r,i,n){switch(g.propertiesTypes[i]){case"byte":r.write(T.from([g.properties[i]])),r.write(T.from([+n]));break;case"int8":r.write(T.from([g.properties[i]])),r.write(T.from([n]));break;case"binary":r.write(T.from([g.properties[i]])),x(r,n);break;case"int16":r.write(T.from([g.properties[i]])),m(r,n);break;case"int32":r.write(T.from([g.properties[i]])),function(t,e){e=s(e);d("write4ByteNumber: %o",e),t.write(e)}(r,n);break;case"var":r.write(T.from([g.properties[i]])),v(r,n);break;case"string":r.write(T.from([g.properties[i]])),w(r,n);break;case"pair":Object.getOwnPropertyNames(n).forEach(e=>{const t=n[e];Array.isArray(t)?t.forEach(t=>{r.write(T.from([g.properties[i]])),f(r,e.toString(),t.toString())}):(r.write(T.from([g.properties[i]])),f(r,e.toString(),t.toString()))});break;default:return r.emit("error",new Error(`Invalid property ${i} value: ${n}`)),0}}function I(e,t,r){v(e,r);for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&null!==t[r]){var i=t[r];if(Array.isArray(i))for(let t=0;t<i.length;t++)k(e,r,i[t]);else k(e,r,i)}}function L(t){return t?t instanceof T?t.length:T.byteLength(t):0}function P(t){return"string"==typeof t||t instanceof T}R.exports=e}.call(this)}.call(this,C("buffer").Buffer)},{"./constants":22,"./numbers":25,buffer:14,debug:15,"process-nextick-args":31}],29:[function(t,e,r){var o=864e5;function s(t,e,r,i){e=1.5*r<=e;return Math.round(t/r)+" "+i+(e?"s":"")}e.exports=function(r,t){t=t||{};var e,i,n=typeof r;if("string"==n&&0<r.length)return function(t){if(!(100<(t=String(r)).length)){t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(t){var e=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*e;case"weeks":case"week":case"w":return 6048e5*e;case"days":case"day":case"d":return e*o;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*e;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*e;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return e;default:return}}}}(r);if("number"==n&&isFinite(r))return t.long?(e=r,i=Math.abs(e),o<=i?s(e,i,o,"day"):36e5<=i?s(e,i,36e5,"hour"):6e4<=i?s(e,i,6e4,"minute"):1e3<=i?s(e,i,1e3,"second"):e+" ms"):(i=r,e=Math.abs(i),o<=e?Math.round(i/o)+"d":36e5<=e?Math.round(i/36e5)+"h":6e4<=e?Math.round(i/6e4)+"m":1e3<=e?Math.round(i/1e3)+"s":i+"ms");throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))}},{}],30:[function(t,e,r){t=t("wrappy");function i(t){var e=function(){return e.called?e.value:(e.called=!0,e.value=t.apply(this,arguments))};return e.called=!1,e}function n(t){var e=function(){if(e.called)throw new Error(e.onceError);return e.called=!0,e.value=t.apply(this,arguments)},r=t.name||"Function wrapped with `once`";return e.onceError=r+" shouldn't be called more than once",e.called=!1,e}e.exports=t(i),e.exports.strict=t(n),i.proto=i(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return i(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return n(this)},configurable:!0})})},{wrappy:59}],31:[function(t,e,r){!function(a){!function(){"use strict";void 0===a||!a.version||0===a.version.indexOf("v0.")||0===a.version.indexOf("v1.")&&0!==a.version.indexOf("v1.8.")?e.exports={nextTick:function(t,e,r,i){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var n,o,s=arguments.length;switch(s){case 0:case 1:return a.nextTick(t);case 2:return a.nextTick(function(){t.call(null,e)});case 3:return a.nextTick(function(){t.call(null,e,r)});case 4:return a.nextTick(function(){t.call(null,e,r,i)});default:for(n=new Array(s-1),o=0;o<n.length;)n[o++]=arguments[o];return a.nextTick(function(){t.apply(null,n)})}}}:e.exports=a}.call(this)}.call(this,t("_process"))},{_process:32}],32:[function(t,e,r){var i,n,e=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(i===setTimeout)return setTimeout(e,0);if((i===o||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:o}catch(t){i=o}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(t){n=s}}();var c,h=[],l=!1,u=-1;function d(){l&&c&&(l=!1,c.length?h=c.concat(h):u=-1,h.length&&p())}function p(){if(!l){var t=a(d);l=!0;for(var e=h.length;e;){for(c=h,h=[];++u<e;)c&&c[u].run();u=-1,e=h.length}c=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function y(){}e.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];h.push(new f(t,e)),1!==h.length||l||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=y,e.addListener=y,e.once=y,e.off=y,e.removeListener=y,e.removeAllListeners=y,e.emit=y,e.prependListener=y,e.prependOnceListener=y,e.listeners=function(t){return[]},e.binding=function(t){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(t){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},{}],33:[function(t,T,C){!function(P){!function(){!function(t){var e="object"==typeof C&&C&&!C.nodeType&&C,r="object"==typeof T&&T&&!T.nodeType&&T,i="object"==typeof P&&P;i.global!==i&&i.window!==i&&i.self!==i||(t=i);var n,o,g=2147483647,m=36,v=26,s=38,a=700,c=/^xn--/,h=/[^\x20-\x7E]/,l=/[\x2E\u3002\uFF0E\uFF61]/g,u={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},d=m-1,w=Math.floor,b=String.fromCharCode;function x(t){throw new RangeError(u[t])}function p(t,e){for(var r=t.length,i=[];r--;)i[r]=e(t[r]);return i}function f(t,e){var r=t.split("@"),i="";return 1<r.length&&(i=r[0]+"@",t=r[1]),i+p((t=t.replace(l,".")).split("."),e).join(".")}function S(t){for(var e,r,i=[],n=0,o=t.length;n<o;)55296<=(e=t.charCodeAt(n++))&&e<=56319&&n<o?56320==(64512&(r=t.charCodeAt(n++)))?i.push(((1023&e)<<10)+(1023&r)+65536):(i.push(e),n--):i.push(e);return i}function y(t){return p(t,function(t){var e="";return 65535<t&&(e+=b((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+b(t)}).join("")}function _(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function k(t,e,r){var i=0;for(t=r?w(t/a):t>>1,t+=w(t/e);d*v>>1<t;i+=m)t=w(t/d);return w(i+(d+1)*t/(t+s))}function I(t){var e,r,i,n,o,s,a,c,h=[],l=t.length,u=0,d=128,p=72;for((r=t.lastIndexOf("-"))<0&&(r=0),i=0;i<r;++i)128<=t.charCodeAt(i)&&x("not-basic"),h.push(t.charCodeAt(i));for(n=0<r?r+1:0;n<l;){for(o=u,s=1,a=m;l<=n&&x("invalid-input"),((c=(c=t.charCodeAt(n++))-48<10?c-22:c-65<26?c-65:c-97<26?c-97:m)>=m||c>w((g-u)/s))&&x("overflow"),u+=c*s,!(c<(c=a<=p?1:p+v<=a?v:a-p));a+=m)s>w(g/(c=m-c))&&x("overflow"),s*=c;p=k(u-o,e=h.length+1,0==o),w(u/e)>g-d&&x("overflow"),d+=w(u/e),u%=e,h.splice(u++,0,d)}return y(h)}function L(t){for(var e,r,i,n,o,s,a,c,h,l=[],u=(t=S(t)).length,d=128,p=0,f=72,y=0;y<u;++y)(s=t[y])<128&&l.push(b(s));for(e=r=l.length,r&&l.push("-");e<u;){for(i=g,y=0;y<u;++y)(s=t[y])>=d&&s<i&&(i=s);for(i-d>w((g-p)/(a=e+1))&&x("overflow"),p+=(i-d)*a,d=i,y=0;y<u;++y)if((s=t[y])<d&&++p>g&&x("overflow"),s==d){for(n=p,o=m;!(n<(c=o<=f?1:f+v<=o?v:o-f));o+=m)l.push(b(_(c+(h=n-c)%(c=m-c),0))),n=w(h/c);l.push(b(_(n,0))),f=k(p,a,e==r),p=0,++e}++p,++d}return l.join("")}if(n={version:"1.4.1",ucs2:{decode:S,encode:y},decode:I,encode:L,toASCII:function(t){return f(t,function(t){return h.test(t)?"xn--"+L(t):t})},toUnicode:function(t){return f(t,function(t){return c.test(t)?I(t.slice(4).toLowerCase()):t})}},e&&r)if(T.exports==e)r.exports=n;else for(o in n)n.hasOwnProperty(o)&&(e[o]=n[o]);else t.punycode=n}(this)}.call(this)}.call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],34:[function(t,e,r){"use strict";e.exports=function(t,e,r,i){r=r||"=";var n={};if("string"!=typeof t||0===t.length)return n;var o=/\+/g;t=t.split(e=e||"&");e=1e3;i&&"number"==typeof i.maxKeys&&(e=i.maxKeys);var s=t.length;0<e&&e<s&&(s=e);for(var a=0;a<s;++a){var c,h=t[a].replace(o,"%20"),l=h.indexOf(r),l=0<=l?(c=h.substr(0,l),h.substr(l+1)):(c=h,""),h=decodeURIComponent(c),l=decodeURIComponent(l);Object.prototype.hasOwnProperty.call(n,h)?u(n[h])?n[h].push(l):n[h]=[n[h],l]:n[h]=l}return n};var u=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},{}],35:[function(t,e,r){"use strict";function o(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}}e.exports=function(r,i,n,t){return i=i||"&",n=n||"=","object"==typeof(r=null===r?void 0:r)?a(c(r),function(t){var e=encodeURIComponent(o(t))+n;return s(r[t])?a(r[t],function(t){return e+encodeURIComponent(o(t))}).join(i):e+encodeURIComponent(o(r[t]))}).join(i):t?encodeURIComponent(o(t))+n+encodeURIComponent(o(r)):""};var s=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function a(t,e){if(t.map)return t.map(e);for(var r=[],i=0;i<t.length;i++)r.push(e(t[i],i));return r}var c=Object.keys||function(t){var e,r=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&r.push(e);return r}},{}],36:[function(t,e,r){"use strict";r.decode=r.parse=t("./decode"),r.encode=r.stringify=t("./encode")},{"./decode":34,"./encode":35}],37:[function(t,e,r){"use strict";var a={};function i(t,i,e){e=e||Error;var n,r,o,o=(o=n=e,(r=s).prototype=Object.create(o.prototype),(r.prototype.constructor=r).__proto__=o,s);function s(t,e,r){return n.call(this,"string"==typeof i?i:i(t,e,r))||this}o.prototype.name=e.name,o.prototype.code=t,a[t]=o}function c(t,e){if(Array.isArray(t)){var r=t.length;return t=t.map(function(t){return String(t)}),2<r?"one of ".concat(e," ").concat(t.slice(0,r-1).join(", "),", or ")+t[r-1]:2===r?"one of ".concat(e," ").concat(t[0]," or ").concat(t[1]):"of ".concat(e," ").concat(t[0])}return"of ".concat(e," ").concat(String(t))}i("ERR_INVALID_OPT_VALUE",function(t,e){return'The value "'+e+'" is invalid for option "'+t+'"'},TypeError),i("ERR_INVALID_ARG_TYPE",function(t,e,r){var i,n,o,s;return"string"==typeof e&&"not "===e.substr(0,"not ".length)?(i="must not be",e=e.replace(/^not /,"")):i="must be",o=t,(void 0===s||s>o.length)&&(s=o.length),(" argument"===o.substring(s-" argument".length,s)?"The ".concat(t," ").concat(i," ").concat(c(e,"type")):(n=(n="number"!=typeof n?0:n)+".".length>(s=t).length||-1===s.indexOf(".",n)?"argument":"property",'The "'.concat(t,'" ').concat(n," ").concat(i," ").concat(c(e,"type"))))+". Received type ".concat(typeof r)},TypeError),i("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),i("ERR_METHOD_NOT_IMPLEMENTED",function(t){return"The "+t+" method is not implemented"}),i("ERR_STREAM_PREMATURE_CLOSE","Premature close"),i("ERR_STREAM_DESTROYED",function(t){return"Cannot call "+t+" after a stream was destroyed"}),i("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),i("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),i("ERR_STREAM_WRITE_AFTER_END","write after end"),i("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),i("ERR_UNKNOWN_ENCODING",function(t){return"Unknown encoding: "+t},TypeError),i("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.codes=a},{}],38:[function(l,u,t){!function(h){!function(){"use strict";var t=Object.keys||function(t){var e,r=[];for(e in t)r.push(e);return r};u.exports=s;var e=l("./_stream_readable"),r=l("./_stream_writable");l("inherits")(s,e);for(var i=t(r.prototype),n=0;n<i.length;n++){var o=i[n];s.prototype[o]||(s.prototype[o]=r.prototype[o])}function s(t){if(!(this instanceof s))return new s(t);e.call(this,t),r.call(this,t),this.allowHalfOpen=!0,t&&(!1===t.readable&&(this.readable=!1),!1===t.writable&&(this.writable=!1),!1===t.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",a)))}function a(){this._writableState.ended||h.nextTick(c,this)}function c(t){t.end()}Object.defineProperty(s.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(s.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(s.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(s.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}})}.call(this)}.call(this,l("_process"))},{"./_stream_readable":40,"./_stream_writable":42,_process:32,inherits:21}],39:[function(t,e,r){"use strict";e.exports=n;var i=t("./_stream_transform");function n(t){if(!(this instanceof n))return new n(t);i.call(this,t)}t("inherits")(n,i),n.prototype._transform=function(t,e,r){r(null,t)}},{"./_stream_transform":41,inherits:21}],40:[function(F,j,t){!function(B,D){!function(){"use strict";var i;(j.exports=b).ReadableState=w,F("events").EventEmitter;function y(t,e){return t.listeners(e).length}var n,t,r,o=F("./internal/streams/stream"),u=F("buffer").Buffer,d=D.Uint8Array||function(){},e=F("util"),g=e&&e.debuglog?e.debuglog("stream"):function(){},s=F("./internal/streams/buffer_list"),a=F("./internal/streams/destroy"),c=F("./internal/streams/state").getHighWaterMark,e=F("../errors").codes,p=e.ERR_INVALID_ARG_TYPE,f=e.ERR_STREAM_PUSH_AFTER_EOF,h=e.ERR_METHOD_NOT_IMPLEMENTED,m=e.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;F("inherits")(b,o);var v=a.errorOrDestroy,l=["error","close","destroy","pause","resume"];function w(t,e,r){i=i||F("./_stream_duplex"),"boolean"!=typeof r&&(r=e instanceof i),this.objectMode=!!(t=t||{}).objectMode,r&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=c(this,t,"readableHighWaterMark",r),this.buffer=new s,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(n=n||F("string_decoder/").StringDecoder,this.decoder=new n(t.encoding),this.encoding=t.encoding)}function b(t){if(i=i||F("./_stream_duplex"),!(this instanceof b))return new b(t);var e=this instanceof i;this._readableState=new w(t,this,e),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),o.call(this)}function x(t,e,r,i,n){g("readableAddChunk",e);var o,s,a,c,h,l=t._readableState;if(null===e)l.reading=!1,a=t,c=l,g("onEofChunk"),c.ended||(!c.decoder||(h=c.decoder.end())&&h.length&&(c.buffer.push(h),c.length+=c.objectMode?1:h.length),c.ended=!0,c.sync?k(a):(c.needReadable=!1,c.emittedReadable||(c.emittedReadable=!0,I(a))));else if(n||(a=l,n=o=e,o=s=u.isBuffer(n)||n instanceof d||"string"==typeof o||void 0===o||a.objectMode?s:new p("chunk",["string","Buffer","Uint8Array"],o)),o)v(t,o);else if(l.objectMode||e&&0<e.length)if("string"==typeof e||l.objectMode||Object.getPrototypeOf(e)===u.prototype||(o=e,e=u.from(o)),i)l.endEmitted?v(t,new m):S(t,l,e,!0);else if(l.ended)v(t,new f);else{if(l.destroyed)return!1;l.reading=!1,l.decoder&&!r?(e=l.decoder.write(e),l.objectMode||0!==e.length?S(t,l,e,!1):L(t,l)):S(t,l,e,!1)}else i||(l.reading=!1,L(t,l));return!l.ended&&(l.length<l.highWaterMark||0===l.length)}function S(t,e,r,i){e.flowing&&0===e.length&&!e.sync?(e.awaitDrain=0,t.emit("data",r)):(e.length+=e.objectMode?1:r.length,i?e.buffer.unshift(r):e.buffer.push(r),e.needReadable&&k(t)),L(t,e)}Object.defineProperty(b.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),b.prototype.destroy=a.destroy,b.prototype._undestroy=a.undestroy,b.prototype._destroy=function(t,e){e(t)},b.prototype.push=function(t,e){var r,i=this._readableState;return i.objectMode?r=!0:"string"==typeof t&&((e=e||i.defaultEncoding)!==i.encoding&&(t=u.from(t,e),e=""),r=!0),x(this,t,e,!1,r)},b.prototype.unshift=function(t){return x(this,t,null,!0,!1)},b.prototype.isPaused=function(){return!1===this._readableState.flowing},b.prototype.setEncoding=function(t){var e=new(n=n||F("string_decoder/").StringDecoder)(t);this._readableState.decoder=e,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,i="";null!==r;)i+=e.write(r.data),r=r.next;return this._readableState.buffer.clear(),""!==i&&this._readableState.buffer.push(i),this._readableState.length=i.length,this};function _(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?(e.flowing&&e.length?e.buffer.head.data:e).length:(t>e.highWaterMark&&(e.highWaterMark=(1073741824<=(r=t)?r=1073741824:(r--,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r++),r)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0));var r}function k(t){var e=t._readableState;g("emitReadable",e.needReadable,e.emittedReadable),e.needReadable=!1,e.emittedReadable||(g("emitReadable",e.flowing),e.emittedReadable=!0,B.nextTick(I,t))}function I(t){var e=t._readableState;g("emitReadable_",e.destroyed,e.length,e.ended),e.destroyed||!e.length&&!e.ended||(t.emit("readable"),e.emittedReadable=!1),e.needReadable=!e.flowing&&!e.ended&&e.length<=e.highWaterMark,A(t)}function L(t,e){e.readingMore||(e.readingMore=!0,B.nextTick(P,t,e))}function P(t,e){for(;!e.reading&&!e.ended&&(e.length<e.highWaterMark||e.flowing&&0===e.length);){var r=e.length;if(g("maybeReadMore read 0"),t.read(0),r===e.length)break}e.readingMore=!1}function T(t){var e=t._readableState;e.readableListening=0<t.listenerCount("readable"),e.resumeScheduled&&!e.paused?e.flowing=!0:0<t.listenerCount("data")&&t.resume()}function C(t){g("readable nexttick read 0"),t.read(0)}function R(t,e){g("resume",e.reading),e.reading||t.read(0),e.resumeScheduled=!1,t.emit("resume"),A(t),e.flowing&&!e.reading&&t.read(0)}function A(t){var e=t._readableState;for(g("flow",e.flowing);e.flowing&&null!==t.read(););}function E(t,e){return 0===e.length?null:(e.objectMode?r=e.buffer.shift():!t||t>=e.length?(r=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.first():e.buffer.concat(e.length),e.buffer.clear()):r=e.buffer.consume(t,e.decoder),r);var r}function N(t){var e=t._readableState;g("endReadable",e.endEmitted),e.endEmitted||(e.ended=!0,B.nextTick(M,e,t))}function M(t,e){g("endReadableNT",t.endEmitted,t.length),!t.endEmitted&&0===t.length&&(t.endEmitted=!0,e.readable=!1,e.emit("end"),t.autoDestroy)&&(!(t=e._writableState)||t.autoDestroy&&t.finished)&&e.destroy()}function O(t,e){for(var r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1}b.prototype.read=function(t){g("read",t),t=parseInt(t,10);var e=this._readableState,r=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&((0!==e.highWaterMark?e.length>=e.highWaterMark:0<e.length)||e.ended))return g("read: emitReadable",e.length,e.ended),(0===e.length&&e.ended?N:k)(this),null;if(0===(t=_(t,e))&&e.ended)return 0===e.length&&N(this),null;var i=e.needReadable;return g("need readable",i),(0===e.length||e.length-t<e.highWaterMark)&&g("length less than watermark",i=!0),e.ended||e.reading?g("reading or ended",i=!1):i&&(g("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=_(r,e))),null===(i=0<t?E(t,e):null)?(e.needReadable=e.length<=e.highWaterMark,t=0):(e.length-=t,e.awaitDrain=0),0===e.length&&(e.ended||(e.needReadable=!0),r!==t&&e.ended&&N(this)),null!==i&&this.emit("data",i),i},b.prototype._read=function(t){v(this,new h("_read()"))},b.prototype.pipe=function(i,t){var n=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=i;break;case 1:o.pipes=[o.pipes,i];break;default:o.pipes.push(i)}o.pipesCount+=1,g("pipe count=%d opts=%j",o.pipesCount,t);var e=t&&!1===t.end||i===B.stdout||i===B.stderr?f:s;function s(){g("onend"),i.end()}o.endEmitted?B.nextTick(e):n.once("end",e),i.on("unpipe",function t(e,r){g("onunpipe"),e===n&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,g("cleanup"),i.removeListener("close",d),i.removeListener("finish",p),i.removeListener("drain",a),i.removeListener("error",u),i.removeListener("unpipe",t),n.removeListener("end",s),n.removeListener("end",f),n.removeListener("data",l),h=!0,!o.awaitDrain||i._writableState&&!i._writableState.needDrain||a())});var r,a=(r=n,function(){var t=r._readableState;g("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&y(r,"data")&&(t.flowing=!0,A(r))});i.on("drain",a);var c,h=!1;function l(t){g("ondata");t=i.write(t);g("dest.write",t),!1===t&&((1===o.pipesCount&&o.pipes===i||1<o.pipesCount&&-1!==O(o.pipes,i))&&!h&&(g("false write response, pause",o.awaitDrain),o.awaitDrain++),n.pause())}function u(t){g("onerror",t),f(),i.removeListener("error",u),0===y(i,"error")&&v(i,t)}function d(){i.removeListener("finish",p),f()}function p(){g("onfinish"),i.removeListener("close",d),f()}function f(){g("unpipe"),n.unpipe(i)}return n.on("data",l),c="error",t=u,"function"==typeof(e=i).prependListener?e.prependListener(c,t):e._events&&e._events[c]?Array.isArray(e._events[c])?e._events[c].unshift(t):e._events[c]=[t,e._events[c]]:e.on(c,t),i.once("close",d),i.once("finish",p),i.emit("pipe",n),o.flowing||(g("pipe resume"),n.resume()),i},b.prototype.unpipe=function(t){var e=this._readableState,r={hasUnpiped:!1};if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes||(t=t||e.pipes,e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,r)),this;if(!t){var i=e.pipes,n=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var o=0;o<n;o++)i[o].emit("unpipe",this,{hasUnpiped:!1});return this}var s=O(e.pipes,t);return-1===s||(e.pipes.splice(s,1),--e.pipesCount,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,r)),this},b.prototype.on=function(t,e){var r=o.prototype.on.call(this,t,e),e=this._readableState;return"data"===t?(e.readableListening=0<this.listenerCount("readable"),!1!==e.flowing&&this.resume()):"readable"===t&&(e.endEmitted||e.readableListening||(e.readableListening=e.needReadable=!0,e.flowing=!1,e.emittedReadable=!1,g("on readable",e.length,e.reading),e.length?k(this):e.reading||B.nextTick(C,this))),r},b.prototype.addListener=b.prototype.on,b.prototype.removeListener=function(t,e){e=o.prototype.removeListener.call(this,t,e);return"readable"===t&&B.nextTick(T,this),e},b.prototype.removeAllListeners=function(t){var e=o.prototype.removeAllListeners.apply(this,arguments);return"readable"!==t&&void 0!==t||B.nextTick(T,this),e},b.prototype.resume=function(){var t,e,r=this._readableState;return r.flowing||(g("resume"),r.flowing=!r.readableListening,t=this,(e=r).resumeScheduled||(e.resumeScheduled=!0,B.nextTick(R,t,e))),r.paused=!1,this},b.prototype.pause=function(){return g("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(g("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},b.prototype.wrap=function(e){var t,r=this,i=this._readableState,n=!1;for(t in e.on("end",function(){var t;g("wrapped end"),i.decoder&&!i.ended&&(t=i.decoder.end())&&t.length&&r.push(t),r.push(null)}),e.on("data",function(t){g("wrapped data"),i.decoder&&(t=i.decoder.write(t)),i.objectMode&&null==t||!(i.objectMode||t&&t.length)||r.push(t)||(n=!0,e.pause())}),e)void 0===this[t]&&"function"==typeof e[t]&&(this[t]=function(t){return function(){return e[t].apply(e,arguments)}}(t));for(var o=0;o<l.length;o++)e.on(l[o],this.emit.bind(this,l[o]));return this._read=function(t){g("wrapped _read",t),n&&(n=!1,e.resume())},this},"function"==typeof Symbol&&(b.prototype[Symbol.asyncIterator]=function(){return(t=void 0===t?F("./internal/streams/async_iterator"):t)(this)}),Object.defineProperty(b.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(b.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(b.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(t){this._readableState&&(this._readableState.flowing=t)}}),b._fromList=E,Object.defineProperty(b.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(b.from=function(t,e){return(r=void 0===r?F("./internal/streams/from"):r)(b,t,e)})}.call(this)}.call(this,F("_process"),void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../errors":37,"./_stream_duplex":38,"./internal/streams/async_iterator":43,"./internal/streams/buffer_list":44,"./internal/streams/destroy":45,"./internal/streams/from":47,"./internal/streams/state":49,"./internal/streams/stream":50,_process:32,buffer:14,events:19,inherits:21,"string_decoder/":55,util:13}],41:[function(t,e,r){"use strict";e.exports=c;var e=t("../errors").codes,i=e.ERR_METHOD_NOT_IMPLEMENTED,n=e.ERR_MULTIPLE_CALLBACK,o=e.ERR_TRANSFORM_ALREADY_TRANSFORMING,s=e.ERR_TRANSFORM_WITH_LENGTH_0,a=t("./_stream_duplex");function c(t){if(!(this instanceof c))return new c(t);a.call(this,t),this._transformState={afterTransform:function(t,e){var r=this._transformState;r.transforming=!1;var i=r.writecb;if(null===i)return this.emit("error",new n);r.writechunk=null,(r.writecb=null)!=e&&this.push(e),i(t);t=this._readableState;t.reading=!1,(t.needReadable||t.length<t.highWaterMark)&&this._read(t.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",h)}function h(){var r=this;"function"!=typeof this._flush||this._readableState.destroyed?l(this,null,null):this._flush(function(t,e){l(r,t,e)})}function l(t,e,r){if(e)return t.emit("error",e);if(null!=r&&t.push(r),t._writableState.length)throw new s;if(t._transformState.transforming)throw new o;return t.push(null)}t("inherits")(c,a),c.prototype.push=function(t,e){return this._transformState.needTransform=!1,a.prototype.push.call(this,t,e)},c.prototype._transform=function(t,e,r){r(new i("_transform()"))},c.prototype._write=function(t,e,r){var i=this._transformState;i.writecb=r,i.writechunk=t,i.writeencoding=e,i.transforming||(e=this._readableState,(i.needTransform||e.needReadable||e.length<e.highWaterMark)&&this._read(e.highWaterMark))},c.prototype._read=function(t){var e=this._transformState;null===e.writechunk||e.transforming?e.needTransform=!0:(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform))},c.prototype._destroy=function(t,e){a.prototype._destroy.call(this,t,function(t){e(t)})}},{"../errors":37,"./_stream_duplex":38,inherits:21}],42:[function(R,A,t){!function(T,C){!function(){"use strict";function l(t){var e=this;this.next=null,this.entry=null,this.finish=function(){!function(t,e){var r=t.entry;for(t.entry=null;r;){var i=r.callback;e.pendingcb--,i(void 0),r=r.next}e.corkedRequestsFree.next=t}(e,t)}}var i;(A.exports=x).WritableState=b;var r,t={deprecate:R("util-deprecate")},n=R("./internal/streams/stream"),u=R("buffer").Buffer,d=C.Uint8Array||function(){},e=R("./internal/streams/destroy"),o=R("./internal/streams/state").getHighWaterMark,s=R("../errors").codes,p=s.ERR_INVALID_ARG_TYPE,a=s.ERR_METHOD_NOT_IMPLEMENTED,h=s.ERR_MULTIPLE_CALLBACK,c=s.ERR_STREAM_CANNOT_PIPE,f=s.ERR_STREAM_DESTROYED,y=s.ERR_STREAM_NULL_VALUES,g=s.ERR_STREAM_WRITE_AFTER_END,m=s.ERR_UNKNOWN_ENCODING,v=e.errorOrDestroy;function w(){}function b(t,e,r){i=i||R("./_stream_duplex"),"boolean"!=typeof r&&(r=e instanceof i),this.objectMode=!!(t=t||{}).objectMode,r&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=o(this,t,"writableHighWaterMark",r),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;r=(this.destroyed=!1)===t.decodeStrings;this.decodeStrings=!r,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function(t,e){var r,i,n,o,s=t._writableState,a=s.sync,c=s.writecb;if("function"!=typeof c)throw new h;(o=s).writing=!1,o.writecb=null,o.length-=o.writelen,o.writelen=0,e?(r=t,n=a,o=e,e=c,--(i=s).pendingcb,n?(T.nextTick(e,o),T.nextTick(P,r,i),r._writableState.errorEmitted=!0,v(r,o)):(e(o),r._writableState.errorEmitted=!0,v(r,o),P(r,i))):((i=I(s)||t.destroyed)||s.corked||s.bufferProcessing||!s.bufferedRequest||k(t,s),a?T.nextTick(_,t,s,i,c):_(t,s,i,c))}(e,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new l(this)}function x(t){var e=this instanceof(i=i||R("./_stream_duplex"));if(!e&&!r.call(x,this))return new x(t);this._writableState=new b(t,this,e),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),n.call(this)}function S(t,e,r,i,n,o,s){e.writelen=i,e.writecb=s,e.writing=!0,e.sync=!0,e.destroyed?e.onwrite(new f("write")):r?t._writev(n,e.onwrite):t._write(n,o,e.onwrite),e.sync=!1}function _(t,e,r,i){var n;r||(n=t,0===(r=e).length&&r.needDrain&&(r.needDrain=!1,n.emit("drain"))),e.pendingcb--,i(),P(t,e)}function k(t,e){e.bufferProcessing=!0;var r=e.bufferedRequest;if(t._writev&&r&&r.next){var i=e.bufferedRequestCount,n=new Array(i),i=e.corkedRequestsFree;i.entry=r;for(var o=0,s=!0;r;)(n[o]=r).isBuf||(s=!1),r=r.next,o+=1;n.allBuffers=s,S(t,e,!0,e.length,n,"",i.finish),e.pendingcb++,e.lastBufferedRequest=null,i.next?(e.corkedRequestsFree=i.next,i.next=null):e.corkedRequestsFree=new l(e),e.bufferedRequestCount=0}else{for(;r;){var a=r.chunk,c=r.encoding,h=r.callback;if(S(t,e,!1,e.objectMode?1:a.length,a,c,h),r=r.next,e.bufferedRequestCount--,e.writing)break}null===r&&(e.lastBufferedRequest=null)}e.bufferedRequest=r,e.bufferProcessing=!1}function I(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function L(e,r){e._final(function(t){r.pendingcb--,t&&v(e,t),r.prefinished=!0,e.emit("prefinish"),P(e,r)})}function P(t,e){var r,i,n=I(e);return n&&(r=t,(i=e).prefinished||i.finalCalled||("function"!=typeof r._final||i.destroyed?(i.prefinished=!0,r.emit("prefinish")):(i.pendingcb++,i.finalCalled=!0,T.nextTick(L,r,i))),0===e.pendingcb&&(e.finished=!0,t.emit("finish"),e.autoDestroy))&&((!(e=t._readableState)||e.autoDestroy&&e.endEmitted)&&t.destroy()),n}R("inherits")(x,n),b.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},function(){try{Object.defineProperty(b.prototype,"buffer",{get:t.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(r=Function.prototype[Symbol.hasInstance],Object.defineProperty(x,Symbol.hasInstance,{value:function(t){return!!r.call(this,t)||this===x&&t&&t._writableState instanceof b}})):r=function(t){return t instanceof this},x.prototype.pipe=function(){v(this,new c)},x.prototype.write=function(t,e,r){var i,n,o,s,a,c=this._writableState,h=!1,l=!c.objectMode&&(l=t,u.isBuffer(l)||l instanceof d);return l&&!u.isBuffer(t)&&(a=t,t=u.from(a)),"function"==typeof e&&(r=e,e=null),e=l?"buffer":e||c.defaultEncoding,"function"!=typeof r&&(r=w),c.ending?(n=this,o=r,s=new g,v(n,s),T.nextTick(o,s)):!l&&(a=this,n=c,o=r,null===(s=t)?i=new y:"string"==typeof s||n.objectMode||(i=new p("chunk",["string","Buffer"],s)),i&&(v(a,i),T.nextTick(o,i),!0))||(c.pendingcb++,h=function(t,e,r,i,n,o){r||(a=i,c=n,a=e.objectMode||!1===e.decodeStrings||"string"!=typeof a?a:u.from(a,c),i!==a&&(r=!0,n="buffer",i=a));var s=e.objectMode?1:i.length;e.length+=s;var a,c=e.length<e.highWaterMark;return c||(e.needDrain=!0),e.writing||e.corked?(a=e.lastBufferedRequest,e.lastBufferedRequest={chunk:i,encoding:n,isBuf:r,callback:o,next:null},a?a.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1):S(t,e,!1,s,i,n,o),c}(this,c,l,t,e,r)),h},x.prototype.cork=function(){this._writableState.corked++},x.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.bufferProcessing||!t.bufferedRequest||k(this,t))},x.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())))throw new m(t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(x.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(x.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),x.prototype._write=function(t,e,r){r(new a("_write()"))},x.prototype._writev=null,x.prototype.end=function(t,e,r){var i=this._writableState;return"function"==typeof t?(r=t,e=t=null):"function"==typeof e&&(r=e,e=null),null!=t&&this.write(t,e),i.corked&&(i.corked=1,this.uncork()),i.ending||(e=this,r=r,(i=i).ending=!0,P(e,i),r&&(i.finished?T.nextTick(r):e.once("finish",r)),i.ended=!0,e.writable=!1),this},Object.defineProperty(x.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(x.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),x.prototype.destroy=e.destroy,x.prototype._undestroy=e.undestroy,x.prototype._destroy=function(t,e){e(t)}}.call(this)}.call(this,R("_process"),void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../errors":37,"./_stream_duplex":38,"./internal/streams/destroy":45,"./internal/streams/state":49,"./internal/streams/stream":50,_process:32,buffer:14,inherits:21,"util-deprecate":58}],43:[function(i,g,t){!function(y){!function(){"use strict";var t;function r(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var n=i("./end-of-stream"),o=Symbol("lastResolve"),s=Symbol("lastReject"),a=Symbol("error"),c=Symbol("ended"),h=Symbol("lastPromise"),l=Symbol("handlePromise"),u=Symbol("stream");function d(t,e){return{value:t,done:e}}function p(t){var e,r=t[o];null===r||null!==(e=t[u].read())&&(t[h]=null,t[o]=null,t[s]=null,r(d(e,!1)))}var e=Object.getPrototypeOf(function(){}),f=Object.setPrototypeOf((r(t={get stream(){return this[u]},next:function(){var r=this,t=this[a];if(null!==t)return Promise.reject(t);if(this[c])return Promise.resolve(d(void 0,!0));if(this[u].destroyed)return new Promise(function(t,e){y.nextTick(function(){r[a]?e(r[a]):t(d(void 0,!0))})});var e,i,n,t=this[h];if(t)e=new Promise((i=t,n=this,function(t,e){i.then(function(){n[c]?t(d(void 0,!0)):n[l](t,e)},e)}));else{t=this[u].read();if(null!==t)return Promise.resolve(d(t,!1));e=new Promise(this[l])}return this[h]=e}},Symbol.asyncIterator,function(){return this}),r(t,"return",function(){var t=this;return new Promise(function(e,r){t[u].destroy(null,function(t){t?r(t):e(d(void 0,!0))})})}),t),e);g.exports=function(t){var e,i=Object.create(f,(r(e={},u,{value:t,writable:!0}),r(e,o,{value:null,writable:!0}),r(e,s,{value:null,writable:!0}),r(e,a,{value:null,writable:!0}),r(e,c,{value:t._readableState.endEmitted,writable:!0}),r(e,l,{value:function(t,e){var r=i[u].read();r?(i[h]=null,i[o]=null,i[s]=null,t(d(r,!1))):(i[o]=t,i[s]=e)},writable:!0}),e));return i[h]=null,n(t,function(t){if(t&&"ERR_STREAM_PREMATURE_CLOSE"!==t.code){var e=i[s];return null!==e&&(i[h]=null,i[o]=null,i[s]=null,e(t)),void(i[a]=t)}t=i[o];null!==t&&(i[h]=null,i[o]=null,t(d(void 0,!(i[s]=null)))),i[c]=!0}),t.on("readable",function(t){y.nextTick(p,t)}.bind(null,i)),i}}.call(this)}.call(this,i("_process"))},{"./end-of-stream":46,_process:32}],44:[function(t,e,r){"use strict";function o(e,t){var r,i=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)),i}function i(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var s=t("buffer").Buffer,n=t("util").inspect,t=n&&n.custom||"inspect";function a(){!function(t){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this),this.head=null,this.tail=null,this.length=0}e.exports=(t=[{key:"push",value:function(t){t={data:t,next:null};0<this.length?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(t){t={data:t,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(t){if(0===this.length)return"";for(var e=this.head,r=""+e.data;e=e.next;)r+=t+e.data;return r}},{key:"concat",value:function(t){if(0===this.length)return s.alloc(0);for(var e,r,i=s.allocUnsafe(t>>>0),n=this.head,o=0;n;)e=n.data,r=o,s.prototype.copy.call(e,i,r),o+=n.data.length,n=n.next;return i}},{key:"consume",value:function(t,e){var r;return t<this.head.data.length?(r=this.head.data.slice(0,t),this.head.data=this.head.data.slice(t)):r=t===this.head.data.length?this.shift():e?this._getString(t):this._getBuffer(t),r}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(t){var e=this.head,r=1,i=e.data;for(t-=i.length;e=e.next;){var n=e.data,o=t>n.length?n.length:t;if(o===n.length?i+=n:i+=n.slice(0,t),0==(t-=o)){o===n.length?(++r,e.next?this.head=e.next:this.head=this.tail=null):(this.head=e).data=n.slice(o);break}++r}return this.length-=r,i}},{key:"_getBuffer",value:function(t){var e=s.allocUnsafe(t),r=this.head,i=1;for(r.data.copy(e),t-=r.data.length;r=r.next;){var n=r.data,o=t>n.length?n.length:t;if(n.copy(e,e.length-t,0,o),0==(t-=o)){o===n.length?(++i,r.next?this.head=r.next:this.head=this.tail=null):(this.head=r).data=n.slice(o);break}++i}return this.length-=i,e}},{key:t,value:function(t,e){return n(this,function(i){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach(function(t){var e,r;e=i,t=n[r=t],r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(t){Object.defineProperty(i,t,Object.getOwnPropertyDescriptor(n,t))})}return i}({},e,{depth:0,customInspect:!1}))}}],i(a.prototype,t),a)},{buffer:14,util:13}],45:[function(t,e,r){!function(c){!function(){"use strict";function o(t,e){a(t,e),s(t)}function s(t){t._writableState&&!t._writableState.emitClose||t._readableState&&!t._readableState.emitClose||t.emit("close")}function a(t,e){t.emit("error",e)}e.exports={destroy:function(t,e){var r=this,i=this._readableState&&this._readableState.destroyed,n=this._writableState&&this._writableState.destroyed;return i||n?e?e(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,c.nextTick(a,this,t)):c.nextTick(a,this,t)):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(t){!e&&t?r._writableState?r._writableState.errorEmitted?c.nextTick(s,r):(r._writableState.errorEmitted=!0,c.nextTick(o,r,t)):c.nextTick(o,r,t):e?(c.nextTick(s,r),e(t)):c.nextTick(s,r)})),this},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(t,e){var r=t._readableState,i=t._writableState;r&&r.autoDestroy||i&&i.autoDestroy?t.destroy(e):t.emit("error",e)}}}.call(this)}.call(this,t("_process"))},{_process:32}],46:[function(t,e,r){"use strict";var g=t("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function m(){}e.exports=function t(e,r,i){if("function"==typeof r)return t(e,null,r);var n,o;n=i||m,o=!1,i=function(){if(!o){o=!0;for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];n.apply(this,e)}};function s(){e.writable||f()}function a(){y=!(u=!1),d||i.call(e)}function c(t){i.call(e,t)}function h(){var t;return u&&!y?(e._readableState&&e._readableState.ended||(t=new g),i.call(e,t)):d&&!p?(e._writableState&&e._writableState.ended||(t=new g),i.call(e,t)):void 0}function l(){e.req.on("finish",f)}var u=(r=r||{}).readable||!1!==r.readable&&e.readable,d=r.writable||!1!==r.writable&&e.writable,p=e._writableState&&e._writableState.finished,f=function(){p=!(d=!1),u||i.call(e)},y=e._readableState&&e._readableState.endEmitted;return e.setHeader&&"function"==typeof e.abort?(e.on("complete",f),e.on("abort",h),e.req?l():e.on("request",l)):d&&!e._writableState&&(e.on("end",s),e.on("close",s)),e.on("end",a),e.on("finish",f),!1!==r.error&&e.on("error",c),e.on("close",h),function(){e.removeListener("complete",f),e.removeListener("abort",h),e.removeListener("request",l),e.req&&e.req.removeListener("finish",f),e.removeListener("end",s),e.removeListener("close",s),e.removeListener("finish",f),e.removeListener("end",a),e.removeListener("error",c),e.removeListener("close",h)}}},{"../../../errors":37}],47:[function(t,e,r){e.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],48:[function(c,t,e){"use strict";var h,r=c("../../../errors").codes,a=r.ERR_MISSING_ARGS,l=r.ERR_STREAM_DESTROYED;function u(t){if(t)throw t}function d(t){t()}function p(t,e){return t.pipe(e)}t.exports=function(){for(var t=arguments.length,i=new Array(t),e=0;e<t;e++)i[e]=arguments[e];var n,r,o=!(r=i).length||"function"!=typeof r[r.length-1]?u:r.pop();if((i=Array.isArray(i[0])?i[0]:i).length<2)throw new a("streams");var s=i.map(function(t,e){var r=e<i.length-1;return function(e,t,r,i){var n,o;n=i,o=!1;var s=!(i=function(){o||(o=!0,n.apply(void 0,arguments))});e.on("close",function(){s=!0}),(h=void 0===h?c("./end-of-stream"):h)(e,{readable:t,writable:r},function(t){return t?i(t):(s=!0,void i())});var a=!1;return function(t){if(!s&&!a)return a=!0,e.setHeader&&"function"==typeof e.abort?e.abort():"function"==typeof e.destroy?e.destroy():void i(t||new l("pipe"))}}(t,r,0<e,function(t){n=n||t,t&&s.forEach(d),r||(s.forEach(d),o(n))})});return i.reduce(p)}},{"../../../errors":37,"./end-of-stream":46}],49:[function(t,e,r){"use strict";var n=t("../../../errors").codes.ERR_INVALID_OPT_VALUE;e.exports={getHighWaterMark:function(t,e,r,i){e=null!=e.highWaterMark?e.highWaterMark:i?e[r]:null;if(null==e)return t.objectMode?16:16384;if(!isFinite(e)||Math.floor(e)!==e||e<0)throw new n(i?r:"highWaterMark",e);return Math.floor(e)}}},{"../../../errors":37}],50:[function(t,e,r){e.exports=t("events").EventEmitter},{events:19}],51:[function(t,e,r){(((r=e.exports=t("./lib/_stream_readable.js")).Stream=r).Readable=r).Writable=t("./lib/_stream_writable.js"),r.Duplex=t("./lib/_stream_duplex.js"),r.Transform=t("./lib/_stream_transform.js"),r.PassThrough=t("./lib/_stream_passthrough.js"),r.finished=t("./lib/internal/streams/end-of-stream.js"),r.pipeline=t("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":38,"./lib/_stream_passthrough.js":39,"./lib/_stream_readable.js":40,"./lib/_stream_transform.js":41,"./lib/_stream_writable.js":42,"./lib/internal/streams/end-of-stream.js":46,"./lib/internal/streams/pipeline.js":48}],52:[function(t,e,r){"use strict";e.exports=function(){if("function"!=typeof arguments[0])throw new Error("callback needed");if("number"!=typeof arguments[1])throw new Error("interval needed");if(0<arguments.length)for(var t=new Array(arguments.length-2),e=0;e<t.length;e++)t[e]=arguments[e+2];return new function(t,e,r){var i=this;this._callback=t,this._args=r,this._interval=setInterval(t,e,this._args),this.reschedule=function(t){t=t||i._interval,i._interval&&clearInterval(i._interval),i._interval=setInterval(i._callback,t,i._args)},this.clear=function(){i._interval&&(clearInterval(i._interval),i._interval=void 0)},this.destroy=function(){i._interval&&clearInterval(i._interval),i._callback=void 0,i._interval=void 0,i._args=void 0}}(arguments[0],arguments[1],t)}},{}],53:[function(t,e,r){var i=t("buffer"),n=i.Buffer;function o(t,e){for(var r in t)e[r]=t[r]}function s(t,e,r){return n(t,e,r)}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?e.exports=i:(o(i,r),r.Buffer=s),s.prototype=Object.create(n.prototype),o(n,s),s.from=function(t,e,r){if("number"==typeof t)throw new TypeError("Argument must not be a number");return n(t,e,r)},s.alloc=function(t,e,r){if("number"!=typeof t)throw new TypeError("Argument must be a number");t=n(t);return void 0!==e?"string"==typeof r?t.fill(e,r):t.fill(e):t.fill(0),t},s.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n(t)},s.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return i.SlowBuffer(t)}},{buffer:14}],54:[function(t,e,r){e.exports=function(t){var e=t._readableState;return e?e.objectMode||"number"==typeof t._duplexState?t.read():t.read((e.buffer.length?e.buffer.head?e.buffer.head.data:e.buffer[0]:e).length):null}},{}],55:[function(t,e,r){"use strict";var i=t("safe-buffer").Buffer,n=i.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(t){var e;switch(this.encoding=function(t){var e=function(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}(t);if("string"!=typeof e&&(i.isEncoding===n||!n(t)))throw new Error("Unknown encoding: "+t);return e||t}(t),this.encoding){case"utf16le":this.text=c,this.end=h,e=4;break;case"utf8":this.fillLast=a,e=4;break;case"base64":this.text=l,this.end=u,e=3;break;default:return this.write=d,void(this.end=p)}this.lastNeed=0,this.lastTotal=0,this.lastChar=i.allocUnsafe(e)}function s(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:t>>6==2?-1:-2}function a(t){var e,r,i=this.lastTotal-this.lastNeed,e=(e=this,128!=(192&(r=t)[0])?(e.lastNeed=0,"�"):1<e.lastNeed&&1<r.length?128!=(192&r[1])?(e.lastNeed=1,"�"):2<e.lastNeed&&2<r.length&&128!=(192&r[2])?(e.lastNeed=2,"�"):void 0:void 0);return void 0!==e?e:this.lastNeed<=t.length?(t.copy(this.lastChar,i,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,i,0,t.length),void(this.lastNeed-=t.length))}function c(t,e){if((t.length-e)%2!=0)return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1);var r=t.toString("utf16le",e);if(r){e=r.charCodeAt(r.length-1);if(55296<=e&&e<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],r.slice(0,-1)}return r}function h(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){t=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,t)}return e}function l(t,e){var r=(t.length-e)%3;return 0==r?t.toString("base64",e):(this.lastNeed=3-r,this.lastTotal=3,1==r?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-r))}function u(t){t=t&&t.length?this.write(t):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function d(t){return t.toString(this.encoding)}function p(t){return t&&t.length?this.write(t):""}(r.StringDecoder=o).prototype.write=function(t){if(0===t.length)return"";var e,r;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<t.length?e?e+this.text(t,r):this.text(t,r):e||""},o.prototype.end=function(t){t=t&&t.length?this.write(t):"";return this.lastNeed?t+"�":t},o.prototype.text=function(t,e){var r=function(t,e,r){var i=e.length-1;if(i<r)return 0;var n=s(e[i]);return 0<=n?(0<n&&(t.lastNeed=n-1),n):--i<r||-2===n?0:0<=(n=s(e[i]))?(0<n&&(t.lastNeed=n-2),n):!(--i<r||-2===n)&&0<=(n=s(e[i]))?(0<n&&(2===n?n=0:t.lastNeed=n-3),n):0}(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=r;r=t.length-(r-this.lastNeed);return t.copy(this.lastChar,0,r),t.toString("utf8",e,r)},o.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},{"safe-buffer":53}],56:[function(t,e,r){"use strict";var L=t("punycode"),P=t("./util");function x(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}r.parse=n,r.resolve=function(t,e){return n(t,!1,!0).resolve(e)},r.resolveObject=function(t,e){return t?n(t,!1,!0).resolveObject(e):e},r.format=function(t){return(t=P.isString(t)?n(t):t)instanceof x?t.format():x.prototype.format.call(t)},r.Url=x;var T=/^([a-z0-9.+-]+:)/i,i=/:[0-9]*$/,C=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,r=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),R=["'"].concat(r),A=["%","/","?",";","#"].concat(R),E=["/","?","#"],N=/^[+a-z0-9A-Z_-]{0,63}$/,M=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,O={javascript:!0,"javascript:":!0},B={javascript:!0,"javascript:":!0},D={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},F=t("querystring");function n(t,e,r){if(t&&P.isObject(t)&&t instanceof x)return t;var i=new x;return i.parse(t,e,r),i}x.prototype.parse=function(t,e,r){if(!P.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var i=t.indexOf("?"),n=-1!==i&&i<t.indexOf("#")?"?":"#",i=t.split(n);i[0]=i[0].replace(/\\/g,"/");var o=(o=t=i.join(n)).trim();if(!r&&1===t.split("#").length){var s=C.exec(o);if(s)return this.path=o,this.href=o,this.pathname=s[1],s[2]?(this.search=s[2],this.query=e?F.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var a,s=T.exec(o);if(s&&(I=(s=s[0]).toLowerCase(),this.protocol=I,o=o.substr(s.length)),(r||s||o.match(/^\/\/[^@\/]+@[^@\/]+/))&&(!(a="//"===o.substr(0,2))||s&&B[s]||(o=o.substr(2),this.slashes=!0)),!B[s]&&(a||s&&!D[s])){for(var c,h=-1,l=0;l<E.length;l++)-1!==(c=o.indexOf(E[l]))&&(-1===h||c<h)&&(h=c);for(-1!==(x=-1===h?o.lastIndexOf("@"):o.lastIndexOf("@",h))&&(S=o.slice(0,x),o=o.slice(x+1),this.auth=decodeURIComponent(S)),h=-1,l=0;l<A.length;l++)-1!==(c=o.indexOf(A[l]))&&(-1===h||c<h)&&(h=c);-1===h&&(h=o.length),this.host=o.slice(0,h),o=o.slice(h),this.parseHost(),this.hostname=this.hostname||"";var u="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!u)for(var d=this.hostname.split(/\./),p=(l=0,d.length);l<p;l++){var f=d[l];if(f&&!f.match(N)){for(var y="",g=0,m=f.length;g<m;g++)127<f.charCodeAt(g)?y+="x":y+=f[g];if(!y.match(N)){var v=d.slice(0,l),w=d.slice(l+1),b=f.match(M);b&&(v.push(b[1]),w.unshift(b[2])),w.length&&(o="/"+w.join(".")+o),this.hostname=v.join(".");break}}}255<this.hostname.length?this.hostname="":this.hostname=this.hostname.toLowerCase(),u||(this.hostname=L.toASCII(this.hostname));var x=this.port?":"+this.port:"",S=this.hostname||"";this.host=S+x,this.href+=this.host,u&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==o[0]&&(o="/"+o))}if(!O[I])for(l=0,p=R.length;l<p;l++){var _,k=R[l];-1!==o.indexOf(k)&&((_=encodeURIComponent(k))===k&&(_=escape(k)),o=o.split(k).join(_))}u=o.indexOf("#");-1!==u&&(this.hash=o.substr(u),o=o.slice(0,u));var I,u=o.indexOf("?");return-1!==u?(this.search=o.substr(u),this.query=o.substr(u+1),e&&(this.query=F.parse(this.query)),o=o.slice(0,u)):e&&(this.search="",this.query={}),o&&(this.pathname=o),D[I]&&this.hostname&&!this.pathname&&(this.pathname="/"),(this.pathname||this.search)&&(x=this.pathname||"",I=this.search||"",this.path=x+I),this.href=this.format(),this},x.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",r=this.pathname||"",i=this.hash||"",n=!1,o="";this.host?n=t+this.host:this.hostname&&(n=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&P.isObject(this.query)&&Object.keys(this.query).length&&(o=F.stringify(this.query));o=this.search||o&&"?"+o||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||D[e])&&!1!==n?(n="//"+(n||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):n=n||"",i&&"#"!==i.charAt(0)&&(i="#"+i),o&&"?"!==o.charAt(0)&&(o="?"+o),e+n+(r=r.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(o=o.replace("#","%23"))+i},x.prototype.resolve=function(t){return this.resolveObject(n(t,!1,!0)).format()},x.prototype.resolveObject=function(t){P.isString(t)&&((p=new x).parse(t,!1,!0),t=p);for(var e=new x,r=Object.keys(this),i=0;i<r.length;i++){var n=r[i];e[n]=this[n]}if(e.hash=t.hash,""===t.href)return e.href=e.format(),e;if(t.slashes&&!t.protocol){for(var o=Object.keys(t),s=0;s<o.length;s++){var a=o[s];"protocol"!==a&&(e[a]=t[a])}return D[e.protocol]&&e.hostname&&!e.pathname&&(e.path=e.pathname="/"),e.href=e.format(),e}if(t.protocol&&t.protocol!==e.protocol){if(!D[t.protocol]){for(var c=Object.keys(t),h=0;h<c.length;h++){var l=c[h];e[l]=t[l]}return e.href=e.format(),e}if(e.protocol=t.protocol,t.host||B[t.protocol])e.pathname=t.pathname;else{for(var u=(t.pathname||"").split("/");u.length&&!(t.host=u.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==u[0]&&u.unshift(""),u.length<2&&u.unshift(""),e.pathname=u.join("/")}return e.search=t.search,e.query=t.query,e.host=t.host||"",e.auth=t.auth,e.hostname=t.hostname||t.host,e.port=t.port,(e.pathname||e.search)&&(f=e.pathname||"",y=e.search||"",e.path=f+y),e.slashes=e.slashes||t.slashes,e.href=e.format(),e}var d=e.pathname&&"/"===e.pathname.charAt(0),p=t.host||t.pathname&&"/"===t.pathname.charAt(0),f=p||d||e.host&&t.pathname,y=f,g=e.pathname&&e.pathname.split("/")||[],d=(u=t.pathname&&t.pathname.split("/")||[],e.protocol&&!D[e.protocol]);if(d&&(e.hostname="",e.port=null,e.host&&(""===g[0]?g[0]=e.host:g.unshift(e.host)),e.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===u[0]?u[0]=t.host:u.unshift(t.host)),t.host=null),f=f&&(""===u[0]||""===g[0])),p)e.host=(t.host||""===t.host?t:e).host,e.hostname=(t.hostname||""===t.hostname?t:e).hostname,e.search=t.search,e.query=t.query,g=u;else if(u.length)(g=g||[]).pop(),g=g.concat(u),e.search=t.search,e.query=t.query;else if(!P.isNullOrUndefined(t.search))return d&&(e.hostname=e.host=g.shift(),(b=!!(e.host&&0<e.host.indexOf("@"))&&e.host.split("@"))&&(e.auth=b.shift(),e.host=e.hostname=b.shift())),e.search=t.search,e.query=t.query,P.isNull(e.pathname)&&P.isNull(e.search)||(e.path=(e.pathname||"")+(e.search||"")),e.href=e.format(),e;if(!g.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var m=g.slice(-1)[0],p=(e.host||t.host||1<g.length)&&("."===m||".."===m)||""===m,v=0,w=g.length;0<=w;w--)"."===(m=g[w])?g.splice(w,1):".."===m?(g.splice(w,1),v++):v&&(g.splice(w,1),v--);if(!f&&!y)for(;v--;)g.unshift("..");!f||""===g[0]||g[0]&&"/"===g[0].charAt(0)||g.unshift(""),p&&"/"!==g.join("/").substr(-1)&&g.push("");var b,p=""===g[0]||g[0]&&"/"===g[0].charAt(0);return d&&(e.hostname=e.host=!p&&g.length?g.shift():"",(b=!!(e.host&&0<e.host.indexOf("@"))&&e.host.split("@"))&&(e.auth=b.shift(),e.host=e.hostname=b.shift())),(f=f||e.host&&g.length)&&!p&&g.unshift(""),g.length?e.pathname=g.join("/"):(e.pathname=null,e.path=null),P.isNull(e.pathname)&&P.isNull(e.search)||(e.path=(e.pathname||"")+(e.search||"")),e.auth=t.auth||e.auth,e.slashes=e.slashes||t.slashes,e.href=e.format(),e},x.prototype.parseHost=function(){var t=this.host,e=i.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},{"./util":57,punycode:33,querystring:36}],57:[function(t,e,r){"use strict";e.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},{}],58:[function(t,r,e){!function(e){!function(){function i(t){try{if(!e.localStorage)return}catch(t){return}t=e.localStorage[t];return null!=t&&"true"===String(t).toLowerCase()}r.exports=function(t,e){if(i("noDeprecation"))return t;var r=!1;return function(){if(!r){if(i("throwDeprecation"))throw new Error(e);i("traceDeprecation")?console.trace(e):console.warn(e),r=!0}return t.apply(this,arguments)}}}.call(this)}.call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],59:[function(t,e,r){e.exports=function t(n,e){if(n&&e)return t(n)(e);if("function"!=typeof n)throw new TypeError("need wrapper function");return Object.keys(n).forEach(function(t){r[t]=n[t]}),r;function r(){for(var t=new Array(arguments.length),e=0;e<t.length;e++)t[e]=arguments[e];var r=n.apply(this,t),i=t[t.length-1];return"function"==typeof r&&r!==i&&Object.keys(i).forEach(function(t){r[t]=i[t]}),r}}},{}],60:[function(t,e,r){"use strict";e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},{}],61:[function(t,e,r){e.exports=function(){for(var t={},e=0;e<arguments.length;e++){var r,i=arguments[e];for(r in i)n.call(i,r)&&(t[r]=i[r])}return t};var n=Object.prototype.hasOwnProperty},{}]},{},[9])(9)}.call(this,l(21))},,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,r){"use strict";r.r(e);r(199);function i(t,e){var r=e.rect.width*e.borderRadius,i=e.rect.height*e.borderRadius,i=r<i?r:i;e.rect.width<2*i&&(i=e.rect.width/2),e.rect.height<2*i&&(i=e.rect.height/2),t.beginPath(),t.moveTo(e.rect.x+i,e.rect.y),t.arcTo(e.rect.x+e.rect.width,e.rect.y,e.rect.x+e.rect.width,e.rect.y+e.rect.height,i),t.arcTo(e.rect.x+e.rect.width,e.rect.y+e.rect.height,e.rect.x,e.rect.y+e.rect.height,i),t.arcTo(e.rect.x,e.rect.y+e.rect.height,e.rect.x,e.rect.y,i),t.arcTo(e.rect.x,e.rect.y,e.rect.x+e.rect.width,e.rect.y,i),t.closePath(),t.moveTo(e.rect.x,e.rect.y+40),t.lineTo(e.rect.ex,e.rect.y+40),t.fill(),t.stroke()}function n(t,e){var r=e.rect.width*e.borderRadius,i=e.rect.height*e.borderRadius,i=r<i?r:i;e.rect.width<2*i&&(i=e.rect.width/2),e.rect.height<2*i&&(i=e.rect.height/2),t.beginPath(),t.moveTo(e.rect.x+i,e.rect.y),t.arcTo(e.rect.x+e.rect.width,e.rect.y,e.rect.x+e.rect.width,e.rect.y+e.rect.height,i),t.arcTo(e.rect.x+e.rect.width,e.rect.y+e.rect.height,e.rect.x,e.rect.y+e.rect.height,i),t.arcTo(e.rect.x,e.rect.y+e.rect.height,e.rect.x,e.rect.y,i),t.arcTo(e.rect.x,e.rect.y,e.rect.x+e.rect.width,e.rect.y,i),t.closePath(),t.moveTo(e.rect.x,e.rect.y+40),t.lineTo(e.rect.ex,e.rect.y+40);i=e.rect.y+20+e.rect.height/2;t.moveTo(e.rect.x,i),t.lineTo(e.rect.ex,i),t.fill(),t.stroke()}var o=r(1);function s(t){t.iconRect=new o.c(0,0,0,0)}function a(t){t.textRect=new o.c(t.rect.x,t.rect.y,t.rect.width,40),t.fullTextRect=t.textRect}function c(t){t.iconRect=new o.c(0,0,0,0)}function h(t){t.textRect=new o.c(t.rect.x,t.rect.y,t.rect.width,40),t.fullTextRect=t.textRect}function l(){Object(o.h)("simpleClass",i,null,s,a),Object(o.h)("interfaceClass",n,null,c,h)}r.d(e,"simpleClass",function(){return i}),r.d(e,"interfaceClass",function(){return n}),r.d(e,"simpleClassIconRect",function(){return s}),r.d(e,"simpleClassTextRect",function(){return a}),r.d(e,"interfaceClassIconRect",function(){return c}),r.d(e,"interfaceClassTextRect",function(){return h}),r.d(e,"register",function(){return l}),r.d(e,"Topology",function(){return o.d})},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,r){"use strict";function i(){return(65536*(1+Math.random())|0).toString(16).substring(1)}Object.defineProperty(e,"__esModule",{value:!0}),e.s4=i,e.s8=function(){return i()+i()}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=r(118),s=r(117),a=r(196),r=(h.prototype.get=function(t){return h.get(t,this.data)},h.prototype.set=function(t,e){h.set(t,e,this.data,this.observers)},h.prototype.updated=function(t){h.updated(t,this.data,this.observers)},h.prototype.subscribe=function(t,e){return h.subscribe(t,e,this.data,this.observers)},h.get=function(t,e){if(e=e||c.data,void 0===t)return e;for(var r=0,i=t.split(".");r<i.length;r++)if(void 0===(e=e[i[r]]))break;return e},h.set=function(t,e,r,i){r=r||c.data,i=i||c.observers;for(var n,o=t.split("."),s=r,a=0;a<o.length-1;++a)s[o[a]]||(s[o[a]]={}),s=s[o[a]];for(n in s[o[o.length-1]]=e,i)0===t.indexOf(i[n].key)&&i[n].fn(h.get(i[n].key,r))},h.updated=function(t,e,r){for(var i in r=r||c.observers)0===t.indexOf(r[i].key)&&r[i].fn(h.get(r[i].key,e))},h.subscribe=function(t,e,r,i){i=i||c.observers;var n=a.s8(),o=new s.Observer(n,t,e);i[n]=o;r=h.get(t,r);return void 0!==r&&e(r),o},h);function h(){this.data={},this.observers={}}e.Store=r},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.get=function(t){var t=new RegExp("(^| )"+t+"=([^;]*)(;|$)");return(t=document.cookie.match(t))?decodeURIComponent(t[2]):""},n.set=function(t,e,r){var i=window,e=i.escape(t)+"="+i.escape(e)+";";(r=r||{}).expires&&(e+="expires="+new Date((new Date).getTime()+1e3*r.expires*60*60*24).toUTCString()+";"),r.path&&(e+="path="+r.path+";"),r.domain&&(e+="domain="+r.domain+";"),document.cookie=e},n.delete=function(t,e){n.get(t)&&((e=e||{}).expires=-1,n.set(t,"",e))},n);function n(){}e.Cookie=i},function(t,e,r){var i=r(20),n=r(76),r=r(78);i({target:"Array",proto:!0},{fill:n}),r("fill")}]);
/* eslint-enable  */